<!DOCTYPE html>

<html>
<head>
  <title>js_includes_ng_chat.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="AJAXCompleter.html">
                  AJAXCompleter.js
                </a>
              
                
                <a class="source" href="AJAXEmailClientCompleter.html">
                  AJAXEmailClientCompleter.js
                </a>
              
                
                <a class="source" href="AJAXOtherCompleter.html">
                  AJAXOtherCompleter.js
                </a>
              
                
                <a class="source" href="AJAXReferenceChoice.html">
                  AJAXReferenceChoice.js
                </a>
              
                
                <a class="source" href="AJAXReferenceCompleter.html">
                  AJAXReferenceCompleter.js
                </a>
              
                
                <a class="source" href="AJAXReferenceCompleterMulti.html">
                  AJAXReferenceCompleterMulti.js
                </a>
              
                
                <a class="source" href="AJAXReferenceControls.html">
                  AJAXReferenceControls.js
                </a>
              
                
                <a class="source" href="AJAXTableCompleter.html">
                  AJAXTableCompleter.js
                </a>
              
                
                <a class="source" href="AngularBootstrapper.html">
                  AngularBootstrapper.js
                </a>
              
                
                <a class="source" href="AttachmentUploader.html">
                  AttachmentUploader.js
                </a>
              
                
                <a class="source" href="AutoComplete.html">
                  AutoComplete.js
                </a>
              
                
                <a class="source" href="BindWatch.html">
                  BindWatch.js
                </a>
              
                
                <a class="source" href="BoundsUtil2.html">
                  BoundsUtil2.js
                </a>
              
                
                <a class="source" href="CookieJar.html">
                  CookieJar.js
                </a>
              
                
                <a class="source" href="CustomEventManager.html">
                  CustomEventManager.js
                </a>
              
                
                <a class="source" href="DaysOfWeekElement.html">
                  DaysOfWeekElement.js
                </a>
              
                
                <a class="source" href="DerivedFields.html">
                  DerivedFields.js
                </a>
              
                
                <a class="source" href="Draggable2.html">
                  Draggable2.js
                </a>
              
                
                <a class="source" href="DropTarget2.html">
                  DropTarget2.js
                </a>
              
                
                <a class="source" href="FieldListElement.html">
                  FieldListElement.js
                </a>
              
                
                <a class="source" href="FormAdditionalOptionsMenu.html">
                  FormAdditionalOptionsMenu.js
                </a>
              
                
                <a class="source" href="GlideAPI1.html">
                  GlideAPI1.js
                </a>
              
                
                <a class="source" href="GlideAjax.html">
                  GlideAjax.js
                </a>
              
                
                <a class="source" href="GlideAjaxForm.html">
                  GlideAjaxForm.js
                </a>
              
                
                <a class="source" href="GlideBox.html">
                  GlideBox.js
                </a>
              
                
                <a class="source" href="GlideClientCache.html">
                  GlideClientCache.js
                </a>
              
                
                <a class="source" href="GlideDecoration.html">
                  GlideDecoration.js
                </a>
              
                
                <a class="source" href="GlideDialogForm.html">
                  GlideDialogForm.js
                </a>
              
                
                <a class="source" href="GlideDialogWindow.html">
                  GlideDialogWindow.js
                </a>
              
                
                <a class="source" href="GlideDraggable.html">
                  GlideDraggable.js
                </a>
              
                
                <a class="source" href="GlideDuration.html">
                  GlideDuration.js
                </a>
              
                
                <a class="source" href="GlideEvent.html">
                  GlideEvent.js
                </a>
              
                
                <a class="source" href="GlideEventHandler.html">
                  GlideEventHandler.js
                </a>
              
                
                <a class="source" href="GlideFilter14.html">
                  GlideFilter14.js
                </a>
              
                
                <a class="source" href="GlideFilterDate.html">
                  GlideFilterDate.js
                </a>
              
                
                <a class="source" href="GlideFilterDescription.html">
                  GlideFilterDescription.js
                </a>
              
                
                <a class="source" href="GlideFilterHandlers.html">
                  GlideFilterHandlers.js
                </a>
              
                
                <a class="source" href="GlideFilterItemVariables.html">
                  GlideFilterItemVariables.js
                </a>
              
                
                <a class="source" href="GlideFilterLabels.html">
                  GlideFilterLabels.js
                </a>
              
                
                <a class="source" href="GlideFilterQuestions.html">
                  GlideFilterQuestions.js
                </a>
              
                
                <a class="source" href="GlideFilterReference.html">
                  GlideFilterReference.js
                </a>
              
                
                <a class="source" href="GlideFilterReferenceMulti.html">
                  GlideFilterReferenceMulti.js
                </a>
              
                
                <a class="source" href="GlideFilterVariableMap.html">
                  GlideFilterVariableMap.js
                </a>
              
                
                <a class="source" href="GlideFilterVariables.html">
                  GlideFilterVariables.js
                </a>
              
                
                <a class="source" href="GlideForm14.html">
                  GlideForm14.js
                </a>
              
                
                <a class="source" href="GlideHeaderSearch.html">
                  GlideHeaderSearch.js
                </a>
              
                
                <a class="source" href="GlideList2.html">
                  GlideList2.js
                </a>
              
                
                <a class="source" href="GlideList2FilterUtil.html">
                  GlideList2FilterUtil.js
                </a>
              
                
                <a class="source" href="GlideList2Handlers.html">
                  GlideList2Handlers.js
                </a>
              
                
                <a class="source" href="GlideList2InitEvents.html">
                  GlideList2InitEvents.js
                </a>
              
                
                <a class="source" href="GlideList2Statics.html">
                  GlideList2Statics.js
                </a>
              
                
                <a class="source" href="GlideListAggregates.html">
                  GlideListAggregates.js
                </a>
              
                
                <a class="source" href="GlideListEditor.html">
                  GlideListEditor.js
                </a>
              
                
                <a class="source" href="GlideListEditorMessaging.html">
                  GlideListEditorMessaging.js
                </a>
              
                
                <a class="source" href="GlideListElement.html">
                  GlideListElement.js
                </a>
              
                
                <a class="source" href="GlideListWidget.html">
                  GlideListWidget.js
                </a>
              
                
                <a class="source" href="GlideListv3Compatibility.html">
                  GlideListv3Compatibility.js
                </a>
              
                
                <a class="source" href="GlideModal.html">
                  GlideModal.js
                </a>
              
                
                <a class="source" href="GlideModalForm.html">
                  GlideModalForm.js
                </a>
              
                
                <a class="source" href="GlideNavigation.html">
                  GlideNavigation.js
                </a>
              
                
                <a class="source" href="GlideOverlay.html">
                  GlideOverlay.js
                </a>
              
                
                <a class="source" href="GlidePane.html">
                  GlidePane.js
                </a>
              
                
                <a class="source" href="GlidePaneForm.html">
                  GlidePaneForm.js
                </a>
              
                
                <a class="source" href="GlideRecord.html">
                  GlideRecord.js
                </a>
              
                
                <a class="source" href="GlideTabs2.html">
                  GlideTabs2.js
                </a>
              
                
                <a class="source" href="GlideTabs2State.html">
                  GlideTabs2State.js
                </a>
              
                
                <a class="source" href="GlideTabs2Tab.html">
                  GlideTabs2Tab.js
                </a>
              
                
                <a class="source" href="GlideTimeElement.html">
                  GlideTimeElement.js
                </a>
              
                
                <a class="source" href="GlideTimerElement.html">
                  GlideTimerElement.js
                </a>
              
                
                <a class="source" href="GlideTransactionScope.html">
                  GlideTransactionScope.js
                </a>
              
                
                <a class="source" href="GlideUI.html">
                  GlideUI.js
                </a>
              
                
                <a class="source" href="GlideUIDefault.html">
                  GlideUIDefault.js
                </a>
              
                
                <a class="source" href="GlideUIElement.html">
                  GlideUIElement.js
                </a>
              
                
                <a class="source" href="GlideUINotification.html">
                  GlideUINotification.js
                </a>
              
                
                <a class="source" href="GlideURL.html">
                  GlideURL.js
                </a>
              
                
                <a class="source" href="GlideURLElement.html">
                  GlideURLElement.js
                </a>
              
                
                <a class="source" href="GlideUrlBuilder.html">
                  GlideUrlBuilder.js
                </a>
              
                
                <a class="source" href="GlideUser.html">
                  GlideUser.js
                </a>
              
                
                <a class="source" href="GlideUserImageElement.html">
                  GlideUserImageElement.js
                </a>
              
                
                <a class="source" href="GlideVideoPlayer.html">
                  GlideVideoPlayer.js
                </a>
              
                
                <a class="source" href="GlideWebAnalytics.html">
                  GlideWebAnalytics.js
                </a>
              
                
                <a class="source" href="GlideWidgetActions.html">
                  GlideWidgetActions.js
                </a>
              
                
                <a class="source" href="GlideWidgetFilter.html">
                  GlideWidgetFilter.js
                </a>
              
                
                <a class="source" href="GlideWidgetHideOnEmpty.html">
                  GlideWidgetHideOnEmpty.js
                </a>
              
                
                <a class="source" href="GlideWidgetSearch.html">
                  GlideWidgetSearch.js
                </a>
              
                
                <a class="source" href="GlideWidgetVCR.html">
                  GlideWidgetVCR.js
                </a>
              
                
                <a class="source" href="GlideWindow.html">
                  GlideWindow.js
                </a>
              
                
                <a class="source" href="GuidedTourElementTranslator.html">
                  GuidedTourElementTranslator.js
                </a>
              
                
                <a class="source" href="GwtCellEditor.html">
                  GwtCellEditor.js
                </a>
              
                
                <a class="source" href="GwtCellSelector.html">
                  GwtCellSelector.js
                </a>
              
                
                <a class="source" href="GwtContextMenu.html">
                  GwtContextMenu.js
                </a>
              
                
                <a class="source" href="GwtCursor.html">
                  GwtCursor.js
                </a>
              
                
                <a class="source" href="GwtDate.html">
                  GwtDate.js
                </a>
              
                
                <a class="source" href="GwtDraggable.html">
                  GwtDraggable.js
                </a>
              
                
                <a class="source" href="GwtDraggableSnap.html">
                  GwtDraggableSnap.js
                </a>
              
                
                <a class="source" href="GwtExportScheduleDialog.html">
                  GwtExportScheduleDialog.js
                </a>
              
                
                <a class="source" href="GwtGridEdit.html">
                  GwtGridEdit.js
                </a>
              
                
                <a class="source" href="GwtListEditAjaxChangeSaver.html">
                  GwtListEditAjaxChangeSaver.js
                </a>
              
                
                <a class="source" href="GwtListEditAjaxValueLoader.html">
                  GwtListEditAjaxValueLoader.js
                </a>
              
                
                <a class="source" href="GwtListEditBoolean.html">
                  GwtListEditBoolean.js
                </a>
              
                
                <a class="source" href="GwtListEditCalendar.html">
                  GwtListEditCalendar.js
                </a>
              
                
                <a class="source" href="GwtListEditDependent.html">
                  GwtListEditDependent.js
                </a>
              
                
                <a class="source" href="GwtListEditDuration.html">
                  GwtListEditDuration.js
                </a>
              
                
                <a class="source" href="GwtListEditEncryptedText.html">
                  GwtListEditEncryptedText.js
                </a>
              
                
                <a class="source" href="GwtListEditError.html">
                  GwtListEditError.js
                </a>
              
                
                <a class="source" href="GwtListEditGList.html">
                  GwtListEditGList.js
                </a>
              
                
                <a class="source" href="GwtListEditGlideRecord.html">
                  GwtListEditGlideRecord.js
                </a>
              
                
                <a class="source" href="GwtListEditGridSelector.html">
                  GwtListEditGridSelector.js
                </a>
              
                
                <a class="source" href="GwtListEditInternalType.html">
                  GwtListEditInternalType.js
                </a>
              
                
                <a class="source" href="GwtListEditJournal.html">
                  GwtListEditJournal.js
                </a>
              
                
                <a class="source" href="GwtListEditMultiText.html">
                  GwtListEditMultiText.js
                </a>
              
                
                <a class="source" href="GwtListEditPassword.html">
                  GwtListEditPassword.js
                </a>
              
                
                <a class="source" href="GwtListEditRecord.html">
                  GwtListEditRecord.js
                </a>
              
                
                <a class="source" href="GwtListEditRecordDecorations.html">
                  GwtListEditRecordDecorations.js
                </a>
              
                
                <a class="source" href="GwtListEditReference.html">
                  GwtListEditReference.js
                </a>
              
                
                <a class="source" href="GwtListEditRelatedTags.html">
                  GwtListEditRelatedTags.js
                </a>
              
                
                <a class="source" href="GwtListEditSavePolicy.html">
                  GwtListEditSavePolicy.js
                </a>
              
                
                <a class="source" href="GwtListEditSelect.html">
                  GwtListEditSelect.js
                </a>
              
                
                <a class="source" href="GwtListEditTableController.html">
                  GwtListEditTableController.js
                </a>
              
                
                <a class="source" href="GwtListEditTablename.html">
                  GwtListEditTablename.js
                </a>
              
                
                <a class="source" href="GwtListEditText.html">
                  GwtListEditText.js
                </a>
              
                
                <a class="source" href="GwtListEditTranslatedField.html">
                  GwtListEditTranslatedField.js
                </a>
              
                
                <a class="source" href="GwtListEditUpdateTablename.html">
                  GwtListEditUpdateTablename.js
                </a>
              
                
                <a class="source" href="GwtListEditValueRenderer.html">
                  GwtListEditValueRenderer.js
                </a>
              
                
                <a class="source" href="GwtListEditWindow.html">
                  GwtListEditWindow.js
                </a>
              
                
                <a class="source" href="GwtListEditor.html">
                  GwtListEditor.js
                </a>
              
                
                <a class="source" href="GwtListEditorPendingChanges.html">
                  GwtListEditorPendingChanges.js
                </a>
              
                
                <a class="source" href="GwtMessage14.html">
                  GwtMessage14.js
                </a>
              
                
                <a class="source" href="GwtObservable.html">
                  GwtObservable.js
                </a>
              
                
                <a class="source" href="GwtPollDialog.html">
                  GwtPollDialog.js
                </a>
              
                
                <a class="source" href="InPlaceEdit.html">
                  InPlaceEdit.js
                </a>
              
                
                <a class="source" href="KeyboardRegistry.html">
                  KeyboardRegistry.js
                </a>
              
                
                <a class="source" href="LAB.min.html">
                  LAB.min.js
                </a>
              
                
                <a class="source" href="ListDraggableRow2.html">
                  ListDraggableRow2.js
                </a>
              
                
                <a class="source" href="ListSelectManager2.html">
                  ListSelectManager2.js
                </a>
              
                
                <a class="source" href="ListSortDual2.html">
                  ListSortDual2.js
                </a>
              
                
                <a class="source" href="ListSortWindow2.html">
                  ListSortWindow2.js
                </a>
              
                
                <a class="source" href="NOW.messaging.html">
                  NOW.messaging.js
                </a>
              
                
                <a class="source" href="NOW.messaging.record.html">
                  NOW.messaging.record.js
                </a>
              
                
                <a class="source" href="NameMapEntry.html">
                  NameMapEntry.js
                </a>
              
                
                <a class="source" href="Notification.html">
                  Notification.js
                </a>
              
                
                <a class="source" href="NotificationMessage.html">
                  NotificationMessage.js
                </a>
              
                
                <a class="source" href="PageTiming14.html">
                  PageTiming14.js
                </a>
              
                
                <a class="source" href="PageTimingService.html">
                  PageTimingService.js
                </a>
              
                
                <a class="source" href="PersonalizeForm.html">
                  PersonalizeForm.js
                </a>
              
                
                <a class="source" href="Point.html">
                  Point.js
                </a>
              
                
                <a class="source" href="SLARepairClient.html">
                  SLARepairClient.js
                </a>
              
                
                <a class="source" href="ScriptLoader.html">
                  ScriptLoader.js
                </a>
              
                
                <a class="source" href="Select.html">
                  Select.js
                </a>
              
                
                <a class="source" href="SingletonKeyboardRegistry.html">
                  SingletonKeyboardRegistry.js
                </a>
              
                
                <a class="source" href="SlushBucket.html">
                  SlushBucket.js
                </a>
              
                
                <a class="source" href="SortDraggable2.html">
                  SortDraggable2.js
                </a>
              
                
                <a class="source" href="SortDropTarget2.html">
                  SortDropTarget2.js
                </a>
              
                
                <a class="source" href="SortListManager2.html">
                  SortListManager2.js
                </a>
              
                
                <a class="source" href="SortUtil2.html">
                  SortUtil2.js
                </a>
              
                
                <a class="source" href="StopWatch.html">
                  StopWatch.js
                </a>
              
                
                <a class="source" href="Table.html">
                  Table.js
                </a>
              
                
                <a class="source" href="TableElement.html">
                  TableElement.js
                </a>
              
                
                <a class="source" href="TableExtension.html">
                  TableExtension.js
                </a>
              
                
                <a class="source" href="TemplateRecord.html">
                  TemplateRecord.js
                </a>
              
                
                <a class="source" href="TextAreaElement.html">
                  TextAreaElement.js
                </a>
              
                
                <a class="source" href="UserRolesElement.html">
                  UserRolesElement.js
                </a>
              
                
                <a class="source" href="UtilityAndOverrides2.html">
                  UtilityAndOverrides2.js
                </a>
              
                
                <a class="source" href="_dragdrop.html">
                  _dragdrop.js
                </a>
              
                
                <a class="source" href="_module.heisenberg.html">
                  _module.heisenberg.js
                </a>
              
                
                <a class="source" href="_module.html">
                  _module.js
                </a>
              
                
                <a class="source" href="_ng_chat.html">
                  _ng_chat.js
                </a>
              
                
                <a class="source" href="_sn.dragdrop.html">
                  _sn.dragdrop.js
                </a>
              
                
                <a class="source" href="_util_includes.html">
                  _util_includes.js
                </a>
              
                
                <a class="source" href="ac.html">
                  ac.js
                </a>
              
                
                <a class="source" href="ac_derived_field_support.html">
                  ac_derived_field_support.js
                </a>
              
                
                <a class="source" href="accessibility.html">
                  accessibility.js
                </a>
              
                
                <a class="source" href="accessibility_readonly.html">
                  accessibility_readonly.js
                </a>
              
                
                <a class="source" href="accessibility_tabindex.html">
                  accessibility_tabindex.js
                </a>
              
                
                <a class="source" href="affix.html">
                  affix.js
                </a>
              
                
                <a class="source" href="alert.html">
                  alert.js
                </a>
              
                
                <a class="source" href="amb.Channel.html">
                  amb.Channel.js
                </a>
              
                
                <a class="source" href="amb.ChannelListener.html">
                  amb.ChannelListener.js
                </a>
              
                
                <a class="source" href="amb.ChannelRedirect.html">
                  amb.ChannelRedirect.js
                </a>
              
                
                <a class="source" href="amb.EventManager.html">
                  amb.EventManager.js
                </a>
              
                
                <a class="source" href="amb.Logger.html">
                  amb.Logger.js
                </a>
              
                
                <a class="source" href="amb.MessageClient.html">
                  amb.MessageClient.js
                </a>
              
                
                <a class="source" href="amb.MessageClientBuilder.html">
                  amb.MessageClientBuilder.js
                </a>
              
                
                <a class="source" href="amb.ServerConnection.html">
                  amb.ServerConnection.js
                </a>
              
                
                <a class="source" href="amb_properties.html">
                  amb_properties.js
                </a>
              
                
                <a class="source" href="angular-animate.html">
                  angular-animate.js
                </a>
              
                
                <a class="source" href="angular-animate.min.html">
                  angular-animate.min.js
                </a>
              
                
                <a class="source" href="angular-aria.html">
                  angular-aria.js
                </a>
              
                
                <a class="source" href="angular-aria.min.html">
                  angular-aria.min.js
                </a>
              
                
                <a class="source" href="angular-cookies.html">
                  angular-cookies.js
                </a>
              
                
                <a class="source" href="angular-cookies.min.html">
                  angular-cookies.min.js
                </a>
              
                
                <a class="source" href="angular-dragdrop.html">
                  angular-dragdrop.js
                </a>
              
                
                <a class="source" href="angular-file-upload-all.html">
                  angular-file-upload-all.js
                </a>
              
                
                <a class="source" href="angular-placeholder.min.html">
                  angular-placeholder.min.js
                </a>
              
                
                <a class="source" href="angular-resource.html">
                  angular-resource.js
                </a>
              
                
                <a class="source" href="angular-resource.min.html">
                  angular-resource.min.js
                </a>
              
                
                <a class="source" href="angular-route.html">
                  angular-route.js
                </a>
              
                
                <a class="source" href="angular-route.min.html">
                  angular-route.min.js
                </a>
              
                
                <a class="source" href="angular-sanitize.html">
                  angular-sanitize.js
                </a>
              
                
                <a class="source" href="angular-sanitize.min.html">
                  angular-sanitize.min.js
                </a>
              
                
                <a class="source" href="angular-tooltips.html">
                  angular-tooltips.js
                </a>
              
                
                <a class="source" href="angular-touch.html">
                  angular-touch.js
                </a>
              
                
                <a class="source" href="angular-touch.min.html">
                  angular-touch.min.js
                </a>
              
                
                <a class="source" href="angular-ui-tinymce.html">
                  angular-ui-tinymce.js
                </a>
              
                
                <a class="source" href="angular.html">
                  angular.js
                </a>
              
                
                <a class="source" href="angular.min.html">
                  angular.min.js
                </a>
              
                
                <a class="source" href="angular_includes_1.5.11.html">
                  angular_includes_1.5.11.js
                </a>
              
                
                <a class="source" href="angular_includes_no_min.1.5.11.html">
                  angular_includes_no_min.1.5.11.js
                </a>
              
                
                <a class="source" href="annotations_toggle.html">
                  annotations_toggle.js
                </a>
              
                
                <a class="source" href="app.$sp.html">
                  app.$sp.js
                </a>
              
                
                <a class="source" href="app.config.html">
                  app.config.js
                </a>
              
                
                <a class="source" href="app.form_presence.html">
                  app.form_presence.js
                </a>
              
                
                <a class="source" href="app.html">
                  app.js
                </a>
              
                
                <a class="source" href="app.ng.amb.html">
                  app.ng.amb.js
                </a>
              
                
                <a class="source" href="app.overviewhelp.html">
                  app.overviewhelp.js
                </a>
              
                
                <a class="source" href="appResourcesProvider.html">
                  appResourcesProvider.js
                </a>
              
                
                <a class="source" href="app_embedded_help.html">
                  app_embedded_help.js
                </a>
              
                
                <a class="source" href="aside.html">
                  aside.js
                </a>
              
                
                <a class="source" href="attachments.html">
                  attachments.js
                </a>
              
                
                <a class="source" href="auth.html">
                  auth.js
                </a>
              
                
                <a class="source" href="autosize-3.0.17.min.html">
                  autosize-3.0.17.min.js
                </a>
              
                
                <a class="source" href="batchedGlideAjax.html">
                  batchedGlideAjax.js
                </a>
              
                
                <a class="source" href="bootstrap-datetimepicker.html">
                  bootstrap-datetimepicker.js
                </a>
              
                
                <a class="source" href="bootstrap-iconpicker.html">
                  bootstrap-iconpicker.js
                </a>
              
                
                <a class="source" href="bootstrap_336.html">
                  bootstrap_336.js
                </a>
              
                
                <a class="source" href="button.html">
                  button.js
                </a>
              
                
                <a class="source" href="cabrillo.factory.html">
                  cabrillo.factory.js
                </a>
              
                
                <a class="source" href="calendar.html">
                  calendar.js
                </a>
              
                
                <a class="source" href="camera.html">
                  camera.js
                </a>
              
                
                <a class="source" href="carousel.html">
                  carousel.js
                </a>
              
                
                <a class="source" href="catalogDataLookup.html">
                  catalogDataLookup.js
                </a>
              
                
                <a class="source" href="catalogGlideFormFactory.html">
                  catalogGlideFormFactory.js
                </a>
              
                
                <a class="source" href="catalogItemFactory.html">
                  catalogItemFactory.js
                </a>
              
                
                <a class="source" href="clientScript_components.html">
                  clientScript_components.js
                </a>
              
                
                <a class="source" href="collapse.html">
                  collapse.js
                </a>
              
                
                <a class="source" href="cometd.html">
                  cometd.js
                </a>
              
                
                <a class="source" href="concourseNavigatorService.html">
                  concourseNavigatorService.js
                </a>
              
                
                <a class="source" href="concourse_framebuster.html">
                  concourse_framebuster.js
                </a>
              
                
                <a class="source" href="concourse_gjsv.html">
                  concourse_gjsv.js
                </a>
              
                
                <a class="source" href="condition14_new.html">
                  condition14_new.js
                </a>
              
                
                <a class="source" href="condition14_reporting.html">
                  condition14_reporting.js
                </a>
              
                
                <a class="source" href="condition14_templates.html">
                  condition14_templates.js
                </a>
              
                
                <a class="source" href="condition_global_variables14.html">
                  condition_global_variables14.js
                </a>
              
                
                <a class="source" href="config.bindWatch.html">
                  config.bindWatch.js
                </a>
              
                
                <a class="source" href="constant.spConf.html">
                  constant.spConf.js
                </a>
              
                
                <a class="source" href="constants_embedded_help.html">
                  constants_embedded_help.js
                </a>
              
                
                <a class="source" href="context_actions.html">
                  context_actions.js
                </a>
              
                
                <a class="source" href="controller.AMBRecordWatcher.html">
                  controller.AMBRecordWatcher.js
                </a>
              
                
                <a class="source" href="controller.MagellanCtrl.html">
                  controller.MagellanCtrl.js
                </a>
              
                
                <a class="source" href="controller.Stream.html">
                  controller.Stream.js
                </a>
              
                
                <a class="source" href="controller.chat.html">
                  controller.chat.js
                </a>
              
                
                <a class="source" href="controller.chatFloating.html">
                  controller.chatFloating.js
                </a>
              
                
                <a class="source" href="controller.elevateRoles.html">
                  controller.elevateRoles.js
                </a>
              
                
                <a class="source" href="controller.embeddedHelp.html">
                  controller.embeddedHelp.js
                </a>
              
                
                <a class="source" href="controller.formStream.html">
                  controller.formStream.js
                </a>
              
                
                <a class="source" href="controller.guidedTours.html">
                  controller.guidedTours.js
                </a>
              
                
                <a class="source" href="controller.impersonate.html">
                  controller.impersonate.js
                </a>
              
                
                <a class="source" href="controller.settings.html">
                  controller.settings.js
                </a>
              
                
                <a class="source" href="controller.snStream.html">
                  controller.snStream.js
                </a>
              
                
                <a class="source" href="controller.spLogin.html">
                  controller.spLogin.js
                </a>
              
                
                <a class="source" href="controller.spPage.html">
                  controller.spPage.js
                </a>
              
                
                <a class="source" href="controller.spWidgetDebug.html">
                  controller.spWidgetDebug.js
                </a>
              
                
                <a class="source" href="core.html">
                  core.js
                </a>
              
                
                <a class="source" href="dateTimeFormat.html">
                  dateTimeFormat.js
                </a>
              
                
                <a class="source" href="debug.html">
                  debug.js
                </a>
              
                
                <a class="source" href="debuggerTools.html">
                  debuggerTools.js
                </a>
              
                
                <a class="source" href="decorator.uiTinymce.html">
                  decorator.uiTinymce.js
                </a>
              
                
                <a class="source" href="deferred_related_lists.html">
                  deferred_related_lists.js
                </a>
              
                
                <a class="source" href="depends.html">
                  depends.js
                </a>
              
                
                <a class="source" href="deprecated.html">
                  deprecated.js
                </a>
              
                
                <a class="source" href="dimensions.html">
                  dimensions.js
                </a>
              
                
                <a class="source" href="directive.applicationPicker.html">
                  directive.applicationPicker.js
                </a>
              
                
                <a class="source" href="directive.concourseApplicationTree.html">
                  directive.concourseApplicationTree.js
                </a>
              
                
                <a class="source" href="directive.concourseMainPane.html">
                  directive.concourseMainPane.js
                </a>
              
                
                <a class="source" href="directive.connectConversationBarToggle.html">
                  directive.connectConversationBarToggle.js
                </a>
              
                
                <a class="source" href="directive.contenteditable.html">
                  directive.contenteditable.js
                </a>
              
                
                <a class="source" href="directive.domainPicker.html">
                  directive.domainPicker.js
                </a>
              
                
                <a class="source" href="directive.domainReferencePicker.html">
                  directive.domainReferencePicker.js
                </a>
              
                
                <a class="source" href="directive.elevateRoleIndicator.html">
                  directive.elevateRoleIndicator.js
                </a>
              
                
                <a class="source" href="directive.embeddedHelpBarToggle.html">
                  directive.embeddedHelpBarToggle.js
                </a>
              
                
                <a class="source" href="directive.enableAccessibility.html">
                  directive.enableAccessibility.js
                </a>
              
                
                <a class="source" href="directive.encryptionPicker.html">
                  directive.encryptionPicker.js
                </a>
              
                
                <a class="source" href="directive.formStreamEntry.html">
                  directive.formStreamEntry.js
                </a>
              
                
                <a class="source" href="directive.glideFormField.html">
                  directive.glideFormField.js
                </a>
              
                
                <a class="source" href="directive.glyph.html">
                  directive.glyph.js
                </a>
              
                
                <a class="source" href="directive.javascriptDebugger.html">
                  directive.javascriptDebugger.js
                </a>
              
                
                <a class="source" href="directive.liveIntroduction.html">
                  directive.liveIntroduction.js
                </a>
              
                
                <a class="source" href="directive.liveSearch.html">
                  directive.liveSearch.js
                </a>
              
                
                <a class="source" href="directive.liveSearchControl.html">
                  directive.liveSearchControl.js
                </a>
              
                
                <a class="source" href="directive.liveSearchPopover.html">
                  directive.liveSearchPopover.js
                </a>
              
                
                <a class="source" href="directive.magellanColorPicker.html">
                  directive.magellanColorPicker.js
                </a>
              
                
                <a class="source" href="directive.magellanEditFavorites.html">
                  directive.magellanEditFavorites.js
                </a>
              
                
                <a class="source" href="directive.magellanFavoritesList.html">
                  directive.magellanFavoritesList.js
                </a>
              
                
                <a class="source" href="directive.magellanHistoryCompact.html">
                  directive.magellanHistoryCompact.js
                </a>
              
                
                <a class="source" href="directive.magellanIconPicker.html">
                  directive.magellanIconPicker.js
                </a>
              
                
                <a class="source" href="directive.magellanNavigationFilter.html">
                  directive.magellanNavigationFilter.js
                </a>
              
                
                <a class="source" href="directive.mainPane.html">
                  directive.mainPane.js
                </a>
              
                
                <a class="source" href="directive.message.html">
                  directive.message.js
                </a>
              
                
                <a class="source" href="directive.navBannerLogo.html">
                  directive.navBannerLogo.js
                </a>
              
                
                <a class="source" href="directive.ngModelUpdateOnEnter.html">
                  directive.ngModelUpdateOnEnter.js
                </a>
              
                
                <a class="source" href="directive.nowAttachmentsList.html">
                  directive.nowAttachmentsList.js
                </a>
              
                
                <a class="source" href="directive.preferenceChanger.html">
                  directive.preferenceChanger.js
                </a>
              
                
                <a class="source" href="directive.preferencePicker.html">
                  directive.preferencePicker.js
                </a>
              
                
                <a class="source" href="directive.printerFriendly.html">
                  directive.printerFriendly.js
                </a>
              
                
                <a class="source" href="directive.recursiveHelper.html">
                  directive.recursiveHelper.js
                </a>
              
                
                <a class="source" href="directive.requestManager.html">
                  directive.requestManager.js
                </a>
              
                
                <a class="source" href="directive.scroll_form.html">
                  directive.scroll_form.js
                </a>
              
                
                <a class="source" href="directive.sn-draggable.html">
                  directive.sn-draggable.js
                </a>
              
                
                <a class="source" href="directive.sn-droptarget.html">
                  directive.sn-droptarget.js
                </a>
              
                
                <a class="source" href="directive.sn-sortable.html">
                  directive.sn-sortable.js
                </a>
              
                
                <a class="source" href="directive.snActions.html">
                  directive.snActions.js
                </a>
              
                
                <a class="source" href="directive.snActionsMenu.html">
                  directive.snActionsMenu.js
                </a>
              
                
                <a class="source" href="directive.snAriaChatMessage.html">
                  directive.snAriaChatMessage.js
                </a>
              
                
                <a class="source" href="directive.snAriaUnreadNotifications.html">
                  directive.snAriaUnreadNotifications.js
                </a>
              
                
                <a class="source" href="directive.snAside.html">
                  directive.snAside.js
                </a>
              
                
                <a class="source" href="directive.snAsideAttachments.html">
                  directive.snAsideAttachments.js
                </a>
              
                
                <a class="source" href="directive.snAsideContent.html">
                  directive.snAsideContent.js
                </a>
              
                
                <a class="source" href="directive.snAsideFrame.html">
                  directive.snAsideFrame.js
                </a>
              
                
                <a class="source" href="directive.snAsideInfo.html">
                  directive.snAsideInfo.js
                </a>
              
                
                <a class="source" href="directive.snAsideInfoItem.html">
                  directive.snAsideInfoItem.js
                </a>
              
                
                <a class="source" href="directive.snAsideInfoViewAllItem.html">
                  directive.snAsideInfoViewAllItem.js
                </a>
              
                
                <a class="source" href="directive.snAsideMemberList.html">
                  directive.snAsideMemberList.js
                </a>
              
                
                <a class="source" href="directive.snAsideNotificationItem.html">
                  directive.snAsideNotificationItem.js
                </a>
              
                
                <a class="source" href="directive.snAsideNotifications.html">
                  directive.snAsideNotifications.js
                </a>
              
                
                <a class="source" href="directive.snAttachmentList.html">
                  directive.snAttachmentList.js
                </a>
              
                
                <a class="source" href="directive.snAttachmentPreview.html">
                  directive.snAttachmentPreview.js
                </a>
              
                
                <a class="source" href="directive.snAutoScroll.html">
                  directive.snAutoScroll.js
                </a>
              
                
                <a class="source" href="directive.snAvatar.html">
                  directive.snAvatar.js
                </a>
              
                
                <a class="source" href="directive.snAvatarPopover.html">
                  directive.snAvatarPopover.js
                </a>
              
                
                <a class="source" href="directive.snBindI18n.html">
                  directive.snBindI18n.js
                </a>
              
                
                <a class="source" href="directive.snBindOnce.html">
                  directive.snBindOnce.js
                </a>
              
                
                <a class="source" href="directive.snBindPopoverSelection.html">
                  directive.snBindPopoverSelection.js
                </a>
              
                
                <a class="source" href="directive.snBlurOnEnter.html">
                  directive.snBlurOnEnter.js
                </a>
              
                
                <a class="source" href="directive.snBootstrapPopover.html">
                  directive.snBootstrapPopover.js
                </a>
              
                
                <a class="source" href="directive.snChatActionOptionsPopup.html">
                  directive.snChatActionOptionsPopup.js
                </a>
              
                
                <a class="source" href="directive.snChatTab.html">
                  directive.snChatTab.js
                </a>
              
                
                <a class="source" href="directive.snChoiceList.html">
                  directive.snChoiceList.js
                </a>
              
                
                <a class="source" href="directive.snClickToEdit.html">
                  directive.snClickToEdit.js
                </a>
              
                
                <a class="source" href="directive.snCloak.html">
                  directive.snCloak.js
                </a>
              
                
                <a class="source" href="directive.snComplexPopover.html">
                  directive.snComplexPopover.js
                </a>
              
                
                <a class="source" href="directive.snComposing.html">
                  directive.snComposing.js
                </a>
              
                
                <a class="source" href="directive.snConfirmModal.html">
                  directive.snConfirmModal.js
                </a>
              
                
                <a class="source" href="directive.snConnectContent.html">
                  directive.snConnectContent.js
                </a>
              
                
                <a class="source" href="directive.snConnectDuration.html">
                  directive.snConnectDuration.js
                </a>
              
                
                <a class="source" href="directive.snConnectHeader.html">
                  directive.snConnectHeader.js
                </a>
              
                
                <a class="source" href="directive.snContextMenu.html">
                  directive.snContextMenu.js
                </a>
              
                
                <a class="source" href="directive.snConversation.html">
                  directive.snConversation.js
                </a>
              
                
                <a class="source" href="directive.snConversationAddUserButton.html">
                  directive.snConversationAddUserButton.js
                </a>
              
                
                <a class="source" href="directive.snConversationContainer.html">
                  directive.snConversationContainer.js
                </a>
              
                
                <a class="source" href="directive.snConversationFooter.html">
                  directive.snConversationFooter.js
                </a>
              
                
                <a class="source" href="directive.snConversationHeader.html">
                  directive.snConversationHeader.js
                </a>
              
                
                <a class="source" href="directive.snConversationHeaderControls.html">
                  directive.snConversationHeaderControls.js
                </a>
              
                
                <a class="source" href="directive.snConversationItem.html">
                  directive.snConversationItem.js
                </a>
              
                
                <a class="source" href="directive.snConversationList.html">
                  directive.snConversationList.js
                </a>
              
                
                <a class="source" href="directive.snConversationListContainer.html">
                  directive.snConversationListContainer.js
                </a>
              
                
                <a class="source" href="directive.snConversationSearch.html">
                  directive.snConversationSearch.js
                </a>
              
                
                <a class="source" href="directive.snCreateMessage.html">
                  directive.snCreateMessage.js
                </a>
              
                
                <a class="source" href="directive.snCreateNewConversationHeader.html">
                  directive.snCreateNewConversationHeader.js
                </a>
              
                
                <a class="source" href="directive.snDayAgo.html">
                  directive.snDayAgo.js
                </a>
              
                
                <a class="source" href="directive.snDialog.html">
                  directive.snDialog.js
                </a>
              
                
                <a class="source" href="directive.snDragEventBlocker.html">
                  directive.snDragEventBlocker.js
                </a>
              
                
                <a class="source" href="directive.snDropTargetPopup.html">
                  directive.snDropTargetPopup.js
                </a>
              
                
                <a class="source" href="directive.snEmbeddedHelpActionList.html">
                  directive.snEmbeddedHelpActionList.js
                </a>
              
                
                <a class="source" href="directive.snEmbeddedHelpContent.html">
                  directive.snEmbeddedHelpContent.js
                </a>
              
                
                <a class="source" href="directive.snEmbeddedHelpMenu.html">
                  directive.snEmbeddedHelpMenu.js
                </a>
              
                
                <a class="source" href="directive.snEmbeddedHelpPane.html">
                  directive.snEmbeddedHelpPane.js
                </a>
              
                
                <a class="source" href="directive.snEscape.html">
                  directive.snEscape.js
                </a>
              
                
                <a class="source" href="directive.snExpandedEmail.html">
                  directive.snExpandedEmail.js
                </a>
              
                
                <a class="source" href="directive.snFieldReference.html">
                  directive.snFieldReference.js
                </a>
              
                
                <a class="source" href="directive.snFileUploadInput.html">
                  directive.snFileUploadInput.js
                </a>
              
                
                <a class="source" href="directive.snFloatingConversation.html">
                  directive.snFloatingConversation.js
                </a>
              
                
                <a class="source" href="directive.snFloatingConversationCompressed.html">
                  directive.snFloatingConversationCompressed.js
                </a>
              
                
                <a class="source" href="directive.snFloatingConversationContainer.html">
                  directive.snFloatingConversationContainer.js
                </a>
              
                
                <a class="source" href="directive.snFlyout.html">
                  directive.snFlyout.js
                </a>
              
                
                <a class="source" href="directive.snFocus.html">
                  directive.snFocus.js
                </a>
              
                
                <a class="source" href="directive.snFocusEsc.html">
                  directive.snFocusEsc.js
                </a>
              
                
                <a class="source" href="directive.snFocusOnConversation.html">
                  directive.snFocusOnConversation.js
                </a>
              
                
                <a class="source" href="directive.snGlyph.html">
                  directive.snGlyph.js
                </a>
              
                
                <a class="source" href="directive.snGroupAvatar.html">
                  directive.snGroupAvatar.js
                </a>
              
                
                <a class="source" href="directive.snImageUploader.html">
                  directive.snImageUploader.js
                </a>
              
                
                <a class="source" href="directive.snLinkCardList.html">
                  directive.snLinkCardList.js
                </a>
              
                
                <a class="source" href="directive.snLinkContent.html">
                  directive.snLinkContent.js
                </a>
              
                
                <a class="source" href="directive.snLinkContentArticle.html">
                  directive.snLinkContentArticle.js
                </a>
              
                
                <a class="source" href="directive.snLinkContentAttachment.html">
                  directive.snLinkContentAttachment.js
                </a>
              
                
                <a class="source" href="directive.snLinkContentError.html">
                  directive.snLinkContentError.js
                </a>
              
                
                <a class="source" href="directive.snLinkContentImage.html">
                  directive.snLinkContentImage.js
                </a>
              
                
                <a class="source" href="directive.snLinkContentRecord.html">
                  directive.snLinkContentRecord.js
                </a>
              
                
                <a class="source" href="directive.snLinkContentSoundcloud.html">
                  directive.snLinkContentSoundcloud.js
                </a>
              
                
                <a class="source" href="directive.snLinkContentYoutube.html">
                  directive.snLinkContentYoutube.js
                </a>
              
                
                <a class="source" href="directive.snLoadingBar.html">
                  directive.snLoadingBar.js
                </a>
              
                
                <a class="source" href="directive.snLoadingIndicator.html">
                  directive.snLoadingIndicator.js
                </a>
              
                
                <a class="source" href="directive.snMentionPopover.html">
                  directive.snMentionPopover.js
                </a>
              
                
                <a class="source" href="directive.snMessageBatch.html">
                  directive.snMessageBatch.js
                </a>
              
                
                <a class="source" href="directive.snModal.html">
                  directive.snModal.js
                </a>
              
                
                <a class="source" href="directive.snModalShow.html">
                  directive.snModalShow.js
                </a>
              
                
                <a class="source" href="directive.snNonAgentClose.html">
                  directive.snNonAgentClose.js
                </a>
              
                
                <a class="source" href="directive.snNotification.html">
                  directive.snNotification.js
                </a>
              
                
                <a class="source" href="directive.snOnload.html">
                  directive.snOnload.js
                </a>
              
                
                <a class="source" href="directive.snOptions.html">
                  directive.snOptions.js
                </a>
              
                
                <a class="source" href="directive.snPane.html">
                  directive.snPane.js
                </a>
              
                
                <a class="source" href="directive.snPaneManager.html">
                  directive.snPaneManager.js
                </a>
              
                
                <a class="source" href="directive.snPasteFileHandler.html">
                  directive.snPasteFileHandler.js
                </a>
              
                
                <a class="source" href="directive.snPod.html">
                  directive.snPod.js
                </a>
              
                
                <a class="source" href="directive.snPopOver.html">
                  directive.snPopOver.js
                </a>
              
                
                <a class="source" href="directive.snPopoverBasic.html">
                  directive.snPopoverBasic.js
                </a>
              
                
                <a class="source" href="directive.snPresence.html">
                  directive.snPresence.js
                </a>
              
                
                <a class="source" href="directive.snPulse.html">
                  directive.snPulse.js
                </a>
              
                
                <a class="source" href="directive.snQueueEntryClose.html">
                  directive.snQueueEntryClose.js
                </a>
              
                
                <a class="source" href="directive.snQueueEntryTransfer.html">
                  directive.snQueueEntryTransfer.js
                </a>
              
                
                <a class="source" href="directive.snQueueEntryTransferAccepted.html">
                  directive.snQueueEntryTransferAccepted.js
                </a>
              
                
                <a class="source" href="directive.snQueueItem.html">
                  directive.snQueueItem.js
                </a>
              
                
                <a class="source" href="directive.snQueueList.html">
                  directive.snQueueList.js
                </a>
              
                
                <a class="source" href="directive.snRecordPicker.html">
                  directive.snRecordPicker.js
                </a>
              
                
                <a class="source" href="directive.snReferencePicker.html">
                  directive.snReferencePicker.js
                </a>
              
                
                <a class="source" href="directive.snRepeatEventEmitter.html">
                  directive.snRepeatEventEmitter.js
                </a>
              
                
                <a class="source" href="directive.snResizeHeight.html">
                  directive.snResizeHeight.js
                </a>
              
                
                <a class="source" href="directive.snSearchButton.html">
                  directive.snSearchButton.js
                </a>
              
                
                <a class="source" href="directive.snSelectBasic.html">
                  directive.snSelectBasic.js
                </a>
              
                
                <a class="source" href="directive.snStickyHeaders.html">
                  directive.snStickyHeaders.js
                </a>
              
                
                <a class="source" href="directive.snStream.html">
                  directive.snStream.js
                </a>
              
                
                <a class="source" href="directive.snSupportConversationItem.html">
                  directive.snSupportConversationItem.js
                </a>
              
                
                <a class="source" href="directive.snSupportTab.html">
                  directive.snSupportTab.js
                </a>
              
                
                <a class="source" href="directive.snSyncWith.html">
                  directive.snSyncWith.js
                </a>
              
                
                <a class="source" href="directive.snTableReference.html">
                  directive.snTableReference.js
                </a>
              
                
                <a class="source" href="directive.snTabs.html">
                  directive.snTabs.js
                </a>
              
                
                <a class="source" href="directive.snTabsBasic.html">
                  directive.snTabsBasic.js
                </a>
              
                
                <a class="source" href="directive.snTextExpander.html">
                  directive.snTextExpander.js
                </a>
              
                
                <a class="source" href="directive.snTimeAgo.html">
                  directive.snTimeAgo.js
                </a>
              
                
                <a class="source" href="directive.snTooltipBasic.html">
                  directive.snTooltipBasic.js
                </a>
              
                
                <a class="source" href="directive.snTriggerOverviewHelp.html">
                  directive.snTriggerOverviewHelp.js
                </a>
              
                
                <a class="source" href="directive.snUploadAttachmentList.html">
                  directive.snUploadAttachmentList.js
                </a>
              
                
                <a class="source" href="directive.snUserAvatar.html">
                  directive.snUserAvatar.js
                </a>
              
                
                <a class="source" href="directive.snUserProfile.html">
                  directive.snUserProfile.js
                </a>
              
                
                <a class="source" href="directive.snVideoPlayer.html">
                  directive.snVideoPlayer.js
                </a>
              
                
                <a class="source" href="directive.spAriaPageTitle.html">
                  directive.spAriaPageTitle.js
                </a>
              
                
                <a class="source" href="directive.spAttachmentButton.html">
                  directive.spAttachmentButton.js
                </a>
              
                
                <a class="source" href="directive.spCLink.html">
                  directive.spCLink.js
                </a>
              
                
                <a class="source" href="directive.spCatItem.html">
                  directive.spCatItem.js
                </a>
              
                
                <a class="source" href="directive.spChoiceList.html">
                  directive.spChoiceList.js
                </a>
              
                
                <a class="source" href="directive.spCodeMirror.html">
                  directive.spCodeMirror.js
                </a>
              
                
                <a class="source" href="directive.spColorPicker.html">
                  directive.spColorPicker.js
                </a>
              
                
                <a class="source" href="directive.spContextMenu.html">
                  directive.spContextMenu.js
                </a>
              
                
                <a class="source" href="directive.spCssEditor.html">
                  directive.spCssEditor.js
                </a>
              
                
                <a class="source" href="directive.spCurrencyElement.html">
                  directive.spCurrencyElement.js
                </a>
              
                
                <a class="source" href="directive.spDatePicker.html">
                  directive.spDatePicker.js
                </a>
              
                
                <a class="source" href="directive.spDropdownTree.html">
                  directive.spDropdownTree.js
                </a>
              
                
                <a class="source" href="directive.spDurationElement.html">
                  directive.spDurationElement.js
                </a>
              
                
                <a class="source" href="directive.spEditableField.html">
                  directive.spEditableField.js
                </a>
              
                
                <a class="source" href="directive.spEmailElement.html">
                  directive.spEmailElement.js
                </a>
              
                
                <a class="source" href="directive.spFieldListElement.html">
                  directive.spFieldListElement.js
                </a>
              
                
                <a class="source" href="directive.spFormField.html">
                  directive.spFormField.js
                </a>
              
                
                <a class="source" href="directive.spGlyphPicker.html">
                  directive.spGlyphPicker.js
                </a>
              
                
                <a class="source" href="directive.spHTMLEditor.html">
                  directive.spHTMLEditor.js
                </a>
              
                
                <a class="source" href="directive.spHtmlContent.html">
                  directive.spHtmlContent.js
                </a>
              
                
                <a class="source" href="directive.spMessageDialog.html">
                  directive.spMessageDialog.js
                </a>
              
                
                <a class="source" href="directive.spModel.html">
                  directive.spModel.js
                </a>
              
                
                <a class="source" href="directive.spNavbarToggle.html">
                  directive.spNavbarToggle.js
                </a>
              
                
                <a class="source" href="directive.spNotifications.html">
                  directive.spNotifications.js
                </a>
              
                
                <a class="source" href="directive.spOnTransition.html">
                  directive.spOnTransition.js
                </a>
              
                
                <a class="source" href="directive.spPageRow.html">
                  directive.spPageRow.js
                </a>
              
                
                <a class="source" href="directive.spPanel.html">
                  directive.spPanel.js
                </a>
              
                
                <a class="source" href="directive.spReferenceElement.html">
                  directive.spReferenceElement.js
                </a>
              
                
                <a class="source" href="directive.spReferenceField.html">
                  directive.spReferenceField.js
                </a>
              
                
                <a class="source" href="directive.spScriptEditor.html">
                  directive.spScriptEditor.js
                </a>
              
                
                <a class="source" href="directive.spScroll.html">
                  directive.spScroll.js
                </a>
              
                
                <a class="source" href="directive.spTextarea.html">
                  directive.spTextarea.js
                </a>
              
                
                <a class="source" href="directive.spTinymceEditor.html">
                  directive.spTinymceEditor.js
                </a>
              
                
                <a class="source" href="directive.spWidget.html">
                  directive.spWidget.js
                </a>
              
                
                <a class="source" href="directive.themePicker.html">
                  directive.themePicker.js
                </a>
              
                
                <a class="source" href="directive.updateSetPicker.html">
                  directive.updateSetPicker.js
                </a>
              
                
                <a class="source" href="dropdown.html">
                  dropdown.js
                </a>
              
                
                <a class="source" href="dropdowns.html">
                  dropdowns.js
                </a>
              
                
                <a class="source" href="email_activity.html">
                  email_activity.js
                </a>
              
                
                <a class="source" href="event_initialize.html">
                  event_initialize.js
                </a>
              
                
                <a class="source" href="export-csv.html">
                  export-csv.js
                </a>
              
                
                <a class="source" href="exporting.html">
                  exporting.js
                </a>
              
                
                <a class="source" href="factory.AMBOverlay.html">
                  factory.AMBOverlay.js
                </a>
              
                
                <a class="source" href="factory.ArraySynchronizer.html">
                  factory.ArraySynchronizer.js
                </a>
              
                
                <a class="source" href="factory.Conversation.html">
                  factory.Conversation.js
                </a>
              
                
                <a class="source" href="factory.Document.html">
                  factory.Document.js
                </a>
              
                
                <a class="source" href="factory.LiveLink.html">
                  factory.LiveLink.js
                </a>
              
                
                <a class="source" href="factory.Message.html">
                  factory.Message.js
                </a>
              
                
                <a class="source" href="factory.attachment.html">
                  factory.attachment.js
                </a>
              
                
                <a class="source" href="factory.commandFactory.html">
                  factory.commandFactory.js
                </a>
              
                
                <a class="source" href="factory.glideUrlBuilder.html">
                  factory.glideUrlBuilder.js
                </a>
              
                
                <a class="source" href="factory.keyboardRegistry.html">
                  factory.keyboardRegistry.js
                </a>
              
                
                <a class="source" href="factory.magellan_Endpoint.html">
                  factory.magellan_Endpoint.js
                </a>
              
                
                <a class="source" href="factory.magellan_FavoritesList.html">
                  factory.magellan_FavoritesList.js
                </a>
              
                
                <a class="source" href="factory.magellan_HistoryList.html">
                  factory.magellan_HistoryList.js
                </a>
              
                
                <a class="source" href="factory.magellan_Permalink.html">
                  factory.magellan_Permalink.js
                </a>
              
                
                <a class="source" href="factory.notificationWrapper.html">
                  factory.notificationWrapper.js
                </a>
              
                
                <a class="source" href="factory.nowAttachmentHandler.html">
                  factory.nowAttachmentHandler.js
                </a>
              
                
                <a class="source" href="factory.paneManager.html">
                  factory.paneManager.js
                </a>
              
                
                <a class="source" href="factory.queue.html">
                  factory.queue.js
                </a>
              
                
                <a class="source" href="factory.queueEntry.html">
                  factory.queueEntry.js
                </a>
              
                
                <a class="source" href="factory.snAttachmentHandler.html">
                  factory.snAttachmentHandler.js
                </a>
              
                
                <a class="source" href="factory.snChatAction.html">
                  factory.snChatAction.js
                </a>
              
                
                <a class="source" href="factory.snHotKey.html">
                  factory.snHotKey.js
                </a>
              
                
                <a class="source" href="factory.snPresence.html">
                  factory.snPresence.js
                </a>
              
                
                <a class="source" href="factory.snRecordPresence.html">
                  factory.snRecordPresence.js
                </a>
              
                
                <a class="source" href="factory.snRecordWatcher.html">
                  factory.snRecordWatcher.js
                </a>
              
                
                <a class="source" href="factory.spInterceptor.html">
                  factory.spInterceptor.js
                </a>
              
                
                <a class="source" href="factory.spMacro.html">
                  factory.spMacro.js
                </a>
              
                
                <a class="source" href="factory.spPage.html">
                  factory.spPage.js
                </a>
              
                
                <a class="source" href="factory.spServer.html">
                  factory.spServer.js
                </a>
              
                
                <a class="source" href="factory.spUIActionFactory.html">
                  factory.spUIActionFactory.js
                </a>
              
                
                <a class="source" href="factory.spWidget.html">
                  factory.spWidget.js
                </a>
              
                
                <a class="source" href="factory.unwrappedHTTPPromise.html">
                  factory.unwrappedHTTPPromise.js
                </a>
              
                
                <a class="source" href="filter.conversation.html">
                  filter.conversation.js
                </a>
              
                
                <a class="source" href="filter.frameSet.html">
                  filter.frameSet.js
                </a>
              
                
                <a class="source" href="filter.searchTerm.html">
                  filter.searchTerm.js
                </a>
              
                
                <a class="source" href="filter.transferAccepted.html">
                  filter.transferAccepted.js
                </a>
              
                
                <a class="source" href="filter.truncate.html">
                  filter.truncate.js
                </a>
              
                
                <a class="source" href="fixedHeaders.html">
                  fixedHeaders.js
                </a>
              
                
                <a class="source" href="floating_scrollbar.min.html">
                  floating_scrollbar.min.js
                </a>
              
                
                <a class="source" href="focus-trap.html">
                  focus-trap.js
                </a>
              
                
                <a class="source" href="form.html">
                  form.js
                </a>
              
                
                <a class="source" href="form_submitted_mask.html">
                  form_submitted_mask.js
                </a>
              
                
                <a class="source" href="form_tags.html">
                  form_tags.js
                </a>
              
                
                <a class="source" href="formatting.html">
                  formatting.js
                </a>
              
                
                <a class="source" href="functions.html">
                  functions.js
                </a>
              
                
                <a class="source" href="functions_attachments.html">
                  functions_attachments.js
                </a>
              
                
                <a class="source" href="functions_bootstrap14.html">
                  functions_bootstrap14.js
                </a>
              
                
                <a class="source" href="functions_calendar.html">
                  functions_calendar.js
                </a>
              
                
                <a class="source" href="functions_clipboard.html">
                  functions_clipboard.js
                </a>
              
                
                <a class="source" href="functions_email.html">
                  functions_email.js
                </a>
              
                
                <a class="source" href="functions_fontsizer.html">
                  functions_fontsizer.js
                </a>
              
                
                <a class="source" href="functions_onchange.html">
                  functions_onchange.js
                </a>
              
                
                <a class="source" href="functions_reference.html">
                  functions_reference.js
                </a>
              
                
                <a class="source" href="functions_showloading.html">
                  functions_showloading.js
                </a>
              
                
                <a class="source" href="functions_user_image.html">
                  functions_user_image.js
                </a>
              
                
                <a class="source" href="funnel.html">
                  funnel.js
                </a>
              
                
                <a class="source" href="geolocation.html">
                  geolocation.js
                </a>
              
                
                <a class="source" href="glide-highcharts-v5.html">
                  glide-highcharts-v5.js
                </a>
              
                
                <a class="source" href="glideAjaxBatchQueue.html">
                  glideAjaxBatchQueue.js
                </a>
              
                
                <a class="source" href="glideAjaxFactory.html">
                  glideAjaxFactory.js
                </a>
              
                
                <a class="source" href="glideFormEnvironmentFactory.html">
                  glideFormEnvironmentFactory.js
                </a>
              
                
                <a class="source" href="glideFormFactory.html">
                  glideFormFactory.js
                </a>
              
                
                <a class="source" href="glideFormFieldFactory.html">
                  glideFormFieldFactory.js
                </a>
              
                
                <a class="source" href="glideFormMessageHandler.html">
                  glideFormMessageHandler.js
                </a>
              
                
                <a class="source" href="glideListFactory.html">
                  glideListFactory.js
                </a>
              
                
                <a class="source" href="glideModalFactory.html">
                  glideModalFactory.js
                </a>
              
                
                <a class="source" href="glideRecordData.html">
                  glideRecordData.js
                </a>
              
                
                <a class="source" href="glideRecordFactory.html">
                  glideRecordFactory.js
                </a>
              
                
                <a class="source" href="glideRequest.html">
                  glideRequest.js
                </a>
              
                
                <a class="source" href="glideUIActionsApi.html">
                  glideUIActionsApi.js
                </a>
              
                
                <a class="source" href="glideUIActionsFactory.html">
                  glideUIActionsFactory.js
                </a>
              
                
                <a class="source" href="glideUserFactory.html">
                  glideUserFactory.js
                </a>
              
                
                <a class="source" href="glideUserSession.html">
                  glideUserSession.js
                </a>
              
                
                <a class="source" href="guided_tours_template.html">
                  guided_tours_template.js
                </a>
              
                
                <a class="source" href="heatmap.html">
                  heatmap.js
                </a>
              
                
                <a class="source" href="heisenberg_all.html">
                  heisenberg_all.js
                </a>
              
                
                <a class="source" href="highcharts-more.src.html">
                  highcharts-more.src.js
                </a>
              
                
                <a class="source" href="highstock.src.html">
                  highstock.src.js
                </a>
              
                
                <a class="source" href="hopscotch.min.html">
                  hopscotch.min.js
                </a>
              
                
                <a class="source" href="html_class_setter.html">
                  html_class_setter.js
                </a>
              
                
                <a class="source" href="i18n.html">
                  i18n.js
                </a>
              
                
                <a class="source" href="iconset-fontawesome-4.2.0.html">
                  iconset-fontawesome-4.2.0.js
                </a>
              
                
                <a class="source" href="jQueryRequestShim.html">
                  jQueryRequestShim.js
                </a>
              
                
                <a class="source" href="jquery-2.1.html">
                  jquery-2.1.js
                </a>
              
                
                <a class="source" href="jquery-2.2.3.min.html">
                  jquery-2.2.3.min.js
                </a>
              
                
                <a class="source" href="jquery-ui-1.9.2.custom.html">
                  jquery-ui-1.9.2.custom.js
                </a>
              
                
                <a class="source" href="jquery-ui-dragdrop.min.html">
                  jquery-ui-dragdrop.min.js
                </a>
              
                
                <a class="source" href="jquery.ui.touch-punch.min.html">
                  jquery.ui.touch-punch.min.js
                </a>
              
                
                <a class="source" href="jquery2_includes.html">
                  jquery2_includes.js
                </a>
              
                
                <a class="source" href="jquery_clean.html">
                  jquery_clean.js
                </a>
              
                
                <a class="source" href="jquery_csrf.html">
                  jquery_csrf.js
                </a>
              
                
                <a class="source" href="jquery_no_conflict.html">
                  jquery_no_conflict.js
                </a>
              
                
                <a class="source" href="js_embedded_help_includes.html">
                  js_embedded_help_includes.js
                </a>
              
                
                <a class="source" href="js_guided_tours_includes.html">
                  js_guided_tours_includes.js
                </a>
              
                
                <a class="source" href="js_hopscotch_includes.html">
                  js_hopscotch_includes.js
                </a>
              
                
                <a class="source" href="js_includes_amb.html">
                  js_includes_amb.js
                </a>
              
                
                <a class="source" href="js_includes_angular.html">
                  js_includes_angular.js
                </a>
              
                
                <a class="source" href="js_includes_angular_strap_aside.html">
                  js_includes_angular_strap_aside.js
                </a>
              
                
                <a class="source" href="js_includes_angular_strap_components.html">
                  js_includes_angular_strap_components.js
                </a>
              
                
                <a class="source" href="js_includes_attachments.html">
                  js_includes_attachments.js
                </a>
              
                
                <a class="source" href="js_includes_avatar.html">
                  js_includes_avatar.js
                </a>
              
                
                <a class="source" href="js_includes_batchedga.html">
                  js_includes_batchedga.js
                </a>
              
                
                <a class="source" href="js_includes_bind_watch.html">
                  js_includes_bind_watch.js
                </a>
              
                
                <a class="source" href="js_includes_cabrillo.html">
                  js_includes_cabrillo.js
                </a>
              
                
                <a class="source" href="js_includes_clientScript.html">
                  js_includes_clientScript.js
                </a>
              
                
                <a class="source" href="js_includes_common.html">
                  js_includes_common.js
                </a>
              
                
                <a class="source" href="js_includes_common_accessibility.html">
                  js_includes_common_accessibility.js
                </a>
              
                
                <a class="source" href="js_includes_concourse.html">
                  js_includes_concourse.js
                </a>
              
                
                <a class="source" href="js_includes_concourse_pane_extension.html">
                  js_includes_concourse_pane_extension.js
                </a>
              
                
                <a class="source" href="js_includes_concourse_view_stack.html">
                  js_includes_concourse_view_stack.js
                </a>
              
                
                <a class="source" href="js_includes_connect_conversation.html">
                  js_includes_connect_conversation.js
                </a>
              
                
                <a class="source" href="js_includes_connect_document.html">
                  js_includes_connect_document.js
                </a>
              
                
                <a class="source" href="js_includes_connect_message.html">
                  js_includes_connect_message.js
                </a>
              
                
                <a class="source" href="js_includes_connect_presence.html">
                  js_includes_connect_presence.js
                </a>
              
                
                <a class="source" href="js_includes_connect_profile.html">
                  js_includes_connect_profile.js
                </a>
              
                
                <a class="source" href="js_includes_connect_queue.html">
                  js_includes_connect_queue.js
                </a>
              
                
                <a class="source" href="js_includes_connect_resource.html">
                  js_includes_connect_resource.js
                </a>
              
                
                <a class="source" href="js_includes_connect_util.html">
                  js_includes_connect_util.js
                </a>
              
                
                <a class="source" href="js_includes_controls.html">
                  js_includes_controls.js
                </a>
              
                
                <a class="source" href="js_includes_customer.html">
                  js_includes_customer.js
                </a>
              
                
                <a class="source" href="js_includes_data.html">
                  js_includes_data.js
                </a>
              
                
                <a class="source" href="js_includes_datetime.html">
                  js_includes_datetime.js
                </a>
              
                
                <a class="source" href="js_includes_doctype.html">
                  js_includes_doctype.js
                </a>
              
                
                <a class="source" href="js_includes_fast.html">
                  js_includes_fast.js
                </a>
              
                
                <a class="source" href="js_includes_form.html">
                  js_includes_form.js
                </a>
              
                
                <a class="source" href="js_includes_form_presence.html">
                  js_includes_form_presence.js
                </a>
              
                
                <a class="source" href="js_includes_glide.html">
                  js_includes_glide.js
                </a>
              
                
                <a class="source" href="js_includes_i18n.html">
                  js_includes_i18n.js
                </a>
              
                
                <a class="source" href="js_includes_last_doctype.html">
                  js_includes_last_doctype.js
                </a>
              
                
                <a class="source" href="js_includes_link.html">
                  js_includes_link.js
                </a>
              
                
                <a class="source" href="js_includes_list_edit_doctype.html">
                  js_includes_list_edit_doctype.js
                </a>
              
                
                <a class="source" href="js_includes_listv2_doctype.html">
                  js_includes_listv2_doctype.js
                </a>
              
                
                <a class="source" href="js_includes_magellan.html">
                  js_includes_magellan.js
                </a>
              
                
                <a class="source" href="js_includes_mention.html">
                  js_includes_mention.js
                </a>
              
                
                <a class="source" href="js_includes_messaging.html">
                  js_includes_messaging.js
                </a>
              
                
                <a class="source" href="js_includes_navpage15.html">
                  js_includes_navpage15.js
                </a>
              
                
                <a class="source" href="js_includes_ngCommon.html">
                  js_includes_ngCommon.js
                </a>
              
                
                <a class="source" href="js_includes_ng_amb.html">
                  js_includes_ng_amb.js
                </a>
              
                
                <a class="source" href="js_includes_ng_chat.html">
                  js_includes_ng_chat.js
                </a>
              
                
                <a class="source" href="js_includes_notification.html">
                  js_includes_notification.js
                </a>
              
                
                <a class="source" href="js_includes_overviewhelp.html">
                  js_includes_overviewhelp.js
                </a>
              
                
                <a class="source" href="js_includes_presence.html">
                  js_includes_presence.js
                </a>
              
                
                <a class="source" href="js_includes_resources.html">
                  js_includes_resources.js
                </a>
              
                
                <a class="source" href="js_includes_session_notification.html">
                  js_includes_session_notification.js
                </a>
              
                
                <a class="source" href="js_includes_sorting_new.html">
                  js_includes_sorting_new.js
                </a>
              
                
                <a class="source" href="js_includes_sp.html">
                  js_includes_sp.js
                </a>
              
                
                <a class="source" href="js_includes_sp_core.html">
                  js_includes_sp_core.js
                </a>
              
                
                <a class="source" href="js_includes_sp_deps.html">
                  js_includes_sp_deps.js
                </a>
              
                
                <a class="source" href="js_includes_sp_tinymce.html">
                  js_includes_sp_tinymce.js
                </a>
              
                
                <a class="source" href="js_includes_stream.html">
                  js_includes_stream.js
                </a>
              
                
                <a class="source" href="js_includes_ui.html">
                  js_includes_ui.js
                </a>
              
                
                <a class="source" href="js_includes_ui16_form.html">
                  js_includes_ui16_form.js
                </a>
              
                
                <a class="source" href="js_includes_ui_popover.html">
                  js_includes_ui_popover.js
                </a>
              
                
                <a class="source" href="js_includes_user_profile.html">
                  js_includes_user_profile.js
                </a>
              
                
                <a class="source" href="js_includes_util.html">
                  js_includes_util.js
                </a>
              
                
                <a class="source" href="js_includes_video.html">
                  js_includes_video.js
                </a>
              
                
                <a class="source" href="js_includes_weba.html">
                  js_includes_weba.js
                </a>
              
                
                <a class="source" href="keyboard.0.2.2.min.html">
                  keyboard.0.2.2.min.js
                </a>
              
                
                <a class="source" href="keyboardShortcuts.html">
                  keyboardShortcuts.js
                </a>
              
                
                <a class="source" href="list.html">
                  list.js
                </a>
              
                
                <a class="source" href="list_filter.html">
                  list_filter.js
                </a>
              
                
                <a class="source" href="lodash.min.html">
                  lodash.min.js
                </a>
              
                
                <a class="source" href="magellan.CreateFavoriteModal.html">
                  magellan.CreateFavoriteModal.js
                </a>
              
                
                <a class="source" href="magellan.html">
                  magellan.js
                </a>
              
                
                <a class="source" href="map.html">
                  map.js
                </a>
              
                
                <a class="source" href="mentio.html">
                  mentio.js
                </a>
              
                
                <a class="source" href="modal.html">
                  modal.js
                </a>
              
                
                <a class="source" href="modals.html">
                  modals.js
                </a>
              
                
                <a class="source" href="modernizr.custom.min.html">
                  modernizr.custom.min.js
                </a>
              
                
                <a class="source" href="moment-2.14.1.min.html">
                  moment-2.14.1.min.js
                </a>
              
                
                <a class="source" href="moment-timezone-with-data-0.5.13.html">
                  moment-timezone-with-data-0.5.13.js
                </a>
              
                
                <a class="source" href="navigation.html">
                  navigation.js
                </a>
              
                
                <a class="source" href="newtag-it.html">
                  newtag-it.js
                </a>
              
                
                <a class="source" href="ng-sortable.html">
                  ng-sortable.js
                </a>
              
                
                <a class="source" href="ng_jqdnd_includes.html">
                  ng_jqdnd_includes.js
                </a>
              
                
                <a class="source" href="no-data-to-display.html">
                  no-data-to-display.js
                </a>
              
                
                <a class="source" href="nowapi.html">
                  nowapi.js
                </a>
              
                
                <a class="source" href="ocLazyLoad.html">
                  ocLazyLoad.js
                </a>
              
                
                <a class="source" href="ocLazyLoad.min.html">
                  ocLazyLoad.min.js
                </a>
              
                
                <a class="source" href="offline-exporting.html">
                  offline-exporting.js
                </a>
              
                
                <a class="source" href="page_title.html">
                  page_title.js
                </a>
              
                
                <a class="source" href="pattern-fill-v2.html">
                  pattern-fill-v2.js
                </a>
              
                
                <a class="source" href="popover.html">
                  popover.js
                </a>
              
                
                <a class="source" href="popovers.html">
                  popovers.js
                </a>
              
                
                <a class="source" href="popupdivs14.html">
                  popupdivs14.js
                </a>
              
                
                <a class="source" href="popups.html">
                  popups.js
                </a>
              
                
                <a class="source" href="prism.html">
                  prism.js
                </a>
              
                
                <a class="source" href="proj4.html">
                  proj4.js
                </a>
              
                
                <a class="source" href="prototype.effects.html">
                  prototype.effects.js
                </a>
              
                
                <a class="source" href="prototype.hidefix.html">
                  prototype.hidefix.js
                </a>
              
                
                <a class="source" href="prototype.html">
                  prototype.js
                </a>
              
                
                <a class="source" href="prototype.min.html">
                  prototype.min.js
                </a>
              
                
                <a class="source" href="prototype.plugin.html">
                  prototype.plugin.js
                </a>
              
                
                <a class="source" href="prototype.template.html">
                  prototype.template.js
                </a>
              
                
                <a class="source" href="provider.defaultJSAutocomplete.html">
                  provider.defaultJSAutocomplete.js
                </a>
              
                
                <a class="source" href="provider.lazyloader.html">
                  provider.lazyloader.js
                </a>
              
                
                <a class="source" href="provider.linkContentTypes.html">
                  provider.linkContentTypes.js
                </a>
              
                
                <a class="source" href="responsive_form_header.html">
                  responsive_form_header.js
                </a>
              
                
                <a class="source" href="scoped_object_bridge.html">
                  scoped_object_bridge.js
                </a>
              
                
                <a class="source" href="scoped_object_generators.html">
                  scoped_object_generators.js
                </a>
              
                
                <a class="source" href="scrollable.html">
                  scrollable.js
                </a>
              
                
                <a class="source" href="scrollspy.html">
                  scrollspy.js
                </a>
              
                
                <a class="source" href="searchFocus.html">
                  searchFocus.js
                </a>
              
                
                <a class="source" href="section.html">
                  section.js
                </a>
              
                
                <a class="source" href="select2.html">
                  select2.js
                </a>
              
                
                <a class="source" href="select2.min.html">
                  select2.min.js
                </a>
              
                
                <a class="source" href="selects.html">
                  selects.js
                </a>
              
                
                <a class="source" href="service.AMB.html">
                  service.AMB.js
                </a>
              
                
                <a class="source" href="service.ChatActionHandler.html">
                  service.ChatActionHandler.js
                </a>
              
                
                <a class="source" href="service.activeConversation.html">
                  service.activeConversation.js
                </a>
              
                
                <a class="source" href="service.audioNotifier.html">
                  service.audioNotifier.js
                </a>
              
                
                <a class="source" href="service.authInterceptor.html">
                  service.authInterceptor.js
                </a>
              
                
                <a class="source" href="service.avatarProfilePersister.html">
                  service.avatarProfilePersister.js
                </a>
              
                
                <a class="source" href="service.concoursePaneExtensionRegistry.html">
                  service.concoursePaneExtensionRegistry.js
                </a>
              
                
                <a class="source" href="service.connectDropTarget.html">
                  service.connectDropTarget.js
                </a>
              
                
                <a class="source" href="service.conversationPersister.html">
                  service.conversationPersister.js
                </a>
              
                
                <a class="source" href="service.conversations.html">
                  service.conversations.js
                </a>
              
                
                <a class="source" href="service.dateUtils.html">
                  service.dateUtils.js
                </a>
              
                
                <a class="source" href="service.debounceFn.html">
                  service.debounceFn.js
                </a>
              
                
                <a class="source" href="service.documentLinkMatcher.html">
                  service.documentLinkMatcher.js
                </a>
              
                
                <a class="source" href="service.documents.html">
                  service.documents.js
                </a>
              
                
                <a class="source" href="service.durationFormatter.html">
                  service.durationFormatter.js
                </a>
              
                
                <a class="source" href="service.embeddedHelpService.html">
                  service.embeddedHelpService.js
                </a>
              
                
                <a class="source" href="service.fileSizeConverter.html">
                  service.fileSizeConverter.js
                </a>
              
                
                <a class="source" href="service.filterExpressionParser.html">
                  service.filterExpressionParser.js
                </a>
              
                
                <a class="source" href="service.getTemplateUrl.html">
                  service.getTemplateUrl.js
                </a>
              
                
                <a class="source" href="service.guidedToursService.html">
                  service.guidedToursService.js
                </a>
              
                
                <a class="source" href="service.hotKeyHandler.html">
                  service.hotKeyHandler.js
                </a>
              
                
                <a class="source" href="service.i18n.html">
                  service.i18n.js
                </a>
              
                
                <a class="source" href="service.legacySessionNotificationHandler.html">
                  service.legacySessionNotificationHandler.js
                </a>
              
                
                <a class="source" href="service.md5.html">
                  service.md5.js
                </a>
              
                
                <a class="source" href="service.messageBatcher.html">
                  service.messageBatcher.js
                </a>
              
                
                <a class="source" href="service.messageNotifier.html">
                  service.messageNotifier.js
                </a>
              
                
                <a class="source" href="service.messages.html">
                  service.messages.js
                </a>
              
                
                <a class="source" href="service.notificationPreferences.html">
                  service.notificationPreferences.js
                </a>
              
                
                <a class="source" href="service.nowServer.html">
                  service.nowServer.js
                </a>
              
                
                <a class="source" href="service.nowStream.html">
                  service.nowStream.js
                </a>
              
                
                <a class="source" href="service.priorityQueue.html">
                  service.priorityQueue.js
                </a>
              
                
                <a class="source" href="service.profiles.html">
                  service.profiles.js
                </a>
              
                
                <a class="source" href="service.progressDialog.html">
                  service.progressDialog.js
                </a>
              
                
                <a class="source" href="service.queryFilter.html">
                  service.queryFilter.js
                </a>
              
                
                <a class="source" href="service.queueEntries.html">
                  service.queueEntries.js
                </a>
              
                
                <a class="source" href="service.queueEntryNotifier.html">
                  service.queueEntryNotifier.js
                </a>
              
                
                <a class="source" href="service.queueNotifier.html">
                  service.queueNotifier.js
                </a>
              
                
                <a class="source" href="service.queues.html">
                  service.queues.js
                </a>
              
                
                <a class="source" href="service.resourcePersister.html">
                  service.resourcePersister.js
                </a>
              
                
                <a class="source" href="service.screenReaderStatus.html">
                  service.screenReaderStatus.js
                </a>
              
                
                <a class="source" href="service.screenWidth.html">
                  service.screenWidth.js
                </a>
              
                
                <a class="source" href="service.sessionNotificationInterceptor.html">
                  service.sessionNotificationInterceptor.js
                </a>
              
                
                <a class="source" href="service.snComplexPopoverService.html">
                  service.snComplexPopoverService.js
                </a>
              
                
                <a class="source" href="service.snComposingPresence.html">
                  service.snComposingPresence.js
                </a>
              
                
                <a class="source" href="service.snConnect.html">
                  service.snConnect.js
                </a>
              
                
                <a class="source" href="service.snConnectAsideManager.html">
                  service.snConnectAsideManager.js
                </a>
              
                
                <a class="source" href="service.snConnectMention.html">
                  service.snConnectMention.js
                </a>
              
                
                <a class="source" href="service.snConversationAsideHistory.html">
                  service.snConversationAsideHistory.js
                </a>
              
                
                <a class="source" href="service.snCustomEvent.html">
                  service.snCustomEvent.js
                </a>
              
                
                <a class="source" href="service.snHttp.html">
                  service.snHttp.js
                </a>
              
                
                <a class="source" href="service.snMention.html">
                  service.snMention.js
                </a>
              
                
                <a class="source" href="service.snNotification.html">
                  service.snNotification.js
                </a>
              
                
                <a class="source" href="service.snNotifier.html">
                  service.snNotifier.js
                </a>
              
                
                <a class="source" href="service.snResource.html">
                  service.snResource.js
                </a>
              
                
                <a class="source" href="service.snTabActivity.html">
                  service.snTabActivity.js
                </a>
              
                
                <a class="source" href="service.snTypingTracker.html">
                  service.snTypingTracker.js
                </a>
              
                
                <a class="source" href="service.spAria.html">
                  service.spAria.js
                </a>
              
                
                <a class="source" href="service.spAriaFocusManager.html">
                  service.spAriaFocusManager.js
                </a>
              
                
                <a class="source" href="service.spCodeEditorAutocomplete.html">
                  service.spCodeEditorAutocomplete.js
                </a>
              
                
                <a class="source" href="service.spIs.html">
                  service.spIs.js
                </a>
              
                
                <a class="source" href="service.spModal.html">
                  service.spModal.js
                </a>
              
                
                <a class="source" href="service.spPreference.html">
                  service.spPreference.js
                </a>
              
                
                <a class="source" href="service.spThrottle.html">
                  service.spThrottle.js
                </a>
              
                
                <a class="source" href="service.spUtil.html">
                  service.spUtil.js
                </a>
              
                
                <a class="source" href="service.supportTabHandler.html">
                  service.supportTabHandler.js
                </a>
              
                
                <a class="source" href="service.sysNumberData.html">
                  service.sysNumberData.js
                </a>
              
                
                <a class="source" href="service.titleFlasher.html">
                  service.titleFlasher.js
                </a>
              
                
                <a class="source" href="service.uiNotificationHandler.html">
                  service.uiNotificationHandler.js
                </a>
              
                
                <a class="source" href="service.unreadCount.html">
                  service.unreadCount.js
                </a>
              
                
                <a class="source" href="service.uploadAttachment.html">
                  service.uploadAttachment.js
                </a>
              
                
                <a class="source" href="service.urlTools.html">
                  service.urlTools.js
                </a>
              
                
                <a class="source" href="service.userData.html">
                  service.userData.js
                </a>
              
                
                <a class="source" href="service.userPreferences.html">
                  service.userPreferences.js
                </a>
              
                
                <a class="source" href="service.viewStack.html">
                  service.viewStack.js
                </a>
              
                
                <a class="source" href="simpleStorage.html">
                  simpleStorage.js
                </a>
              
                
                <a class="source" href="snPolyfill.html">
                  snPolyfill.js
                </a>
              
                
                <a class="source" href="snPopover.html">
                  snPopover.js
                </a>
              
                
                <a class="source" href="snPresenceLite.html">
                  snPresenceLite.js
                </a>
              
                
                <a class="source" href="snTimeAgoSettings.html">
                  snTimeAgoSettings.js
                </a>
              
                
                <a class="source" href="snm.auth.data.module.html">
                  snm.auth.data.module.js
                </a>
              
                
                <a class="source" href="snm.serviceCatalog.data.shim.html">
                  snm.serviceCatalog.data.shim.js
                </a>
              
                
                <a class="source" href="snm.serviceCatalog.form.module.html">
                  snm.serviceCatalog.form.module.js
                </a>
              
                
                <a class="source" href="solid-gauge.html">
                  solid-gauge.js
                </a>
              
                
                <a class="source" href="sortable.min.html">
                  sortable.min.js
                </a>
              
                
                <a class="source" href="sp.geo.html">
                  sp.geo.js
                </a>
              
                
                <a class="source" href="streamButton.html">
                  streamButton.js
                </a>
              
                
                <a class="source" href="tabbable.html">
                  tabbable.js
                </a>
              
                
                <a class="source" href="tables.html">
                  tables.js
                </a>
              
                
                <a class="source" href="tabs.html">
                  tabs.js
                </a>
              
                
                <a class="source" href="tabs2_14.html">
                  tabs2_14.js
                </a>
              
                
                <a class="source" href="templates.html">
                  templates.js
                </a>
              
                
                <a class="source" href="textutil.html">
                  textutil.js
                </a>
              
                
                <a class="source" href="theme.min.html">
                  theme.min.js
                </a>
              
                
                <a class="source" href="timeAgo.html">
                  timeAgo.js
                </a>
              
                
                <a class="source" href="tinymce.min.html">
                  tinymce.min.js
                </a>
              
                
                <a class="source" href="tooltip.html">
                  tooltip.js
                </a>
              
                
                <a class="source" href="tooltips.html">
                  tooltips.js
                </a>
              
                
                <a class="source" href="transaction_scope_includes.html">
                  transaction_scope_includes.js
                </a>
              
                
                <a class="source" href="transition.html">
                  transition.js
                </a>
              
                
                <a class="source" href="treemap.html">
                  treemap.js
                </a>
              
                
                <a class="source" href="typeahead.jquery.html">
                  typeahead.jquery.js
                </a>
              
                
                <a class="source" href="ui-bootstrap-tpls-0.12.1.html">
                  ui-bootstrap-tpls-0.12.1.js
                </a>
              
                
                <a class="source" href="ui-bootstrap-tpls-1.1.2.html">
                  ui-bootstrap-tpls-1.1.2.js
                </a>
              
                
                <a class="source" href="ui-sortable.html">
                  ui-sortable.js
                </a>
              
                
                <a class="source" href="uiPolicyFactory.html">
                  uiPolicyFactory.js
                </a>
              
                
                <a class="source" href="uiPolicyTypes.html">
                  uiPolicyTypes.js
                </a>
              
                
                <a class="source" href="ui_policy.html">
                  ui_policy.js
                </a>
              
                
                <a class="source" href="utils14.html">
                  utils14.js
                </a>
              
                
                <a class="source" href="vanilla.cometd.html">
                  vanilla.cometd.js
                </a>
              
                
                <a class="source" href="velocity.min.html">
                  velocity.min.js
                </a>
              
                
                <a class="source" href="velocity.ui.html">
                  velocity.ui.js
                </a>
              
                
                <a class="source" href="viewLayout.html">
                  viewLayout.js
                </a>
              
                
                <a class="source" href="xmlUtil.html">
                  xmlUtil.js
                </a>
              
                
                <a class="source" href="xmlhttp.html">
                  xmlhttp.js
                </a>
              
                
                <a class="source" href="z_last_include.html">
                  z_last_include.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>js_includes_ng_chat.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/js_includes_ng_chat.js */</span>
<span class="hljs-comment">/*! RESOURCE: /scripts/thirdparty/ment.io/mentio.js */</span>
(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    angular.module(<span class="hljs-string">'mentio'</span>, [])
        .directive(<span class="hljs-string">'mentio'</span>, [<span class="hljs-string">'mentioUtil'</span>, <span class="hljs-string">'$document'</span>, <span class="hljs-string">'$compile'</span>, <span class="hljs-string">'$log'</span>, <span class="hljs-string">'$timeout'</span>,
            <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">mentioUtil, $document, $compile, $log, $timeout</span>) </span>{
                <span class="hljs-keyword">return</span> {
                    <span class="hljs-attr">restrict</span>: <span class="hljs-string">'A'</span>,
                    <span class="hljs-attr">scope</span>: {
                        <span class="hljs-attr">macros</span>: <span class="hljs-string">'=mentioMacros'</span>,
                        <span class="hljs-attr">search</span>: <span class="hljs-string">'&amp;mentioSearch'</span>,
                        <span class="hljs-attr">select</span>: <span class="hljs-string">'&amp;mentioSelect'</span>,
                        <span class="hljs-attr">items</span>: <span class="hljs-string">'=mentioItems'</span>,
                        <span class="hljs-attr">typedTerm</span>: <span class="hljs-string">'=mentioTypedTerm'</span>,
                        <span class="hljs-attr">altId</span>: <span class="hljs-string">'=mentioId'</span>,
                        <span class="hljs-attr">iframeElement</span>: <span class="hljs-string">'=mentioIframeElement'</span>,
                        <span class="hljs-attr">requireLeadingSpace</span>: <span class="hljs-string">'=mentioRequireLeadingSpace'</span>,
                        <span class="hljs-attr">suppressTrailingSpace</span>: <span class="hljs-string">'=mentioSuppressTrailingSpace'</span>,
                        <span class="hljs-attr">selectNotFound</span>: <span class="hljs-string">'=mentioSelectNotFound'</span>,
                        <span class="hljs-attr">trimTerm</span>: <span class="hljs-string">'=mentioTrimTerm'</span>,
                        <span class="hljs-attr">ngModel</span>: <span class="hljs-string">'='</span>
                    },
                    <span class="hljs-attr">controller</span>: [<span class="hljs-string">"$scope"</span>, <span class="hljs-string">"$timeout"</span>, <span class="hljs-string">"$attrs"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$scope, $timeout, $attrs</span>) </span>{
                        $scope.query = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">triggerChar, triggerText</span>) </span>{
                            <span class="hljs-keyword">var</span> remoteScope = $scope.triggerCharMap[triggerChar];
                            <span class="hljs-keyword">if</span> ($scope.trimTerm === <span class="hljs-literal">undefined</span> || $scope.trimTerm) {
                                triggerText = triggerText.trim();
                            }
                            remoteScope.showMenu();
                            remoteScope.search({
                                <span class="hljs-attr">term</span>: triggerText
                            });
                            remoteScope.typedTerm = triggerText;
                        };
                        $scope.defaultSearch = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">locals</span>) </span>{
                            <span class="hljs-keyword">var</span> results = [];
                            angular.forEach($scope.items, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">item</span>) </span>{
                                <span class="hljs-keyword">if</span> (item.label.toUpperCase().indexOf(locals.term.toUpperCase()) &gt;= <span class="hljs-number">0</span>) {
                                    results.push(item);
                                }
                            });
                            $scope.localItems = results;
                        };
                        $scope.bridgeSearch = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">termString</span>) </span>{
                            <span class="hljs-keyword">var</span> searchFn = $attrs.mentioSearch ? $scope.search : $scope.defaultSearch;
                            searchFn({
                                <span class="hljs-attr">term</span>: termString
                            });
                        };
                        $scope.defaultSelect = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">locals</span>) </span>{
                            <span class="hljs-keyword">return</span> $scope.defaultTriggerChar + locals.item.label;
                        };
                        $scope.bridgeSelect = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">itemVar</span>) </span>{
                            <span class="hljs-keyword">var</span> selectFn = $attrs.mentioSelect ? $scope.select : $scope.defaultSelect;
                            <span class="hljs-keyword">return</span> selectFn({
                                <span class="hljs-attr">item</span>: itemVar
                            });
                        };
                        $scope.setTriggerText = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">text</span>) </span>{
                            <span class="hljs-keyword">if</span> ($scope.syncTriggerText) {
                                $scope.typedTerm = ($scope.trimTerm === <span class="hljs-literal">undefined</span> || $scope.trimTerm) ? text.trim() : text;
                            }
                        };
                        $scope.context = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                            <span class="hljs-keyword">if</span> ($scope.iframeElement) {
                                <span class="hljs-keyword">return</span> {
                                    <span class="hljs-attr">iframe</span>: $scope.iframeElement
                                };
                            }
                        };
                        $scope.replaceText = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">text, hasTrailingSpace</span>) </span>{
                            $scope.hideAll();
                            mentioUtil.replaceTriggerText($scope.context(), $scope.targetElement, $scope.targetElementPath,
                                $scope.targetElementSelectedOffset, $scope.triggerCharSet, text, $scope.requireLeadingSpace,
                                hasTrailingSpace, $scope.suppressTrailingSpace);
                            <span class="hljs-keyword">if</span> (!hasTrailingSpace) {
                                $scope.setTriggerText(<span class="hljs-string">''</span>);
                                angular.element($scope.targetElement).triggerHandler(<span class="hljs-string">'change'</span>);
                                <span class="hljs-keyword">if</span> ($scope.isContentEditable()) {
                                    $scope.contentEditableMenuPasted = <span class="hljs-literal">true</span>;
                                    <span class="hljs-keyword">var</span> timer = $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                                        $scope.contentEditableMenuPasted = <span class="hljs-literal">false</span>;
                                    }, <span class="hljs-number">200</span>);
                                    $scope.$on(<span class="hljs-string">'$destroy'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                                        $timeout.cancel(timer);
                                    });
                                }
                            }
                        };
                        $scope.hideAll = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> key <span class="hljs-keyword">in</span> $scope.triggerCharMap) {
                                <span class="hljs-keyword">if</span> ($scope.triggerCharMap.hasOwnProperty(key)) {
                                    $scope.triggerCharMap[key].hideMenu();
                                }
                            }
                        };
                        $scope.getActiveMenuScope = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> key <span class="hljs-keyword">in</span> $scope.triggerCharMap) {
                                <span class="hljs-keyword">if</span> ($scope.triggerCharMap.hasOwnProperty(key)) {
                                    <span class="hljs-keyword">if</span> ($scope.triggerCharMap[key].visible) {
                                        <span class="hljs-keyword">return</span> $scope.triggerCharMap[key];
                                    }
                                }
                            }
                            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
                        };
                        $scope.selectActive = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> key <span class="hljs-keyword">in</span> $scope.triggerCharMap) {
                                <span class="hljs-keyword">if</span> ($scope.triggerCharMap.hasOwnProperty(key)) {
                                    <span class="hljs-keyword">if</span> ($scope.triggerCharMap[key].visible) {
                                        $scope.triggerCharMap[key].selectActive();
                                    }
                                }
                            }
                        };
                        $scope.isActive = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> key <span class="hljs-keyword">in</span> $scope.triggerCharMap) {
                                <span class="hljs-keyword">if</span> ($scope.triggerCharMap.hasOwnProperty(key)) {
                                    <span class="hljs-keyword">if</span> ($scope.triggerCharMap[key].visible) {
                                        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
                                    }
                                }
                            }
                            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
                        };
                        $scope.isContentEditable = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                            <span class="hljs-keyword">return</span> ($scope.targetElement.nodeName !== <span class="hljs-string">'INPUT'</span> &amp;&amp; $scope.targetElement.nodeName !== <span class="hljs-string">'TEXTAREA'</span>);
                        };
                        $scope.replaceMacro = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">macro, hasTrailingSpace</span>) </span>{
                            <span class="hljs-keyword">if</span> (!hasTrailingSpace) {
                                $scope.replacingMacro = <span class="hljs-literal">true</span>;
                                $scope.timer = $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                                    mentioUtil.replaceMacroText($scope.context(), $scope.targetElement,
                                        $scope.targetElementPath, $scope.targetElementSelectedOffset,
                                        $scope.macros, $scope.macros[macro]);
                                    angular.element($scope.targetElement).triggerHandler(<span class="hljs-string">'change'</span>);
                                    $scope.replacingMacro = <span class="hljs-literal">false</span>;
                                }, <span class="hljs-number">300</span>);
                                $scope.$on(<span class="hljs-string">'$destroy'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                                    $timeout.cancel($scope.timer);
                                });
                            } <span class="hljs-keyword">else</span> {
                                mentioUtil.replaceMacroText($scope.context(), $scope.targetElement, $scope.targetElementPath,
                                    $scope.targetElementSelectedOffset, $scope.macros, $scope.macros[macro]);
                            }
                        };
                        $scope.addMenu = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">menuScope</span>) </span>{
                            <span class="hljs-keyword">if</span> (menuScope.parentScope &amp;&amp; $scope.triggerCharMap.hasOwnProperty(menuScope.triggerChar)) {
                                <span class="hljs-keyword">return</span>;
                            }
                            $scope.triggerCharMap[menuScope.triggerChar] = menuScope;
                            <span class="hljs-keyword">if</span> ($scope.triggerCharSet === <span class="hljs-literal">undefined</span>) {
                                $scope.triggerCharSet = [];
                            }
                            $scope.triggerCharSet.push(menuScope.triggerChar);
                            menuScope.setParent($scope);
                        };
                        $scope.$on(
                            <span class="hljs-string">'menuCreated'</span>,
                            <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event, data</span>) </span>{
                                <span class="hljs-keyword">if</span> (
                                    $attrs.id !== <span class="hljs-literal">undefined</span> ||
                                    $attrs.mentioId !== <span class="hljs-literal">undefined</span>
                                ) {
                                    <span class="hljs-keyword">if</span> (
                                        $attrs.id === data.targetElement ||
                                        (
                                            $attrs.mentioId !== <span class="hljs-literal">undefined</span> &amp;&amp;
                                            $scope.altId === data.targetElement
                                        )
                                    ) {
                                        $scope.addMenu(data.scope);
                                    }
                                }
                            }
                        );
                        $<span class="hljs-built_in">document</span>.on(
                            <span class="hljs-string">'click'</span>,
                            <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                                <span class="hljs-keyword">if</span> ($scope.isActive()) {
                                    $scope.$apply(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                                        $scope.hideAll();
                                    });
                                }
                            }
                        );
                        $<span class="hljs-built_in">document</span>.on(
                            <span class="hljs-string">'keydown keypress paste'</span>,
                            <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) </span>{
                                <span class="hljs-keyword">var</span> activeMenuScope = $scope.getActiveMenuScope();
                                <span class="hljs-keyword">if</span> (activeMenuScope) {
                                    <span class="hljs-keyword">if</span> (event.which === <span class="hljs-number">9</span> || event.which === <span class="hljs-number">13</span>) {
                                        event.preventDefault();
                                        activeMenuScope.selectActive();
                                    }
                                    <span class="hljs-keyword">if</span> (event.which === <span class="hljs-number">27</span>) {
                                        event.preventDefault();
                                        activeMenuScope.$apply(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                                            activeMenuScope.hideMenu();
                                        });
                                    }
                                    <span class="hljs-keyword">if</span> (event.which === <span class="hljs-number">40</span>) {
                                        event.preventDefault();
                                        activeMenuScope.$apply(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                                            activeMenuScope.activateNextItem();
                                        });
                                        activeMenuScope.adjustScroll(<span class="hljs-number">1</span>);
                                    }
                                    <span class="hljs-keyword">if</span> (event.which === <span class="hljs-number">38</span>) {
                                        event.preventDefault();
                                        activeMenuScope.$apply(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                                            activeMenuScope.activatePreviousItem();
                                        });
                                        activeMenuScope.adjustScroll(<span class="hljs-number">-1</span>);
                                    }
                                    <span class="hljs-keyword">if</span> (event.which === <span class="hljs-number">37</span> || event.which === <span class="hljs-number">39</span>) {
                                        event.preventDefault();
                                    }
                                }
                            }
                        );
                    }],
                    <span class="hljs-attr">link</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">scope, element, attrs, $timeout</span>) </span>{
                        scope.triggerCharMap = {};
                        scope.targetElement = element;
                        scope.scrollBarParents = element.parents().filter(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                            <span class="hljs-keyword">var</span> overflow = angular.element(<span class="hljs-keyword">this</span>).css(<span class="hljs-string">"overflow"</span>);
                            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.scrollHeight &gt; <span class="hljs-keyword">this</span>.clientHeight &amp;&amp; overflow !== <span class="hljs-string">"hidden"</span> &amp;&amp; overflow !== <span class="hljs-string">"visible"</span>;
                        });
                        scope.scrollPosition = <span class="hljs-literal">null</span>;
                        attrs.$set(<span class="hljs-string">'autocomplete'</span>, <span class="hljs-string">'off'</span>);
                        <span class="hljs-keyword">if</span> (attrs.mentioItems) {
                            scope.localItems = [];
                            scope.parentScope = scope;
                            <span class="hljs-keyword">var</span> itemsRef = attrs.mentioSearch ? <span class="hljs-string">' mentio-items="items"'</span> : <span class="hljs-string">' mentio-items="localItems"'</span>;
                            scope.defaultTriggerChar = attrs.mentioTriggerChar ? scope.$<span class="hljs-built_in">eval</span>(attrs.mentioTriggerChar) : <span class="hljs-string">'@'</span>;
                            <span class="hljs-keyword">var</span> html = <span class="hljs-string">'&lt;mentio-menu'</span> +
                                <span class="hljs-string">' mentio-search="bridgeSearch(term)"'</span> +
                                <span class="hljs-string">' mentio-select="bridgeSelect(item)"'</span> +
                                itemsRef;
                            <span class="hljs-keyword">if</span> (attrs.mentioTemplateUrl) {
                                html = html + <span class="hljs-string">' mentio-template-url="'</span> + attrs.mentioTemplateUrl + <span class="hljs-string">'"'</span>;
                            }
                            html = html + <span class="hljs-string">' mentio-trigger-char="\''</span> + scope.defaultTriggerChar + <span class="hljs-string">'\'"'</span> +
                                <span class="hljs-string">' mentio-parent-scope="parentScope"'</span> +
                                <span class="hljs-string">'/&gt;'</span>;
                            <span class="hljs-keyword">var</span> linkFn = $compile(html);
                            <span class="hljs-keyword">var</span> el = linkFn(scope);
                            element.parent().append(el);
                            scope.$on(<span class="hljs-string">'$destroy'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                                el.remove();
                            });
                        }
                        <span class="hljs-keyword">if</span> (attrs.mentioTypedTerm) {
                            scope.syncTriggerText = <span class="hljs-literal">true</span>;
                        }

                        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">keyHandler</span>(<span class="hljs-params">event</span>) </span>{
                            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">stopEvent</span>(<span class="hljs-params">event</span>) </span>{
                                event.preventDefault();
                                event.stopPropagation();
                                event.stopImmediatePropagation();
                            }
                            <span class="hljs-keyword">var</span> activeMenuScope = scope.getActiveMenuScope();
                            <span class="hljs-keyword">if</span> (activeMenuScope) {
                                <span class="hljs-keyword">if</span> (event.which === <span class="hljs-number">9</span> || event.which === <span class="hljs-number">13</span>) {
                                    stopEvent(event);
                                    activeMenuScope.selectActive();
                                    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
                                }
                                <span class="hljs-keyword">if</span> (event.which === <span class="hljs-number">27</span>) {
                                    stopEvent(event);
                                    activeMenuScope.$apply(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                                        activeMenuScope.hideMenu();
                                    });
                                    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
                                }
                                <span class="hljs-keyword">if</span> (event.which === <span class="hljs-number">40</span>) {
                                    stopEvent(event);
                                    activeMenuScope.$apply(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                                        activeMenuScope.activateNextItem();
                                    });
                                    activeMenuScope.adjustScroll(<span class="hljs-number">1</span>);
                                    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
                                }
                                <span class="hljs-keyword">if</span> (event.which === <span class="hljs-number">38</span>) {
                                    stopEvent(event);
                                    activeMenuScope.$apply(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                                        activeMenuScope.activatePreviousItem();
                                    });
                                    activeMenuScope.adjustScroll(<span class="hljs-number">-1</span>);
                                    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
                                }
                                <span class="hljs-keyword">if</span> (event.which === <span class="hljs-number">37</span> || event.which === <span class="hljs-number">39</span>) {
                                    stopEvent(event);
                                    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
                                }
                            }
                        }
                        scope.$watch(
                            <span class="hljs-string">'iframeElement'</span>,
                            <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">newValue</span>) </span>{
                                <span class="hljs-keyword">if</span> (newValue) {
                                    <span class="hljs-keyword">var</span> iframeDocument = newValue.contentWindow.document;
                                    iframeDocument.addEventListener(<span class="hljs-string">'click'</span>,
                                        <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                                            <span class="hljs-keyword">if</span> (scope.isActive()) {
                                                scope.$apply(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                                                    scope.hideAll();
                                                });
                                            }
                                        }
                                    );
                                    iframeDocument.addEventListener(<span class="hljs-string">'keydown'</span>, keyHandler, <span class="hljs-literal">true</span>);
                                    scope.$on(<span class="hljs-string">'$destroy'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                                        iframeDocument.removeEventListener(<span class="hljs-string">'keydown'</span>, keyHandler);
                                    });
                                }
                            }
                        );
                        scope.$watch(
                            <span class="hljs-string">'ngModel'</span>,
                            <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">newValue</span>) </span>{
                                <span class="hljs-keyword">if</span> ((!newValue || newValue === <span class="hljs-string">''</span>) &amp;&amp; !scope.isActive()) {
                                    <span class="hljs-keyword">return</span>;
                                }
                                <span class="hljs-keyword">if</span> (scope.triggerCharSet === <span class="hljs-literal">undefined</span>) {
                                    $log.warn(<span class="hljs-string">'Error, no mentio-items attribute was provided, '</span> +
                                        <span class="hljs-string">'and no separate mentio-menus were specified.  Nothing to do.'</span>);
                                    <span class="hljs-keyword">return</span>;
                                }
                                <span class="hljs-keyword">if</span> (scope.contentEditableMenuPasted) {
                                    scope.contentEditableMenuPasted = <span class="hljs-literal">false</span>;
                                    <span class="hljs-keyword">return</span>;
                                }
                                <span class="hljs-keyword">if</span> (scope.replacingMacro) {
                                    $timeout.cancel(scope.timer);
                                    scope.replacingMacro = <span class="hljs-literal">false</span>;
                                }
                                <span class="hljs-keyword">var</span> isActive = scope.isActive();
                                <span class="hljs-keyword">var</span> isContentEditable = scope.isContentEditable();
                                <span class="hljs-keyword">var</span> mentionInfo = mentioUtil.getTriggerInfo(scope.context(), scope.triggerCharSet,
                                    scope.requireLeadingSpace, isActive);
                                <span class="hljs-keyword">if</span> (mentionInfo !== <span class="hljs-literal">undefined</span> &amp;&amp;
                                    (!isActive ||
                                        (isActive &amp;&amp;
                                            (
                                                (isContentEditable &amp;&amp; mentionInfo.mentionTriggerChar ===
                                                    scope.currentMentionTriggerChar) ||
                                                (!isContentEditable &amp;&amp; mentionInfo.mentionPosition ===
                                                    scope.currentMentionPosition)
                                            )
                                        )
                                    )
                                ) {
                                    <span class="hljs-keyword">if</span> (mentionInfo.mentionSelectedElement) {
                                        scope.targetElement = mentionInfo.mentionSelectedElement;
                                        scope.targetElementPath = mentionInfo.mentionSelectedPath;
                                        scope.targetElementSelectedOffset = mentionInfo.mentionSelectedOffset;
                                    }
                                    scope.setTriggerText(mentionInfo.mentionText);
                                    scope.currentMentionPosition = mentionInfo.mentionPosition;
                                    scope.currentMentionTriggerChar = mentionInfo.mentionTriggerChar;
                                    scope.query(mentionInfo.mentionTriggerChar, mentionInfo.mentionText);
                                } <span class="hljs-keyword">else</span> {
                                    <span class="hljs-keyword">var</span> currentTypedTerm = scope.typedTerm;
                                    scope.setTriggerText(<span class="hljs-string">''</span>);
                                    scope.hideAll();
                                    <span class="hljs-keyword">var</span> macroMatchInfo = mentioUtil.getMacroMatch(scope.context(), scope.macros);
                                    <span class="hljs-keyword">if</span> (macroMatchInfo !== <span class="hljs-literal">undefined</span>) {
                                        scope.targetElement = macroMatchInfo.macroSelectedElement;
                                        scope.targetElementPath = macroMatchInfo.macroSelectedPath;
                                        scope.targetElementSelectedOffset = macroMatchInfo.macroSelectedOffset;
                                        scope.replaceMacro(macroMatchInfo.macroText, macroMatchInfo.macroHasTrailingSpace);
                                    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (scope.selectNotFound &amp;&amp; currentTypedTerm &amp;&amp; currentTypedTerm !== <span class="hljs-string">''</span>) {
                                        <span class="hljs-keyword">var</span> lastScope = scope.triggerCharMap[scope.currentMentionTriggerChar];
                                        <span class="hljs-keyword">if</span> (lastScope) {
                                            <span class="hljs-keyword">var</span> text = lastScope.select({
                                                <span class="hljs-attr">item</span>: {
                                                    <span class="hljs-attr">label</span>: currentTypedTerm
                                                }
                                            });
                                            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> text.then === <span class="hljs-string">'function'</span>) {
                                                text.then(scope.replaceText);
                                            } <span class="hljs-keyword">else</span> {
                                                scope.replaceText(text, <span class="hljs-literal">true</span>);
                                            }
                                        }
                                    }
                                }
                            }
                        );
                    }
                };
            }
        ])
        .directive(<span class="hljs-string">'mentioMenu'</span>, [<span class="hljs-string">'mentioUtil'</span>, <span class="hljs-string">'$rootScope'</span>, <span class="hljs-string">'$log'</span>, <span class="hljs-string">'$window'</span>, <span class="hljs-string">'$document'</span>, <span class="hljs-string">'$timeout'</span>,
            <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">mentioUtil, $rootScope, $log, $window, $document, $timeout</span>) </span>{
                <span class="hljs-keyword">return</span> {
                    <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
                    <span class="hljs-attr">scope</span>: {
                        <span class="hljs-attr">search</span>: <span class="hljs-string">'&amp;mentioSearch'</span>,
                        <span class="hljs-attr">select</span>: <span class="hljs-string">'&amp;mentioSelect'</span>,
                        <span class="hljs-attr">items</span>: <span class="hljs-string">'=mentioItems'</span>,
                        <span class="hljs-attr">triggerChar</span>: <span class="hljs-string">'=mentioTriggerChar'</span>,
                        <span class="hljs-attr">forElem</span>: <span class="hljs-string">'=mentioFor'</span>,
                        <span class="hljs-attr">parentScope</span>: <span class="hljs-string">'=mentioParentScope'</span>
                    },
                    <span class="hljs-attr">templateUrl</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">tElement, tAttrs</span>) </span>{
                        <span class="hljs-keyword">return</span> tAttrs.mentioTemplateUrl !== <span class="hljs-literal">undefined</span> ? tAttrs.mentioTemplateUrl : <span class="hljs-string">'mentio-menu.tpl.html'</span>;
                    },
                    <span class="hljs-attr">controller</span>: [<span class="hljs-string">"$scope"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$scope</span>) </span>{
                        $scope.visible = <span class="hljs-literal">false</span>;
                        <span class="hljs-keyword">this</span>.activate = $scope.activate = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">item</span>) </span>{
                            $scope.activeItem = item;
                        };
                        <span class="hljs-keyword">this</span>.isActive = $scope.isActive = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">item</span>) </span>{
                            <span class="hljs-keyword">return</span> $scope.activeItem === item;
                        };
                        <span class="hljs-keyword">this</span>.selectItem = $scope.selectItem = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">item</span>) </span>{
                            <span class="hljs-keyword">if</span> (item.termLengthIsZero) {
                                item.name = $scope.triggerChar + $scope.typedTerm
                            }
                            <span class="hljs-keyword">var</span> text = $scope.select({
                                <span class="hljs-attr">item</span>: item
                            });
                            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> text.then === <span class="hljs-string">'function'</span>) {
                                text.then($scope.parentMentio.replaceText);
                            } <span class="hljs-keyword">else</span> {
                                $scope.parentMentio.replaceText(text);
                            }
                        };
                        $scope.activateNextItem = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                            <span class="hljs-keyword">var</span> index = $scope.items.indexOf($scope.activeItem);
                            <span class="hljs-keyword">this</span>.activate($scope.items[(index + <span class="hljs-number">1</span>) % $scope.items.length]);
                        };
                        $scope.activatePreviousItem = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                            <span class="hljs-keyword">var</span> index = $scope.items.indexOf($scope.activeItem);
                            <span class="hljs-keyword">this</span>.activate($scope.items[index === <span class="hljs-number">0</span> ? $scope.items.length - <span class="hljs-number">1</span> : index - <span class="hljs-number">1</span>]);
                        };
                        $scope.isFirstItemActive = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                            <span class="hljs-keyword">var</span> index = $scope.items.indexOf($scope.activeItem);
                            <span class="hljs-keyword">return</span> index === <span class="hljs-number">0</span>;
                        };
                        $scope.isLastItemActive = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                            <span class="hljs-keyword">var</span> index = $scope.items.indexOf($scope.activeItem);
                            <span class="hljs-keyword">return</span> index === ($scope.items.length - <span class="hljs-number">1</span>);
                        };
                        $scope.selectActive = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                            $scope.selectItem($scope.activeItem);
                        };
                        $scope.isVisible = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                            <span class="hljs-keyword">return</span> $scope.visible;
                        };
                        $scope.showMenu = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                            <span class="hljs-keyword">if</span> (!$scope.visible) {
                                $scope.menuElement.css(<span class="hljs-string">"visibility"</span>, <span class="hljs-string">"visible"</span>);
                                $scope.requestVisiblePendingSearch = <span class="hljs-literal">true</span>;
                            }
                        };
                        $scope.setParent = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">scope</span>) </span>{
                            $scope.parentMentio = scope;
                            $scope.targetElement = scope.targetElement;
                        };
                        <span class="hljs-keyword">var</span> scopeDuplicate = $scope;
                        $rootScope.$on(<span class="hljs-string">'mentio.closeMenu'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                            scopeDuplicate.hideMenu();
                        })
                    }],
                    <span class="hljs-attr">link</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">scope, element</span>) </span>{
                        element[<span class="hljs-number">0</span>].parentNode.removeChild(element[<span class="hljs-number">0</span>]);
                        $<span class="hljs-built_in">document</span>[<span class="hljs-number">0</span>].body.appendChild(element[<span class="hljs-number">0</span>]);
                        scope.menuElement = element;
                        scope.menuElement.css(<span class="hljs-string">"visibility"</span>, <span class="hljs-string">"hidden"</span>);
                        <span class="hljs-keyword">if</span> (scope.parentScope) {
                            scope.parentScope.addMenu(scope);
                        } <span class="hljs-keyword">else</span> {
                            <span class="hljs-keyword">if</span> (!scope.forElem) {
                                $log.error(<span class="hljs-string">'mentio-menu requires a target element in tbe mentio-for attribute'</span>);
                                <span class="hljs-keyword">return</span>;
                            }
                            <span class="hljs-keyword">if</span> (!scope.triggerChar) {
                                $log.error(<span class="hljs-string">'mentio-menu requires a trigger char'</span>);
                                <span class="hljs-keyword">return</span>;
                            }
                            $rootScope.$broadcast(<span class="hljs-string">'menuCreated'</span>, {
                                <span class="hljs-attr">targetElement</span>: scope.forElem,
                                <span class="hljs-attr">scope</span>: scope
                            });
                        }
                        angular.element($<span class="hljs-built_in">window</span>).bind(
                            <span class="hljs-string">'resize'</span>,
                            <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                                <span class="hljs-keyword">if</span> (scope.isVisible()) {
                                    <span class="hljs-keyword">var</span> triggerCharSet = [];
                                    triggerCharSet.push(scope.triggerChar);
                                    mentioUtil.popUnderMention(scope.parentMentio.context(),
                                        triggerCharSet, element, scope.requireLeadingSpace);
                                }
                            }
                        );
                        scope.$watch(<span class="hljs-string">'items'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">items</span>) </span>{
                            <span class="hljs-keyword">if</span> (items &amp;&amp; items.length &gt; <span class="hljs-number">0</span>) {
                                scope.activate(items[<span class="hljs-number">0</span>]);
                                <span class="hljs-keyword">if</span> (!scope.visible &amp;&amp; scope.requestVisiblePendingSearch) {
                                    scope.visible = <span class="hljs-literal">true</span>;
                                    scope.requestVisiblePendingSearch = <span class="hljs-literal">false</span>;
                                }
                                $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                                    <span class="hljs-keyword">var</span> menu = element.find(<span class="hljs-string">".dropdown-menu"</span>);
                                    <span class="hljs-keyword">if</span> (menu.length &gt; <span class="hljs-number">0</span> &amp;&amp; menu.offset().top &lt; <span class="hljs-number">0</span>)
                                        menu.addClass(<span class="hljs-string">"reverse"</span>);
                                }, <span class="hljs-number">0</span>, <span class="hljs-literal">false</span>);
                            } <span class="hljs-keyword">else</span> {
                                scope.activate({
                                    <span class="hljs-attr">termLengthIsZero</span>: <span class="hljs-literal">true</span>
                                });
                            }
                        });
                        scope.$watch(<span class="hljs-string">'isVisible()'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">visible</span>) </span>{
                            <span class="hljs-keyword">if</span> (visible) {
                                <span class="hljs-keyword">var</span> triggerCharSet = [];
                                triggerCharSet.push(scope.triggerChar);
                                mentioUtil.popUnderMention(scope.parentMentio.context(),
                                    triggerCharSet, element, scope.requireLeadingSpace);
                            } <span class="hljs-keyword">else</span> {
                                element.find(<span class="hljs-string">".dropdown-menu"</span>).removeClass(<span class="hljs-string">"reverse"</span>);
                            }
                        });
                        <span class="hljs-keyword">var</span> prevScroll;
                        scope.parentMentio.scrollBarParents.each(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                            angular.element(<span class="hljs-keyword">this</span>).on(<span class="hljs-string">"scroll.mentio"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                                <span class="hljs-keyword">if</span> (!prevScroll)
                                    prevScroll = <span class="hljs-keyword">this</span>.scrollTop;
                                <span class="hljs-keyword">var</span> scrollDiff = prevScroll - <span class="hljs-keyword">this</span>.scrollTop;
                                prevScroll = <span class="hljs-keyword">this</span>.scrollTop;
                                <span class="hljs-keyword">if</span> (element[<span class="hljs-number">0</span>].style[<span class="hljs-string">"position"</span>] === <span class="hljs-string">"absolute"</span>) {
                                    element[<span class="hljs-number">0</span>].style[<span class="hljs-string">"z-index"</span>] = <span class="hljs-number">9</span>;
                                    element[<span class="hljs-number">0</span>].style.top = (<span class="hljs-built_in">parseInt</span>(element[<span class="hljs-number">0</span>].style.top) + scrollDiff) + <span class="hljs-string">"px"</span>;
                                }
                            });
                        });
                        scope.parentMentio.$on(<span class="hljs-string">'$destroy'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                            element.remove();
                        });
                        scope.hideMenu = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                            scope.visible = <span class="hljs-literal">false</span>;
                            element.css(<span class="hljs-string">'display'</span>, <span class="hljs-string">'none'</span>);
                        };
                        scope.adjustScroll = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">direction</span>) </span>{
                            <span class="hljs-keyword">var</span> menuEl = element[<span class="hljs-number">0</span>];
                            <span class="hljs-keyword">var</span> menuItemsList = menuEl.querySelector(<span class="hljs-string">'ul'</span>);
                            <span class="hljs-keyword">var</span> menuItem = menuEl.querySelector(<span class="hljs-string">'[mentio-menu-item].active'</span>);
                            <span class="hljs-keyword">if</span> (scope.isFirstItemActive()) {
                                <span class="hljs-keyword">return</span> menuItemsList.scrollTop = <span class="hljs-number">0</span>;
                            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (scope.isLastItemActive()) {
                                <span class="hljs-keyword">return</span> menuItemsList.scrollTop = menuItemsList.scrollHeight;
                            }
                            <span class="hljs-keyword">if</span> (direction === <span class="hljs-number">1</span>) {
                                menuItemsList.scrollTop += menuItem.offsetHeight;
                            } <span class="hljs-keyword">else</span> {
                                menuItemsList.scrollTop -= menuItem.offsetHeight;
                            }
                        };
                    }
                };
            }
        ])
        .directive(<span class="hljs-string">'mentioMenuItem'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">return</span> {
                <span class="hljs-attr">restrict</span>: <span class="hljs-string">'A'</span>,
                <span class="hljs-attr">scope</span>: {
                    <span class="hljs-attr">item</span>: <span class="hljs-string">'=mentioMenuItem'</span>
                },
                <span class="hljs-attr">require</span>: <span class="hljs-string">'^mentioMenu'</span>,
                <span class="hljs-attr">link</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">scope, element, attrs, controller</span>) </span>{
                    scope.$watch(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                        <span class="hljs-keyword">return</span> controller.isActive(scope.item);
                    }, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">active</span>) </span>{
                        <span class="hljs-keyword">if</span> (active) {
                            element.addClass(<span class="hljs-string">'active'</span>);
                        } <span class="hljs-keyword">else</span> {
                            element.removeClass(<span class="hljs-string">'active'</span>);
                        }
                    });
                    element.bind(<span class="hljs-string">'mouseenter'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                        scope.$apply(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                            controller.activate(scope.item);
                        });
                    });
                    element.bind(<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                        controller.selectItem(scope.item);
                        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
                    });
                }
            };
        })
        .filter(<span class="hljs-string">'unsafe'</span>, [<span class="hljs-string">"$sce"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$sce</span>) </span>{
            <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">val</span>) </span>{
                <span class="hljs-keyword">return</span> $sce.trustAsHtml(val);
            };
        }])
        .filter(<span class="hljs-string">'mentioHighlight'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">escapeRegexp</span>(<span class="hljs-params">queryToEscape</span>) </span>{
                <span class="hljs-keyword">return</span> queryToEscape.replace(<span class="hljs-regexp">/([.?*+^$[\]\\(){}|-])/g</span>, <span class="hljs-string">'\\$1'</span>);
            }
            <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">matchItem, query, hightlightClass</span>) </span>{
                <span class="hljs-keyword">if</span> (query) {
                    <span class="hljs-keyword">var</span> replaceText = hightlightClass ?
                        <span class="hljs-string">'&lt;span class="'</span> + hightlightClass + <span class="hljs-string">'"&gt;$&amp;&lt;/span&gt;'</span> :
                        <span class="hljs-string">'&lt;strong&gt;$&amp;&lt;/strong&gt;'</span>;
                    <span class="hljs-keyword">return</span> (<span class="hljs-string">''</span> + matchItem).replace(<span class="hljs-keyword">new</span> <span class="hljs-built_in">RegExp</span>(escapeRegexp(query), <span class="hljs-string">'gi'</span>), replaceText);
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">return</span> matchItem;
                }
            };
        });
    <span class="hljs-string">'use strict'</span>;
    angular.module(<span class="hljs-string">'mentio'</span>)
        .factory(<span class="hljs-string">'mentioUtil'</span>, [<span class="hljs-string">"$window"</span>, <span class="hljs-string">"$location"</span>, <span class="hljs-string">"$anchorScroll"</span>, <span class="hljs-string">"$timeout"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$window, $location, $anchorScroll, $timeout</span>) </span>{
            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">popUnderMention</span>(<span class="hljs-params">ctx, triggerCharSet, selectionEl, requireLeadingSpace</span>) </span>{
                <span class="hljs-keyword">var</span> coordinates;
                <span class="hljs-keyword">var</span> mentionInfo = getTriggerInfo(ctx, triggerCharSet, requireLeadingSpace, <span class="hljs-literal">false</span>);
                <span class="hljs-keyword">if</span> (mentionInfo !== <span class="hljs-literal">undefined</span>) {
                    <span class="hljs-keyword">if</span> (selectedElementIsTextAreaOrInput(ctx)) {
                        coordinates = getTextAreaOrInputUnderlinePosition(ctx, getDocument(ctx).activeElement,
                            mentionInfo.mentionPosition);
                    } <span class="hljs-keyword">else</span> {
                        coordinates = getContentEditableCaretPosition(ctx, mentionInfo.mentionPosition);
                    }
                    selectionEl.css({
                        <span class="hljs-attr">top</span>: coordinates.top + <span class="hljs-string">'px'</span>,
                        <span class="hljs-attr">left</span>: coordinates.left + <span class="hljs-string">'px'</span>,
                        <span class="hljs-attr">position</span>: <span class="hljs-string">'absolute'</span>,
                        <span class="hljs-attr">zIndex</span>: <span class="hljs-number">5000</span>,
                        <span class="hljs-attr">display</span>: <span class="hljs-string">'block'</span>
                    });
                    $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                        scrollIntoView(ctx, selectionEl);
                    }, <span class="hljs-number">0</span>);
                } <span class="hljs-keyword">else</span> {
                    selectionEl.css({
                        <span class="hljs-attr">display</span>: <span class="hljs-string">'none'</span>
                    });
                }
            }

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">scrollIntoView</span>(<span class="hljs-params">ctx, elem</span>) </span>{
                <span class="hljs-keyword">var</span> reasonableBuffer = <span class="hljs-number">20</span>;
                <span class="hljs-keyword">var</span> maxScrollDisplacement = <span class="hljs-number">100</span>;
                <span class="hljs-keyword">var</span> clientRect;
                <span class="hljs-keyword">var</span> e = elem[<span class="hljs-number">0</span>];
                <span class="hljs-keyword">while</span> (clientRect === <span class="hljs-literal">undefined</span> || clientRect.height === <span class="hljs-number">0</span>) {
                    clientRect = e.getBoundingClientRect();
                    <span class="hljs-keyword">if</span> (clientRect.height === <span class="hljs-number">0</span>) {
                        e = e.childNodes[<span class="hljs-number">0</span>];
                        <span class="hljs-keyword">if</span> (e === <span class="hljs-literal">undefined</span> || !e.getBoundingClientRect) {
                            <span class="hljs-keyword">return</span>;
                        }
                    }
                }
                <span class="hljs-keyword">var</span> elemTop = clientRect.top;
                <span class="hljs-keyword">var</span> elemBottom = elemTop + clientRect.height;
                <span class="hljs-keyword">if</span> (elemTop &lt; <span class="hljs-number">0</span>) {
                    $<span class="hljs-built_in">window</span>.scrollTo(<span class="hljs-number">0</span>, $<span class="hljs-built_in">window</span>.pageYOffset + clientRect.top - reasonableBuffer);
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (elemBottom &gt; $<span class="hljs-built_in">window</span>.innerHeight) {
                    <span class="hljs-keyword">var</span> maxY = $<span class="hljs-built_in">window</span>.pageYOffset + clientRect.top - reasonableBuffer;
                    <span class="hljs-keyword">if</span> (maxY - $<span class="hljs-built_in">window</span>.pageYOffset &gt; maxScrollDisplacement) {
                        maxY = $<span class="hljs-built_in">window</span>.pageYOffset + maxScrollDisplacement;
                    }
                    <span class="hljs-keyword">var</span> targetY = $<span class="hljs-built_in">window</span>.pageYOffset - ($<span class="hljs-built_in">window</span>.innerHeight - elemBottom);
                    <span class="hljs-keyword">if</span> (targetY &gt; maxY) {
                        targetY = maxY;
                    }
                    $<span class="hljs-built_in">window</span>.scrollTo(<span class="hljs-number">0</span>, targetY);
                }
            }

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">selectedElementIsTextAreaOrInput</span>(<span class="hljs-params">ctx</span>) </span>{
                <span class="hljs-keyword">var</span> element = getDocument(ctx).activeElement;
                <span class="hljs-keyword">if</span> (element !== <span class="hljs-literal">null</span>) {
                    <span class="hljs-keyword">var</span> nodeName = element.nodeName;
                    <span class="hljs-keyword">var</span> type = element.getAttribute(<span class="hljs-string">'type'</span>);
                    <span class="hljs-keyword">return</span> (nodeName === <span class="hljs-string">'INPUT'</span> &amp;&amp; type === <span class="hljs-string">'text'</span>) || nodeName === <span class="hljs-string">'TEXTAREA'</span>;
                }
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            }

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">selectElement</span>(<span class="hljs-params">ctx, targetElement, path, offset</span>) </span>{
                <span class="hljs-keyword">var</span> range;
                <span class="hljs-keyword">var</span> elem = targetElement;
                <span class="hljs-keyword">if</span> (path) {
                    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; path.length; i++) {
                        elem = elem.childNodes[path[i]];
                        <span class="hljs-keyword">if</span> (elem === <span class="hljs-literal">undefined</span>) {
                            <span class="hljs-keyword">return</span>;
                        }
                        <span class="hljs-keyword">while</span> (elem.length &lt; offset) {
                            offset -= elem.length;
                            elem = elem.nextSibling;
                        }
                        <span class="hljs-keyword">if</span> (elem.childNodes.length === <span class="hljs-number">0</span> &amp;&amp; !elem.length) {
                            elem = elem.previousSibling;
                        }
                    }
                }
                <span class="hljs-keyword">var</span> sel = getWindowSelection(ctx);
                range = getDocument(ctx).createRange();
                range.setStart(elem, offset);
                range.setEnd(elem, offset);
                range.collapse(<span class="hljs-literal">true</span>);
                <span class="hljs-keyword">try</span> {
                    sel.removeAllRanges();
                } <span class="hljs-keyword">catch</span> (error) {}
                sel.addRange(range);
                targetElement.focus();
            }

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">pasteHtml</span>(<span class="hljs-params">ctx, html, startPos, endPos</span>) </span>{
                <span class="hljs-keyword">var</span> range, sel;
                sel = getWindowSelection(ctx);
                range = getDocument(ctx).createRange();
                range.setStart(sel.anchorNode, startPos);
                range.setEnd(sel.anchorNode, endPos);
                range.deleteContents();
                <span class="hljs-keyword">var</span> el = getDocument(ctx).createElement(<span class="hljs-string">'div'</span>);
                el.innerHTML = html;
                <span class="hljs-keyword">var</span> frag = getDocument(ctx).createDocumentFragment(),
                    node, lastNode;
                <span class="hljs-keyword">while</span> ((node = el.firstChild)) {
                    lastNode = frag.appendChild(node);
                }
                range.insertNode(frag);
                <span class="hljs-keyword">if</span> (lastNode) {
                    range = range.cloneRange();
                    range.setStartAfter(lastNode);
                    range.collapse(<span class="hljs-literal">true</span>);
                    sel.removeAllRanges();
                    sel.addRange(range);
                }
            }

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">resetSelection</span>(<span class="hljs-params">ctx, targetElement, path, offset</span>) </span>{
                <span class="hljs-keyword">var</span> nodeName = targetElement.nodeName;
                <span class="hljs-keyword">if</span> (nodeName === <span class="hljs-string">'INPUT'</span> || nodeName === <span class="hljs-string">'TEXTAREA'</span>) {
                    <span class="hljs-keyword">if</span> (targetElement !== getDocument(ctx).activeElement) {
                        targetElement.focus();
                    }
                } <span class="hljs-keyword">else</span> {
                    selectElement(ctx, targetElement, path, offset);
                }
            }

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">replaceMacroText</span>(<span class="hljs-params">ctx, targetElement, path, offset, macros, text</span>) </span>{
                resetSelection(ctx, targetElement, path, offset);
                <span class="hljs-keyword">var</span> macroMatchInfo = getMacroMatch(ctx, macros);
                <span class="hljs-keyword">if</span> (macroMatchInfo.macroHasTrailingSpace) {
                    macroMatchInfo.macroText = macroMatchInfo.macroText + <span class="hljs-string">'\xA0'</span>;
                    text = text + <span class="hljs-string">'\xA0'</span>;
                }
                <span class="hljs-keyword">if</span> (macroMatchInfo !== <span class="hljs-literal">undefined</span>) {
                    <span class="hljs-keyword">var</span> element = getDocument(ctx).activeElement;
                    <span class="hljs-keyword">if</span> (selectedElementIsTextAreaOrInput(ctx)) {
                        <span class="hljs-keyword">var</span> startPos = macroMatchInfo.macroPosition;
                        <span class="hljs-keyword">var</span> endPos = macroMatchInfo.macroPosition + macroMatchInfo.macroText.length;
                        element.value = element.value.substring(<span class="hljs-number">0</span>, startPos) + text +
                            element.value.substring(endPos, element.value.length);
                        element.selectionStart = startPos + text.length;
                        element.selectionEnd = startPos + text.length;
                    } <span class="hljs-keyword">else</span> {
                        pasteHtml(ctx, text, macroMatchInfo.macroPosition,
                            macroMatchInfo.macroPosition + macroMatchInfo.macroText.length);
                    }
                }
            }

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">replaceTriggerText</span>(<span class="hljs-params">ctx, targetElement, path, offset, triggerCharSet,
                text, requireLeadingSpace, hasTrailingSpace, suppressTrailingSpace</span>) </span>{
                resetSelection(ctx, targetElement, path, offset);
                <span class="hljs-keyword">var</span> mentionInfo = getTriggerInfo(ctx, triggerCharSet, requireLeadingSpace, <span class="hljs-literal">true</span>, hasTrailingSpace);
                <span class="hljs-keyword">if</span> (mentionInfo !== <span class="hljs-literal">undefined</span>) {
                    <span class="hljs-keyword">if</span> (selectedElementIsTextAreaOrInput()) {
                        <span class="hljs-keyword">var</span> myField = getDocument(ctx).activeElement;
                        <span class="hljs-keyword">if</span> (!suppressTrailingSpace) {
                            text = text + <span class="hljs-string">' '</span>;
                        }
                        <span class="hljs-keyword">var</span> startPos = mentionInfo.mentionPosition;
                        <span class="hljs-keyword">var</span> endPos = mentionInfo.mentionPosition + mentionInfo.mentionText.length + <span class="hljs-number">1</span>;
                        myField.value = myField.value.substring(<span class="hljs-number">0</span>, startPos) + text +
                            myField.value.substring(endPos, myField.value.length);
                        myField.selectionStart = startPos + text.length;
                        myField.selectionEnd = startPos + text.length;
                    } <span class="hljs-keyword">else</span> {
                        <span class="hljs-keyword">if</span> (!suppressTrailingSpace) {
                            text = text + <span class="hljs-string">'\xA0'</span>;
                        }
                        pasteHtml(ctx, text, mentionInfo.mentionPosition,
                            mentionInfo.mentionPosition + mentionInfo.mentionText.length + <span class="hljs-number">1</span>);
                    }
                }
            }

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getNodePositionInParent</span>(<span class="hljs-params">ctx, elem</span>) </span>{
                <span class="hljs-keyword">if</span> (elem.parentNode === <span class="hljs-literal">null</span>) {
                    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
                }
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; elem.parentNode.childNodes.length; i++) {
                    <span class="hljs-keyword">var</span> node = elem.parentNode.childNodes[i];
                    <span class="hljs-keyword">if</span> (node === elem) {
                        <span class="hljs-keyword">return</span> i;
                    }
                }
            }

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getMacroMatch</span>(<span class="hljs-params">ctx, macros</span>) </span>{
                <span class="hljs-keyword">var</span> selected, path = [],
                    offset;
                <span class="hljs-keyword">if</span> (selectedElementIsTextAreaOrInput(ctx)) {
                    selected = getDocument(ctx).activeElement;
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">var</span> selectionInfo = getContentEditableSelectedPath(ctx);
                    <span class="hljs-keyword">if</span> (selectionInfo) {
                        selected = selectionInfo.selected;
                        path = selectionInfo.path;
                        offset = selectionInfo.offset;
                    }
                }
                <span class="hljs-keyword">var</span> effectiveRange = getTextPrecedingCurrentSelection(ctx);
                <span class="hljs-keyword">if</span> (effectiveRange !== <span class="hljs-literal">undefined</span> &amp;&amp; effectiveRange !== <span class="hljs-literal">null</span>) {
                    <span class="hljs-keyword">var</span> matchInfo;
                    <span class="hljs-keyword">var</span> hasTrailingSpace = <span class="hljs-literal">false</span>;
                    <span class="hljs-keyword">if</span> (effectiveRange.length &gt; <span class="hljs-number">0</span> &amp;&amp;
                        (effectiveRange.charAt(effectiveRange.length - <span class="hljs-number">1</span>) === <span class="hljs-string">'\xA0'</span> ||
                            effectiveRange.charAt(effectiveRange.length - <span class="hljs-number">1</span>) === <span class="hljs-string">' '</span>)) {
                        hasTrailingSpace = <span class="hljs-literal">true</span>;
                        effectiveRange = effectiveRange.substring(<span class="hljs-number">0</span>, effectiveRange.length - <span class="hljs-number">1</span>);
                    }
                    angular.forEach(macros, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">macro, c</span>) </span>{
                        <span class="hljs-keyword">var</span> idx = effectiveRange.toUpperCase().lastIndexOf(c.toUpperCase());
                        <span class="hljs-keyword">if</span> (idx &gt;= <span class="hljs-number">0</span> &amp;&amp; c.length + idx === effectiveRange.length) {
                            <span class="hljs-keyword">var</span> prevCharPos = idx - <span class="hljs-number">1</span>;
                            <span class="hljs-keyword">if</span> (idx === <span class="hljs-number">0</span> || effectiveRange.charAt(prevCharPos) === <span class="hljs-string">'\xA0'</span> ||
                                effectiveRange.charAt(prevCharPos) === <span class="hljs-string">' '</span>) {
                                matchInfo = {
                                    <span class="hljs-attr">macroPosition</span>: idx,
                                    <span class="hljs-attr">macroText</span>: c,
                                    <span class="hljs-attr">macroSelectedElement</span>: selected,
                                    <span class="hljs-attr">macroSelectedPath</span>: path,
                                    <span class="hljs-attr">macroSelectedOffset</span>: offset,
                                    <span class="hljs-attr">macroHasTrailingSpace</span>: hasTrailingSpace
                                };
                            }
                        }
                    });
                    <span class="hljs-keyword">if</span> (matchInfo) {
                        <span class="hljs-keyword">return</span> matchInfo;
                    }
                }
            }

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getContentEditableSelectedPath</span>(<span class="hljs-params">ctx</span>) </span>{
                <span class="hljs-keyword">var</span> sel = getWindowSelection(ctx);
                <span class="hljs-keyword">var</span> selected = sel.anchorNode;
                <span class="hljs-keyword">var</span> path = [];
                <span class="hljs-keyword">var</span> offset;
                <span class="hljs-keyword">if</span> (selected != <span class="hljs-literal">null</span>) {
                    <span class="hljs-keyword">var</span> i;
                    <span class="hljs-keyword">var</span> ce = selected.contentEditable;
                    <span class="hljs-keyword">while</span> (selected !== <span class="hljs-literal">null</span> &amp;&amp; ce !== <span class="hljs-string">'true'</span>) {
                        i = getNodePositionInParent(ctx, selected);
                        path.push(i);
                        selected = selected.parentNode;
                        <span class="hljs-keyword">if</span> (selected !== <span class="hljs-literal">null</span>) {
                            ce = selected.contentEditable;
                        }
                    }
                    path.reverse();
                    offset = sel.getRangeAt(<span class="hljs-number">0</span>).startOffset;
                    <span class="hljs-keyword">return</span> {
                        <span class="hljs-attr">selected</span>: selected,
                        <span class="hljs-attr">path</span>: path,
                        <span class="hljs-attr">offset</span>: offset
                    };
                }
            }

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getTriggerInfo</span>(<span class="hljs-params">ctx, triggerCharSet, requireLeadingSpace, menuAlreadyActive, hasTrailingSpace</span>) </span>{
                <span class="hljs-keyword">var</span> selected, path, offset;
                <span class="hljs-keyword">if</span> (selectedElementIsTextAreaOrInput(ctx)) {
                    selected = getDocument(ctx).activeElement;
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">var</span> selectionInfo = getContentEditableSelectedPath(ctx);
                    <span class="hljs-keyword">if</span> (selectionInfo) {
                        selected = selectionInfo.selected;
                        path = selectionInfo.path;
                        offset = selectionInfo.offset;
                    }
                }
                <span class="hljs-keyword">var</span> effectiveRange = getTextPrecedingCurrentSelection(ctx);
                <span class="hljs-keyword">if</span> (effectiveRange !== <span class="hljs-literal">undefined</span> &amp;&amp; effectiveRange !== <span class="hljs-literal">null</span>) {
                    <span class="hljs-keyword">var</span> mostRecentTriggerCharPos = <span class="hljs-number">-1</span>;
                    <span class="hljs-keyword">var</span> triggerChar;
                    triggerCharSet.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">c</span>) </span>{
                        <span class="hljs-keyword">var</span> idx = effectiveRange.lastIndexOf(c);
                        <span class="hljs-keyword">if</span> (idx &gt; mostRecentTriggerCharPos) {
                            mostRecentTriggerCharPos = idx;
                            triggerChar = c;
                        }
                    });
                    <span class="hljs-keyword">if</span> (mostRecentTriggerCharPos &gt;= <span class="hljs-number">0</span> &amp;&amp;
                        (
                            mostRecentTriggerCharPos === <span class="hljs-number">0</span> ||
                            !requireLeadingSpace ||
                            <span class="hljs-regexp">/[\xA0\s]/g</span>.test(
                                effectiveRange.substring(
                                    mostRecentTriggerCharPos - <span class="hljs-number">1</span>,
                                    mostRecentTriggerCharPos)
                            )
                        )
                    ) {
                        <span class="hljs-keyword">var</span> currentTriggerSnippet = effectiveRange.substring(mostRecentTriggerCharPos + <span class="hljs-number">1</span>,
                            effectiveRange.length);
                        triggerChar = effectiveRange.substring(mostRecentTriggerCharPos, mostRecentTriggerCharPos + <span class="hljs-number">1</span>);
                        <span class="hljs-keyword">var</span> firstSnippetChar = currentTriggerSnippet.substring(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>);
                        <span class="hljs-keyword">var</span> leadingSpace = currentTriggerSnippet.length &gt; <span class="hljs-number">0</span> &amp;&amp;
                            (
                                firstSnippetChar === <span class="hljs-string">' '</span> ||
                                firstSnippetChar === <span class="hljs-string">'\xA0'</span>
                            );
                        <span class="hljs-keyword">if</span> (hasTrailingSpace) {
                            currentTriggerSnippet = currentTriggerSnippet.trim();
                        }
                        <span class="hljs-keyword">if</span> (!leadingSpace &amp;&amp; (menuAlreadyActive || !(<span class="hljs-regexp">/[\xA0\s]/g</span>.test(currentTriggerSnippet)))) {
                            <span class="hljs-keyword">return</span> {
                                <span class="hljs-attr">mentionPosition</span>: mostRecentTriggerCharPos,
                                <span class="hljs-attr">mentionText</span>: currentTriggerSnippet,
                                <span class="hljs-attr">mentionSelectedElement</span>: selected,
                                <span class="hljs-attr">mentionSelectedPath</span>: path,
                                <span class="hljs-attr">mentionSelectedOffset</span>: offset,
                                <span class="hljs-attr">mentionTriggerChar</span>: triggerChar
                            };
                        }
                    }
                }
            }

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getWindowSelection</span>(<span class="hljs-params">ctx</span>) </span>{
                <span class="hljs-keyword">if</span> (!ctx) {
                    <span class="hljs-keyword">return</span> <span class="hljs-built_in">window</span>.getSelection();
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">return</span> ctx.iframe.contentWindow.getSelection();
                }
            }

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getDocument</span>(<span class="hljs-params">ctx</span>) </span>{
                <span class="hljs-keyword">if</span> (!ctx) {
                    <span class="hljs-keyword">return</span> <span class="hljs-built_in">document</span>;
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">return</span> ctx.iframe.contentWindow.document;
                }
            }

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getTextPrecedingCurrentSelection</span>(<span class="hljs-params">ctx</span>) </span>{
                <span class="hljs-keyword">var</span> text;
                <span class="hljs-keyword">if</span> (selectedElementIsTextAreaOrInput(ctx)) {
                    <span class="hljs-keyword">var</span> textComponent = getDocument(ctx).activeElement;
                    <span class="hljs-keyword">var</span> startPos = textComponent.selectionStart;
                    text = textComponent.value.substring(<span class="hljs-number">0</span>, startPos);
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">var</span> selectedElem = getWindowSelection(ctx).anchorNode;
                    <span class="hljs-keyword">if</span> (selectedElem != <span class="hljs-literal">null</span>) {
                        <span class="hljs-keyword">var</span> workingNodeContent = selectedElem.textContent;
                        <span class="hljs-keyword">var</span> selectStartOffset = getWindowSelection(ctx).getRangeAt(<span class="hljs-number">0</span>).startOffset;
                        <span class="hljs-keyword">if</span> (selectStartOffset &gt;= <span class="hljs-number">0</span>) {
                            text = workingNodeContent.substring(<span class="hljs-number">0</span>, selectStartOffset);
                        }
                    }
                }
                <span class="hljs-keyword">return</span> text;
            }

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getContentEditableCaretPosition</span>(<span class="hljs-params">ctx, selectedNodePosition</span>) </span>{
                <span class="hljs-keyword">var</span> markerTextChar = <span class="hljs-string">'\ufeff'</span>;
                <span class="hljs-keyword">var</span> markerEl, markerId = <span class="hljs-string">'sel_'</span> + <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().getTime() + <span class="hljs-string">'_'</span> + <span class="hljs-built_in">Math</span>.random().toString().substr(<span class="hljs-number">2</span>);
                <span class="hljs-keyword">var</span> range;
                <span class="hljs-keyword">var</span> sel = getWindowSelection(ctx);
                <span class="hljs-keyword">var</span> prevRange = sel.getRangeAt(<span class="hljs-number">0</span>);
                range = getDocument(ctx).createRange();
                range.setStart(sel.anchorNode, selectedNodePosition);
                range.setEnd(sel.anchorNode, selectedNodePosition);
                range.collapse(<span class="hljs-literal">false</span>);
                markerEl = getDocument(ctx).createElement(<span class="hljs-string">'span'</span>);
                markerEl.id = markerId;
                markerEl.appendChild(getDocument(ctx).createTextNode(markerTextChar));
                range.insertNode(markerEl);
                sel.removeAllRanges();
                sel.addRange(prevRange);
                <span class="hljs-keyword">var</span> coordinates = {
                    <span class="hljs-attr">left</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-attr">top</span>: markerEl.offsetHeight
                };
                localToGlobalCoordinates(ctx, markerEl, coordinates);
                markerEl.parentNode.removeChild(markerEl);
                <span class="hljs-keyword">return</span> coordinates;
            }

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">localToGlobalCoordinates</span>(<span class="hljs-params">ctx, element, coordinates</span>) </span>{
                <span class="hljs-keyword">var</span> obj = element;
                <span class="hljs-keyword">var</span> iframe = ctx ? ctx.iframe : <span class="hljs-literal">null</span>;
                <span class="hljs-keyword">while</span> (obj) {
                    coordinates.left += obj.offsetLeft;
                    coordinates.top += obj.offsetTop;
                    <span class="hljs-keyword">if</span> (obj !== getDocument().body) {
                        coordinates.top -= obj.scrollTop;
                        coordinates.left -= obj.scrollLeft;
                    }
                    obj = obj.offsetParent;
                    <span class="hljs-keyword">if</span> (!obj &amp;&amp; iframe) {
                        obj = iframe;
                        iframe = <span class="hljs-literal">null</span>;
                    }
                }
            }

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getTextAreaOrInputUnderlinePosition</span>(<span class="hljs-params">ctx, element, position</span>) </span>{
                <span class="hljs-keyword">var</span> properties = [
                    <span class="hljs-string">'direction'</span>,
                    <span class="hljs-string">'boxSizing'</span>,
                    <span class="hljs-string">'width'</span>,
                    <span class="hljs-string">'height'</span>,
                    <span class="hljs-string">'overflowX'</span>,
                    <span class="hljs-string">'overflowY'</span>,
                    <span class="hljs-string">'borderTopWidth'</span>,
                    <span class="hljs-string">'borderRightWidth'</span>,
                    <span class="hljs-string">'borderBottomWidth'</span>,
                    <span class="hljs-string">'borderLeftWidth'</span>,
                    <span class="hljs-string">'paddingTop'</span>,
                    <span class="hljs-string">'paddingRight'</span>,
                    <span class="hljs-string">'paddingBottom'</span>,
                    <span class="hljs-string">'paddingLeft'</span>,
                    <span class="hljs-string">'fontStyle'</span>,
                    <span class="hljs-string">'fontVariant'</span>,
                    <span class="hljs-string">'fontWeight'</span>,
                    <span class="hljs-string">'fontStretch'</span>,
                    <span class="hljs-string">'fontSize'</span>,
                    <span class="hljs-string">'fontSizeAdjust'</span>,
                    <span class="hljs-string">'lineHeight'</span>,
                    <span class="hljs-string">'fontFamily'</span>,
                    <span class="hljs-string">'textAlign'</span>,
                    <span class="hljs-string">'textTransform'</span>,
                    <span class="hljs-string">'textIndent'</span>,
                    <span class="hljs-string">'textDecoration'</span>,
                    <span class="hljs-string">'letterSpacing'</span>,
                    <span class="hljs-string">'wordSpacing'</span>
                ];
                <span class="hljs-keyword">var</span> isFirefox = (<span class="hljs-built_in">window</span>.mozInnerScreenX !== <span class="hljs-literal">null</span>);
                <span class="hljs-keyword">var</span> div = getDocument(ctx).createElement(<span class="hljs-string">'div'</span>);
                div.id = <span class="hljs-string">'input-textarea-caret-position-mirror-div'</span>;
                getDocument(ctx).body.appendChild(div);
                <span class="hljs-keyword">var</span> style = div.style;
                <span class="hljs-keyword">var</span> computed = <span class="hljs-built_in">window</span>.getComputedStyle ? getComputedStyle(element) : element.currentStyle;
                style.whiteSpace = <span class="hljs-string">'pre-wrap'</span>;
                <span class="hljs-keyword">if</span> (element.nodeName !== <span class="hljs-string">'INPUT'</span>) {
                    style.wordWrap = <span class="hljs-string">'break-word'</span>;
                }
                style.position = <span class="hljs-string">'absolute'</span>;
                style.visibility = <span class="hljs-string">'hidden'</span>;
                properties.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">prop</span>) </span>{
                    style[prop] = computed[prop];
                });
                <span class="hljs-keyword">if</span> (isFirefox) {
                    style.width = (<span class="hljs-built_in">parseInt</span>(computed.width) - <span class="hljs-number">2</span>) + <span class="hljs-string">'px'</span>;
                    <span class="hljs-keyword">if</span> (element.scrollHeight &gt; <span class="hljs-built_in">parseInt</span>(computed.height))
                        style.overflowY = <span class="hljs-string">'scroll'</span>;
                } <span class="hljs-keyword">else</span> {
                    style.overflow = <span class="hljs-string">'hidden'</span>;
                }
                div.textContent = element.value.substring(<span class="hljs-number">0</span>, position);
                <span class="hljs-keyword">if</span> (element.nodeName === <span class="hljs-string">'INPUT'</span>) {
                    div.textContent = div.textContent.replace(<span class="hljs-regexp">/\s/g</span>, <span class="hljs-string">'\u00a0'</span>);
                }
                <span class="hljs-keyword">var</span> span = getDocument(ctx).createElement(<span class="hljs-string">'span'</span>);
                span.textContent = element.value.substring(position) || <span class="hljs-string">'.'</span>;
                div.appendChild(span);
                <span class="hljs-keyword">var</span> coordinates = {
                    <span class="hljs-attr">top</span>: span.offsetTop + <span class="hljs-built_in">parseInt</span>(computed.borderTopWidth) + <span class="hljs-built_in">parseInt</span>(computed.fontSize),
                    <span class="hljs-attr">left</span>: span.offsetLeft + <span class="hljs-built_in">parseInt</span>(computed.borderLeftWidth)
                };
                localToGlobalCoordinates(ctx, element, coordinates);
                getDocument(ctx).body.removeChild(div);
                <span class="hljs-keyword">return</span> coordinates;
            }
            <span class="hljs-keyword">return</span> {
                <span class="hljs-attr">popUnderMention</span>: popUnderMention,
                <span class="hljs-attr">replaceMacroText</span>: replaceMacroText,
                <span class="hljs-attr">replaceTriggerText</span>: replaceTriggerText,
                <span class="hljs-attr">getMacroMatch</span>: getMacroMatch,
                <span class="hljs-attr">getTriggerInfo</span>: getTriggerInfo,
                <span class="hljs-attr">selectElement</span>: selectElement,
                <span class="hljs-attr">getTextAreaOrInputUnderlinePosition</span>: getTextAreaOrInputUnderlinePosition,
                <span class="hljs-attr">getTextPrecedingCurrentSelection</span>: getTextPrecedingCurrentSelection,
                <span class="hljs-attr">getContentEditableSelectedPath</span>: getContentEditableSelectedPath,
                <span class="hljs-attr">getNodePositionInParent</span>: getNodePositionInParent,
                <span class="hljs-attr">getContentEditableCaretPosition</span>: getContentEditableCaretPosition,
                <span class="hljs-attr">pasteHtml</span>: pasteHtml,
                <span class="hljs-attr">resetSelection</span>: resetSelection,
                <span class="hljs-attr">scrollIntoView</span>: scrollIntoView
            };
        }]);
    angular.module(<span class="hljs-string">"mentio"</span>).run([<span class="hljs-string">"$templateCache"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$templateCache</span>) </span>{
        $templateCache.put(<span class="hljs-string">"mentio-menu.tpl.html"</span>, <span class="hljs-string">"&lt;style&gt;\n.scrollable-menu {\n    height: auto;\n    max-height: 300px;\n    overflow: auto;\n}\n\n.menu-highlighted {\n    font-weight: bold;\n}\n&lt;/style&gt;\n&lt;ul class=\"dropdown-menu scrollable-menu\" style=\"display:block\"&gt;\n    &lt;li mentio-menu-item=\"item\" ng-repeat=\"item in items track by $index\"&gt;\n        &lt;a class=\"text-primary\" ng-bind-html=\"item.label | mentioHighlight:typedTerm:\'menu-highlighted\' | unsafe\"&gt;&lt;/a&gt;\n    &lt;/li&gt;\n&lt;/ul&gt;"</span>);
    }]);
})();
<span class="hljs-comment">/*! RESOURCE: /scripts/thirdparty/typeahead/typeahead.jquery.js */</span>
(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">root, factory</span>) </span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> define === <span class="hljs-string">"function"</span> &amp;&amp; define.amd) {
        define(<span class="hljs-string">"typeahead.js"</span>, [<span class="hljs-string">"jquery"</span>], <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">a0</span>) </span>{
            <span class="hljs-keyword">return</span> factory(a0);
        });
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> exports === <span class="hljs-string">"object"</span>) {
        <span class="hljs-built_in">module</span>.exports = factory(<span class="hljs-built_in">require</span>(<span class="hljs-string">"jquery"</span>));
    } <span class="hljs-keyword">else</span> {
        factory(jQuery);
    }
})(<span class="hljs-keyword">this</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$</span>) </span>{
    <span class="hljs-keyword">var</span> _ = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-meta">        "use strict"</span>;
        <span class="hljs-keyword">return</span> {
            <span class="hljs-attr">isMsie</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> <span class="hljs-regexp">/(msie|trident)/i</span>.test(navigator.userAgent) ? navigator.userAgent.match(<span class="hljs-regexp">/(msie |rv:)(\d+(.\d+)?)/i</span>)[<span class="hljs-number">2</span>] : <span class="hljs-literal">false</span>;
            },
            <span class="hljs-attr">isBlankString</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">str</span>) </span>{
                <span class="hljs-keyword">return</span> !str || <span class="hljs-regexp">/^\s*$/</span>.test(str);
            },
            <span class="hljs-attr">escapeRegExChars</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">str</span>) </span>{
                <span class="hljs-keyword">return</span> str.replace(<span class="hljs-regexp">/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g</span>, <span class="hljs-string">"\\$&amp;"</span>);
            },
            <span class="hljs-attr">isString</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">obj</span>) </span>{
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">typeof</span> obj === <span class="hljs-string">"string"</span>;
            },
            <span class="hljs-attr">isNumber</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">obj</span>) </span>{
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">typeof</span> obj === <span class="hljs-string">"number"</span>;
            },
            <span class="hljs-attr">isArray</span>: $.isArray,
            <span class="hljs-attr">isFunction</span>: $.isFunction,
            <span class="hljs-attr">isObject</span>: $.isPlainObject,
            <span class="hljs-attr">isUndefined</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">obj</span>) </span>{
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">typeof</span> obj === <span class="hljs-string">"undefined"</span>;
            },
            <span class="hljs-attr">isElement</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">obj</span>) </span>{
                <span class="hljs-keyword">return</span> !!(obj &amp;&amp; obj.nodeType === <span class="hljs-number">1</span>);
            },
            <span class="hljs-attr">isJQuery</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">obj</span>) </span>{
                <span class="hljs-keyword">return</span> obj <span class="hljs-keyword">instanceof</span> $;
            },
            <span class="hljs-attr">toStr</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">toStr</span>(<span class="hljs-params">s</span>) </span>{
                <span class="hljs-keyword">return</span> _.isUndefined(s) || s === <span class="hljs-literal">null</span> ? <span class="hljs-string">""</span> : s + <span class="hljs-string">""</span>;
            },
            <span class="hljs-attr">bind</span>: $.proxy,
            <span class="hljs-attr">each</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">collection, cb</span>) </span>{
                $.each(collection, reverseArgs);

                <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">reverseArgs</span>(<span class="hljs-params">index, value</span>) </span>{
                    <span class="hljs-keyword">return</span> cb(value, index);
                }
            },
            <span class="hljs-attr">map</span>: $.map,
            <span class="hljs-attr">filter</span>: $.grep,
            <span class="hljs-attr">every</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">obj, test</span>) </span>{
                <span class="hljs-keyword">var</span> result = <span class="hljs-literal">true</span>;
                <span class="hljs-keyword">if</span> (!obj) {
                    <span class="hljs-keyword">return</span> result;
                }
                $.each(obj, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">key, val</span>) </span>{
                    <span class="hljs-keyword">if</span> (!(result = test.call(<span class="hljs-literal">null</span>, val, key, obj))) {
                        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
                    }
                });
                <span class="hljs-keyword">return</span> !!result;
            },
            <span class="hljs-attr">some</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">obj, test</span>) </span>{
                <span class="hljs-keyword">var</span> result = <span class="hljs-literal">false</span>;
                <span class="hljs-keyword">if</span> (!obj) {
                    <span class="hljs-keyword">return</span> result;
                }
                $.each(obj, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">key, val</span>) </span>{
                    <span class="hljs-keyword">if</span> (result = test.call(<span class="hljs-literal">null</span>, val, key, obj)) {
                        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
                    }
                });
                <span class="hljs-keyword">return</span> !!result;
            },
            <span class="hljs-attr">mixin</span>: $.extend,
            <span class="hljs-attr">identity</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">x</span>) </span>{
                <span class="hljs-keyword">return</span> x;
            },
            <span class="hljs-attr">clone</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">obj</span>) </span>{
                <span class="hljs-keyword">return</span> $.extend(<span class="hljs-literal">true</span>, {}, obj);
            },
            <span class="hljs-attr">getIdGenerator</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">var</span> counter = <span class="hljs-number">0</span>;
                <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    <span class="hljs-keyword">return</span> counter++;
                };
            },
            <span class="hljs-attr">templatify</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">templatify</span>(<span class="hljs-params">obj</span>) </span>{
                <span class="hljs-keyword">return</span> $.isFunction(obj) ? obj : template;

                <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">template</span>(<span class="hljs-params"></span>) </span>{
                    <span class="hljs-keyword">return</span> <span class="hljs-built_in">String</span>(obj);
                }
            },
            <span class="hljs-attr">defer</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">fn</span>) </span>{
                setTimeout(fn, <span class="hljs-number">0</span>);
            },
            <span class="hljs-attr">debounce</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">func, wait, immediate</span>) </span>{
                <span class="hljs-keyword">var</span> timeout, result;
                <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    <span class="hljs-keyword">var</span> context = <span class="hljs-keyword">this</span>,
                        args = <span class="hljs-built_in">arguments</span>,
                        later, callNow;
                    later = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                        timeout = <span class="hljs-literal">null</span>;
                        <span class="hljs-keyword">if</span> (!immediate) {
                            result = func.apply(context, args);
                        }
                    };
                    callNow = immediate &amp;&amp; !timeout;
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                    <span class="hljs-keyword">if</span> (callNow) {
                        result = func.apply(context, args);
                    }
                    <span class="hljs-keyword">return</span> result;
                };
            },
            <span class="hljs-attr">throttle</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">func, wait</span>) </span>{
                <span class="hljs-keyword">var</span> context, args, timeout, result, previous, later;
                previous = <span class="hljs-number">0</span>;
                later = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    previous = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>();
                    timeout = <span class="hljs-literal">null</span>;
                    result = func.apply(context, args);
                };
                <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    <span class="hljs-keyword">var</span> now = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(),
                        remaining = wait - (now - previous);
                    context = <span class="hljs-keyword">this</span>;
                    args = <span class="hljs-built_in">arguments</span>;
                    <span class="hljs-keyword">if</span> (remaining &lt;= <span class="hljs-number">0</span>) {
                        clearTimeout(timeout);
                        timeout = <span class="hljs-literal">null</span>;
                        previous = now;
                        result = func.apply(context, args);
                    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!timeout) {
                        timeout = setTimeout(later, remaining);
                    }
                    <span class="hljs-keyword">return</span> result;
                };
            },
            <span class="hljs-attr">stringify</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">val</span>) </span>{
                <span class="hljs-keyword">return</span> _.isString(val) ? val : <span class="hljs-built_in">JSON</span>.stringify(val);
            },
            <span class="hljs-attr">noop</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{}
        };
    }();
    <span class="hljs-keyword">var</span> WWW = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-meta">        "use strict"</span>;
        <span class="hljs-keyword">var</span> defaultClassNames = {
            <span class="hljs-attr">wrapper</span>: <span class="hljs-string">"twitter-typeahead"</span>,
            <span class="hljs-attr">input</span>: <span class="hljs-string">"tt-input"</span>,
            <span class="hljs-attr">hint</span>: <span class="hljs-string">"tt-hint"</span>,
            <span class="hljs-attr">menu</span>: <span class="hljs-string">"tt-menu"</span>,
            <span class="hljs-attr">dataset</span>: <span class="hljs-string">"tt-dataset"</span>,
            <span class="hljs-attr">suggestion</span>: <span class="hljs-string">"tt-suggestion"</span>,
            <span class="hljs-attr">selectable</span>: <span class="hljs-string">"tt-selectable"</span>,
            <span class="hljs-attr">empty</span>: <span class="hljs-string">"tt-empty"</span>,
            <span class="hljs-attr">open</span>: <span class="hljs-string">"tt-open"</span>,
            <span class="hljs-attr">cursor</span>: <span class="hljs-string">"tt-cursor"</span>,
            <span class="hljs-attr">highlight</span>: <span class="hljs-string">"tt-highlight"</span>
        };
        <span class="hljs-keyword">return</span> build;

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">build</span>(<span class="hljs-params">o</span>) </span>{
            <span class="hljs-keyword">var</span> www, classes;
            classes = _.mixin({}, defaultClassNames, o);
            www = {
                <span class="hljs-attr">css</span>: buildCss(),
                <span class="hljs-attr">classes</span>: classes,
                <span class="hljs-attr">html</span>: buildHtml(classes),
                <span class="hljs-attr">selectors</span>: buildSelectors(classes)
            };
            <span class="hljs-keyword">return</span> {
                <span class="hljs-attr">css</span>: www.css,
                <span class="hljs-attr">html</span>: www.html,
                <span class="hljs-attr">classes</span>: www.classes,
                <span class="hljs-attr">selectors</span>: www.selectors,
                <span class="hljs-attr">mixin</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">o</span>) </span>{
                    _.mixin(o, www);
                }
            };
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">buildHtml</span>(<span class="hljs-params">c</span>) </span>{
            <span class="hljs-keyword">return</span> {
                <span class="hljs-attr">wrapper</span>: <span class="hljs-string">'&lt;span class="'</span> + c.wrapper + <span class="hljs-string">'"&gt;&lt;/span&gt;'</span>,
                <span class="hljs-attr">menu</span>: <span class="hljs-string">'&lt;div class="'</span> + c.menu + <span class="hljs-string">'"&gt;&lt;/div&gt;'</span>
            };
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">buildSelectors</span>(<span class="hljs-params">classes</span>) </span>{
            <span class="hljs-keyword">var</span> selectors = {};
            _.each(classes, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">v, k</span>) </span>{
                selectors[k] = <span class="hljs-string">"."</span> + v;
            });
            <span class="hljs-keyword">return</span> selectors;
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">buildCss</span>(<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">var</span> css = {
                <span class="hljs-attr">wrapper</span>: {
                    <span class="hljs-attr">position</span>: <span class="hljs-string">"relative"</span>,
                    <span class="hljs-attr">display</span>: <span class="hljs-string">"inline-block"</span>
                },
                <span class="hljs-attr">hint</span>: {
                    <span class="hljs-attr">position</span>: <span class="hljs-string">"absolute"</span>,
                    <span class="hljs-attr">top</span>: <span class="hljs-string">"0"</span>,
                    <span class="hljs-attr">left</span>: <span class="hljs-string">"0"</span>,
                    <span class="hljs-attr">borderColor</span>: <span class="hljs-string">"transparent"</span>,
                    <span class="hljs-attr">boxShadow</span>: <span class="hljs-string">"none"</span>,
                    <span class="hljs-attr">opacity</span>: <span class="hljs-string">"1"</span>
                },
                <span class="hljs-attr">input</span>: {
                    <span class="hljs-attr">position</span>: <span class="hljs-string">"relative"</span>,
                    <span class="hljs-attr">verticalAlign</span>: <span class="hljs-string">"top"</span>,
                    <span class="hljs-attr">backgroundColor</span>: <span class="hljs-string">"transparent"</span>
                },
                <span class="hljs-attr">inputWithNoHint</span>: {
                    <span class="hljs-attr">position</span>: <span class="hljs-string">"relative"</span>,
                    <span class="hljs-attr">verticalAlign</span>: <span class="hljs-string">"top"</span>
                },
                <span class="hljs-attr">menu</span>: {
                    <span class="hljs-attr">position</span>: <span class="hljs-string">"absolute"</span>,
                    <span class="hljs-attr">top</span>: <span class="hljs-string">"100%"</span>,
                    <span class="hljs-attr">left</span>: <span class="hljs-string">"0"</span>,
                    <span class="hljs-attr">zIndex</span>: <span class="hljs-string">"100"</span>,
                    <span class="hljs-attr">display</span>: <span class="hljs-string">"none"</span>
                },
                <span class="hljs-attr">ltr</span>: {
                    <span class="hljs-attr">left</span>: <span class="hljs-string">"0"</span>,
                    <span class="hljs-attr">right</span>: <span class="hljs-string">"auto"</span>
                },
                <span class="hljs-attr">rtl</span>: {
                    <span class="hljs-attr">left</span>: <span class="hljs-string">"auto"</span>,
                    <span class="hljs-attr">right</span>: <span class="hljs-string">" 0"</span>
                }
            };
            <span class="hljs-keyword">if</span> (_.isMsie()) {
                _.mixin(css.input, {
                    <span class="hljs-attr">backgroundImage</span>: <span class="hljs-string">"url(data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)"</span>
                });
            }
            <span class="hljs-keyword">return</span> css;
        }
    }();
    <span class="hljs-keyword">var</span> EventBus = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-meta">        "use strict"</span>;
        <span class="hljs-keyword">var</span> namespace, deprecationMap;
        namespace = <span class="hljs-string">"typeahead:"</span>;
        deprecationMap = {
            <span class="hljs-attr">render</span>: <span class="hljs-string">"rendered"</span>,
            <span class="hljs-attr">cursorchange</span>: <span class="hljs-string">"cursorchanged"</span>,
            <span class="hljs-attr">select</span>: <span class="hljs-string">"selected"</span>,
            <span class="hljs-attr">autocomplete</span>: <span class="hljs-string">"autocompleted"</span>
        };

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">EventBus</span>(<span class="hljs-params">o</span>) </span>{
            <span class="hljs-keyword">if</span> (!o || !o.el) {
                $.error(<span class="hljs-string">"EventBus initialized without el"</span>);
            }
            <span class="hljs-keyword">this</span>.$el = $(o.el);
        }
        _.mixin(EventBus.prototype, {
            <span class="hljs-attr">_trigger</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">type, args</span>) </span>{
                <span class="hljs-keyword">var</span> $e;
                $e = $.Event(namespace + type);
                (args = args || []).unshift($e);
                <span class="hljs-keyword">this</span>.$el.trigger.apply(<span class="hljs-keyword">this</span>.$el, args);
                <span class="hljs-keyword">return</span> $e;
            },
            <span class="hljs-attr">before</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">type</span>) </span>{
                <span class="hljs-keyword">var</span> args, $e;
                args = [].slice.call(<span class="hljs-built_in">arguments</span>, <span class="hljs-number">1</span>);
                $e = <span class="hljs-keyword">this</span>._trigger(<span class="hljs-string">"before"</span> + type, args);
                <span class="hljs-keyword">return</span> $e.isDefaultPrevented();
            },
            <span class="hljs-attr">trigger</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">type</span>) </span>{
                <span class="hljs-keyword">var</span> deprecatedType;
                <span class="hljs-keyword">this</span>._trigger(type, [].slice.call(<span class="hljs-built_in">arguments</span>, <span class="hljs-number">1</span>));
                <span class="hljs-keyword">if</span> (deprecatedType = deprecationMap[type]) {
                    <span class="hljs-keyword">this</span>._trigger(deprecatedType, [].slice.call(<span class="hljs-built_in">arguments</span>, <span class="hljs-number">1</span>));
                }
            }
        });
        <span class="hljs-keyword">return</span> EventBus;
    }();
    <span class="hljs-keyword">var</span> EventEmitter = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-meta">        "use strict"</span>;
        <span class="hljs-keyword">var</span> splitter = <span class="hljs-regexp">/\s+/</span>,
            nextTick = getNextTick();
        <span class="hljs-keyword">return</span> {
            <span class="hljs-attr">onSync</span>: onSync,
            <span class="hljs-attr">onAsync</span>: onAsync,
            <span class="hljs-attr">off</span>: off,
            <span class="hljs-attr">trigger</span>: trigger
        };

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">on</span>(<span class="hljs-params">method, types, cb, context</span>) </span>{
            <span class="hljs-keyword">var</span> type;
            <span class="hljs-keyword">if</span> (!cb) {
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
            }
            types = types.split(splitter);
            cb = context ? bindContext(cb, context) : cb;
            <span class="hljs-keyword">this</span>._callbacks = <span class="hljs-keyword">this</span>._callbacks || {};
            <span class="hljs-keyword">while</span> (type = types.shift()) {
                <span class="hljs-keyword">this</span>._callbacks[type] = <span class="hljs-keyword">this</span>._callbacks[type] || {
                    <span class="hljs-attr">sync</span>: [],
                    <span class="hljs-attr">async</span>: []
                };
                <span class="hljs-keyword">this</span>._callbacks[type][method].push(cb);
            }
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onAsync</span>(<span class="hljs-params">types, cb, context</span>) </span>{
            <span class="hljs-keyword">return</span> on.call(<span class="hljs-keyword">this</span>, <span class="hljs-string">"async"</span>, types, cb, context);
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onSync</span>(<span class="hljs-params">types, cb, context</span>) </span>{
            <span class="hljs-keyword">return</span> on.call(<span class="hljs-keyword">this</span>, <span class="hljs-string">"sync"</span>, types, cb, context);
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">off</span>(<span class="hljs-params">types</span>) </span>{
            <span class="hljs-keyword">var</span> type;
            <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>._callbacks) {
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
            }
            types = types.split(splitter);
            <span class="hljs-keyword">while</span> (type = types.shift()) {
                <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>._callbacks[type];
            }
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">trigger</span>(<span class="hljs-params">types</span>) </span>{
            <span class="hljs-keyword">var</span> type, callbacks, args, syncFlush, asyncFlush;
            <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>._callbacks) {
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
            }
            types = types.split(splitter);
            args = [].slice.call(<span class="hljs-built_in">arguments</span>, <span class="hljs-number">1</span>);
            <span class="hljs-keyword">while</span> ((type = types.shift()) &amp;&amp; (callbacks = <span class="hljs-keyword">this</span>._callbacks[type])) {
                syncFlush = getFlush(callbacks.sync, <span class="hljs-keyword">this</span>, [type].concat(args));
                asyncFlush = getFlush(callbacks.async, <span class="hljs-keyword">this</span>, [type].concat(args));
                syncFlush() &amp;&amp; nextTick(asyncFlush);
            }
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getFlush</span>(<span class="hljs-params">callbacks, context, args</span>) </span>{
            <span class="hljs-keyword">return</span> flush;

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">flush</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">var</span> cancelled;
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, len = callbacks.length; !cancelled &amp;&amp; i &lt; len; i += <span class="hljs-number">1</span>) {
                    cancelled = callbacks[i].apply(context, args) === <span class="hljs-literal">false</span>;
                }
                <span class="hljs-keyword">return</span> !cancelled;
            }
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getNextTick</span>(<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">var</span> nextTickFn;
            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">window</span>.setImmediate) {
                nextTickFn = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">nextTickSetImmediate</span>(<span class="hljs-params">fn</span>) </span>{
                    setImmediate(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                        fn();
                    });
                };
            } <span class="hljs-keyword">else</span> {
                nextTickFn = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">nextTickSetTimeout</span>(<span class="hljs-params">fn</span>) </span>{
                    setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                        fn();
                    }, <span class="hljs-number">0</span>);
                };
            }
            <span class="hljs-keyword">return</span> nextTickFn;
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">bindContext</span>(<span class="hljs-params">fn, context</span>) </span>{
            <span class="hljs-keyword">return</span> fn.bind ? fn.bind(context) : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                fn.apply(context, [].slice.call(<span class="hljs-built_in">arguments</span>, <span class="hljs-number">0</span>));
            };
        }
    }();
    <span class="hljs-keyword">var</span> highlight = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">doc</span>) </span>{
<span class="hljs-meta">        "use strict"</span>;
        <span class="hljs-keyword">var</span> defaults = {
            <span class="hljs-attr">node</span>: <span class="hljs-literal">null</span>,
            <span class="hljs-attr">pattern</span>: <span class="hljs-literal">null</span>,
            <span class="hljs-attr">tagName</span>: <span class="hljs-string">"strong"</span>,
            <span class="hljs-attr">className</span>: <span class="hljs-literal">null</span>,
            <span class="hljs-attr">wordsOnly</span>: <span class="hljs-literal">false</span>,
            <span class="hljs-attr">caseSensitive</span>: <span class="hljs-literal">false</span>
        };
        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">hightlight</span>(<span class="hljs-params">o</span>) </span>{
            <span class="hljs-keyword">var</span> regex;
            o = _.mixin({}, defaults, o);
            <span class="hljs-keyword">if</span> (!o.node || !o.pattern) {
                <span class="hljs-keyword">return</span>;
            }
            o.pattern = _.isArray(o.pattern) ? o.pattern : [o.pattern];
            regex = getRegex(o.pattern, o.caseSensitive, o.wordsOnly);
            traverse(o.node, hightlightTextNode);

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">hightlightTextNode</span>(<span class="hljs-params">textNode</span>) </span>{
                <span class="hljs-keyword">var</span> match, patternNode, wrapperNode;
                <span class="hljs-keyword">if</span> (match = regex.exec(textNode.data)) {
                    wrapperNode = doc.createElement(o.tagName);
                    o.className &amp;&amp; (wrapperNode.className = o.className);
                    patternNode = textNode.splitText(match.index);
                    patternNode.splitText(match[<span class="hljs-number">0</span>].length);
                    wrapperNode.appendChild(patternNode.cloneNode(<span class="hljs-literal">true</span>));
                    textNode.parentNode.replaceChild(wrapperNode, patternNode);
                }
                <span class="hljs-keyword">return</span> !!match;
            }

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">traverse</span>(<span class="hljs-params">el, hightlightTextNode</span>) </span>{
                <span class="hljs-keyword">var</span> childNode, TEXT_NODE_TYPE = <span class="hljs-number">3</span>;
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; el.childNodes.length; i++) {
                    childNode = el.childNodes[i];
                    <span class="hljs-keyword">if</span> (childNode.nodeType === TEXT_NODE_TYPE) {
                        i += hightlightTextNode(childNode) ? <span class="hljs-number">1</span> : <span class="hljs-number">0</span>;
                    } <span class="hljs-keyword">else</span> {
                        traverse(childNode, hightlightTextNode);
                    }
                }
            }
        };

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getRegex</span>(<span class="hljs-params">patterns, caseSensitive, wordsOnly</span>) </span>{
            <span class="hljs-keyword">var</span> escapedPatterns = [],
                regexStr;
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, len = patterns.length; i &lt; len; i++) {
                escapedPatterns.push(_.escapeRegExChars(patterns[i]));
            }
            regexStr = wordsOnly ? <span class="hljs-string">"\\b("</span> + escapedPatterns.join(<span class="hljs-string">"|"</span>) + <span class="hljs-string">")\\b"</span> : <span class="hljs-string">"("</span> + escapedPatterns.join(<span class="hljs-string">"|"</span>) + <span class="hljs-string">")"</span>;
            <span class="hljs-keyword">return</span> caseSensitive ? <span class="hljs-keyword">new</span> <span class="hljs-built_in">RegExp</span>(regexStr) : <span class="hljs-keyword">new</span> <span class="hljs-built_in">RegExp</span>(regexStr, <span class="hljs-string">"i"</span>);
        }
    }(<span class="hljs-built_in">window</span>.document);
    <span class="hljs-keyword">var</span> Input = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-meta">        "use strict"</span>;
        <span class="hljs-keyword">var</span> specialKeyCodeMap;
        specialKeyCodeMap = {
            <span class="hljs-number">9</span>: <span class="hljs-string">"tab"</span>,
            <span class="hljs-number">27</span>: <span class="hljs-string">"esc"</span>,
            <span class="hljs-number">37</span>: <span class="hljs-string">"left"</span>,
            <span class="hljs-number">39</span>: <span class="hljs-string">"right"</span>,
            <span class="hljs-number">13</span>: <span class="hljs-string">"enter"</span>,
            <span class="hljs-number">38</span>: <span class="hljs-string">"up"</span>,
            <span class="hljs-number">40</span>: <span class="hljs-string">"down"</span>
        };

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Input</span>(<span class="hljs-params">o, www</span>) </span>{
            o = o || {};
            <span class="hljs-keyword">if</span> (!o.input) {
                $.error(<span class="hljs-string">"input is missing"</span>);
            }
            www.mixin(<span class="hljs-keyword">this</span>);
            <span class="hljs-keyword">this</span>.$hint = $(o.hint);
            <span class="hljs-keyword">this</span>.$input = $(o.input);
            <span class="hljs-keyword">this</span>.query = <span class="hljs-keyword">this</span>.$input.val();
            <span class="hljs-keyword">this</span>.queryWhenFocused = <span class="hljs-keyword">this</span>.hasFocus() ? <span class="hljs-keyword">this</span>.query : <span class="hljs-literal">null</span>;
            <span class="hljs-keyword">this</span>.$overflowHelper = buildOverflowHelper(<span class="hljs-keyword">this</span>.$input);
            <span class="hljs-keyword">this</span>._checkLanguageDirection();
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.$hint.length === <span class="hljs-number">0</span>) {
                <span class="hljs-keyword">this</span>.setHint = <span class="hljs-keyword">this</span>.getHint = <span class="hljs-keyword">this</span>.clearHint = <span class="hljs-keyword">this</span>.clearHintIfInvalid = _.noop;
            }
        }
        Input.normalizeQuery = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">str</span>) </span>{
            <span class="hljs-keyword">return</span> _.toStr(str).replace(<span class="hljs-regexp">/^\s*/g</span>, <span class="hljs-string">""</span>).replace(<span class="hljs-regexp">/\s{2,}/g</span>, <span class="hljs-string">" "</span>);
        };
        _.mixin(Input.prototype, EventEmitter, {
            <span class="hljs-attr">_onBlur</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onBlur</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">this</span>.resetInputValue();
                <span class="hljs-keyword">this</span>.trigger(<span class="hljs-string">"blurred"</span>);
            },
            <span class="hljs-attr">_onFocus</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onFocus</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">this</span>.queryWhenFocused = <span class="hljs-keyword">this</span>.query;
                <span class="hljs-keyword">this</span>.trigger(<span class="hljs-string">"focused"</span>);
            },
            <span class="hljs-attr">_onKeydown</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onKeydown</span>(<span class="hljs-params">$e</span>) </span>{
                <span class="hljs-keyword">var</span> keyName = specialKeyCodeMap[$e.which || $e.keyCode];
                <span class="hljs-keyword">this</span>._managePreventDefault(keyName, $e);
                <span class="hljs-keyword">if</span> (keyName &amp;&amp; <span class="hljs-keyword">this</span>._shouldTrigger(keyName, $e)) {
                    <span class="hljs-keyword">this</span>.trigger(keyName + <span class="hljs-string">"Keyed"</span>, $e);
                }
            },
            <span class="hljs-attr">_onInput</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onInput</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">this</span>._setQuery(<span class="hljs-keyword">this</span>.getInputValue());
                <span class="hljs-keyword">this</span>.clearHintIfInvalid();
                <span class="hljs-keyword">this</span>._checkLanguageDirection();
            },
            <span class="hljs-attr">_managePreventDefault</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">managePreventDefault</span>(<span class="hljs-params">keyName, $e</span>) </span>{
                <span class="hljs-keyword">var</span> preventDefault;
                <span class="hljs-keyword">switch</span> (keyName) {
                    <span class="hljs-keyword">case</span> <span class="hljs-string">"up"</span>:
                    <span class="hljs-keyword">case</span> <span class="hljs-string">"down"</span>:
                        preventDefault = !withModifier($e);
                        <span class="hljs-keyword">break</span>;
                    <span class="hljs-keyword">default</span>:
                        preventDefault = <span class="hljs-literal">false</span>;
                }
                preventDefault &amp;&amp; $e.preventDefault();
            },
            <span class="hljs-attr">_shouldTrigger</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">shouldTrigger</span>(<span class="hljs-params">keyName, $e</span>) </span>{
                <span class="hljs-keyword">var</span> trigger;
                <span class="hljs-keyword">switch</span> (keyName) {
                    <span class="hljs-keyword">case</span> <span class="hljs-string">"tab"</span>:
                        trigger = !withModifier($e);
                        <span class="hljs-keyword">break</span>;
                    <span class="hljs-keyword">default</span>:
                        trigger = <span class="hljs-literal">true</span>;
                }
                <span class="hljs-keyword">return</span> trigger;
            },
            <span class="hljs-attr">_checkLanguageDirection</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">checkLanguageDirection</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">var</span> dir = (<span class="hljs-keyword">this</span>.$input.css(<span class="hljs-string">"direction"</span>) || <span class="hljs-string">"ltr"</span>).toLowerCase();
                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.dir !== dir) {
                    <span class="hljs-keyword">this</span>.dir = dir;
                    <span class="hljs-keyword">this</span>.$hint.attr(<span class="hljs-string">"dir"</span>, dir);
                    <span class="hljs-keyword">this</span>.trigger(<span class="hljs-string">"langDirChanged"</span>, dir);
                }
            },
            <span class="hljs-attr">_setQuery</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setQuery</span>(<span class="hljs-params">val, silent</span>) </span>{
                <span class="hljs-keyword">var</span> areEquivalent, hasDifferentWhitespace;
                areEquivalent = areQueriesEquivalent(val, <span class="hljs-keyword">this</span>.query);
                hasDifferentWhitespace = areEquivalent ? <span class="hljs-keyword">this</span>.query.length !== val.length : <span class="hljs-literal">false</span>;
                <span class="hljs-keyword">this</span>.query = val;
                <span class="hljs-keyword">if</span> (!silent &amp;&amp; !areEquivalent) {
                    <span class="hljs-keyword">this</span>.trigger(<span class="hljs-string">"queryChanged"</span>, <span class="hljs-keyword">this</span>.query);
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!silent &amp;&amp; hasDifferentWhitespace) {
                    <span class="hljs-keyword">this</span>.trigger(<span class="hljs-string">"whitespaceChanged"</span>, <span class="hljs-keyword">this</span>.query);
                }
            },
            <span class="hljs-attr">bind</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">var</span> that = <span class="hljs-keyword">this</span>,
                    onBlur, onFocus, onKeydown, onInput;
                onBlur = _.bind(<span class="hljs-keyword">this</span>._onBlur, <span class="hljs-keyword">this</span>);
                onFocus = _.bind(<span class="hljs-keyword">this</span>._onFocus, <span class="hljs-keyword">this</span>);
                onKeydown = _.bind(<span class="hljs-keyword">this</span>._onKeydown, <span class="hljs-keyword">this</span>);
                onInput = _.bind(<span class="hljs-keyword">this</span>._onInput, <span class="hljs-keyword">this</span>);
                <span class="hljs-keyword">this</span>.$input.on(<span class="hljs-string">"blur.tt"</span>, onBlur).on(<span class="hljs-string">"focus.tt"</span>, onFocus).on(<span class="hljs-string">"keydown.tt"</span>, onKeydown);
                <span class="hljs-keyword">if</span> (!_.isMsie() || _.isMsie() &gt; <span class="hljs-number">9</span>) {
                    <span class="hljs-keyword">this</span>.$input.on(<span class="hljs-string">"input.tt"</span>, onInput);
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">this</span>.$input.on(<span class="hljs-string">"keydown.tt keypress.tt cut.tt paste.tt"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$e</span>) </span>{
                        <span class="hljs-keyword">if</span> (specialKeyCodeMap[$e.which || $e.keyCode]) {
                            <span class="hljs-keyword">return</span>;
                        }
                        _.defer(_.bind(that._onInput, that, $e));
                    });
                }
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
            },
            <span class="hljs-attr">focus</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">focus</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">this</span>.$input.focus();
            },
            <span class="hljs-attr">blur</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">blur</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">this</span>.$input.blur();
            },
            <span class="hljs-attr">getLangDir</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getLangDir</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.dir;
            },
            <span class="hljs-attr">getQuery</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getQuery</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.query || <span class="hljs-string">""</span>;
            },
            <span class="hljs-attr">setQuery</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setQuery</span>(<span class="hljs-params">val, silent</span>) </span>{
                <span class="hljs-keyword">this</span>.setInputValue(val);
                <span class="hljs-keyword">this</span>._setQuery(val, silent);
            },
            <span class="hljs-attr">hasQueryChangedSinceLastFocus</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">hasQueryChangedSinceLastFocus</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.query !== <span class="hljs-keyword">this</span>.queryWhenFocused;
            },
            <span class="hljs-attr">getInputValue</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getInputValue</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.$input.val();
            },
            <span class="hljs-attr">setInputValue</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setInputValue</span>(<span class="hljs-params">value</span>) </span>{
                <span class="hljs-keyword">this</span>.$input.val(value);
                <span class="hljs-keyword">this</span>.clearHintIfInvalid();
                <span class="hljs-keyword">this</span>._checkLanguageDirection();
            },
            <span class="hljs-attr">resetInputValue</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">resetInputValue</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">this</span>.setInputValue(<span class="hljs-keyword">this</span>.query);
            },
            <span class="hljs-attr">getHint</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getHint</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.$hint.val();
            },
            <span class="hljs-attr">setHint</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setHint</span>(<span class="hljs-params">value</span>) </span>{
                <span class="hljs-keyword">this</span>.$hint.val(value);
            },
            <span class="hljs-attr">clearHint</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">clearHint</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">this</span>.setHint(<span class="hljs-string">""</span>);
            },
            <span class="hljs-attr">clearHintIfInvalid</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">clearHintIfInvalid</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">var</span> val, hint, valIsPrefixOfHint, isValid;
                val = <span class="hljs-keyword">this</span>.getInputValue();
                hint = <span class="hljs-keyword">this</span>.getHint();
                valIsPrefixOfHint = val !== hint &amp;&amp; hint.indexOf(val) === <span class="hljs-number">0</span>;
                isValid = val !== <span class="hljs-string">""</span> &amp;&amp; valIsPrefixOfHint &amp;&amp; !<span class="hljs-keyword">this</span>.hasOverflow();
                !isValid &amp;&amp; <span class="hljs-keyword">this</span>.clearHint();
            },
            <span class="hljs-attr">hasFocus</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">hasFocus</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.$input.is(<span class="hljs-string">":focus"</span>);
            },
            <span class="hljs-attr">hasOverflow</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">hasOverflow</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">var</span> constraint = <span class="hljs-keyword">this</span>.$input.width() - <span class="hljs-number">2</span>;
                <span class="hljs-keyword">this</span>.$overflowHelper.text(<span class="hljs-keyword">this</span>.getInputValue());
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.$overflowHelper.width() &gt;= constraint;
            },
            <span class="hljs-attr">isCursorAtEnd</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">var</span> valueLength, selectionStart, range;
                valueLength = <span class="hljs-keyword">this</span>.$input.val().length;
                selectionStart = <span class="hljs-keyword">this</span>.$input[<span class="hljs-number">0</span>].selectionStart;
                <span class="hljs-keyword">if</span> (_.isNumber(selectionStart)) {
                    <span class="hljs-keyword">return</span> selectionStart === valueLength;
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-built_in">document</span>.selection) {
                    range = <span class="hljs-built_in">document</span>.selection.createRange();
                    range.moveStart(<span class="hljs-string">"character"</span>, -valueLength);
                    <span class="hljs-keyword">return</span> valueLength === range.text.length;
                }
                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
            },
            <span class="hljs-attr">destroy</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">destroy</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">this</span>.$hint.off(<span class="hljs-string">".tt"</span>);
                <span class="hljs-keyword">this</span>.$input.off(<span class="hljs-string">".tt"</span>);
                <span class="hljs-keyword">this</span>.$overflowHelper.remove();
                <span class="hljs-keyword">this</span>.$hint = <span class="hljs-keyword">this</span>.$input = <span class="hljs-keyword">this</span>.$overflowHelper = $(<span class="hljs-string">"&lt;div&gt;"</span>);
            }
        });
        <span class="hljs-keyword">return</span> Input;

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">buildOverflowHelper</span>(<span class="hljs-params">$input</span>) </span>{
            <span class="hljs-keyword">return</span> $(<span class="hljs-string">'&lt;pre aria-hidden="true"&gt;&lt;/pre&gt;'</span>).css({
                <span class="hljs-attr">position</span>: <span class="hljs-string">"absolute"</span>,
                <span class="hljs-attr">visibility</span>: <span class="hljs-string">"hidden"</span>,
                <span class="hljs-attr">whiteSpace</span>: <span class="hljs-string">"pre"</span>,
                <span class="hljs-attr">fontFamily</span>: $input.css(<span class="hljs-string">"font-family"</span>),
                <span class="hljs-attr">fontSize</span>: $input.css(<span class="hljs-string">"font-size"</span>),
                <span class="hljs-attr">fontStyle</span>: $input.css(<span class="hljs-string">"font-style"</span>),
                <span class="hljs-attr">fontVariant</span>: $input.css(<span class="hljs-string">"font-variant"</span>),
                <span class="hljs-attr">fontWeight</span>: $input.css(<span class="hljs-string">"font-weight"</span>),
                <span class="hljs-attr">wordSpacing</span>: $input.css(<span class="hljs-string">"word-spacing"</span>),
                <span class="hljs-attr">letterSpacing</span>: $input.css(<span class="hljs-string">"letter-spacing"</span>),
                <span class="hljs-attr">textIndent</span>: $input.css(<span class="hljs-string">"text-indent"</span>),
                <span class="hljs-attr">textRendering</span>: $input.css(<span class="hljs-string">"text-rendering"</span>),
                <span class="hljs-attr">textTransform</span>: $input.css(<span class="hljs-string">"text-transform"</span>)
            }).insertAfter($input);
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">areQueriesEquivalent</span>(<span class="hljs-params">a, b</span>) </span>{
            <span class="hljs-keyword">return</span> Input.normalizeQuery(a) === Input.normalizeQuery(b);
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">withModifier</span>(<span class="hljs-params">$e</span>) </span>{
            <span class="hljs-keyword">return</span> $e.altKey || $e.ctrlKey || $e.metaKey || $e.shiftKey;
        }
    }();
    <span class="hljs-keyword">var</span> Dataset = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-meta">        "use strict"</span>;
        <span class="hljs-keyword">var</span> keys, nameGenerator;
        keys = {
            <span class="hljs-attr">val</span>: <span class="hljs-string">"tt-selectable-display"</span>,
            <span class="hljs-attr">obj</span>: <span class="hljs-string">"tt-selectable-object"</span>
        };
        nameGenerator = _.getIdGenerator();

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Dataset</span>(<span class="hljs-params">o, www</span>) </span>{
            o = o || {};
            o.templates = o.templates || {};
            o.templates.notFound = o.templates.notFound || o.templates.empty;
            <span class="hljs-keyword">if</span> (!o.source) {
                $.error(<span class="hljs-string">"missing source"</span>);
            }
            <span class="hljs-keyword">if</span> (!o.node) {
                $.error(<span class="hljs-string">"missing node"</span>);
            }
            <span class="hljs-keyword">if</span> (o.name &amp;&amp; !isValidName(o.name)) {
                $.error(<span class="hljs-string">"invalid dataset name: "</span> + o.name);
            }
            www.mixin(<span class="hljs-keyword">this</span>);
            <span class="hljs-keyword">this</span>.highlight = !!o.highlight;
            <span class="hljs-keyword">this</span>.name = o.name || nameGenerator();
            <span class="hljs-keyword">this</span>.limit = o.limit || <span class="hljs-number">5</span>;
            <span class="hljs-keyword">this</span>.displayFn = getDisplayFn(o.display || o.displayKey);
            <span class="hljs-keyword">this</span>.templates = getTemplates(o.templates, <span class="hljs-keyword">this</span>.displayFn);
            <span class="hljs-keyword">this</span>.source = o.source.__ttAdapter ? o.source.__ttAdapter() : o.source;
            <span class="hljs-keyword">this</span>.async = _.isUndefined(o.async) ? <span class="hljs-keyword">this</span>.source.length &gt; <span class="hljs-number">2</span> : !!o.async;
            <span class="hljs-keyword">this</span>._resetLastSuggestion();
            <span class="hljs-keyword">this</span>.$el = $(o.node).addClass(<span class="hljs-keyword">this</span>.classes.dataset).addClass(<span class="hljs-keyword">this</span>.classes.dataset + <span class="hljs-string">"-"</span> + <span class="hljs-keyword">this</span>.name);
        }
        Dataset.extractData = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">extractData</span>(<span class="hljs-params">el</span>) </span>{
            <span class="hljs-keyword">var</span> $el = $(el);
            <span class="hljs-keyword">if</span> ($el.data(keys.obj)) {
                <span class="hljs-keyword">return</span> {
                    <span class="hljs-attr">val</span>: $el.data(keys.val) || <span class="hljs-string">""</span>,
                    <span class="hljs-attr">obj</span>: $el.data(keys.obj) || <span class="hljs-literal">null</span>
                };
            }
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        };
        _.mixin(Dataset.prototype, EventEmitter, {
            <span class="hljs-attr">_overwrite</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">overwrite</span>(<span class="hljs-params">query, suggestions</span>) </span>{
                suggestions = suggestions || [];
                <span class="hljs-keyword">if</span> (suggestions.length) {
                    <span class="hljs-keyword">this</span>._renderSuggestions(query, suggestions);
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.async &amp;&amp; <span class="hljs-keyword">this</span>.templates.pending) {
                    <span class="hljs-keyword">this</span>._renderPending(query);
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.async &amp;&amp; <span class="hljs-keyword">this</span>.templates.notFound) {
                    <span class="hljs-keyword">this</span>._renderNotFound(query);
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">this</span>._empty();
                }
                <span class="hljs-keyword">this</span>.trigger(<span class="hljs-string">"rendered"</span>, <span class="hljs-keyword">this</span>.name, suggestions, <span class="hljs-literal">false</span>);
            },
            <span class="hljs-attr">_append</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">append</span>(<span class="hljs-params">query, suggestions</span>) </span>{
                suggestions = suggestions || [];
                <span class="hljs-keyword">if</span> (suggestions.length &amp;&amp; <span class="hljs-keyword">this</span>.$lastSuggestion.length) {
                    <span class="hljs-keyword">this</span>._appendSuggestions(query, suggestions);
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (suggestions.length) {
                    <span class="hljs-keyword">this</span>._renderSuggestions(query, suggestions);
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.$lastSuggestion.length &amp;&amp; <span class="hljs-keyword">this</span>.templates.notFound) {
                    <span class="hljs-keyword">this</span>._renderNotFound(query);
                }
                <span class="hljs-keyword">this</span>.trigger(<span class="hljs-string">"rendered"</span>, <span class="hljs-keyword">this</span>.name, suggestions, <span class="hljs-literal">true</span>);
            },
            <span class="hljs-attr">_renderSuggestions</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">renderSuggestions</span>(<span class="hljs-params">query, suggestions</span>) </span>{
                <span class="hljs-keyword">var</span> $fragment;
                $fragment = <span class="hljs-keyword">this</span>._getSuggestionsFragment(query, suggestions);
                <span class="hljs-keyword">this</span>.$lastSuggestion = $fragment.children().last();
                <span class="hljs-keyword">this</span>.$el.html($fragment).prepend(<span class="hljs-keyword">this</span>._getHeader(query, suggestions)).append(<span class="hljs-keyword">this</span>._getFooter(query, suggestions));
            },
            <span class="hljs-attr">_appendSuggestions</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">appendSuggestions</span>(<span class="hljs-params">query, suggestions</span>) </span>{
                <span class="hljs-keyword">var</span> $fragment, $lastSuggestion;
                $fragment = <span class="hljs-keyword">this</span>._getSuggestionsFragment(query, suggestions);
                $lastSuggestion = $fragment.children().last();
                <span class="hljs-keyword">this</span>.$lastSuggestion.after($fragment);
                <span class="hljs-keyword">this</span>.$lastSuggestion = $lastSuggestion;
            },
            <span class="hljs-attr">_renderPending</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">renderPending</span>(<span class="hljs-params">query</span>) </span>{
                <span class="hljs-keyword">var</span> template = <span class="hljs-keyword">this</span>.templates.pending;
                <span class="hljs-keyword">this</span>._resetLastSuggestion();
                template &amp;&amp; <span class="hljs-keyword">this</span>.$el.html(template({
                    <span class="hljs-attr">query</span>: query,
                    <span class="hljs-attr">dataset</span>: <span class="hljs-keyword">this</span>.name
                }));
            },
            <span class="hljs-attr">_renderNotFound</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">renderNotFound</span>(<span class="hljs-params">query</span>) </span>{
                <span class="hljs-keyword">var</span> template = <span class="hljs-keyword">this</span>.templates.notFound;
                <span class="hljs-keyword">this</span>._resetLastSuggestion();
                template &amp;&amp; <span class="hljs-keyword">this</span>.$el.html(template({
                    <span class="hljs-attr">query</span>: query,
                    <span class="hljs-attr">dataset</span>: <span class="hljs-keyword">this</span>.name
                }));
            },
            <span class="hljs-attr">_empty</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">empty</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">this</span>.$el.empty();
                <span class="hljs-keyword">this</span>._resetLastSuggestion();
            },
            <span class="hljs-attr">_getSuggestionsFragment</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getSuggestionsFragment</span>(<span class="hljs-params">query, suggestions</span>) </span>{
                <span class="hljs-keyword">var</span> that = <span class="hljs-keyword">this</span>,
                    fragment;
                fragment = <span class="hljs-built_in">document</span>.createDocumentFragment();
                _.each(suggestions, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getSuggestionNode</span>(<span class="hljs-params">suggestion</span>) </span>{
                    <span class="hljs-keyword">var</span> $el, context;
                    context = that._injectQuery(query, suggestion);
                    $el = $(that.templates.suggestion(context)).data(keys.obj, suggestion).data(keys.val, that.displayFn(suggestion)).addClass(that.classes.suggestion + <span class="hljs-string">" "</span> + that.classes.selectable);
                    fragment.appendChild($el[<span class="hljs-number">0</span>]);
                });
                <span class="hljs-keyword">this</span>.highlight &amp;&amp; highlight({
                    <span class="hljs-attr">className</span>: <span class="hljs-keyword">this</span>.classes.highlight,
                    <span class="hljs-attr">node</span>: fragment,
                    <span class="hljs-attr">pattern</span>: query
                });
                <span class="hljs-keyword">return</span> $(fragment);
            },
            <span class="hljs-attr">_getFooter</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getFooter</span>(<span class="hljs-params">query, suggestions</span>) </span>{
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.templates.footer ? <span class="hljs-keyword">this</span>.templates.footer({
                    <span class="hljs-attr">query</span>: query,
                    <span class="hljs-attr">suggestions</span>: suggestions,
                    <span class="hljs-attr">dataset</span>: <span class="hljs-keyword">this</span>.name
                }) : <span class="hljs-literal">null</span>;
            },
            <span class="hljs-attr">_getHeader</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getHeader</span>(<span class="hljs-params">query, suggestions</span>) </span>{
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.templates.header ? <span class="hljs-keyword">this</span>.templates.header({
                    <span class="hljs-attr">query</span>: query,
                    <span class="hljs-attr">suggestions</span>: suggestions,
                    <span class="hljs-attr">dataset</span>: <span class="hljs-keyword">this</span>.name
                }) : <span class="hljs-literal">null</span>;
            },
            <span class="hljs-attr">_resetLastSuggestion</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">resetLastSuggestion</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">this</span>.$lastSuggestion = $();
            },
            <span class="hljs-attr">_injectQuery</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">injectQuery</span>(<span class="hljs-params">query, obj</span>) </span>{
                <span class="hljs-keyword">return</span> _.isObject(obj) ? _.mixin({
                    <span class="hljs-attr">_query</span>: query
                }, obj) : obj;
            },
            <span class="hljs-attr">update</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">update</span>(<span class="hljs-params">query</span>) </span>{
                <span class="hljs-keyword">var</span> that = <span class="hljs-keyword">this</span>,
                    canceled = <span class="hljs-literal">false</span>,
                    syncCalled = <span class="hljs-literal">false</span>,
                    rendered = <span class="hljs-number">0</span>;
                <span class="hljs-keyword">this</span>.cancel();
                <span class="hljs-keyword">this</span>.cancel = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">cancel</span>(<span class="hljs-params"></span>) </span>{
                    canceled = <span class="hljs-literal">true</span>;
                    that.cancel = $.noop;
                    that.async &amp;&amp; that.trigger(<span class="hljs-string">"asyncCanceled"</span>, query);
                };
                <span class="hljs-keyword">this</span>.source(query, sync, <span class="hljs-keyword">async</span>);
                !syncCalled &amp;&amp; sync([]);

                <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sync</span>(<span class="hljs-params">suggestions</span>) </span>{
                    <span class="hljs-keyword">if</span> (syncCalled) {
                        <span class="hljs-keyword">return</span>;
                    }
                    syncCalled = <span class="hljs-literal">true</span>;
                    suggestions = (suggestions || []).slice(<span class="hljs-number">0</span>, that.limit);
                    rendered = suggestions.length;
                    that._overwrite(query, suggestions);
                    <span class="hljs-keyword">if</span> (rendered &lt; that.limit &amp;&amp; that.async) {
                        that.trigger(<span class="hljs-string">"asyncRequested"</span>, query);
                    }
                }

                <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">async</span>(<span class="hljs-params">suggestions</span>) </span>{
                    suggestions = suggestions || [];
                    <span class="hljs-keyword">if</span> (!canceled &amp;&amp; rendered &lt; that.limit) {
                        that.cancel = $.noop;
                        that._append(query, suggestions.slice(<span class="hljs-number">0</span>, that.limit - rendered));
                        rendered += suggestions.length;
                        that.async &amp;&amp; that.trigger(<span class="hljs-string">"asyncReceived"</span>, query);
                    }
                }
            },
            <span class="hljs-attr">cancel</span>: $.noop,
            <span class="hljs-attr">clear</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">clear</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">this</span>._empty();
                <span class="hljs-keyword">this</span>.cancel();
                <span class="hljs-keyword">this</span>.trigger(<span class="hljs-string">"cleared"</span>);
            },
            <span class="hljs-attr">isEmpty</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isEmpty</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.$el.is(<span class="hljs-string">":empty"</span>);
            },
            <span class="hljs-attr">destroy</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">destroy</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">this</span>.$el = $(<span class="hljs-string">"&lt;div&gt;"</span>);
            }
        });
        <span class="hljs-keyword">return</span> Dataset;

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getDisplayFn</span>(<span class="hljs-params">display</span>) </span>{
            display = display || _.stringify;
            <span class="hljs-keyword">return</span> _.isFunction(display) ? display : displayFn;

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">displayFn</span>(<span class="hljs-params">obj</span>) </span>{
                <span class="hljs-keyword">return</span> obj[display];
            }
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getTemplates</span>(<span class="hljs-params">templates, displayFn</span>) </span>{
            <span class="hljs-keyword">return</span> {
                <span class="hljs-attr">notFound</span>: templates.notFound &amp;&amp; _.templatify(templates.notFound),
                <span class="hljs-attr">pending</span>: templates.pending &amp;&amp; _.templatify(templates.pending),
                <span class="hljs-attr">header</span>: templates.header &amp;&amp; _.templatify(templates.header),
                <span class="hljs-attr">footer</span>: templates.footer &amp;&amp; _.templatify(templates.footer),
                <span class="hljs-attr">suggestion</span>: templates.suggestion || suggestionTemplate
            };

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">suggestionTemplate</span>(<span class="hljs-params">context</span>) </span>{
                <span class="hljs-keyword">return</span> $(<span class="hljs-string">"&lt;div&gt;"</span>).text(displayFn(context));
            }
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isValidName</span>(<span class="hljs-params">str</span>) </span>{
            <span class="hljs-keyword">return</span> <span class="hljs-regexp">/^[_a-zA-Z0-9-]+$/</span>.test(str);
        }
    }();
    <span class="hljs-keyword">var</span> Menu = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-meta">        "use strict"</span>;

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Menu</span>(<span class="hljs-params">o, www</span>) </span>{
            <span class="hljs-keyword">var</span> that = <span class="hljs-keyword">this</span>;
            o = o || {};
            <span class="hljs-keyword">if</span> (!o.node) {
                $.error(<span class="hljs-string">"node is required"</span>);
            }
            www.mixin(<span class="hljs-keyword">this</span>);
            <span class="hljs-keyword">this</span>.$node = $(o.node);
            <span class="hljs-keyword">this</span>.query = <span class="hljs-literal">null</span>;
            <span class="hljs-keyword">this</span>.datasets = _.map(o.datasets, initializeDataset);

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">initializeDataset</span>(<span class="hljs-params">oDataset</span>) </span>{
                <span class="hljs-keyword">var</span> node = that.$node.find(oDataset.node).first();
                oDataset.node = node.length ? node : $(<span class="hljs-string">"&lt;div&gt;"</span>).appendTo(that.$node);
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Dataset(oDataset, www);
            }
        }
        _.mixin(Menu.prototype, EventEmitter, {
            <span class="hljs-attr">_onSelectableClick</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onSelectableClick</span>(<span class="hljs-params">$e</span>) </span>{
                <span class="hljs-keyword">this</span>.trigger(<span class="hljs-string">"selectableClicked"</span>, $($e.currentTarget));
            },
            <span class="hljs-attr">_onRendered</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onRendered</span>(<span class="hljs-params">type, dataset, suggestions, async</span>) </span>{
                <span class="hljs-keyword">this</span>.$node.toggleClass(<span class="hljs-keyword">this</span>.classes.empty, <span class="hljs-keyword">this</span>._allDatasetsEmpty());
                <span class="hljs-keyword">this</span>.trigger(<span class="hljs-string">"datasetRendered"</span>, dataset, suggestions, <span class="hljs-keyword">async</span>);
            },
            <span class="hljs-attr">_onCleared</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onCleared</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">this</span>.$node.toggleClass(<span class="hljs-keyword">this</span>.classes.empty, <span class="hljs-keyword">this</span>._allDatasetsEmpty());
                <span class="hljs-keyword">this</span>.trigger(<span class="hljs-string">"datasetCleared"</span>);
            },
            <span class="hljs-attr">_propagate</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">propagate</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">this</span>.trigger.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>);
            },
            <span class="hljs-attr">_allDatasetsEmpty</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">allDatasetsEmpty</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> _.every(<span class="hljs-keyword">this</span>.datasets, isDatasetEmpty);

                <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isDatasetEmpty</span>(<span class="hljs-params">dataset</span>) </span>{
                    <span class="hljs-keyword">return</span> dataset.isEmpty();
                }
            },
            <span class="hljs-attr">_getSelectables</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getSelectables</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.$node.find(<span class="hljs-keyword">this</span>.selectors.selectable);
            },
            <span class="hljs-attr">_removeCursor</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_removeCursor</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">var</span> $selectable = <span class="hljs-keyword">this</span>.getActiveSelectable();
                $selectable &amp;&amp; $selectable.removeClass(<span class="hljs-keyword">this</span>.classes.cursor);
            },
            <span class="hljs-attr">_ensureVisible</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ensureVisible</span>(<span class="hljs-params">$el</span>) </span>{
                <span class="hljs-keyword">var</span> elTop, elBottom, nodeScrollTop, nodeHeight;
                elTop = $el.position().top;
                elBottom = elTop + $el.outerHeight(<span class="hljs-literal">true</span>);
                nodeScrollTop = <span class="hljs-keyword">this</span>.$node.scrollTop();
                nodeHeight = <span class="hljs-keyword">this</span>.$node.height() + <span class="hljs-built_in">parseInt</span>(<span class="hljs-keyword">this</span>.$node.css(<span class="hljs-string">"paddingTop"</span>), <span class="hljs-number">10</span>) + <span class="hljs-built_in">parseInt</span>(<span class="hljs-keyword">this</span>.$node.css(<span class="hljs-string">"paddingBottom"</span>), <span class="hljs-number">10</span>);
                <span class="hljs-keyword">if</span> (elTop &lt; <span class="hljs-number">0</span>) {
                    <span class="hljs-keyword">this</span>.$node.scrollTop(nodeScrollTop + elTop);
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (nodeHeight &lt; elBottom) {
                    <span class="hljs-keyword">this</span>.$node.scrollTop(nodeScrollTop + (elBottom - nodeHeight));
                }
            },
            <span class="hljs-attr">bind</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">var</span> that = <span class="hljs-keyword">this</span>,
                    onSelectableClick;
                onSelectableClick = _.bind(<span class="hljs-keyword">this</span>._onSelectableClick, <span class="hljs-keyword">this</span>);
                <span class="hljs-keyword">this</span>.$node.on(<span class="hljs-string">"click.tt"</span>, <span class="hljs-keyword">this</span>.selectors.selectable, onSelectableClick);
                _.each(<span class="hljs-keyword">this</span>.datasets, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">dataset</span>) </span>{
                    dataset.onSync(<span class="hljs-string">"asyncRequested"</span>, that._propagate, that).onSync(<span class="hljs-string">"asyncCanceled"</span>, that._propagate, that).onSync(<span class="hljs-string">"asyncReceived"</span>, that._propagate, that).onSync(<span class="hljs-string">"rendered"</span>, that._onRendered, that).onSync(<span class="hljs-string">"cleared"</span>, that._onCleared, that);
                });
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
            },
            <span class="hljs-attr">isOpen</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isOpen</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.$node.hasClass(<span class="hljs-keyword">this</span>.classes.open);
            },
            <span class="hljs-attr">open</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">open</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">this</span>.$node.addClass(<span class="hljs-keyword">this</span>.classes.open);
            },
            <span class="hljs-attr">close</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">close</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">this</span>.$node.removeClass(<span class="hljs-keyword">this</span>.classes.open);
                <span class="hljs-keyword">this</span>._removeCursor();
            },
            <span class="hljs-attr">setLanguageDirection</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setLanguageDirection</span>(<span class="hljs-params">dir</span>) </span>{
                <span class="hljs-keyword">this</span>.$node.attr(<span class="hljs-string">"dir"</span>, dir);
            },
            <span class="hljs-attr">selectableRelativeToCursor</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">selectableRelativeToCursor</span>(<span class="hljs-params">delta</span>) </span>{
                <span class="hljs-keyword">var</span> $selectables, $oldCursor, oldIndex, newIndex;
                $oldCursor = <span class="hljs-keyword">this</span>.getActiveSelectable();
                $selectables = <span class="hljs-keyword">this</span>._getSelectables();
                oldIndex = $oldCursor ? $selectables.index($oldCursor) : <span class="hljs-number">-1</span>;
                newIndex = oldIndex + delta;
                newIndex = (newIndex + <span class="hljs-number">1</span>) % ($selectables.length + <span class="hljs-number">1</span>) - <span class="hljs-number">1</span>;
                newIndex = newIndex &lt; <span class="hljs-number">-1</span> ? $selectables.length - <span class="hljs-number">1</span> : newIndex;
                <span class="hljs-keyword">return</span> newIndex === <span class="hljs-number">-1</span> ? <span class="hljs-literal">null</span> : $selectables.eq(newIndex);
            },
            <span class="hljs-attr">setCursor</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setCursor</span>(<span class="hljs-params">$selectable</span>) </span>{
                <span class="hljs-keyword">this</span>._removeCursor();
                <span class="hljs-keyword">if</span> ($selectable = $selectable &amp;&amp; $selectable.first()) {
                    $selectable.addClass(<span class="hljs-keyword">this</span>.classes.cursor);
                    <span class="hljs-keyword">this</span>._ensureVisible($selectable);
                }
            },
            <span class="hljs-attr">getSelectableData</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getSelectableData</span>(<span class="hljs-params">$el</span>) </span>{
                <span class="hljs-keyword">return</span> $el &amp;&amp; $el.length ? Dataset.extractData($el) : <span class="hljs-literal">null</span>;
            },
            <span class="hljs-attr">getActiveSelectable</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getActiveSelectable</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">var</span> $selectable = <span class="hljs-keyword">this</span>._getSelectables().filter(<span class="hljs-keyword">this</span>.selectors.cursor).first();
                <span class="hljs-keyword">return</span> $selectable.length ? $selectable : <span class="hljs-literal">null</span>;
            },
            <span class="hljs-attr">getTopSelectable</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getTopSelectable</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">var</span> $selectable = <span class="hljs-keyword">this</span>._getSelectables().first();
                <span class="hljs-keyword">return</span> $selectable.length ? $selectable : <span class="hljs-literal">null</span>;
            },
            <span class="hljs-attr">update</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">update</span>(<span class="hljs-params">query</span>) </span>{
                <span class="hljs-keyword">var</span> isValidUpdate = query !== <span class="hljs-keyword">this</span>.query;
                <span class="hljs-keyword">if</span> (isValidUpdate) {
                    <span class="hljs-keyword">this</span>.query = query;
                    _.each(<span class="hljs-keyword">this</span>.datasets, updateDataset);
                }
                <span class="hljs-keyword">return</span> isValidUpdate;

                <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">updateDataset</span>(<span class="hljs-params">dataset</span>) </span>{
                    dataset.update(query);
                }
            },
            <span class="hljs-attr">empty</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">empty</span>(<span class="hljs-params"></span>) </span>{
                _.each(<span class="hljs-keyword">this</span>.datasets, clearDataset);
                <span class="hljs-keyword">this</span>.query = <span class="hljs-literal">null</span>;
                <span class="hljs-keyword">this</span>.$node.addClass(<span class="hljs-keyword">this</span>.classes.empty);

                <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">clearDataset</span>(<span class="hljs-params">dataset</span>) </span>{
                    dataset.clear();
                }
            },
            <span class="hljs-attr">destroy</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">destroy</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">this</span>.$node.off(<span class="hljs-string">".tt"</span>);
                <span class="hljs-keyword">this</span>.$node = $(<span class="hljs-string">"&lt;div&gt;"</span>);
                _.each(<span class="hljs-keyword">this</span>.datasets, destroyDataset);

                <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">destroyDataset</span>(<span class="hljs-params">dataset</span>) </span>{
                    dataset.destroy();
                }
            }
        });
        <span class="hljs-keyword">return</span> Menu;
    }();
    <span class="hljs-keyword">var</span> DefaultMenu = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-meta">        "use strict"</span>;
        <span class="hljs-keyword">var</span> s = Menu.prototype;

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">DefaultMenu</span>(<span class="hljs-params"></span>) </span>{
            Menu.apply(<span class="hljs-keyword">this</span>, [].slice.call(<span class="hljs-built_in">arguments</span>, <span class="hljs-number">0</span>));
        }
        _.mixin(DefaultMenu.prototype, Menu.prototype, {
            <span class="hljs-attr">open</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">open</span>(<span class="hljs-params"></span>) </span>{
                !<span class="hljs-keyword">this</span>._allDatasetsEmpty() &amp;&amp; <span class="hljs-keyword">this</span>._show();
                <span class="hljs-keyword">return</span> s.open.apply(<span class="hljs-keyword">this</span>, [].slice.call(<span class="hljs-built_in">arguments</span>, <span class="hljs-number">0</span>));
            },
            <span class="hljs-attr">close</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">close</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">this</span>._hide();
                <span class="hljs-keyword">return</span> s.close.apply(<span class="hljs-keyword">this</span>, [].slice.call(<span class="hljs-built_in">arguments</span>, <span class="hljs-number">0</span>));
            },
            <span class="hljs-attr">_onRendered</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onRendered</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._allDatasetsEmpty()) {
                    <span class="hljs-keyword">this</span>._hide();
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">this</span>.isOpen() &amp;&amp; <span class="hljs-keyword">this</span>._show();
                }
                <span class="hljs-keyword">return</span> s._onRendered.apply(<span class="hljs-keyword">this</span>, [].slice.call(<span class="hljs-built_in">arguments</span>, <span class="hljs-number">0</span>));
            },
            <span class="hljs-attr">_onCleared</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onCleared</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._allDatasetsEmpty()) {
                    <span class="hljs-keyword">this</span>._hide();
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">this</span>.isOpen() &amp;&amp; <span class="hljs-keyword">this</span>._show();
                }
                <span class="hljs-keyword">return</span> s._onCleared.apply(<span class="hljs-keyword">this</span>, [].slice.call(<span class="hljs-built_in">arguments</span>, <span class="hljs-number">0</span>));
            },
            <span class="hljs-attr">setLanguageDirection</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setLanguageDirection</span>(<span class="hljs-params">dir</span>) </span>{
                <span class="hljs-keyword">this</span>.$node.css(dir === <span class="hljs-string">"ltr"</span> ? <span class="hljs-keyword">this</span>.css.ltr : <span class="hljs-keyword">this</span>.css.rtl);
                <span class="hljs-keyword">return</span> s.setLanguageDirection.apply(<span class="hljs-keyword">this</span>, [].slice.call(<span class="hljs-built_in">arguments</span>, <span class="hljs-number">0</span>));
            },
            <span class="hljs-attr">_hide</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">hide</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">this</span>.$node.hide();
            },
            <span class="hljs-attr">_show</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">show</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">this</span>.$node.css(<span class="hljs-string">"display"</span>, <span class="hljs-string">"block"</span>);
            }
        });
        <span class="hljs-keyword">return</span> DefaultMenu;
    }();
    <span class="hljs-keyword">var</span> Typeahead = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-meta">        "use strict"</span>;

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Typeahead</span>(<span class="hljs-params">o, www</span>) </span>{
            <span class="hljs-keyword">var</span> onFocused, onBlurred, onEnterKeyed, onTabKeyed, onEscKeyed, onUpKeyed, onDownKeyed, onLeftKeyed, onRightKeyed, onQueryChanged, onWhitespaceChanged;
            o = o || {};
            <span class="hljs-keyword">if</span> (!o.input) {
                $.error(<span class="hljs-string">"missing input"</span>);
            }
            <span class="hljs-keyword">if</span> (!o.menu) {
                $.error(<span class="hljs-string">"missing menu"</span>);
            }
            <span class="hljs-keyword">if</span> (!o.eventBus) {
                $.error(<span class="hljs-string">"missing event bus"</span>);
            }
            www.mixin(<span class="hljs-keyword">this</span>);
            <span class="hljs-keyword">this</span>.eventBus = o.eventBus;
            <span class="hljs-keyword">this</span>.minLength = _.isNumber(o.minLength) ? o.minLength : <span class="hljs-number">1</span>;
            <span class="hljs-keyword">this</span>.input = o.input;
            <span class="hljs-keyword">this</span>.menu = o.menu;
            <span class="hljs-keyword">this</span>.enabled = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">this</span>.active = <span class="hljs-literal">false</span>;
            <span class="hljs-keyword">this</span>.input.hasFocus() &amp;&amp; <span class="hljs-keyword">this</span>.activate();
            <span class="hljs-keyword">this</span>.dir = <span class="hljs-keyword">this</span>.input.getLangDir();
            <span class="hljs-keyword">this</span>._hacks();
            <span class="hljs-keyword">this</span>.menu.bind().onSync(<span class="hljs-string">"selectableClicked"</span>, <span class="hljs-keyword">this</span>._onSelectableClicked, <span class="hljs-keyword">this</span>).onSync(<span class="hljs-string">"asyncRequested"</span>, <span class="hljs-keyword">this</span>._onAsyncRequested, <span class="hljs-keyword">this</span>).onSync(<span class="hljs-string">"asyncCanceled"</span>, <span class="hljs-keyword">this</span>._onAsyncCanceled, <span class="hljs-keyword">this</span>).onSync(<span class="hljs-string">"asyncReceived"</span>, <span class="hljs-keyword">this</span>._onAsyncReceived, <span class="hljs-keyword">this</span>).onSync(<span class="hljs-string">"datasetRendered"</span>, <span class="hljs-keyword">this</span>._onDatasetRendered, <span class="hljs-keyword">this</span>).onSync(<span class="hljs-string">"datasetCleared"</span>, <span class="hljs-keyword">this</span>._onDatasetCleared, <span class="hljs-keyword">this</span>);
            onFocused = c(<span class="hljs-keyword">this</span>, <span class="hljs-string">"activate"</span>, <span class="hljs-string">"open"</span>, <span class="hljs-string">"_onFocused"</span>);
            onBlurred = c(<span class="hljs-keyword">this</span>, <span class="hljs-string">"deactivate"</span>, <span class="hljs-string">"_onBlurred"</span>);
            onEnterKeyed = c(<span class="hljs-keyword">this</span>, <span class="hljs-string">"isActive"</span>, <span class="hljs-string">"isOpen"</span>, <span class="hljs-string">"_onEnterKeyed"</span>);
            onTabKeyed = c(<span class="hljs-keyword">this</span>, <span class="hljs-string">"isActive"</span>, <span class="hljs-string">"isOpen"</span>, <span class="hljs-string">"_onTabKeyed"</span>);
            onEscKeyed = c(<span class="hljs-keyword">this</span>, <span class="hljs-string">"isActive"</span>, <span class="hljs-string">"_onEscKeyed"</span>);
            onUpKeyed = c(<span class="hljs-keyword">this</span>, <span class="hljs-string">"isActive"</span>, <span class="hljs-string">"open"</span>, <span class="hljs-string">"_onUpKeyed"</span>);
            onDownKeyed = c(<span class="hljs-keyword">this</span>, <span class="hljs-string">"isActive"</span>, <span class="hljs-string">"open"</span>, <span class="hljs-string">"_onDownKeyed"</span>);
            onLeftKeyed = c(<span class="hljs-keyword">this</span>, <span class="hljs-string">"isActive"</span>, <span class="hljs-string">"isOpen"</span>, <span class="hljs-string">"_onLeftKeyed"</span>);
            onRightKeyed = c(<span class="hljs-keyword">this</span>, <span class="hljs-string">"isActive"</span>, <span class="hljs-string">"isOpen"</span>, <span class="hljs-string">"_onRightKeyed"</span>);
            onQueryChanged = c(<span class="hljs-keyword">this</span>, <span class="hljs-string">"_openIfActive"</span>, <span class="hljs-string">"_onQueryChanged"</span>);
            onWhitespaceChanged = c(<span class="hljs-keyword">this</span>, <span class="hljs-string">"_openIfActive"</span>, <span class="hljs-string">"_onWhitespaceChanged"</span>);
            <span class="hljs-keyword">this</span>.input.bind().onSync(<span class="hljs-string">"focused"</span>, onFocused, <span class="hljs-keyword">this</span>).onSync(<span class="hljs-string">"blurred"</span>, onBlurred, <span class="hljs-keyword">this</span>).onSync(<span class="hljs-string">"enterKeyed"</span>, onEnterKeyed, <span class="hljs-keyword">this</span>).onSync(<span class="hljs-string">"tabKeyed"</span>, onTabKeyed, <span class="hljs-keyword">this</span>).onSync(<span class="hljs-string">"escKeyed"</span>, onEscKeyed, <span class="hljs-keyword">this</span>).onSync(<span class="hljs-string">"upKeyed"</span>, onUpKeyed, <span class="hljs-keyword">this</span>).onSync(<span class="hljs-string">"downKeyed"</span>, onDownKeyed, <span class="hljs-keyword">this</span>).onSync(<span class="hljs-string">"leftKeyed"</span>, onLeftKeyed, <span class="hljs-keyword">this</span>).onSync(<span class="hljs-string">"rightKeyed"</span>, onRightKeyed, <span class="hljs-keyword">this</span>).onSync(<span class="hljs-string">"queryChanged"</span>, onQueryChanged, <span class="hljs-keyword">this</span>).onSync(<span class="hljs-string">"whitespaceChanged"</span>, onWhitespaceChanged, <span class="hljs-keyword">this</span>).onSync(<span class="hljs-string">"langDirChanged"</span>, <span class="hljs-keyword">this</span>._onLangDirChanged, <span class="hljs-keyword">this</span>);
        }
        _.mixin(Typeahead.prototype, {
            <span class="hljs-attr">_hacks</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">hacks</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">var</span> $input, $menu;
                $input = <span class="hljs-keyword">this</span>.input.$input || $(<span class="hljs-string">"&lt;div&gt;"</span>);
                $menu = <span class="hljs-keyword">this</span>.menu.$node || $(<span class="hljs-string">"&lt;div&gt;"</span>);
                $input.on(<span class="hljs-string">"blur.tt"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$e</span>) </span>{
                    <span class="hljs-keyword">var</span> active, isActive, hasActive;
                    active = <span class="hljs-built_in">document</span>.activeElement;
                    isActive = $menu.is(active);
                    hasActive = $menu.has(active).length &gt; <span class="hljs-number">0</span>;
                    <span class="hljs-keyword">if</span> (_.isMsie() &amp;&amp; (isActive || hasActive)) {
                        $e.preventDefault();
                        $e.stopImmediatePropagation();
                        _.defer(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                            $input.focus();
                        });
                    }
                });
                $menu.on(<span class="hljs-string">"mousedown.tt"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$e</span>) </span>{
                    $e.preventDefault();
                });
            },
            <span class="hljs-attr">_onSelectableClicked</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onSelectableClicked</span>(<span class="hljs-params">type, $el</span>) </span>{
                <span class="hljs-keyword">this</span>.select($el);
            },
            <span class="hljs-attr">_onDatasetCleared</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onDatasetCleared</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">this</span>._updateHint();
            },
            <span class="hljs-attr">_onDatasetRendered</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onDatasetRendered</span>(<span class="hljs-params">type, dataset, suggestions, async</span>) </span>{
                <span class="hljs-keyword">this</span>._updateHint();
                <span class="hljs-keyword">this</span>.eventBus.trigger(<span class="hljs-string">"render"</span>, suggestions, <span class="hljs-keyword">async</span>, dataset);
            },
            <span class="hljs-attr">_onAsyncRequested</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onAsyncRequested</span>(<span class="hljs-params">type, dataset, query</span>) </span>{
                <span class="hljs-keyword">this</span>.eventBus.trigger(<span class="hljs-string">"asyncrequest"</span>, query, dataset);
            },
            <span class="hljs-attr">_onAsyncCanceled</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onAsyncCanceled</span>(<span class="hljs-params">type, dataset, query</span>) </span>{
                <span class="hljs-keyword">this</span>.eventBus.trigger(<span class="hljs-string">"asynccancel"</span>, query, dataset);
            },
            <span class="hljs-attr">_onAsyncReceived</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onAsyncReceived</span>(<span class="hljs-params">type, dataset, query</span>) </span>{
                <span class="hljs-keyword">this</span>.eventBus.trigger(<span class="hljs-string">"asyncreceive"</span>, query, dataset);
            },
            <span class="hljs-attr">_onFocused</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onFocused</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">this</span>._minLengthMet() &amp;&amp; <span class="hljs-keyword">this</span>.menu.update(<span class="hljs-keyword">this</span>.input.getQuery());
            },
            <span class="hljs-attr">_onBlurred</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onBlurred</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.input.hasQueryChangedSinceLastFocus()) {
                    <span class="hljs-keyword">this</span>.eventBus.trigger(<span class="hljs-string">"change"</span>, <span class="hljs-keyword">this</span>.input.getQuery());
                }
            },
            <span class="hljs-attr">_onEnterKeyed</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onEnterKeyed</span>(<span class="hljs-params">type, $e</span>) </span>{
                <span class="hljs-keyword">var</span> $selectable;
                <span class="hljs-keyword">if</span> ($selectable = <span class="hljs-keyword">this</span>.menu.getActiveSelectable()) {
                    <span class="hljs-keyword">this</span>.select($selectable) &amp;&amp; $e.preventDefault();
                }
            },
            <span class="hljs-attr">_onTabKeyed</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onTabKeyed</span>(<span class="hljs-params">type, $e</span>) </span>{
                <span class="hljs-keyword">var</span> $selectable;
                <span class="hljs-keyword">if</span> ($selectable = <span class="hljs-keyword">this</span>.menu.getActiveSelectable()) {
                    <span class="hljs-keyword">this</span>.select($selectable) &amp;&amp; $e.preventDefault();
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ($selectable = <span class="hljs-keyword">this</span>.menu.getTopSelectable()) {
                    <span class="hljs-keyword">this</span>.autocomplete($selectable) &amp;&amp; $e.preventDefault();
                }
            },
            <span class="hljs-attr">_onEscKeyed</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onEscKeyed</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">this</span>.close();
            },
            <span class="hljs-attr">_onUpKeyed</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onUpKeyed</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">this</span>.moveCursor(<span class="hljs-number">-1</span>);
            },
            <span class="hljs-attr">_onDownKeyed</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onDownKeyed</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">this</span>.moveCursor(+<span class="hljs-number">1</span>);
            },
            <span class="hljs-attr">_onLeftKeyed</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onLeftKeyed</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.dir === <span class="hljs-string">"rtl"</span> &amp;&amp; <span class="hljs-keyword">this</span>.input.isCursorAtEnd()) {
                    <span class="hljs-keyword">this</span>.autocomplete(<span class="hljs-keyword">this</span>.menu.getTopSelectable());
                }
            },
            <span class="hljs-attr">_onRightKeyed</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onRightKeyed</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.dir === <span class="hljs-string">"ltr"</span> &amp;&amp; <span class="hljs-keyword">this</span>.input.isCursorAtEnd()) {
                    <span class="hljs-keyword">this</span>.autocomplete(<span class="hljs-keyword">this</span>.menu.getTopSelectable());
                }
            },
            <span class="hljs-attr">_onQueryChanged</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onQueryChanged</span>(<span class="hljs-params">e, query</span>) </span>{
                <span class="hljs-keyword">this</span>._minLengthMet(query) ? <span class="hljs-keyword">this</span>.menu.update(query) : <span class="hljs-keyword">this</span>.menu.empty();
            },
            <span class="hljs-attr">_onWhitespaceChanged</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onWhitespaceChanged</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">this</span>._updateHint();
            },
            <span class="hljs-attr">_onLangDirChanged</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onLangDirChanged</span>(<span class="hljs-params">e, dir</span>) </span>{
                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.dir !== dir) {
                    <span class="hljs-keyword">this</span>.dir = dir;
                    <span class="hljs-keyword">this</span>.menu.setLanguageDirection(dir);
                }
            },
            <span class="hljs-attr">_openIfActive</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">openIfActive</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">this</span>.isActive() &amp;&amp; <span class="hljs-keyword">this</span>.open();
            },
            <span class="hljs-attr">_minLengthMet</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">minLengthMet</span>(<span class="hljs-params">query</span>) </span>{
                query = _.isString(query) ? query : <span class="hljs-keyword">this</span>.input.getQuery() || <span class="hljs-string">""</span>;
                <span class="hljs-keyword">return</span> query.length &gt;= <span class="hljs-keyword">this</span>.minLength;
            },
            <span class="hljs-attr">_updateHint</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">updateHint</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">var</span> $selectable, data, val, query, escapedQuery, frontMatchRegEx, match;
                $selectable = <span class="hljs-keyword">this</span>.menu.getTopSelectable();
                data = <span class="hljs-keyword">this</span>.menu.getSelectableData($selectable);
                val = <span class="hljs-keyword">this</span>.input.getInputValue();
                <span class="hljs-keyword">if</span> (data &amp;&amp; !_.isBlankString(val) &amp;&amp; !<span class="hljs-keyword">this</span>.input.hasOverflow()) {
                    query = Input.normalizeQuery(val);
                    escapedQuery = _.escapeRegExChars(query);
                    frontMatchRegEx = <span class="hljs-keyword">new</span> <span class="hljs-built_in">RegExp</span>(<span class="hljs-string">"^(?:"</span> + escapedQuery + <span class="hljs-string">")(.+$)"</span>, <span class="hljs-string">"i"</span>);
                    match = frontMatchRegEx.exec(data.val);
                    match &amp;&amp; <span class="hljs-keyword">this</span>.input.setHint(val + match[<span class="hljs-number">1</span>]);
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">this</span>.input.clearHint();
                }
            },
            <span class="hljs-attr">isEnabled</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isEnabled</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.enabled;
            },
            <span class="hljs-attr">enable</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">enable</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">this</span>.enabled = <span class="hljs-literal">true</span>;
            },
            <span class="hljs-attr">disable</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">disable</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">this</span>.enabled = <span class="hljs-literal">false</span>;
            },
            <span class="hljs-attr">isActive</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isActive</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.active;
            },
            <span class="hljs-attr">activate</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">activate</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.isActive()) {
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.isEnabled() || <span class="hljs-keyword">this</span>.eventBus.before(<span class="hljs-string">"active"</span>)) {
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">this</span>.active = <span class="hljs-literal">true</span>;
                    <span class="hljs-keyword">this</span>.eventBus.trigger(<span class="hljs-string">"active"</span>);
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
                }
            },
            <span class="hljs-attr">deactivate</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">deactivate</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.isActive()) {
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.eventBus.before(<span class="hljs-string">"idle"</span>)) {
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">this</span>.active = <span class="hljs-literal">false</span>;
                    <span class="hljs-keyword">this</span>.close();
                    <span class="hljs-keyword">this</span>.eventBus.trigger(<span class="hljs-string">"idle"</span>);
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
                }
            },
            <span class="hljs-attr">isOpen</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isOpen</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.menu.isOpen();
            },
            <span class="hljs-attr">open</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">open</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.isOpen() &amp;&amp; !<span class="hljs-keyword">this</span>.eventBus.before(<span class="hljs-string">"open"</span>)) {
                    <span class="hljs-keyword">this</span>.menu.open();
                    <span class="hljs-keyword">this</span>._updateHint();
                    <span class="hljs-keyword">this</span>.eventBus.trigger(<span class="hljs-string">"open"</span>);
                }
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.isOpen();
            },
            <span class="hljs-attr">close</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">close</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.isOpen() &amp;&amp; !<span class="hljs-keyword">this</span>.eventBus.before(<span class="hljs-string">"close"</span>)) {
                    <span class="hljs-keyword">this</span>.menu.close();
                    <span class="hljs-keyword">this</span>.input.clearHint();
                    <span class="hljs-keyword">this</span>.input.resetInputValue();
                    <span class="hljs-keyword">this</span>.eventBus.trigger(<span class="hljs-string">"close"</span>);
                }
                <span class="hljs-keyword">return</span> !<span class="hljs-keyword">this</span>.isOpen();
            },
            <span class="hljs-attr">setVal</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setVal</span>(<span class="hljs-params">val</span>) </span>{
                <span class="hljs-keyword">this</span>.input.setQuery(_.toStr(val));
            },
            <span class="hljs-attr">getVal</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getVal</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.input.getQuery();
            },
            <span class="hljs-attr">select</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">select</span>(<span class="hljs-params">$selectable</span>) </span>{
                <span class="hljs-keyword">var</span> data = <span class="hljs-keyword">this</span>.menu.getSelectableData($selectable);
                <span class="hljs-keyword">if</span> (data &amp;&amp; !<span class="hljs-keyword">this</span>.eventBus.before(<span class="hljs-string">"select"</span>, data.obj)) {
                    <span class="hljs-keyword">this</span>.input.setQuery(data.val, <span class="hljs-literal">true</span>);
                    <span class="hljs-keyword">this</span>.eventBus.trigger(<span class="hljs-string">"select"</span>, data.obj);
                    <span class="hljs-keyword">this</span>.close();
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
                }
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            },
            <span class="hljs-attr">autocomplete</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">autocomplete</span>(<span class="hljs-params">$selectable</span>) </span>{
                <span class="hljs-keyword">var</span> query, data, isValid;
                query = <span class="hljs-keyword">this</span>.input.getQuery();
                data = <span class="hljs-keyword">this</span>.menu.getSelectableData($selectable);
                isValid = data &amp;&amp; query !== data.val;
                <span class="hljs-keyword">if</span> (isValid &amp;&amp; !<span class="hljs-keyword">this</span>.eventBus.before(<span class="hljs-string">"autocomplete"</span>, data.obj)) {
                    <span class="hljs-keyword">this</span>.input.setQuery(data.val);
                    <span class="hljs-keyword">this</span>.eventBus.trigger(<span class="hljs-string">"autocomplete"</span>, data.obj);
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
                }
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            },
            <span class="hljs-attr">moveCursor</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">moveCursor</span>(<span class="hljs-params">delta</span>) </span>{
                <span class="hljs-keyword">var</span> query, $candidate, data, payload, cancelMove;
                query = <span class="hljs-keyword">this</span>.input.getQuery();
                $candidate = <span class="hljs-keyword">this</span>.menu.selectableRelativeToCursor(delta);
                data = <span class="hljs-keyword">this</span>.menu.getSelectableData($candidate);
                payload = data ? data.obj : <span class="hljs-literal">null</span>;
                cancelMove = <span class="hljs-keyword">this</span>._minLengthMet() &amp;&amp; <span class="hljs-keyword">this</span>.menu.update(query);
                <span class="hljs-keyword">if</span> (!cancelMove &amp;&amp; !<span class="hljs-keyword">this</span>.eventBus.before(<span class="hljs-string">"cursorchange"</span>, payload)) {
                    <span class="hljs-keyword">this</span>.menu.setCursor($candidate);
                    <span class="hljs-keyword">if</span> (data) {
                        <span class="hljs-keyword">this</span>.input.setInputValue(data.val);
                    } <span class="hljs-keyword">else</span> {
                        <span class="hljs-keyword">this</span>.input.resetInputValue();
                        <span class="hljs-keyword">this</span>._updateHint();
                    }
                    <span class="hljs-keyword">this</span>.eventBus.trigger(<span class="hljs-string">"cursorchange"</span>, payload);
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
                }
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            },
            <span class="hljs-attr">destroy</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">destroy</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">this</span>.input.destroy();
                <span class="hljs-keyword">this</span>.menu.destroy();
            }
        });
        <span class="hljs-keyword">return</span> Typeahead;

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">c</span>(<span class="hljs-params">ctx</span>) </span>{
            <span class="hljs-keyword">var</span> methods = [].slice.call(<span class="hljs-built_in">arguments</span>, <span class="hljs-number">1</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">var</span> args = [].slice.call(<span class="hljs-built_in">arguments</span>);
                _.each(methods, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">method</span>) </span>{
                    <span class="hljs-keyword">return</span> ctx[method].apply(ctx, args);
                });
            };
        }
    }();
    (<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-meta">        "use strict"</span>;
        <span class="hljs-keyword">var</span> old, keys, methods;
        old = $.fn.typeahead;
        keys = {
            <span class="hljs-attr">www</span>: <span class="hljs-string">"tt-www"</span>,
            <span class="hljs-attr">attrs</span>: <span class="hljs-string">"tt-attrs"</span>,
            <span class="hljs-attr">typeahead</span>: <span class="hljs-string">"tt-typeahead"</span>
        };
        methods = {
            <span class="hljs-attr">initialize</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">initialize</span>(<span class="hljs-params">o, datasets</span>) </span>{
                <span class="hljs-keyword">var</span> www;
                datasets = _.isArray(datasets) ? datasets : [].slice.call(<span class="hljs-built_in">arguments</span>, <span class="hljs-number">1</span>);
                o = o || {};
                www = WWW(o.classNames);
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.each(attach);

                <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">attach</span>(<span class="hljs-params"></span>) </span>{
                    <span class="hljs-keyword">var</span> $input, $wrapper, $hint, $menu, defaultHint, defaultMenu, eventBus, input, menu, typeahead, MenuConstructor;
                    _.each(datasets, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">d</span>) </span>{
                        d.highlight = !!o.highlight;
                    });
                    $input = $(<span class="hljs-keyword">this</span>);
                    $wrapper = $(www.html.wrapper);
                    $hint = $elOrNull(o.hint);
                    $menu = $elOrNull(o.menu);
                    defaultHint = o.hint !== <span class="hljs-literal">false</span> &amp;&amp; !$hint;
                    defaultMenu = o.menu !== <span class="hljs-literal">false</span> &amp;&amp; !$menu;
                    defaultHint &amp;&amp; ($hint = buildHintFromInput($input, www));
                    defaultMenu &amp;&amp; ($menu = $(www.html.menu).css(www.css.menu));
                    $hint &amp;&amp; $hint.val(<span class="hljs-string">""</span>);
                    $input = prepInput($input, www);
                    <span class="hljs-keyword">if</span> (defaultHint || defaultMenu) {
                        $wrapper.css(www.css.wrapper);
                        $input.css(defaultHint ? www.css.input : www.css.inputWithNoHint);
                        $input.wrap($wrapper).parent().prepend(defaultHint ? $hint : <span class="hljs-literal">null</span>).append(defaultMenu ? $menu : <span class="hljs-literal">null</span>);
                    }
                    MenuConstructor = defaultMenu ? DefaultMenu : Menu;
                    eventBus = <span class="hljs-keyword">new</span> EventBus({
                        <span class="hljs-attr">el</span>: $input
                    });
                    input = <span class="hljs-keyword">new</span> Input({
                        <span class="hljs-attr">hint</span>: $hint,
                        <span class="hljs-attr">input</span>: $input
                    }, www);
                    menu = <span class="hljs-keyword">new</span> MenuConstructor({
                        <span class="hljs-attr">node</span>: $menu,
                        <span class="hljs-attr">datasets</span>: datasets
                    }, www);
                    typeahead = <span class="hljs-keyword">new</span> Typeahead({
                        <span class="hljs-attr">input</span>: input,
                        <span class="hljs-attr">menu</span>: menu,
                        <span class="hljs-attr">eventBus</span>: eventBus,
                        <span class="hljs-attr">minLength</span>: o.minLength
                    }, www);
                    $input.data(keys.www, www);
                    $input.data(keys.typeahead, typeahead);
                }
            },
            <span class="hljs-attr">isEnabled</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isEnabled</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">var</span> enabled;
                ttEach(<span class="hljs-keyword">this</span>.first(), <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">t</span>) </span>{
                    enabled = t.isEnabled();
                });
                <span class="hljs-keyword">return</span> enabled;
            },
            <span class="hljs-attr">enable</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">enable</span>(<span class="hljs-params"></span>) </span>{
                ttEach(<span class="hljs-keyword">this</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">t</span>) </span>{
                    t.enable();
                });
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
            },
            <span class="hljs-attr">disable</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">disable</span>(<span class="hljs-params"></span>) </span>{
                ttEach(<span class="hljs-keyword">this</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">t</span>) </span>{
                    t.disable();
                });
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
            },
            <span class="hljs-attr">isActive</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isActive</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">var</span> active;
                ttEach(<span class="hljs-keyword">this</span>.first(), <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">t</span>) </span>{
                    active = t.isActive();
                });
                <span class="hljs-keyword">return</span> active;
            },
            <span class="hljs-attr">activate</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">activate</span>(<span class="hljs-params"></span>) </span>{
                ttEach(<span class="hljs-keyword">this</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">t</span>) </span>{
                    t.activate();
                });
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
            },
            <span class="hljs-attr">deactivate</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">deactivate</span>(<span class="hljs-params"></span>) </span>{
                ttEach(<span class="hljs-keyword">this</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">t</span>) </span>{
                    t.deactivate();
                });
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
            },
            <span class="hljs-attr">isOpen</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isOpen</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">var</span> open;
                ttEach(<span class="hljs-keyword">this</span>.first(), <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">t</span>) </span>{
                    open = t.isOpen();
                });
                <span class="hljs-keyword">return</span> open;
            },
            <span class="hljs-attr">open</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">open</span>(<span class="hljs-params"></span>) </span>{
                ttEach(<span class="hljs-keyword">this</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">t</span>) </span>{
                    t.open();
                });
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
            },
            <span class="hljs-attr">close</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">close</span>(<span class="hljs-params"></span>) </span>{
                ttEach(<span class="hljs-keyword">this</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">t</span>) </span>{
                    t.close();
                });
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
            },
            <span class="hljs-attr">select</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">select</span>(<span class="hljs-params">el</span>) </span>{
                <span class="hljs-keyword">var</span> success = <span class="hljs-literal">false</span>,
                    $el = $(el);
                ttEach(<span class="hljs-keyword">this</span>.first(), <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">t</span>) </span>{
                    success = t.select($el);
                });
                <span class="hljs-keyword">return</span> success;
            },
            <span class="hljs-attr">autocomplete</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">autocomplete</span>(<span class="hljs-params">el</span>) </span>{
                <span class="hljs-keyword">var</span> success = <span class="hljs-literal">false</span>,
                    $el = $(el);
                ttEach(<span class="hljs-keyword">this</span>.first(), <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">t</span>) </span>{
                    success = t.autocomplete($el);
                });
                <span class="hljs-keyword">return</span> success;
            },
            <span class="hljs-attr">moveCursor</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">moveCursoe</span>(<span class="hljs-params">delta</span>) </span>{
                <span class="hljs-keyword">var</span> success = <span class="hljs-literal">false</span>;
                ttEach(<span class="hljs-keyword">this</span>.first(), <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">t</span>) </span>{
                    success = t.moveCursor(delta);
                });
                <span class="hljs-keyword">return</span> success;
            },
            <span class="hljs-attr">val</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">val</span>(<span class="hljs-params">newVal</span>) </span>{
                <span class="hljs-keyword">var</span> query;
                <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">arguments</span>.length) {
                    ttEach(<span class="hljs-keyword">this</span>.first(), <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">t</span>) </span>{
                        query = t.getVal();
                    });
                    <span class="hljs-keyword">return</span> query;
                } <span class="hljs-keyword">else</span> {
                    ttEach(<span class="hljs-keyword">this</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">t</span>) </span>{
                        t.setVal(newVal);
                    });
                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
                }
            },
            <span class="hljs-attr">destroy</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">destroy</span>(<span class="hljs-params"></span>) </span>{
                ttEach(<span class="hljs-keyword">this</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">typeahead, $input</span>) </span>{
                    revert($input);
                    typeahead.destroy();
                });
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
            }
        };
        $.fn.typeahead = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">method</span>) </span>{
            <span class="hljs-keyword">if</span> (methods[method]) {
                <span class="hljs-keyword">return</span> methods[method].apply(<span class="hljs-keyword">this</span>, [].slice.call(<span class="hljs-built_in">arguments</span>, <span class="hljs-number">1</span>));
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">return</span> methods.initialize.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>);
            }
        };
        $.fn.typeahead.noConflict = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">noConflict</span>(<span class="hljs-params"></span>) </span>{
            $.fn.typeahead = old;
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
        };

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ttEach</span>(<span class="hljs-params">$els, fn</span>) </span>{
            $els.each(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">var</span> $input = $(<span class="hljs-keyword">this</span>),
                    typeahead;
                (typeahead = $input.data(keys.typeahead)) &amp;&amp; fn(typeahead, $input);
            });
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">buildHintFromInput</span>(<span class="hljs-params">$input, www</span>) </span>{
            <span class="hljs-keyword">return</span> $input.clone().addClass(www.classes.hint).removeData().css(www.css.hint).css(getBackgroundStyles($input)).prop(<span class="hljs-string">"readonly"</span>, <span class="hljs-literal">true</span>).removeAttr(<span class="hljs-string">"id name placeholder required"</span>).attr({
                <span class="hljs-attr">autocomplete</span>: <span class="hljs-string">"off"</span>,
                <span class="hljs-attr">spellcheck</span>: <span class="hljs-string">"false"</span>,
                <span class="hljs-attr">tabindex</span>: <span class="hljs-number">-1</span>
            });
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">prepInput</span>(<span class="hljs-params">$input, www</span>) </span>{
            $input.data(keys.attrs, {
                <span class="hljs-attr">dir</span>: $input.attr(<span class="hljs-string">"dir"</span>),
                <span class="hljs-attr">autocomplete</span>: $input.attr(<span class="hljs-string">"autocomplete"</span>),
                <span class="hljs-attr">spellcheck</span>: $input.attr(<span class="hljs-string">"spellcheck"</span>),
                <span class="hljs-attr">style</span>: $input.attr(<span class="hljs-string">"style"</span>)
            });
            $input.addClass(www.classes.input).attr({
                <span class="hljs-attr">autocomplete</span>: <span class="hljs-string">"off"</span>,
                <span class="hljs-attr">spellcheck</span>: <span class="hljs-literal">false</span>
            });
            <span class="hljs-keyword">try</span> {
                !$input.attr(<span class="hljs-string">"dir"</span>) &amp;&amp; $input.attr(<span class="hljs-string">"dir"</span>, <span class="hljs-string">"auto"</span>);
            } <span class="hljs-keyword">catch</span> (e) {}
            <span class="hljs-keyword">return</span> $input;
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getBackgroundStyles</span>(<span class="hljs-params">$el</span>) </span>{
            <span class="hljs-keyword">return</span> {
                <span class="hljs-attr">backgroundAttachment</span>: $el.css(<span class="hljs-string">"background-attachment"</span>),
                <span class="hljs-attr">backgroundClip</span>: $el.css(<span class="hljs-string">"background-clip"</span>),
                <span class="hljs-attr">backgroundColor</span>: $el.css(<span class="hljs-string">"background-color"</span>),
                <span class="hljs-attr">backgroundImage</span>: $el.css(<span class="hljs-string">"background-image"</span>),
                <span class="hljs-attr">backgroundOrigin</span>: $el.css(<span class="hljs-string">"background-origin"</span>),
                <span class="hljs-attr">backgroundPosition</span>: $el.css(<span class="hljs-string">"background-position"</span>),
                <span class="hljs-attr">backgroundRepeat</span>: $el.css(<span class="hljs-string">"background-repeat"</span>),
                <span class="hljs-attr">backgroundSize</span>: $el.css(<span class="hljs-string">"background-size"</span>)
            };
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">revert</span>(<span class="hljs-params">$input</span>) </span>{
            <span class="hljs-keyword">var</span> www, $wrapper;
            www = $input.data(keys.www);
            $wrapper = $input.parent().filter(www.selectors.wrapper);
            _.each($input.data(keys.attrs), <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">val, key</span>) </span>{
                _.isUndefined(val) ? $input.removeAttr(key) : $input.attr(key, val);
            });
            $input.removeData(keys.typeahead).removeData(keys.www).removeData(keys.attr).removeClass(www.classes.input);
            <span class="hljs-keyword">if</span> ($wrapper.length) {
                $input.detach().insertAfter($wrapper);
                $wrapper.remove();
            }
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">$elOrNull</span>(<span class="hljs-params">obj</span>) </span>{
            <span class="hljs-keyword">var</span> isValid, $el;
            isValid = _.isJQuery(obj) || _.isElement(obj);
            $el = isValid ? $(obj).first() : [];
            <span class="hljs-keyword">return</span> $el.length ? $el : <span class="hljs-literal">null</span>;
        }
    })();
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/sn.angularstrap/js_includes_angular_strap_aside.js */</span>
<span class="hljs-comment">/*! RESOURCE: /scripts/thirdparty/angular.strap.2.2.2/modules/dimensions.js */</span>
angular.module(<span class="hljs-string">'mgcrea.ngStrap.helpers.dimensions'</span>, []).factory(<span class="hljs-string">'dimensions'</span>, [<span class="hljs-string">'$document'</span>, <span class="hljs-string">'$window'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$document, $window</span>) </span>{
    <span class="hljs-keyword">var</span> jqLite = angular.element;
    <span class="hljs-keyword">var</span> fn = {};
    <span class="hljs-keyword">var</span> nodeName = fn.nodeName = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">element, name</span>) </span>{
        <span class="hljs-keyword">return</span> element.nodeName &amp;&amp; element.nodeName.toLowerCase() === name.toLowerCase();
    };
    fn.css = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">element, prop, extra</span>) </span>{
        <span class="hljs-keyword">var</span> value;
        <span class="hljs-keyword">if</span> (element.currentStyle) {
            value = element.currentStyle[prop];
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-built_in">window</span>.getComputedStyle) {
            value = <span class="hljs-built_in">window</span>.getComputedStyle(element)[prop];
        } <span class="hljs-keyword">else</span> {
            value = element.style[prop];
        }
        <span class="hljs-keyword">return</span> extra === <span class="hljs-literal">true</span> ? <span class="hljs-built_in">parseFloat</span>(value) || <span class="hljs-number">0</span> : value;
    };
    fn.offset = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">element</span>) </span>{
        <span class="hljs-keyword">var</span> boxRect = element.getBoundingClientRect();
        <span class="hljs-keyword">var</span> docElement = element.ownerDocument;
        <span class="hljs-keyword">return</span> {
            <span class="hljs-attr">width</span>: boxRect.width || element.offsetWidth,
            <span class="hljs-attr">height</span>: boxRect.height || element.offsetHeight,
            <span class="hljs-attr">top</span>: boxRect.top + (<span class="hljs-built_in">window</span>.pageYOffset || docElement.documentElement.scrollTop) - (docElement.documentElement.clientTop || <span class="hljs-number">0</span>),
            <span class="hljs-attr">left</span>: boxRect.left + (<span class="hljs-built_in">window</span>.pageXOffset || docElement.documentElement.scrollLeft) - (docElement.documentElement.clientLeft || <span class="hljs-number">0</span>)
        };
    };
    fn.setOffset = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">element, options, i</span>) </span>{
        <span class="hljs-keyword">var</span> curPosition, curLeft, curCSSTop, curTop, curOffset, curCSSLeft, calculatePosition, position = fn.css(element, <span class="hljs-string">'position'</span>),
            curElem = angular.element(element),
            props = {};
        <span class="hljs-keyword">if</span> (position === <span class="hljs-string">'static'</span>) {
            element.style.position = <span class="hljs-string">'relative'</span>;
        }
        curOffset = fn.offset(element);
        curCSSTop = fn.css(element, <span class="hljs-string">'top'</span>);
        curCSSLeft = fn.css(element, <span class="hljs-string">'left'</span>);
        calculatePosition = (position === <span class="hljs-string">'absolute'</span> || position === <span class="hljs-string">'fixed'</span>) &amp;&amp; (curCSSTop + curCSSLeft).indexOf(<span class="hljs-string">'auto'</span>) &gt; <span class="hljs-number">-1</span>;
        <span class="hljs-keyword">if</span> (calculatePosition) {
            curPosition = fn.position(element);
            curTop = curPosition.top;
            curLeft = curPosition.left;
        } <span class="hljs-keyword">else</span> {
            curTop = <span class="hljs-built_in">parseFloat</span>(curCSSTop) || <span class="hljs-number">0</span>;
            curLeft = <span class="hljs-built_in">parseFloat</span>(curCSSLeft) || <span class="hljs-number">0</span>;
        }
        <span class="hljs-keyword">if</span> (angular.isFunction(options)) {
            options = options.call(element, i, curOffset);
        }
        <span class="hljs-keyword">if</span> (options.top !== <span class="hljs-literal">null</span>) {
            props.top = options.top - curOffset.top + curTop;
        }
        <span class="hljs-keyword">if</span> (options.left !== <span class="hljs-literal">null</span>) {
            props.left = options.left - curOffset.left + curLeft;
        }
        <span class="hljs-keyword">if</span> (<span class="hljs-string">'using'</span> <span class="hljs-keyword">in</span> options) {
            options.using.call(curElem, props);
        } <span class="hljs-keyword">else</span> {
            curElem.css({
                <span class="hljs-attr">top</span>: props.top + <span class="hljs-string">'px'</span>,
                <span class="hljs-attr">left</span>: props.left + <span class="hljs-string">'px'</span>
            });
        }
    };
    fn.position = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">element</span>) </span>{
        <span class="hljs-keyword">var</span> offsetParentRect = {
                <span class="hljs-attr">top</span>: <span class="hljs-number">0</span>,
                <span class="hljs-attr">left</span>: <span class="hljs-number">0</span>
            },
            offsetParentElement, offset;
        <span class="hljs-keyword">if</span> (fn.css(element, <span class="hljs-string">'position'</span>) === <span class="hljs-string">'fixed'</span>) {
            offset = element.getBoundingClientRect();
        } <span class="hljs-keyword">else</span> {
            offsetParentElement = offsetParent(element);
            offset = fn.offset(element);
            <span class="hljs-keyword">if</span> (!nodeName(offsetParentElement, <span class="hljs-string">'html'</span>)) {
                offsetParentRect = fn.offset(offsetParentElement);
            }
            offsetParentRect.top += fn.css(offsetParentElement, <span class="hljs-string">'borderTopWidth'</span>, <span class="hljs-literal">true</span>);
            offsetParentRect.left += fn.css(offsetParentElement, <span class="hljs-string">'borderLeftWidth'</span>, <span class="hljs-literal">true</span>);
        }
        <span class="hljs-keyword">return</span> {
            <span class="hljs-attr">width</span>: element.offsetWidth,
            <span class="hljs-attr">height</span>: element.offsetHeight,
            <span class="hljs-attr">top</span>: offset.top - offsetParentRect.top - fn.css(element, <span class="hljs-string">'marginTop'</span>, <span class="hljs-literal">true</span>),
            <span class="hljs-attr">left</span>: offset.left - offsetParentRect.left - fn.css(element, <span class="hljs-string">'marginLeft'</span>, <span class="hljs-literal">true</span>)
        };
    };
    <span class="hljs-keyword">var</span> offsetParent = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">offsetParentElement</span>(<span class="hljs-params">element</span>) </span>{
        <span class="hljs-keyword">var</span> docElement = element.ownerDocument;
        <span class="hljs-keyword">var</span> offsetParent = element.offsetParent || docElement;
        <span class="hljs-keyword">if</span> (nodeName(offsetParent, <span class="hljs-string">'#document'</span>)) <span class="hljs-keyword">return</span> docElement.documentElement;
        <span class="hljs-keyword">while</span> (offsetParent &amp;&amp; !nodeName(offsetParent, <span class="hljs-string">'html'</span>) &amp;&amp; fn.css(offsetParent, <span class="hljs-string">'position'</span>) === <span class="hljs-string">'static'</span>) {
            offsetParent = offsetParent.offsetParent;
        }
        <span class="hljs-keyword">return</span> offsetParent || docElement.documentElement;
    };
    fn.height = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">element, outer</span>) </span>{
        <span class="hljs-keyword">var</span> value = element.offsetHeight;
        <span class="hljs-keyword">if</span> (outer) {
            value += fn.css(element, <span class="hljs-string">'marginTop'</span>, <span class="hljs-literal">true</span>) + fn.css(element, <span class="hljs-string">'marginBottom'</span>, <span class="hljs-literal">true</span>);
        } <span class="hljs-keyword">else</span> {
            value -= fn.css(element, <span class="hljs-string">'paddingTop'</span>, <span class="hljs-literal">true</span>) + fn.css(element, <span class="hljs-string">'paddingBottom'</span>, <span class="hljs-literal">true</span>) + fn.css(element, <span class="hljs-string">'borderTopWidth'</span>, <span class="hljs-literal">true</span>) + fn.css(element, <span class="hljs-string">'borderBottomWidth'</span>, <span class="hljs-literal">true</span>);
        }
        <span class="hljs-keyword">return</span> value;
    };
    fn.width = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">element, outer</span>) </span>{
        <span class="hljs-keyword">var</span> value = element.offsetWidth;
        <span class="hljs-keyword">if</span> (outer) {
            value += fn.css(element, <span class="hljs-string">'marginLeft'</span>, <span class="hljs-literal">true</span>) + fn.css(element, <span class="hljs-string">'marginRight'</span>, <span class="hljs-literal">true</span>);
        } <span class="hljs-keyword">else</span> {
            value -= fn.css(element, <span class="hljs-string">'paddingLeft'</span>, <span class="hljs-literal">true</span>) + fn.css(element, <span class="hljs-string">'paddingRight'</span>, <span class="hljs-literal">true</span>) + fn.css(element, <span class="hljs-string">'borderLeftWidth'</span>, <span class="hljs-literal">true</span>) + fn.css(element, <span class="hljs-string">'borderRightWidth'</span>, <span class="hljs-literal">true</span>);
        }
        <span class="hljs-keyword">return</span> value;
    };
    <span class="hljs-keyword">return</span> fn;
}]);;
<span class="hljs-comment">/*! RESOURCE: /scripts/thirdparty/angular.strap.2.2.2/modules/modal.js */</span>
angular.module(<span class="hljs-string">'mgcrea.ngStrap.modal'</span>, [<span class="hljs-string">'mgcrea.ngStrap.helpers.dimensions'</span>]).provider(<span class="hljs-string">'$modal'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> defaults = <span class="hljs-keyword">this</span>.defaults = {
        <span class="hljs-attr">animation</span>: <span class="hljs-string">'am-fade'</span>,
        <span class="hljs-attr">backdropAnimation</span>: <span class="hljs-string">'am-fade'</span>,
        <span class="hljs-attr">prefixClass</span>: <span class="hljs-string">'modal'</span>,
        <span class="hljs-attr">prefixEvent</span>: <span class="hljs-string">'modal'</span>,
        <span class="hljs-attr">placement</span>: <span class="hljs-string">'top'</span>,
        <span class="hljs-attr">template</span>: <span class="hljs-string">'modal/modal.tpl.html'</span>,
        <span class="hljs-attr">contentTemplate</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">container</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">element</span>: <span class="hljs-literal">null</span>,
        <span class="hljs-attr">backdrop</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">keyboard</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">html</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">show</span>: <span class="hljs-literal">true</span>
    };
    <span class="hljs-keyword">this</span>.$get = [<span class="hljs-string">'$window'</span>, <span class="hljs-string">'$rootScope'</span>, <span class="hljs-string">'$compile'</span>, <span class="hljs-string">'$q'</span>, <span class="hljs-string">'$templateCache'</span>, <span class="hljs-string">'$http'</span>, <span class="hljs-string">'$animate'</span>, <span class="hljs-string">'$timeout'</span>, <span class="hljs-string">'$sce'</span>, <span class="hljs-string">'dimensions'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$window, $rootScope, $compile, $q, $templateCache, $http, $animate, $timeout, $sce, dimensions</span>) </span>{
        <span class="hljs-keyword">var</span> forEach = angular.forEach;
        <span class="hljs-keyword">var</span> trim = <span class="hljs-built_in">String</span>.prototype.trim;
        <span class="hljs-keyword">var</span> requestAnimationFrame = $<span class="hljs-built_in">window</span>.requestAnimationFrame || $<span class="hljs-built_in">window</span>.setTimeout;
        <span class="hljs-keyword">var</span> bodyElement = angular.element($<span class="hljs-built_in">window</span>.document.body);
        <span class="hljs-keyword">var</span> htmlReplaceRegExp = <span class="hljs-regexp">/ng-bind="/gi</span>;

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ModalFactory</span>(<span class="hljs-params">config</span>) </span>{
            <span class="hljs-keyword">var</span> $modal = {};
            <span class="hljs-keyword">var</span> options = $modal.$options = angular.extend({}, defaults, config);
            $modal.$promise = fetchTemplate(options.template);
            <span class="hljs-keyword">var</span> scope = $modal.$scope = options.scope &amp;&amp; options.scope.$<span class="hljs-keyword">new</span>() || $rootScope.$<span class="hljs-keyword">new</span>();
            <span class="hljs-keyword">if</span> (!options.element &amp;&amp; !options.container) {
                options.container = <span class="hljs-string">'body'</span>;
            }
            $modal.$id = options.id || options.element &amp;&amp; options.element.attr(<span class="hljs-string">'id'</span>) || <span class="hljs-string">''</span>;
            forEach([<span class="hljs-string">'title'</span>, <span class="hljs-string">'content'</span>], <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">key</span>) </span>{
                <span class="hljs-keyword">if</span> (options[key]) scope[key] = $sce.trustAsHtml(options[key]);
            });
            scope.$hide = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                scope.$$postDigest(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    $modal.hide();
                });
            };
            scope.$show = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                scope.$$postDigest(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    $modal.show();
                });
            };
            scope.$toggle = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                scope.$$postDigest(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    $modal.toggle();
                });
            };
            $modal.$isShown = scope.$isShown = <span class="hljs-literal">false</span>;
            <span class="hljs-keyword">if</span> (options.contentTemplate) {
                $modal.$promise = $modal.$promise.then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">template</span>) </span>{
                    <span class="hljs-keyword">var</span> templateEl = angular.element(template);
                    <span class="hljs-keyword">return</span> fetchTemplate(options.contentTemplate).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">contentTemplate</span>) </span>{
                        <span class="hljs-keyword">var</span> contentEl = findElement(<span class="hljs-string">'[ng-bind="content"]'</span>, templateEl[<span class="hljs-number">0</span>]).removeAttr(<span class="hljs-string">'ng-bind'</span>).html(contentTemplate);
                        <span class="hljs-keyword">if</span> (!config.template) contentEl.next().remove();
                        <span class="hljs-keyword">return</span> templateEl[<span class="hljs-number">0</span>].outerHTML;
                    });
                });
            }
            <span class="hljs-keyword">var</span> modalLinker, modalElement;
            <span class="hljs-keyword">var</span> backdropElement = angular.element(<span class="hljs-string">'&lt;div class="'</span> + options.prefixClass + <span class="hljs-string">'-backdrop"/&gt;'</span>);
            backdropElement.css({
                <span class="hljs-attr">position</span>: <span class="hljs-string">'fixed'</span>,
                <span class="hljs-attr">top</span>: <span class="hljs-string">'0px'</span>,
                <span class="hljs-attr">left</span>: <span class="hljs-string">'0px'</span>,
                <span class="hljs-attr">bottom</span>: <span class="hljs-string">'0px'</span>,
                <span class="hljs-attr">right</span>: <span class="hljs-string">'0px'</span>,
                <span class="hljs-string">'z-index'</span>: <span class="hljs-number">1038</span>
            });
            $modal.$promise.then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">template</span>) </span>{
                <span class="hljs-keyword">if</span> (angular.isObject(template)) template = template.data;
                <span class="hljs-keyword">if</span> (options.html) template = template.replace(htmlReplaceRegExp, <span class="hljs-string">'ng-bind-html="'</span>);
                template = trim.apply(template);
                modalLinker = $compile(template);
                $modal.init();
            });
            $modal.init = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">if</span> (options.show) {
                    scope.$$postDigest(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                        $modal.show();
                    });
                }
            };
            $modal.destroy = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">if</span> (modalElement) {
                    modalElement.remove();
                    modalElement = <span class="hljs-literal">null</span>;
                }
                <span class="hljs-keyword">if</span> (backdropElement) {
                    backdropElement.remove();
                    backdropElement = <span class="hljs-literal">null</span>;
                }
                scope.$destroy();
            };
            $modal.show = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">if</span> ($modal.$isShown) <span class="hljs-keyword">return</span>;
                <span class="hljs-keyword">var</span> parent, after;
                <span class="hljs-keyword">if</span> (angular.isElement(options.container)) {
                    parent = options.container;
                    after = options.container[<span class="hljs-number">0</span>].lastChild ? angular.element(options.container[<span class="hljs-number">0</span>].lastChild) : <span class="hljs-literal">null</span>;
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">if</span> (options.container) {
                        parent = findElement(options.container);
                        after = parent[<span class="hljs-number">0</span>] &amp;&amp; parent[<span class="hljs-number">0</span>].lastChild ? angular.element(parent[<span class="hljs-number">0</span>].lastChild) : <span class="hljs-literal">null</span>;
                    } <span class="hljs-keyword">else</span> {
                        parent = <span class="hljs-literal">null</span>;
                        after = options.element;
                    }
                }
                modalElement = $modal.$element = modalLinker(scope, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">clonedElement, scope</span>) </span>{});
                <span class="hljs-keyword">if</span> (scope.$emit(options.prefixEvent + <span class="hljs-string">'.show.before'</span>, $modal).defaultPrevented) {
                    <span class="hljs-keyword">return</span>;
                }
                modalElement.css({
                    <span class="hljs-attr">display</span>: <span class="hljs-string">'block'</span>
                }).addClass(options.placement);
                <span class="hljs-keyword">if</span> (options.animation) {
                    <span class="hljs-keyword">if</span> (options.backdrop) {
                        backdropElement.addClass(options.backdropAnimation);
                    }
                    modalElement.addClass(options.animation);
                }
                <span class="hljs-keyword">if</span> (options.backdrop) {
                    $animate.enter(backdropElement, bodyElement, <span class="hljs-literal">null</span>);
                }
                <span class="hljs-keyword">var</span> promise = $animate.enter(modalElement, parent, after, enterAnimateCallback);
                <span class="hljs-keyword">if</span> (promise &amp;&amp; promise.then) promise.then(enterAnimateCallback);
                $modal.$isShown = scope.$isShown = <span class="hljs-literal">true</span>;
                safeDigest(scope);
                <span class="hljs-keyword">var</span> el = modalElement[<span class="hljs-number">0</span>];
                requestAnimationFrame(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    el.focus();
                });
                bodyElement.addClass(options.prefixClass + <span class="hljs-string">'-open'</span>);
                <span class="hljs-keyword">if</span> (options.animation) {
                    bodyElement.addClass(options.prefixClass + <span class="hljs-string">'-with-'</span> + options.animation);
                }
                <span class="hljs-keyword">if</span> (options.backdrop) {
                    modalElement.on(<span class="hljs-string">'click'</span>, hideOnBackdropClick);
                    backdropElement.on(<span class="hljs-string">'click'</span>, hideOnBackdropClick);
                    backdropElement.on(<span class="hljs-string">'wheel'</span>, preventEventDefault);
                }
                <span class="hljs-keyword">if</span> (options.keyboard) {
                    modalElement.on(<span class="hljs-string">'keyup'</span>, $modal.$onKeyUp);
                }
            };

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">enterAnimateCallback</span>(<span class="hljs-params"></span>) </span>{
                scope.$emit(options.prefixEvent + <span class="hljs-string">'.show'</span>, $modal);
            }
            $modal.hide = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">if</span> (!$modal.$isShown) <span class="hljs-keyword">return</span>;
                <span class="hljs-keyword">if</span> (scope.$emit(options.prefixEvent + <span class="hljs-string">'.hide.before'</span>, $modal).defaultPrevented) {
                    <span class="hljs-keyword">return</span>;
                }
                <span class="hljs-keyword">var</span> promise = $animate.leave(modalElement, leaveAnimateCallback);
                <span class="hljs-keyword">if</span> (promise &amp;&amp; promise.then) promise.then(leaveAnimateCallback);
                <span class="hljs-keyword">if</span> (options.backdrop) {
                    $animate.leave(backdropElement);
                }
                $modal.$isShown = scope.$isShown = <span class="hljs-literal">false</span>;
                safeDigest(scope);
                <span class="hljs-keyword">if</span> (options.backdrop) {
                    modalElement.off(<span class="hljs-string">'click'</span>, hideOnBackdropClick);
                    backdropElement.off(<span class="hljs-string">'click'</span>, hideOnBackdropClick);
                    backdropElement.off(<span class="hljs-string">'wheel'</span>, preventEventDefault);
                }
                <span class="hljs-keyword">if</span> (options.keyboard) {
                    modalElement.off(<span class="hljs-string">'keyup'</span>, $modal.$onKeyUp);
                }
            };

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">leaveAnimateCallback</span>(<span class="hljs-params"></span>) </span>{
                scope.$emit(options.prefixEvent + <span class="hljs-string">'.hide'</span>, $modal);
                bodyElement.removeClass(options.prefixClass + <span class="hljs-string">'-open'</span>);
                <span class="hljs-keyword">if</span> (options.animation) {
                    bodyElement.removeClass(options.prefixClass + <span class="hljs-string">'-with-'</span> + options.animation);
                }
            }
            $modal.toggle = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                $modal.$isShown ? $modal.hide() : $modal.show();
            };
            $modal.focus = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                modalElement[<span class="hljs-number">0</span>].focus();
            };
            $modal.$onKeyUp = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">evt</span>) </span>{
                <span class="hljs-keyword">if</span> (evt.which === <span class="hljs-number">27</span> &amp;&amp; $modal.$isShown) {
                    $modal.hide();
                    evt.stopPropagation();
                }
            };

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">hideOnBackdropClick</span>(<span class="hljs-params">evt</span>) </span>{
                <span class="hljs-keyword">if</span> (evt.target !== evt.currentTarget) <span class="hljs-keyword">return</span>;
                options.backdrop === <span class="hljs-string">'static'</span> ? $modal.focus() : $modal.hide();
            }

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">preventEventDefault</span>(<span class="hljs-params">evt</span>) </span>{
                evt.preventDefault();
            }
            <span class="hljs-keyword">return</span> $modal;
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">safeDigest</span>(<span class="hljs-params">scope</span>) </span>{
            scope.$$phase || scope.$root &amp;&amp; scope.$root.$$phase || scope.$digest();
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">findElement</span>(<span class="hljs-params">query, element</span>) </span>{
            <span class="hljs-keyword">return</span> angular.element((element || <span class="hljs-built_in">document</span>).querySelectorAll(query));
        }
        <span class="hljs-keyword">var</span> fetchPromises = {};

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fetchTemplate</span>(<span class="hljs-params">template</span>) </span>{
            <span class="hljs-keyword">if</span> (fetchPromises[template]) <span class="hljs-keyword">return</span> fetchPromises[template];
            <span class="hljs-keyword">return</span> fetchPromises[template] = $http.get(template, {
                <span class="hljs-attr">cache</span>: $templateCache
            }).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">res</span>) </span>{
                <span class="hljs-keyword">return</span> res.data;
            });
        }
        <span class="hljs-keyword">return</span> ModalFactory;
    }];
}).directive(<span class="hljs-string">'bsModal'</span>, [<span class="hljs-string">'$window'</span>, <span class="hljs-string">'$sce'</span>, <span class="hljs-string">'$modal'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$window, $sce, $modal</span>) </span>{
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">restrict</span>: <span class="hljs-string">'EAC'</span>,
        <span class="hljs-attr">scope</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">link</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">postLink</span>(<span class="hljs-params">scope, element, attr, transclusion</span>) </span>{
            <span class="hljs-keyword">var</span> options = {
                <span class="hljs-attr">scope</span>: scope,
                <span class="hljs-attr">element</span>: element,
                <span class="hljs-attr">show</span>: <span class="hljs-literal">false</span>
            };
            angular.forEach([<span class="hljs-string">'template'</span>, <span class="hljs-string">'contentTemplate'</span>, <span class="hljs-string">'placement'</span>, <span class="hljs-string">'backdrop'</span>, <span class="hljs-string">'keyboard'</span>, <span class="hljs-string">'html'</span>, <span class="hljs-string">'container'</span>, <span class="hljs-string">'animation'</span>, <span class="hljs-string">'id'</span>, <span class="hljs-string">'prefixEvent'</span>, <span class="hljs-string">'prefixClass'</span>], <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">key</span>) </span>{
                <span class="hljs-keyword">if</span> (angular.isDefined(attr[key])) options[key] = attr[key];
            });
            <span class="hljs-keyword">var</span> falseValueRegExp = <span class="hljs-regexp">/^(false|0|)$/i</span>;
            angular.forEach([<span class="hljs-string">'backdrop'</span>, <span class="hljs-string">'keyboard'</span>, <span class="hljs-string">'html'</span>, <span class="hljs-string">'container'</span>], <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">key</span>) </span>{
                <span class="hljs-keyword">if</span> (angular.isDefined(attr[key]) &amp;&amp; falseValueRegExp.test(attr[key])) options[key] = <span class="hljs-literal">false</span>;
            });
            angular.forEach([<span class="hljs-string">'title'</span>, <span class="hljs-string">'content'</span>], <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">key</span>) </span>{
                attr[key] &amp;&amp; attr.$observe(key, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">newValue, oldValue</span>) </span>{
                    scope[key] = $sce.trustAsHtml(newValue);
                });
            });
            attr.bsModal &amp;&amp; scope.$watch(attr.bsModal, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">newValue, oldValue</span>) </span>{
                <span class="hljs-keyword">if</span> (angular.isObject(newValue)) {
                    angular.extend(scope, newValue);
                } <span class="hljs-keyword">else</span> {
                    scope.content = newValue;
                }
            }, <span class="hljs-literal">true</span>);
            <span class="hljs-keyword">var</span> modal = $modal(options);
            element.on(attr.trigger || <span class="hljs-string">'click'</span>, modal.toggle);
            scope.$on(<span class="hljs-string">'$destroy'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">if</span> (modal) modal.destroy();
                options = <span class="hljs-literal">null</span>;
                modal = <span class="hljs-literal">null</span>;
            });
        }
    };
}]);;
<span class="hljs-comment">/*! RESOURCE: /scripts/thirdparty/angular.strap.2.2.2/modules/aside.js */</span>
angular.module(<span class="hljs-string">'mgcrea.ngStrap.aside'</span>, [<span class="hljs-string">'mgcrea.ngStrap.modal'</span>]).provider(<span class="hljs-string">'$aside'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> defaults = <span class="hljs-keyword">this</span>.defaults = {
        <span class="hljs-attr">animation</span>: <span class="hljs-string">'am-fade-and-slide-right'</span>,
        <span class="hljs-attr">prefixClass</span>: <span class="hljs-string">'aside'</span>,
        <span class="hljs-attr">prefixEvent</span>: <span class="hljs-string">'aside'</span>,
        <span class="hljs-attr">placement</span>: <span class="hljs-string">'right'</span>,
        <span class="hljs-attr">template</span>: <span class="hljs-string">'aside/aside.tpl.html'</span>,
        <span class="hljs-attr">contentTemplate</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">container</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">element</span>: <span class="hljs-literal">null</span>,
        <span class="hljs-attr">backdrop</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">keyboard</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">html</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">show</span>: <span class="hljs-literal">true</span>
    };
    <span class="hljs-keyword">this</span>.$get = [<span class="hljs-string">'$modal'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$modal</span>) </span>{
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">AsideFactory</span>(<span class="hljs-params">config</span>) </span>{
            <span class="hljs-keyword">var</span> $aside = {};
            <span class="hljs-keyword">var</span> options = angular.extend({}, defaults, config);
            $aside = $modal(options);
            <span class="hljs-keyword">return</span> $aside;
        }
        <span class="hljs-keyword">return</span> AsideFactory;
    }];
}).directive(<span class="hljs-string">'bsAside'</span>, [<span class="hljs-string">'$window'</span>, <span class="hljs-string">'$sce'</span>, <span class="hljs-string">'$aside'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$window, $sce, $aside</span>) </span>{
    <span class="hljs-keyword">var</span> requestAnimationFrame = $<span class="hljs-built_in">window</span>.requestAnimationFrame || $<span class="hljs-built_in">window</span>.setTimeout;
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">restrict</span>: <span class="hljs-string">'EAC'</span>,
        <span class="hljs-attr">scope</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">link</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">postLink</span>(<span class="hljs-params">scope, element, attr, transclusion</span>) </span>{
            <span class="hljs-keyword">var</span> options = {
                <span class="hljs-attr">scope</span>: scope,
                <span class="hljs-attr">element</span>: element,
                <span class="hljs-attr">show</span>: <span class="hljs-literal">false</span>
            };
            angular.forEach([<span class="hljs-string">'template'</span>, <span class="hljs-string">'contentTemplate'</span>, <span class="hljs-string">'placement'</span>, <span class="hljs-string">'backdrop'</span>, <span class="hljs-string">'keyboard'</span>, <span class="hljs-string">'html'</span>, <span class="hljs-string">'container'</span>, <span class="hljs-string">'animation'</span>], <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">key</span>) </span>{
                <span class="hljs-keyword">if</span> (angular.isDefined(attr[key])) options[key] = attr[key];
            });
            <span class="hljs-keyword">var</span> falseValueRegExp = <span class="hljs-regexp">/^(false|0|)$/i</span>;
            angular.forEach([<span class="hljs-string">'backdrop'</span>, <span class="hljs-string">'keyboard'</span>, <span class="hljs-string">'html'</span>, <span class="hljs-string">'container'</span>], <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">key</span>) </span>{
                <span class="hljs-keyword">if</span> (angular.isDefined(attr[key]) &amp;&amp; falseValueRegExp.test(attr[key])) options[key] = <span class="hljs-literal">false</span>;
            });
            angular.forEach([<span class="hljs-string">'title'</span>, <span class="hljs-string">'content'</span>], <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">key</span>) </span>{
                attr[key] &amp;&amp; attr.$observe(key, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">newValue, oldValue</span>) </span>{
                    scope[key] = $sce.trustAsHtml(newValue);
                });
            });
            attr.bsAside &amp;&amp; scope.$watch(attr.bsAside, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">newValue, oldValue</span>) </span>{
                <span class="hljs-keyword">if</span> (angular.isObject(newValue)) {
                    angular.extend(scope, newValue);
                } <span class="hljs-keyword">else</span> {
                    scope.content = newValue;
                }
            }, <span class="hljs-literal">true</span>);
            <span class="hljs-keyword">var</span> aside = $aside(options);
            element.on(attr.trigger || <span class="hljs-string">'click'</span>, aside.toggle);
            scope.$on(<span class="hljs-string">'$destroy'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">if</span> (aside) aside.destroy();
                options = <span class="hljs-literal">null</span>;
                aside = <span class="hljs-literal">null</span>;
            });
        }
    };
}]);;;
<span class="hljs-comment">/*! RESOURCE: /scripts/sn.angularstrap/js_includes_angular_strap_components.js */</span>
<span class="hljs-comment">/*! RESOURCE: /scripts/sn.angularstrap/_module.js */</span>
angular.module(<span class="hljs-string">'sn.angularstrap'</span>, [
    <span class="hljs-string">'mgcrea.ngStrap.aside'</span>
]);;
<span class="hljs-comment">/*! RESOURCE: /scripts/sn.angularstrap/directive.snAside.js */</span>
angular.module(<span class="hljs-string">'sn.angularstrap'</span>).directive(<span class="hljs-string">'snAside'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">getTemplateUrl, $aside, $animate, $timeout</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
        <span class="hljs-attr">template</span>: <span class="hljs-string">'&lt;div /&gt;'</span>,
        <span class="hljs-attr">scope</span>: {
            <span class="hljs-attr">name</span>: <span class="hljs-string">'@'</span>
        },
        <span class="hljs-attr">link</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">scope, element, attrs</span>) </span>{
            <span class="hljs-keyword">var</span> broadcastPrefix = <span class="hljs-string">'sn.aside'</span> + (attrs.name ? <span class="hljs-string">'.'</span> + attrs.name : <span class="hljs-string">''</span>);
            scope.options = {
                <span class="hljs-attr">title</span>: <span class="hljs-string">''</span>,
                <span class="hljs-attr">content</span>: <span class="hljs-string">''</span>,
                <span class="hljs-attr">placement</span>: <span class="hljs-string">'right'</span>,
                <span class="hljs-attr">backdrop</span>: <span class="hljs-literal">false</span>,
                <span class="hljs-attr">keyboard</span>: <span class="hljs-literal">false</span>,
                <span class="hljs-attr">element</span>: element,
                <span class="hljs-attr">scope</span>: scope,
                <span class="hljs-attr">show</span>: <span class="hljs-literal">false</span>,
                <span class="hljs-attr">template</span>: getTemplateUrl(<span class="hljs-string">'sn_aside.xml'</span>)
            };
            scope.aside = $aside(scope.options);
            scope.$on(broadcastPrefix + <span class="hljs-string">'.open'</span>, _openAside);
            scope.$on(broadcastPrefix + <span class="hljs-string">'.deferred.open'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e, view, widthOverride</span>) </span>{
                scope.aside.$promise.then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    _openAside(e, view, widthOverride);
                });
            });

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_openAside</span>(<span class="hljs-params">e, view, widthOverride</span>) </span>{
                <span class="hljs-keyword">if</span> (!scope.$isShown) {
                    scope.aside.show();
                    scope.$isShown = <span class="hljs-literal">true</span>;
                    scope.aside.$element.addClass(<span class="hljs-string">'sn-aside_open'</span>);
                    scope.aside.$element.addClass(<span class="hljs-string">'sn-aside-hide'</span>);
                    $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                        scope.aside.$element.removeClass(<span class="hljs-string">'sn-aside-hide'</span>);
                    }, <span class="hljs-number">0</span>, <span class="hljs-literal">false</span>);
                }
                applyManualWidth(widthOverride);
                <span class="hljs-keyword">if</span> (view)
                    scope.$broadcast(broadcastPrefix + <span class="hljs-string">'.load'</span>, view);
            }
            scope.$on(broadcastPrefix + <span class="hljs-string">'.resize'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e, width</span>) </span>{
                applyManualWidth(width);
            });
            scope.$on(broadcastPrefix + <span class="hljs-string">'.close'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e, killAnimation</span>) </span>{
                <span class="hljs-keyword">if</span> (!scope.$isShown)
                    <span class="hljs-keyword">return</span>;
                scope.$isShown = <span class="hljs-literal">false</span>;
                <span class="hljs-keyword">var</span> element = scope.aside.$element;
                <span class="hljs-keyword">if</span> (killAnimation === <span class="hljs-literal">true</span>) {
                    element.addClass(<span class="hljs-string">'disableAnimations'</span>);
                    scope.$broadcast(broadcastPrefix + <span class="hljs-string">'.unload'</span>);
                } <span class="hljs-keyword">else</span> {
                    $animate.addClass(element, <span class="hljs-string">'sn-aside-hide'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                        scope.$broadcast(broadcastPrefix + <span class="hljs-string">'.unload'</span>);
                    });
                }
                element.removeClass(<span class="hljs-string">'disableAnimations'</span>);
            });
            scope.$on(<span class="hljs-string">'aside.hide.before'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                scope.aside.$element.removeClass(<span class="hljs-string">'sn-aside_open'</span>);
            });
            scope.$on(<span class="hljs-string">'aside.hide'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                scope.$isShown = <span class="hljs-literal">false</span>;
                scope.aside.$element.addClass(<span class="hljs-string">'sn-aside-hide'</span>);
            });

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">applyManualWidth</span>(<span class="hljs-params">width</span>) </span>{
                <span class="hljs-keyword">if</span> (angular.isString(width))
                    <span class="hljs-keyword">return</span> scope.aside.$element.css(<span class="hljs-string">'width'</span>, width).find(<span class="hljs-string">'.aside-dialog'</span>).css(<span class="hljs-string">'min-width'</span>, width);
                <span class="hljs-keyword">if</span> (angular.isNumber) {
                    <span class="hljs-keyword">var</span> newWidth = <span class="hljs-built_in">Math</span>.max(<span class="hljs-number">320</span>, width);
                    <span class="hljs-keyword">return</span> scope.aside.$element.innerWidth(newWidth).find(<span class="hljs-string">'.aside-dialog'</span>).css(<span class="hljs-string">'min-width'</span>, newWidth);
                }
            }
        }
    };
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/sn.angularstrap/directive.snAsideContent.js */</span>
angular.module(<span class="hljs-string">'sn.angularstrap'</span>).directive(<span class="hljs-string">'snAsideContent'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">getTemplateUrl, $compile, $templateCache, $timeout, $window</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
        <span class="hljs-attr">template</span>: <span class="hljs-string">'&lt;div class="aside-content" /&gt;'</span>,
        <span class="hljs-attr">link</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">scope, element, attrs</span>) </span>{
            <span class="hljs-keyword">var</span> broadcastPrefix = <span class="hljs-string">'sn.aside'</span> + (attrs.name ? <span class="hljs-string">'.'</span> + attrs.name : <span class="hljs-string">''</span>);
            scope.history = [];
            <span class="hljs-keyword">var</span> findPrefix = <span class="hljs-string">'#snAsideContent_'</span>,
                viewPrefix = findPrefix.slice(<span class="hljs-number">1</span>),
                cachedViews = {},
                cachedViewScopes = {},
                cachedViewKeys = [],
                asideContainer = element.parent().parent();
            <span class="hljs-keyword">var</span> asideTransitionDuration = <span class="hljs-built_in">parseFloat</span>(asideContainer.css(<span class="hljs-string">'transition-duration'</span>), <span class="hljs-number">10</span>) * <span class="hljs-number">1000</span> || <span class="hljs-number">500</span>;

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">stringFunction</span>(<span class="hljs-params">stringOrFunction</span>) </span>{
                <span class="hljs-keyword">if</span> (angular.isFunction(stringOrFunction))
                    <span class="hljs-keyword">return</span> stringOrFunction();
                <span class="hljs-keyword">return</span> stringOrFunction;
            }
            scope.loadView = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">view</span>) </span>{
                <span class="hljs-keyword">var</span> container;
                <span class="hljs-keyword">if</span> (!view)
                    <span class="hljs-keyword">return</span>;
                <span class="hljs-keyword">if</span> (view.cacheKey &amp;&amp; cachedViewKeys.indexOf(stringFunction(view.cacheKey)) &gt;= <span class="hljs-number">0</span>) {
                    <span class="hljs-keyword">if</span> (!view.isChild)
                        unloadView(<span class="hljs-literal">true</span>);
                    <span class="hljs-keyword">var</span> escapedKey = stringFunction(view.cacheKey).replace(<span class="hljs-regexp">/\./g</span>, <span class="hljs-string">'\\.'</span>);
                    container = element.find(findPrefix + escapedKey);
                    container.show().siblings().hide();
                    focusOnFirstChild(container);
                    <span class="hljs-keyword">return</span>;
                }
                <span class="hljs-keyword">var</span> subScope = scope.$<span class="hljs-keyword">new</span>();
                <span class="hljs-keyword">var</span> historyObj = {
                    <span class="hljs-attr">view</span>: view,
                    <span class="hljs-attr">cacheKey</span>: stringFunction(view.cacheKey),
                    <span class="hljs-attr">subScope</span>: subScope
                };
                <span class="hljs-keyword">if</span> (view.scope) {
                    <span class="hljs-keyword">if</span> (view.scope.constructor === scope.constructor) {
                        subScope.$destroy();
                        <span class="hljs-keyword">delete</span> historyObj.subScope;
                        subScope = view.scope.$<span class="hljs-keyword">new</span>();
                        historyObj.subScope = subScope;
                    } <span class="hljs-keyword">else</span> {
                        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> prop <span class="hljs-keyword">in</span> view.scope) {
                            <span class="hljs-keyword">if</span> (view.scope.hasOwnProperty(prop) &amp;&amp; !subScope.hasOwnProperty(prop))
                                subScope[prop] = view.scope[prop];
                        }
                    }
                }
                <span class="hljs-keyword">var</span> template = view.templateUrl ? $templateCache.get(view.templateUrl) : stringFunction(view.template);
                <span class="hljs-keyword">var</span> compiledTemplate = $compile(template)(subScope);
                <span class="hljs-keyword">if</span> (!view.isChild)
                    unloadView(<span class="hljs-literal">true</span>);
                scope.history.push(historyObj);
                <span class="hljs-keyword">if</span> (view.cacheKey)
                    cachedViewKeys.push(stringFunction(view.cacheKey));
                <span class="hljs-keyword">var</span> containerID = viewPrefix;
                containerID += view.cacheKey ? stringFunction(view.cacheKey) : scope.history.length;
                element.append(<span class="hljs-string">'&lt;div id="'</span> + containerID + <span class="hljs-string">'" /&gt;'</span>);
                containerID = containerID.replace(<span class="hljs-regexp">/\./g</span>, <span class="hljs-string">'\\.'</span>);
                container = element.find(<span class="hljs-string">'#'</span> + containerID);
                container.html(compiledTemplate).siblings().hide();
                <span class="hljs-keyword">if</span> (asideContainer.hasClass(<span class="hljs-string">"sn-aside-hide"</span>)) {
                    $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                        focusOnFirstChild(container);
                    }, asideTransitionDuration, <span class="hljs-literal">false</span>);
                } <span class="hljs-keyword">else</span> {
                    focusOnFirstChild(container);
                }
            };
            scope.$on(broadcastPrefix + <span class="hljs-string">'.historyBack'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                scope.historyBack();
            });
            scope.historyBack = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">evt</span>) </span>{
                <span class="hljs-keyword">if</span> (scope.history.length &lt;= <span class="hljs-number">1</span> || (evt &amp;&amp; evt.keyCode === <span class="hljs-number">9</span>))
                    <span class="hljs-keyword">return</span>;
                unloadView();
                <span class="hljs-keyword">var</span> previousView = scope.history[scope.history.length - <span class="hljs-number">1</span>];
                <span class="hljs-keyword">if</span> (previousView.cacheKey) {
                    element.find(findPrefix + previousView.cacheKey).show();
                } <span class="hljs-keyword">else</span> {
                    element.find(findPrefix + scope.history.length).show();
                }
                scope.$emit(broadcastPrefix + <span class="hljs-string">'.historyBack.completed'</span>, previousView.view);
            };

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">unloadView</span>(<span class="hljs-params">unloadAll</span>) </span>{
                <span class="hljs-keyword">if</span> (!scope.history.length)
                    <span class="hljs-keyword">return</span>;
                <span class="hljs-keyword">var</span> numViews = scope.history.length,
                    historyView = scope.history.pop(),
                    escapedKey = <span class="hljs-string">''</span>,
                    contentDiv;
                <span class="hljs-keyword">if</span> (historyView.cacheKey) {
                    escapedKey = historyView.cacheKey.replace(<span class="hljs-regexp">/\./g</span>, <span class="hljs-string">"\\."</span>);
                    contentDiv = element.find(findPrefix + escapedKey);
                    contentDiv.hide();
                    cachedViews[historyView.cacheKey] = historyView.view;
                    <span class="hljs-keyword">if</span> (historyView.subScope)
                        cachedViewScopes[historyView.cacheKey] = historyView.subScope;
                } <span class="hljs-keyword">else</span> {
                    contentDiv = element.find(findPrefix + numViews);
                    contentDiv.remove();
                    <span class="hljs-keyword">if</span> (historyView.subScope)
                        historyView.subScope.$destroy();
                }
                <span class="hljs-keyword">if</span> (unloadAll)
                    unloadView(unloadAll);
            }

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">clearCache</span>(<span class="hljs-params">key</span>) </span>{
                <span class="hljs-keyword">var</span> keys = cachedViewKeys.slice();
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, len = keys.length; i &lt; len; i++) {
                    <span class="hljs-keyword">if</span> (keys[i].indexOf(key) !== <span class="hljs-number">0</span>)
                        <span class="hljs-keyword">continue</span>;
                    <span class="hljs-keyword">if</span> (cachedViews[keys[i]])
                        <span class="hljs-keyword">delete</span> cachedViews[keys[i]];
                    <span class="hljs-keyword">if</span> (cachedViewScopes[keys[i]]) {
                        cachedViewScopes[keys[i]].$destroy();
                        <span class="hljs-keyword">delete</span> cachedViewScopes[keys[i]];
                    }
                    <span class="hljs-keyword">var</span> escapedKey = keys[i].replace(<span class="hljs-regexp">/\./g</span>, <span class="hljs-string">'\\.'</span>);
                    element.find(findPrefix + escapedKey).remove();
                    cachedViewKeys.splice(cachedViewKeys.indexOf(keys[i]), <span class="hljs-number">1</span>);
                }
            }

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">focusOnFirstChild</span>(<span class="hljs-params">container</span>) </span>{
                <span class="hljs-keyword">if</span> (!$<span class="hljs-built_in">window</span>.tabbable)
                    <span class="hljs-keyword">return</span>;
                $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    <span class="hljs-keyword">var</span> firstFocusable = $<span class="hljs-built_in">window</span>.tabbable(container[<span class="hljs-number">0</span>])[<span class="hljs-number">0</span>];
                    <span class="hljs-keyword">if</span> (firstFocusable)
                        firstFocusable.focus();
                }, <span class="hljs-number">0</span>, <span class="hljs-literal">false</span>);
            }
            scope.close = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">evt</span>) </span>{
                <span class="hljs-keyword">if</span> (evt.keyCode === <span class="hljs-number">9</span>)
                    <span class="hljs-keyword">return</span>;
                scope.$emit(broadcastPrefix + <span class="hljs-string">'.close'</span>);
            };
            scope.$on(broadcastPrefix + <span class="hljs-string">'.unload'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                unloadView(<span class="hljs-literal">true</span>);
            });
            scope.$on(broadcastPrefix + <span class="hljs-string">'.load'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e, view</span>) </span>{
                <span class="hljs-keyword">if</span> (!view)
                    <span class="hljs-keyword">return</span>;
                <span class="hljs-keyword">if</span> (scope.history.length) {
                    <span class="hljs-keyword">var</span> currentView = scope.history[scope.history.length - <span class="hljs-number">1</span>];
                    <span class="hljs-keyword">if</span> (angular.equals(currentView.view, view) &amp;&amp; currentView.key === stringFunction(view.cacheKey))
                        <span class="hljs-keyword">return</span>;
                }
                scope.loadView(view);
            });
            scope.$on(broadcastPrefix + <span class="hljs-string">'.clearCache'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e, cacheKey</span>) </span>{
                clearCache(cacheKey);
            })
        }
    }
});;;
<span class="hljs-comment">/*! RESOURCE: /scripts/sn/common/accessibility/js_includes_common_accessibility.js */</span>
<span class="hljs-comment">/*! RESOURCE: /scripts/sn/common/accessibility/_module.js */</span>
angular.module(<span class="hljs-string">'sn.common.accessibility'</span>, []);;
<span class="hljs-comment">/*! RESOURCE: /scripts/sn/common/accessibility/service.screenReaderStatus.js */</span>
angular.module(<span class="hljs-string">'sn.common.accessibility'</span>).service(<span class="hljs-string">'screenReaderStatus'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$document</span>) </span>{
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getAnnouncer</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> el = $<span class="hljs-built_in">document</span>[<span class="hljs-number">0</span>].getElementById(<span class="hljs-string">'ngStatus'</span>);
        <span class="hljs-keyword">if</span> (el)
            <span class="hljs-keyword">return</span> el;
        el = $<span class="hljs-built_in">document</span>[<span class="hljs-number">0</span>].createElement(<span class="hljs-string">'span'</span>)
        el.id = <span class="hljs-string">'ngStatus'</span>;
        el.setAttribute(<span class="hljs-string">'role'</span>, <span class="hljs-string">'status'</span>);
        el.setAttribute(<span class="hljs-string">'aria-live'</span>, <span class="hljs-string">'polite'</span>);
        el.classList.add(<span class="hljs-string">'sr-only'</span>);
        $<span class="hljs-built_in">document</span>[<span class="hljs-number">0</span>].body.appendChild(el);
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">cleanOldMessages</span>(<span class="hljs-params">el</span>) </span>{
        <span class="hljs-keyword">var</span> nodes = el.childNodes;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; nodes.length; i++) {
            el.removeChild(nodes[i]);
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">announce</span>(<span class="hljs-params">text</span>) </span>{
        <span class="hljs-keyword">var</span> statusEl = getAnnouncer();
        cleanOldMessages(statusEl);
        <span class="hljs-keyword">var</span> textNode = $<span class="hljs-built_in">document</span>[<span class="hljs-number">0</span>].createTextNode(text);
        statusEl.appendChild(textNode);
        statusEl.style.display = <span class="hljs-string">'none'</span>;
        statusEl.style.display = <span class="hljs-string">'inline'</span>;
    }
    getAnnouncer();
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">announce</span>: announce
    }
});;;
<span class="hljs-comment">/*! RESOURCE: /scripts/angularjs-1.4/sn/common/attachments/js_includes_attachments.js */</span>
<span class="hljs-comment">/*! RESOURCE: /scripts/angularjs-1.4/thirdparty/angular-file-upload/angular-file-upload-all.js */</span>
(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">patchXHR</span>(<span class="hljs-params">fnName, newFn</span>) </span>{
        <span class="hljs-built_in">window</span>.XMLHttpRequest.prototype[fnName] = newFn(<span class="hljs-built_in">window</span>.XMLHttpRequest.prototype[fnName]);
    }
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">window</span>.XMLHttpRequest &amp;&amp; !<span class="hljs-built_in">window</span>.XMLHttpRequest.__isFileAPIShim) {
        patchXHR(<span class="hljs-string">'setRequestHeader'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">orig</span>) </span>{
            <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">header, value</span>) </span>{
                <span class="hljs-keyword">if</span> (header === <span class="hljs-string">'__setXHR_'</span>) {
                    <span class="hljs-keyword">var</span> val = value(<span class="hljs-keyword">this</span>);
                    <span class="hljs-keyword">if</span> (val <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Function</span>) {
                        val(<span class="hljs-keyword">this</span>);
                    }
                } <span class="hljs-keyword">else</span> {
                    orig.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>);
                }
            }
        });
    }
    <span class="hljs-keyword">var</span> angularFileUpload = angular.module(<span class="hljs-string">'angularFileUpload'</span>, []);
    angularFileUpload.version = <span class="hljs-string">'3.1.2'</span>;
    angularFileUpload.service(<span class="hljs-string">'$upload'</span>, [<span class="hljs-string">'$http'</span>, <span class="hljs-string">'$q'</span>, <span class="hljs-string">'$timeout'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$http, $q, $timeout</span>) </span>{
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sendHttp</span>(<span class="hljs-params">config</span>) </span>{
            config.method = config.method || <span class="hljs-string">'POST'</span>;
            config.headers = config.headers || {};
            config.transformRequest = config.transformRequest || <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">data, headersGetter</span>) </span>{
                <span class="hljs-keyword">if</span> (<span class="hljs-built_in">window</span>.ArrayBuffer &amp;&amp; data <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">window</span>.ArrayBuffer) {
                    <span class="hljs-keyword">return</span> data;
                }
                <span class="hljs-keyword">return</span> $http.defaults.transformRequest[<span class="hljs-number">0</span>](data, headersGetter);
            };
            <span class="hljs-keyword">var</span> deferred = $q.defer();
            <span class="hljs-keyword">var</span> promise = deferred.promise;
            config.headers[<span class="hljs-string">'__setXHR_'</span>] = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">xhr</span>) </span>{
                    <span class="hljs-keyword">if</span> (!xhr) <span class="hljs-keyword">return</span>;
                    config.__XHR = xhr;
                    config.xhrFn &amp;&amp; config.xhrFn(xhr);
                    xhr.upload.addEventListener(<span class="hljs-string">'progress'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
                        e.config = config;
                        deferred.notify ? deferred.notify(e) : promise.progress_fn &amp;&amp; $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                            promise.progress_fn(e)
                        });
                    }, <span class="hljs-literal">false</span>);
                    xhr.upload.addEventListener(<span class="hljs-string">'load'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
                        <span class="hljs-keyword">if</span> (e.lengthComputable) {
                            e.config = config;
                            deferred.notify ? deferred.notify(e) : promise.progress_fn &amp;&amp; $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                                promise.progress_fn(e)
                            });
                        }
                    }, <span class="hljs-literal">false</span>);
                };
            };
            $http(config).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">r</span>) </span>{
                deferred.resolve(r)
            }, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
                deferred.reject(e)
            }, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">n</span>) </span>{
                deferred.notify(n)
            });
            promise.success = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">fn</span>) </span>{
                promise.then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>) </span>{
                    fn(response.data, response.status, response.headers, config);
                });
                <span class="hljs-keyword">return</span> promise;
            };
            promise.error = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">fn</span>) </span>{
                promise.then(<span class="hljs-literal">null</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>) </span>{
                    fn(response.data, response.status, response.headers, config);
                });
                <span class="hljs-keyword">return</span> promise;
            };
            promise.progress = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">fn</span>) </span>{
                promise.progress_fn = fn;
                promise.then(<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">update</span>) </span>{
                    fn(update);
                });
                <span class="hljs-keyword">return</span> promise;
            };
            promise.abort = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">if</span> (config.__XHR) {
                    $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                        config.__XHR.abort();
                    });
                }
                <span class="hljs-keyword">return</span> promise;
            };
            promise.xhr = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">fn</span>) </span>{
                config.xhrFn = (<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">origXhrFn</span>) </span>{
                    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                        origXhrFn &amp;&amp; origXhrFn.apply(promise, <span class="hljs-built_in">arguments</span>);
                        fn.apply(promise, <span class="hljs-built_in">arguments</span>);
                    }
                })(config.xhrFn);
                <span class="hljs-keyword">return</span> promise;
            };
            <span class="hljs-keyword">return</span> promise;
        }
        <span class="hljs-keyword">this</span>.upload = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">config</span>) </span>{
            config.headers = config.headers || {};
            config.headers[<span class="hljs-string">'Content-Type'</span>] = <span class="hljs-literal">undefined</span>;
            <span class="hljs-keyword">var</span> origTransformRequest = config.transformRequest;
            config.transformRequest = config.transformRequest ?
                (<span class="hljs-built_in">Object</span>.prototype.toString.call(config.transformRequest) === <span class="hljs-string">'[object Array]'</span> ?
                    config.transformRequest : [config.transformRequest]) : [];
            config.transformRequest.push(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">data, headerGetter</span>) </span>{
                <span class="hljs-keyword">var</span> formData = <span class="hljs-keyword">new</span> FormData();
                <span class="hljs-keyword">var</span> allFields = {};
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> key <span class="hljs-keyword">in</span> config.fields) allFields[key] = config.fields[key];
                <span class="hljs-keyword">if</span> (data) allFields[<span class="hljs-string">'data'</span>] = data;
                <span class="hljs-keyword">if</span> (config.formDataAppender) {
                    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> key <span class="hljs-keyword">in</span> allFields) {
                        config.formDataAppender(formData, key, allFields[key]);
                    }
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> key <span class="hljs-keyword">in</span> allFields) {
                        <span class="hljs-keyword">var</span> val = allFields[key];
                        <span class="hljs-keyword">if</span> (val !== <span class="hljs-literal">undefined</span>) {
                            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">Object</span>.prototype.toString.call(val) === <span class="hljs-string">'[object String]'</span>) {
                                formData.append(key, val);
                            } <span class="hljs-keyword">else</span> {
                                <span class="hljs-keyword">if</span> (config.sendObjectsAsJsonBlob &amp;&amp; <span class="hljs-keyword">typeof</span> val === <span class="hljs-string">'object'</span>) {
                                    formData.append(key, <span class="hljs-keyword">new</span> Blob([val], {
                                        <span class="hljs-attr">type</span>: <span class="hljs-string">'application/json'</span>
                                    }));
                                } <span class="hljs-keyword">else</span> {
                                    formData.append(key, <span class="hljs-built_in">JSON</span>.stringify(val));
                                }
                            }
                        }
                    }
                }
                <span class="hljs-keyword">if</span> (config.file != <span class="hljs-literal">null</span>) {
                    <span class="hljs-keyword">var</span> fileFormName = config.fileFormDataName || <span class="hljs-string">'file'</span>;
                    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">Object</span>.prototype.toString.call(config.file) === <span class="hljs-string">'[object Array]'</span>) {
                        <span class="hljs-keyword">var</span> isFileFormNameString = <span class="hljs-built_in">Object</span>.prototype.toString.call(fileFormName) === <span class="hljs-string">'[object String]'</span>;
                        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; config.file.length; i++) {
                            formData.append(isFileFormNameString ? fileFormName : fileFormName[i], config.file[i],
                                (config.fileName &amp;&amp; config.fileName[i]) || config.file[i].name);
                        }
                    } <span class="hljs-keyword">else</span> {
                        formData.append(fileFormName, config.file, config.fileName || config.file.name);
                    }
                }
                <span class="hljs-keyword">return</span> formData;
            });
            <span class="hljs-keyword">return</span> sendHttp(config);
        };
        <span class="hljs-keyword">this</span>.http = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">config</span>) </span>{
            <span class="hljs-keyword">return</span> sendHttp(config);
        };
    }]);
    angularFileUpload.directive(<span class="hljs-string">'ngFileSelect'</span>, [<span class="hljs-string">'$parse'</span>, <span class="hljs-string">'$timeout'</span>, <span class="hljs-string">'$compile'</span>,
        <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$parse, $timeout, $compile</span>) </span>{
            <span class="hljs-keyword">return</span> {
                <span class="hljs-attr">restrict</span>: <span class="hljs-string">'AEC'</span>,
                <span class="hljs-attr">require</span>: <span class="hljs-string">'?ngModel'</span>,
                <span class="hljs-attr">link</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">scope, elem, attr, ngModel</span>) </span>{
                    handleFileSelect(scope, elem, attr, ngModel, $parse, $timeout, $compile);
                }
            }
        }
    ]);

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">handleFileSelect</span>(<span class="hljs-params">scope, elem, attr, ngModel, $parse, $timeout, $compile</span>) </span>{
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isInputTypeFile</span>(<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">return</span> elem[<span class="hljs-number">0</span>].tagName.toLowerCase() === <span class="hljs-string">'input'</span> &amp;&amp; elem.attr(<span class="hljs-string">'type'</span>) &amp;&amp; elem.attr(<span class="hljs-string">'type'</span>).toLowerCase() === <span class="hljs-string">'file'</span>;
        }
        <span class="hljs-keyword">var</span> watchers = [];

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">watchForRecompile</span>(<span class="hljs-params">attrVal</span>) </span>{
            $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">if</span> (elem.parent().length) {
                    watchers.push(scope.$watch(attrVal, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">val, oldVal</span>) </span>{
                        <span class="hljs-keyword">if</span> (val != oldVal) {
                            recompileElem();
                        }
                    }));
                }
            });
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">recompileElem</span>(<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">var</span> clone = elem.clone();
            <span class="hljs-keyword">if</span> (elem.attr(<span class="hljs-string">'__afu_gen__'</span>)) {
                angular.element(<span class="hljs-built_in">document</span>.getElementById(elem.attr(<span class="hljs-string">'id'</span>).substring(<span class="hljs-number">1</span>))).remove();
            }
            <span class="hljs-keyword">if</span> (elem.parent().length) {
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; watchers.length; i++) {
                    watchers[i]();
                }
                elem.replaceWith(clone);
                $compile(clone)(scope);
            }
            <span class="hljs-keyword">return</span> clone;
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">bindAttr</span>(<span class="hljs-params">bindAttr, attrName</span>) </span>{
            <span class="hljs-keyword">if</span> (bindAttr) {
                watchForRecompile(bindAttr);
                <span class="hljs-keyword">var</span> val = $parse(bindAttr)(scope);
                <span class="hljs-keyword">if</span> (val) {
                    elem.attr(attrName, val);
                    attr[attrName] = val;
                } <span class="hljs-keyword">else</span> {
                    elem.attr(attrName, <span class="hljs-literal">null</span>);
                    <span class="hljs-keyword">delete</span> attr[attrName];
                }
            }
        }
        bindAttr(attr.ngMultiple, <span class="hljs-string">'multiple'</span>);
        bindAttr(attr.ngAccept, <span class="hljs-string">'ng-accept'</span>);
        bindAttr(attr.ngCapture, <span class="hljs-string">'capture'</span>);
        <span class="hljs-keyword">if</span> (attr[<span class="hljs-string">'ngFileSelect'</span>] != <span class="hljs-string">''</span>) {
            attr.ngFileChange = attr.ngFileSelect;
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onChangeFn</span>(<span class="hljs-params">evt</span>) </span>{
            <span class="hljs-keyword">var</span> files = [],
                fileList, i;
            fileList = evt.__files_ || (evt.target &amp;&amp; evt.target.files);
            updateModel(fileList, attr, ngModel, scope, evt);
        };
        <span class="hljs-keyword">var</span> fileElem = elem;
        <span class="hljs-keyword">if</span> (!isInputTypeFile()) {
            fileElem = angular.element(<span class="hljs-string">'&lt;input type="file"&gt;'</span>)
            <span class="hljs-keyword">if</span> (elem.attr(<span class="hljs-string">'multiple'</span>)) fileElem.attr(<span class="hljs-string">'multiple'</span>, elem.attr(<span class="hljs-string">'multiple'</span>));
            <span class="hljs-keyword">if</span> (elem.attr(<span class="hljs-string">'accept'</span>)) fileElem.attr(<span class="hljs-string">'accept'</span>, elem.attr(<span class="hljs-string">'accept'</span>));
            <span class="hljs-keyword">if</span> (elem.attr(<span class="hljs-string">'capture'</span>)) fileElem.attr(<span class="hljs-string">'capture'</span>, elem.attr(<span class="hljs-string">'capture'</span>));
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> key <span class="hljs-keyword">in</span> attr) {
                <span class="hljs-keyword">if</span> (key.indexOf(<span class="hljs-string">'inputFile'</span>) == <span class="hljs-number">0</span>) {
                    <span class="hljs-keyword">var</span> name = key.substring(<span class="hljs-string">'inputFile'</span>.length);
                    name = name[<span class="hljs-number">0</span>].toLowerCase() + name.substring(<span class="hljs-number">1</span>);
                    fileElem.attr(name, attr[key]);
                }
            }
            fileElem.css(<span class="hljs-string">'width'</span>, <span class="hljs-string">'0px'</span>).css(<span class="hljs-string">'height'</span>, <span class="hljs-string">'0px'</span>).css(<span class="hljs-string">'position'</span>, <span class="hljs-string">'absolute'</span>).css(<span class="hljs-string">'padding'</span>, <span class="hljs-number">0</span>).css(<span class="hljs-string">'margin'</span>, <span class="hljs-number">0</span>)
                .css(<span class="hljs-string">'overflow'</span>, <span class="hljs-string">'hidden'</span>).attr(<span class="hljs-string">'tabindex'</span>, <span class="hljs-string">'-1'</span>).css(<span class="hljs-string">'opacity'</span>, <span class="hljs-number">0</span>).attr(<span class="hljs-string">'__afu_gen__'</span>, <span class="hljs-literal">true</span>);
            elem.attr(<span class="hljs-string">'__refElem__'</span>, <span class="hljs-literal">true</span>);
            fileElem[<span class="hljs-number">0</span>].__refElem__ = elem[<span class="hljs-number">0</span>];
            elem.parent()[<span class="hljs-number">0</span>].insertBefore(fileElem[<span class="hljs-number">0</span>], elem[<span class="hljs-number">0</span>])
            elem.css(<span class="hljs-string">'overflow'</span>, <span class="hljs-string">'hidden'</span>);
            elem.bind(<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
                <span class="hljs-keyword">if</span> (!resetAndClick(e)) {
                    fileElem[<span class="hljs-number">0</span>].click();
                }
            });
        } <span class="hljs-keyword">else</span> {
            elem.bind(<span class="hljs-string">'click'</span>, resetAndClick);
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">resetAndClick</span>(<span class="hljs-params">evt</span>) </span>{
            <span class="hljs-keyword">if</span> (fileElem[<span class="hljs-number">0</span>].value != <span class="hljs-literal">null</span> &amp;&amp; fileElem[<span class="hljs-number">0</span>].value != <span class="hljs-string">''</span>) {
                fileElem[<span class="hljs-number">0</span>].value = <span class="hljs-literal">null</span>;
                <span class="hljs-keyword">if</span> (navigator.userAgent.indexOf(<span class="hljs-string">"Trident/7"</span>) === <span class="hljs-number">-1</span>) {
                    onChangeFn({
                        <span class="hljs-attr">target</span>: {
                            <span class="hljs-attr">files</span>: []
                        }
                    });
                }
            }
            <span class="hljs-keyword">if</span> (!elem.attr(<span class="hljs-string">'__afu_clone__'</span>)) {
                <span class="hljs-keyword">if</span> (navigator.appVersion.indexOf(<span class="hljs-string">"MSIE 10"</span>) !== <span class="hljs-number">-1</span> || navigator.userAgent.indexOf(<span class="hljs-string">"Trident/7"</span>) !== <span class="hljs-number">-1</span>) {
                    <span class="hljs-keyword">var</span> clone = recompileElem();
                    clone.attr(<span class="hljs-string">'__afu_clone__'</span>, <span class="hljs-literal">true</span>);
                    clone[<span class="hljs-number">0</span>].click();
                    evt.preventDefault();
                    evt.stopPropagation();
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
                }
            } <span class="hljs-keyword">else</span> {
                elem.attr(<span class="hljs-string">'__afu_clone__'</span>, <span class="hljs-literal">null</span>);
            }
        }
        fileElem.bind(<span class="hljs-string">'change'</span>, onChangeFn);
        elem.on(<span class="hljs-string">'$destroy'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; watchers.length; i++) {
                watchers[i]();
            }
            <span class="hljs-keyword">if</span> (elem[<span class="hljs-number">0</span>] != fileElem[<span class="hljs-number">0</span>]) fileElem.remove();
        });
        watchers.push(scope.$watch(attr.ngModel, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">val, oldVal</span>) </span>{
            <span class="hljs-keyword">if</span> (val != oldVal &amp;&amp; (val == <span class="hljs-literal">null</span> || !val.length)) {
                <span class="hljs-keyword">if</span> (navigator.appVersion.indexOf(<span class="hljs-string">"MSIE 10"</span>) !== <span class="hljs-number">-1</span>) {
                    recompileElem();
                } <span class="hljs-keyword">else</span> {
                    fileElem[<span class="hljs-number">0</span>].value = <span class="hljs-literal">null</span>;
                }
            }
        }));

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">updateModel</span>(<span class="hljs-params">fileList, attr, ngModel, scope, evt</span>) </span>{
            <span class="hljs-keyword">var</span> files = [],
                rejFiles = [];
            <span class="hljs-keyword">var</span> accept = $parse(attr.ngAccept)(scope);
            <span class="hljs-keyword">var</span> regexp = angular.isString(accept) &amp;&amp; accept ? <span class="hljs-keyword">new</span> <span class="hljs-built_in">RegExp</span>(globStringToRegex(accept), <span class="hljs-string">'gi'</span>) : <span class="hljs-literal">null</span>;
            <span class="hljs-keyword">var</span> acceptFn = regexp ? <span class="hljs-literal">null</span> : attr.ngAccept;
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; fileList.length; i++) {
                <span class="hljs-keyword">var</span> file = fileList.item(i);
                <span class="hljs-keyword">if</span> ((!regexp || file.type.match(regexp) || (file.name != <span class="hljs-literal">null</span> &amp;&amp; file.name.match(regexp))) &amp;&amp;
                    (!acceptFn || $parse(acceptFn)(scope, {
                        <span class="hljs-attr">$file</span>: file,
                        <span class="hljs-attr">$event</span>: evt
                    }))) {
                    files.push(file);
                } <span class="hljs-keyword">else</span> {
                    rejFiles.push(file);
                }
            }
            $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">if</span> (ngModel) {
                    $parse(attr.ngModel).assign(scope, files);
                    ngModel &amp;&amp; ngModel.$setViewValue(files != <span class="hljs-literal">null</span> &amp;&amp; files.length == <span class="hljs-number">0</span> ? <span class="hljs-string">''</span> : files);
                    <span class="hljs-keyword">if</span> (attr.ngModelRejected) {
                        $parse(attr.ngModelRejected).assign(scope, rejFiles);
                    }
                }
                <span class="hljs-keyword">if</span> (attr.ngFileChange &amp;&amp; attr.ngFileChange != <span class="hljs-string">""</span>) {
                    $parse(attr.ngFileChange)(scope, {
                        <span class="hljs-attr">$files</span>: files,
                        <span class="hljs-attr">$rejectedFiles</span>: rejFiles,
                        <span class="hljs-attr">$event</span>: evt
                    });
                }
            });
        }
    }
    angularFileUpload.directive(<span class="hljs-string">'ngFileDrop'</span>, [<span class="hljs-string">'$parse'</span>, <span class="hljs-string">'$timeout'</span>, <span class="hljs-string">'$location'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$parse, $timeout, $location</span>) </span>{
        <span class="hljs-keyword">return</span> {
            <span class="hljs-attr">restrict</span>: <span class="hljs-string">'AEC'</span>,
            <span class="hljs-attr">require</span>: <span class="hljs-string">'?ngModel'</span>,
            <span class="hljs-attr">link</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">scope, elem, attr, ngModel</span>) </span>{
                handleDrop(scope, elem, attr, ngModel, $parse, $timeout, $location);
            }
        }
    }]);
    angularFileUpload.directive(<span class="hljs-string">'ngNoFileDrop'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">scope, elem, attr</span>) </span>{
            <span class="hljs-keyword">if</span> (dropAvailable()) elem.css(<span class="hljs-string">'display'</span>, <span class="hljs-string">'none'</span>)
        }
    });
    angularFileUpload.directive(<span class="hljs-string">'ngFileDropAvailable'</span>, [<span class="hljs-string">'$parse'</span>, <span class="hljs-string">'$timeout'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$parse, $timeout</span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">scope, elem, attr</span>) </span>{
            <span class="hljs-keyword">if</span> (dropAvailable()) {
                <span class="hljs-keyword">var</span> fn = $parse(attr[<span class="hljs-string">'ngFileDropAvailable'</span>]);
                $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    fn(scope);
                });
            }
        }
    }]);

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">handleDrop</span>(<span class="hljs-params">scope, elem, attr, ngModel, $parse, $timeout, $location</span>) </span>{
        <span class="hljs-keyword">var</span> available = dropAvailable();
        <span class="hljs-keyword">if</span> (attr[<span class="hljs-string">'dropAvailable'</span>]) {
            $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                scope.dropAvailable ? scope.dropAvailable.value = available : scope.dropAvailable = available;
            });
        }
        <span class="hljs-keyword">if</span> (!available) {
            <span class="hljs-keyword">if</span> ($parse(attr.hideOnDropNotAvailable)(scope) != <span class="hljs-literal">false</span>) {
                elem.css(<span class="hljs-string">'display'</span>, <span class="hljs-string">'none'</span>);
            }
            <span class="hljs-keyword">return</span>;
        }
        <span class="hljs-keyword">var</span> leaveTimeout = <span class="hljs-literal">null</span>;
        <span class="hljs-keyword">var</span> stopPropagation = $parse(attr.stopPropagation)(scope);
        <span class="hljs-keyword">var</span> dragOverDelay = <span class="hljs-number">1</span>;
        <span class="hljs-keyword">var</span> accept = $parse(attr.ngAccept)(scope) || attr.accept;
        <span class="hljs-keyword">var</span> regexp = angular.isString(accept) &amp;&amp; accept ? <span class="hljs-keyword">new</span> <span class="hljs-built_in">RegExp</span>(globStringToRegex(accept), <span class="hljs-string">'gi'</span>) : <span class="hljs-literal">null</span>;
        <span class="hljs-keyword">var</span> acceptFn = regexp ? <span class="hljs-literal">null</span> : attr.ngAccept;
        <span class="hljs-keyword">var</span> actualDragOverClass;
        elem[<span class="hljs-number">0</span>].addEventListener(<span class="hljs-string">'dragover'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">evt</span>) </span>{
            evt.preventDefault();
            <span class="hljs-keyword">if</span> (stopPropagation) evt.stopPropagation();
            <span class="hljs-keyword">if</span> (navigator.userAgent.indexOf(<span class="hljs-string">"Chrome"</span>) &gt; <span class="hljs-number">-1</span>) {
                <span class="hljs-keyword">var</span> b = evt.dataTransfer.effectAllowed;
                evt.dataTransfer.dropEffect = (<span class="hljs-string">'move'</span> === b || <span class="hljs-string">'linkMove'</span> === b) ? <span class="hljs-string">'move'</span> : <span class="hljs-string">'copy'</span>;
            }
            $timeout.cancel(leaveTimeout);
            <span class="hljs-keyword">if</span> (!scope.actualDragOverClass) {
                actualDragOverClass = calculateDragOverClass(scope, attr, evt);
            }
            elem.addClass(actualDragOverClass);
        }, <span class="hljs-literal">false</span>);
        elem[<span class="hljs-number">0</span>].addEventListener(<span class="hljs-string">'dragenter'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">evt</span>) </span>{
            evt.preventDefault();
            <span class="hljs-keyword">if</span> (stopPropagation) evt.stopPropagation();
        }, <span class="hljs-literal">false</span>);
        elem[<span class="hljs-number">0</span>].addEventListener(<span class="hljs-string">'dragleave'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">evt</span>) </span>{
            leaveTimeout = $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                elem.removeClass(actualDragOverClass);
                actualDragOverClass = <span class="hljs-literal">null</span>;
            }, dragOverDelay || <span class="hljs-number">1</span>);
        }, <span class="hljs-literal">false</span>);
        <span class="hljs-keyword">if</span> (attr[<span class="hljs-string">'ngFileDrop'</span>] != <span class="hljs-string">''</span>) {
            attr.ngFileChange = attr[<span class="hljs-string">'ngFileDrop'</span>];
        }
        elem[<span class="hljs-number">0</span>].addEventListener(<span class="hljs-string">'drop'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">evt</span>) </span>{
            evt.preventDefault();
            <span class="hljs-keyword">if</span> (stopPropagation) evt.stopPropagation();
            elem.removeClass(actualDragOverClass);
            actualDragOverClass = <span class="hljs-literal">null</span>;
            extractFiles(evt, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">files, rejFiles</span>) </span>{
                $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    <span class="hljs-keyword">if</span> (ngModel) {
                        $parse(attr.ngModel).assign(scope, files);
                        ngModel &amp;&amp; ngModel.$setViewValue(files != <span class="hljs-literal">null</span> &amp;&amp; files.length == <span class="hljs-number">0</span> ? <span class="hljs-string">''</span> : files);
                    }
                    <span class="hljs-keyword">if</span> (attr[<span class="hljs-string">'ngModelRejected'</span>]) {
                        <span class="hljs-keyword">if</span> (scope[attr.ngModelRejected]) {
                            $parse(attr.ngModelRejected).assign(scope, rejFiles);
                        }
                    }
                });
                $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    $parse(attr.ngFileChange)(scope, {
                        <span class="hljs-attr">$files</span>: files,
                        <span class="hljs-attr">$rejectedFiles</span>: rejFiles,
                        <span class="hljs-attr">$event</span>: evt
                    });
                });
            }, $parse(attr.allowDir)(scope) != <span class="hljs-literal">false</span>, attr.multiple || $parse(attr.ngMultiple)(scope));
        }, <span class="hljs-literal">false</span>);

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">calculateDragOverClass</span>(<span class="hljs-params">scope, attr, evt</span>) </span>{
            <span class="hljs-keyword">var</span> valid = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">if</span> (regexp || acceptFn) {
                <span class="hljs-keyword">var</span> items = evt.dataTransfer.items;
                <span class="hljs-keyword">if</span> (items != <span class="hljs-literal">null</span>) {
                    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; items.length &amp;&amp; valid; i++) {
                        valid = valid &amp;&amp; (items[i].kind == <span class="hljs-string">'file'</span> || items[i].kind == <span class="hljs-string">''</span>) &amp;&amp;
                            ((acceptFn &amp;&amp; $parse(acceptFn)(scope, {
                                    <span class="hljs-attr">$file</span>: items[i],
                                    <span class="hljs-attr">$event</span>: evt
                                })) ||
                                (regexp &amp;&amp; (items[i].type != <span class="hljs-literal">null</span> &amp;&amp; items[i].type.match(regexp)) ||
                                    (items[i].name != <span class="hljs-literal">null</span> &amp;&amp; items[i].name.match(regexp))));
                    }
                }
            }
            <span class="hljs-keyword">var</span> clazz = $parse(attr.dragOverClass)(scope, {
                <span class="hljs-attr">$event</span>: evt
            });
            <span class="hljs-keyword">if</span> (clazz) {
                <span class="hljs-keyword">if</span> (clazz.delay) dragOverDelay = clazz.delay;
                <span class="hljs-keyword">if</span> (clazz.accept) clazz = valid ? clazz.accept : clazz.reject;
            }
            <span class="hljs-keyword">return</span> clazz || attr[<span class="hljs-string">'dragOverClass'</span>] || <span class="hljs-string">'dragover'</span>;
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">extractFiles</span>(<span class="hljs-params">evt, callback, allowDir, multiple</span>) </span>{
            <span class="hljs-keyword">var</span> files = [],
                rejFiles = [],
                items = evt.dataTransfer.items,
                processing = <span class="hljs-number">0</span>;

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addFile</span>(<span class="hljs-params">file</span>) </span>{
                <span class="hljs-keyword">if</span> ((!regexp || file.type.match(regexp) || (file.name != <span class="hljs-literal">null</span> &amp;&amp; file.name.match(regexp))) &amp;&amp;
                    (!acceptFn || $parse(acceptFn)(scope, {
                        <span class="hljs-attr">$file</span>: file,
                        <span class="hljs-attr">$event</span>: evt
                    }))) {
                    files.push(file);
                } <span class="hljs-keyword">else</span> {
                    rejFiles.push(file);
                }
            }
            <span class="hljs-keyword">if</span> (items &amp;&amp; items.length &gt; <span class="hljs-number">0</span> &amp;&amp; $location.protocol() != <span class="hljs-string">'file'</span>) {
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; items.length; i++) {
                    <span class="hljs-keyword">if</span> (items[i].webkitGetAsEntry &amp;&amp; items[i].webkitGetAsEntry() &amp;&amp; items[i].webkitGetAsEntry().isDirectory) {
                        <span class="hljs-keyword">var</span> entry = items[i].webkitGetAsEntry();
                        <span class="hljs-keyword">if</span> (entry.isDirectory &amp;&amp; !allowDir) {
                            <span class="hljs-keyword">continue</span>;
                        }
                        <span class="hljs-keyword">if</span> (entry != <span class="hljs-literal">null</span>) {
                            traverseFileTree(files, entry);
                        }
                    } <span class="hljs-keyword">else</span> {
                        <span class="hljs-keyword">var</span> f = items[i].getAsFile();
                        <span class="hljs-keyword">if</span> (f != <span class="hljs-literal">null</span>) addFile(f);
                    }
                    <span class="hljs-keyword">if</span> (!multiple &amp;&amp; files.length &gt; <span class="hljs-number">0</span>) <span class="hljs-keyword">break</span>;
                }
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">var</span> fileList = evt.dataTransfer.files;
                <span class="hljs-keyword">if</span> (fileList != <span class="hljs-literal">null</span>) {
                    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; fileList.length; i++) {
                        addFile(fileList.item(i));
                        <span class="hljs-keyword">if</span> (!multiple &amp;&amp; files.length &gt; <span class="hljs-number">0</span>) <span class="hljs-keyword">break</span>;
                    }
                }
            }
            <span class="hljs-keyword">var</span> delays = <span class="hljs-number">0</span>;
            (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">waitForProcess</span>(<span class="hljs-params">delay</span>) </span>{
                $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    <span class="hljs-keyword">if</span> (!processing) {
                        <span class="hljs-keyword">if</span> (!multiple &amp;&amp; files.length &gt; <span class="hljs-number">1</span>) {
                            <span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>;
                            <span class="hljs-keyword">while</span> (files[i].type == <span class="hljs-string">'directory'</span>) i++;
                            files = [files[i]];
                        }
                        callback(files, rejFiles);
                    } <span class="hljs-keyword">else</span> {
                        <span class="hljs-keyword">if</span> (delays++ * <span class="hljs-number">10</span> &lt; <span class="hljs-number">20</span> * <span class="hljs-number">1000</span>) {
                            waitForProcess(<span class="hljs-number">10</span>);
                        }
                    }
                }, delay || <span class="hljs-number">0</span>)
            })();

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">traverseFileTree</span>(<span class="hljs-params">files, entry, path</span>) </span>{
                <span class="hljs-keyword">if</span> (entry != <span class="hljs-literal">null</span>) {
                    <span class="hljs-keyword">if</span> (entry.isDirectory) {
                        <span class="hljs-keyword">var</span> filePath = (path || <span class="hljs-string">''</span>) + entry.name;
                        addFile({
                            <span class="hljs-attr">name</span>: entry.name,
                            <span class="hljs-attr">type</span>: <span class="hljs-string">'directory'</span>,
                            <span class="hljs-attr">path</span>: filePath
                        });
                        <span class="hljs-keyword">var</span> dirReader = entry.createReader();
                        <span class="hljs-keyword">var</span> entries = [];
                        processing++;
                        <span class="hljs-keyword">var</span> readEntries = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                            dirReader.readEntries(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">results</span>) </span>{
                                <span class="hljs-keyword">try</span> {
                                    <span class="hljs-keyword">if</span> (!results.length) {
                                        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; entries.length; i++) {
                                            traverseFileTree(files, entries[i], (path ? path : <span class="hljs-string">''</span>) + entry.name + <span class="hljs-string">'/'</span>);
                                        }
                                        processing--;
                                    } <span class="hljs-keyword">else</span> {
                                        entries = entries.concat(<span class="hljs-built_in">Array</span>.prototype.slice.call(results || [], <span class="hljs-number">0</span>));
                                        readEntries();
                                    }
                                } <span class="hljs-keyword">catch</span> (e) {
                                    processing--;
                                    <span class="hljs-built_in">console</span>.error(e);
                                }
                            }, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                                processing--;
                            });
                        };
                        readEntries();
                    } <span class="hljs-keyword">else</span> {
                        processing++;
                        entry.file(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">file</span>) </span>{
                            <span class="hljs-keyword">try</span> {
                                processing--;
                                file.path = (path ? path : <span class="hljs-string">''</span>) + file.name;
                                addFile(file);
                            } <span class="hljs-keyword">catch</span> (e) {
                                processing--;
                                <span class="hljs-built_in">console</span>.error(e);
                            }
                        }, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
                            processing--;
                        });
                    }
                }
            }
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">dropAvailable</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> div = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'div'</span>);
        <span class="hljs-keyword">return</span> (<span class="hljs-string">'draggable'</span> <span class="hljs-keyword">in</span> div) &amp;&amp; (<span class="hljs-string">'ondrop'</span> <span class="hljs-keyword">in</span> div);
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">globStringToRegex</span>(<span class="hljs-params">str</span>) </span>{
        <span class="hljs-keyword">if</span> (str.length &gt; <span class="hljs-number">2</span> &amp;&amp; str[<span class="hljs-number">0</span>] === <span class="hljs-string">'/'</span> &amp;&amp; str[str.length - <span class="hljs-number">1</span>] === <span class="hljs-string">'/'</span>) {
            <span class="hljs-keyword">return</span> str.substring(<span class="hljs-number">1</span>, str.length - <span class="hljs-number">1</span>);
        }
        <span class="hljs-keyword">var</span> split = str.split(<span class="hljs-string">','</span>),
            result = <span class="hljs-string">''</span>;
        <span class="hljs-keyword">if</span> (split.length &gt; <span class="hljs-number">1</span>) {
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; split.length; i++) {
                result += <span class="hljs-string">'('</span> + globStringToRegex(split[i]) + <span class="hljs-string">')'</span>;
                <span class="hljs-keyword">if</span> (i &lt; split.length - <span class="hljs-number">1</span>) {
                    result += <span class="hljs-string">'|'</span>
                }
            }
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">if</span> (str.indexOf(<span class="hljs-string">'.'</span>) == <span class="hljs-number">0</span>) {
                str = <span class="hljs-string">'*'</span> + str;
            }
            result = <span class="hljs-string">'^'</span> + str.replace(<span class="hljs-keyword">new</span> <span class="hljs-built_in">RegExp</span>(<span class="hljs-string">'[.\\\\+*?\\[\\^\\]$(){}=!&lt;&gt;|:\\'</span> + <span class="hljs-string">'-]'</span>, <span class="hljs-string">'g'</span>), <span class="hljs-string">'\\$&amp;'</span>) + <span class="hljs-string">'$'</span>;
            result = result.replace(<span class="hljs-regexp">/\\\*/g</span>, <span class="hljs-string">'.*'</span>).replace(<span class="hljs-regexp">/\\\?/g</span>, <span class="hljs-string">'.'</span>);
        }
        <span class="hljs-keyword">return</span> result;
    }
    <span class="hljs-keyword">var</span> ngFileUpload = angular.module(<span class="hljs-string">'ngFileUpload'</span>, []);
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> key <span class="hljs-keyword">in</span> angularFileUpload) {
        ngFileUpload[key] = angularFileUpload[key];
    }
})();
(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> hasFlash = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">var</span> fo = <span class="hljs-keyword">new</span> ActiveXObject(<span class="hljs-string">'ShockwaveFlash.ShockwaveFlash'</span>);
            <span class="hljs-keyword">if</span> (fo) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        } <span class="hljs-keyword">catch</span> (e) {
            <span class="hljs-keyword">if</span> (navigator.mimeTypes[<span class="hljs-string">'application/x-shockwave-flash'</span>] != <span class="hljs-literal">undefined</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">patchXHR</span>(<span class="hljs-params">fnName, newFn</span>) </span>{
        <span class="hljs-built_in">window</span>.XMLHttpRequest.prototype[fnName] = newFn(<span class="hljs-built_in">window</span>.XMLHttpRequest.prototype[fnName]);
    };
    <span class="hljs-keyword">if</span> ((<span class="hljs-built_in">window</span>.XMLHttpRequest &amp;&amp; !<span class="hljs-built_in">window</span>.FormData) || (<span class="hljs-built_in">window</span>.FileAPI &amp;&amp; FileAPI.forceLoad)) {
        <span class="hljs-keyword">var</span> initializeUploadListener = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">xhr</span>) </span>{
            <span class="hljs-keyword">if</span> (!xhr.__listeners) {
                <span class="hljs-keyword">if</span> (!xhr.upload) xhr.upload = {};
                xhr.__listeners = [];
                <span class="hljs-keyword">var</span> origAddEventListener = xhr.upload.addEventListener;
                xhr.upload.addEventListener = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">t, fn, b</span>) </span>{
                    xhr.__listeners[t] = fn;
                    origAddEventListener &amp;&amp; origAddEventListener.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>);
                };
            }
        }
        patchXHR(<span class="hljs-string">'open'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">orig</span>) </span>{
            <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">m, url, b</span>) </span>{
                initializeUploadListener(<span class="hljs-keyword">this</span>);
                <span class="hljs-keyword">this</span>.__url = url;
                <span class="hljs-keyword">try</span> {
                    orig.apply(<span class="hljs-keyword">this</span>, [m, url, b]);
                } <span class="hljs-keyword">catch</span> (e) {
                    <span class="hljs-keyword">if</span> (e.message.indexOf(<span class="hljs-string">'Access is denied'</span>) &gt; <span class="hljs-number">-1</span>) {
                        <span class="hljs-keyword">this</span>.__origError = e;
                        orig.apply(<span class="hljs-keyword">this</span>, [m, <span class="hljs-string">'_fix_for_ie_crossdomain__'</span>, b]);
                    }
                }
            }
        });
        patchXHR(<span class="hljs-string">'getResponseHeader'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">orig</span>) </span>{
            <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">h</span>) </span>{
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.__fileApiXHR &amp;&amp; <span class="hljs-keyword">this</span>.__fileApiXHR.getResponseHeader ? <span class="hljs-keyword">this</span>.__fileApiXHR.getResponseHeader(h) : (orig == <span class="hljs-literal">null</span> ? <span class="hljs-literal">null</span> : orig.apply(<span class="hljs-keyword">this</span>, [h]));
            };
        });
        patchXHR(<span class="hljs-string">'getAllResponseHeaders'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">orig</span>) </span>{
            <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.__fileApiXHR &amp;&amp; <span class="hljs-keyword">this</span>.__fileApiXHR.getAllResponseHeaders ? <span class="hljs-keyword">this</span>.__fileApiXHR.getAllResponseHeaders() : (orig == <span class="hljs-literal">null</span> ? <span class="hljs-literal">null</span> : orig.apply(<span class="hljs-keyword">this</span>));
            }
        });
        patchXHR(<span class="hljs-string">'abort'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">orig</span>) </span>{
            <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.__fileApiXHR &amp;&amp; <span class="hljs-keyword">this</span>.__fileApiXHR.abort ? <span class="hljs-keyword">this</span>.__fileApiXHR.abort() : (orig == <span class="hljs-literal">null</span> ? <span class="hljs-literal">null</span> : orig.apply(<span class="hljs-keyword">this</span>));
            }
        });
        patchXHR(<span class="hljs-string">'setRequestHeader'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">orig</span>) </span>{
            <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">header, value</span>) </span>{
                <span class="hljs-keyword">if</span> (header === <span class="hljs-string">'__setXHR_'</span>) {
                    initializeUploadListener(<span class="hljs-keyword">this</span>);
                    <span class="hljs-keyword">var</span> val = value(<span class="hljs-keyword">this</span>);
                    <span class="hljs-keyword">if</span> (val <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Function</span>) {
                        val(<span class="hljs-keyword">this</span>);
                    }
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">this</span>.__requestHeaders = <span class="hljs-keyword">this</span>.__requestHeaders || {};
                    <span class="hljs-keyword">this</span>.__requestHeaders[header] = value;
                    orig.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>);
                }
            }
        });

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">redefineProp</span>(<span class="hljs-params">xhr, prop, fn</span>) </span>{
            <span class="hljs-keyword">try</span> {
                <span class="hljs-built_in">Object</span>.defineProperty(xhr, prop, {
                    <span class="hljs-attr">get</span>: fn
                });
            } <span class="hljs-keyword">catch</span> (e) {}
        }
        patchXHR(<span class="hljs-string">'send'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">orig</span>) </span>{
            <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">var</span> xhr = <span class="hljs-keyword">this</span>;
                <span class="hljs-keyword">if</span> (<span class="hljs-built_in">arguments</span>[<span class="hljs-number">0</span>] &amp;&amp; <span class="hljs-built_in">arguments</span>[<span class="hljs-number">0</span>].__isFileAPIShim) {
                    <span class="hljs-keyword">var</span> formData = <span class="hljs-built_in">arguments</span>[<span class="hljs-number">0</span>];
                    <span class="hljs-keyword">var</span> config = {
                        <span class="hljs-attr">url</span>: xhr.__url,
                        <span class="hljs-attr">jsonp</span>: <span class="hljs-literal">false</span>,
                        <span class="hljs-attr">cache</span>: <span class="hljs-literal">true</span>,
                        <span class="hljs-attr">complete</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, fileApiXHR</span>) </span>{
                            xhr.__completed = <span class="hljs-literal">true</span>;
                            <span class="hljs-keyword">if</span> (!err &amp;&amp; xhr.__listeners[<span class="hljs-string">'load'</span>])
                                xhr.__listeners[<span class="hljs-string">'load'</span>]({
                                    <span class="hljs-attr">type</span>: <span class="hljs-string">'load'</span>,
                                    <span class="hljs-attr">loaded</span>: xhr.__loaded,
                                    <span class="hljs-attr">total</span>: xhr.__total,
                                    <span class="hljs-attr">target</span>: xhr,
                                    <span class="hljs-attr">lengthComputable</span>: <span class="hljs-literal">true</span>
                                });
                            <span class="hljs-keyword">if</span> (!err &amp;&amp; xhr.__listeners[<span class="hljs-string">'loadend'</span>])
                                xhr.__listeners[<span class="hljs-string">'loadend'</span>]({
                                    <span class="hljs-attr">type</span>: <span class="hljs-string">'loadend'</span>,
                                    <span class="hljs-attr">loaded</span>: xhr.__loaded,
                                    <span class="hljs-attr">total</span>: xhr.__total,
                                    <span class="hljs-attr">target</span>: xhr,
                                    <span class="hljs-attr">lengthComputable</span>: <span class="hljs-literal">true</span>
                                });
                            <span class="hljs-keyword">if</span> (err === <span class="hljs-string">'abort'</span> &amp;&amp; xhr.__listeners[<span class="hljs-string">'abort'</span>])
                                xhr.__listeners[<span class="hljs-string">'abort'</span>]({
                                    <span class="hljs-attr">type</span>: <span class="hljs-string">'abort'</span>,
                                    <span class="hljs-attr">loaded</span>: xhr.__loaded,
                                    <span class="hljs-attr">total</span>: xhr.__total,
                                    <span class="hljs-attr">target</span>: xhr,
                                    <span class="hljs-attr">lengthComputable</span>: <span class="hljs-literal">true</span>
                                });
                            <span class="hljs-keyword">if</span> (fileApiXHR.status !== <span class="hljs-literal">undefined</span>) redefineProp(xhr, <span class="hljs-string">'status'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                                <span class="hljs-keyword">return</span> (fileApiXHR.status == <span class="hljs-number">0</span> &amp;&amp; err &amp;&amp; err !== <span class="hljs-string">'abort'</span>) ? <span class="hljs-number">500</span> : fileApiXHR.status
                            });
                            <span class="hljs-keyword">if</span> (fileApiXHR.statusText !== <span class="hljs-literal">undefined</span>) redefineProp(xhr, <span class="hljs-string">'statusText'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                                <span class="hljs-keyword">return</span> fileApiXHR.statusText
                            });
                            redefineProp(xhr, <span class="hljs-string">'readyState'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                                <span class="hljs-keyword">return</span> <span class="hljs-number">4</span>
                            });
                            <span class="hljs-keyword">if</span> (fileApiXHR.response !== <span class="hljs-literal">undefined</span>) redefineProp(xhr, <span class="hljs-string">'response'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                                <span class="hljs-keyword">return</span> fileApiXHR.response
                            });
                            <span class="hljs-keyword">var</span> resp = fileApiXHR.responseText || (err &amp;&amp; fileApiXHR.status == <span class="hljs-number">0</span> &amp;&amp; err !== <span class="hljs-string">'abort'</span> ? err : <span class="hljs-literal">undefined</span>);
                            redefineProp(xhr, <span class="hljs-string">'responseText'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                                <span class="hljs-keyword">return</span> resp
                            });
                            redefineProp(xhr, <span class="hljs-string">'response'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                                <span class="hljs-keyword">return</span> resp
                            });
                            <span class="hljs-keyword">if</span> (err) redefineProp(xhr, <span class="hljs-string">'err'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                                <span class="hljs-keyword">return</span> err
                            });
                            xhr.__fileApiXHR = fileApiXHR;
                            <span class="hljs-keyword">if</span> (xhr.onreadystatechange) xhr.onreadystatechange();
                            <span class="hljs-keyword">if</span> (xhr.onload) xhr.onload();
                        },
                        <span class="hljs-attr">fileprogress</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
                            e.target = xhr;
                            xhr.__listeners[<span class="hljs-string">'progress'</span>] &amp;&amp; xhr.__listeners[<span class="hljs-string">'progress'</span>](e);
                            xhr.__total = e.total;
                            xhr.__loaded = e.loaded;
                            <span class="hljs-keyword">if</span> (e.total === e.loaded) {
                                <span class="hljs-keyword">var</span> _this = <span class="hljs-keyword">this</span>
                                setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                                    <span class="hljs-keyword">if</span> (!xhr.__completed) {
                                        xhr.getAllResponseHeaders = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{};
                                        _this.complete(<span class="hljs-literal">null</span>, {
                                            <span class="hljs-attr">status</span>: <span class="hljs-number">204</span>,
                                            <span class="hljs-attr">statusText</span>: <span class="hljs-string">'No Content'</span>
                                        });
                                    }
                                }, FileAPI.noContentTimeout || <span class="hljs-number">10000</span>);
                            }
                        },
                        <span class="hljs-attr">headers</span>: xhr.__requestHeaders
                    }
                    config.data = {};
                    config.files = {}
                    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; formData.data.length; i++) {
                        <span class="hljs-keyword">var</span> item = formData.data[i];
                        <span class="hljs-keyword">if</span> (item.val != <span class="hljs-literal">null</span> &amp;&amp; item.val.name != <span class="hljs-literal">null</span> &amp;&amp; item.val.size != <span class="hljs-literal">null</span> &amp;&amp; item.val.type != <span class="hljs-literal">null</span>) {
                            config.files[item.key] = item.val;
                        } <span class="hljs-keyword">else</span> {
                            config.data[item.key] = item.val;
                        }
                    }
                    setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                        <span class="hljs-keyword">if</span> (!hasFlash()) {
                            <span class="hljs-keyword">throw</span> <span class="hljs-string">'Adode Flash Player need to be installed. To check ahead use "FileAPI.hasFlash"'</span>;
                        }
                        xhr.__fileApiXHR = FileAPI.upload(config);
                    }, <span class="hljs-number">1</span>);
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.__origError) {
                        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">this</span>.__origError;
                    }
                    orig.apply(xhr, <span class="hljs-built_in">arguments</span>);
                }
            }
        });
        <span class="hljs-built_in">window</span>.XMLHttpRequest.__isFileAPIShim = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">var</span> addFlash = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">elem</span>) </span>{
            <span class="hljs-keyword">if</span> (!hasFlash()) {
                <span class="hljs-keyword">throw</span> <span class="hljs-string">'Adode Flash Player need to be installed. To check ahead use "FileAPI.hasFlash"'</span>;
            }
            <span class="hljs-keyword">var</span> el = angular.element(elem);
            <span class="hljs-keyword">if</span> (!el.attr(<span class="hljs-string">'disabled'</span>)) {
                <span class="hljs-keyword">var</span> hasFileSelect = <span class="hljs-literal">false</span>;
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; el[<span class="hljs-number">0</span>].attributes.length; i++) {
                    <span class="hljs-keyword">var</span> attrib = el[<span class="hljs-number">0</span>].attributes[i];
                    <span class="hljs-keyword">if</span> (attrib.name.indexOf(<span class="hljs-string">'file-select'</span>) !== <span class="hljs-number">-1</span>) {
                        hasFileSelect = <span class="hljs-literal">true</span>;
                        <span class="hljs-keyword">break</span>;
                    }
                }
                <span class="hljs-keyword">if</span> (!el.hasClass(<span class="hljs-string">'js-fileapi-wrapper'</span>) &amp;&amp; (hasFileSelect || el.attr(<span class="hljs-string">'__afu_gen__'</span>) != <span class="hljs-literal">null</span>)) {
                    el.addClass(<span class="hljs-string">'js-fileapi-wrapper'</span>);
                    <span class="hljs-keyword">if</span> (el.attr(<span class="hljs-string">'__afu_gen__'</span>) != <span class="hljs-literal">null</span>) {
                        <span class="hljs-keyword">var</span> ref = (el[<span class="hljs-number">0</span>].__refElem__ &amp;&amp; angular.element(el[<span class="hljs-number">0</span>].__refElem__)) || el;
                        <span class="hljs-keyword">while</span> (ref &amp;&amp; !ref.attr(<span class="hljs-string">'__refElem__'</span>)) {
                            ref = angular.element(ref[<span class="hljs-number">0</span>].nextSibling);
                        }
                        ref.bind(<span class="hljs-string">'mouseover'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                            <span class="hljs-keyword">if</span> (el.parent().css(<span class="hljs-string">'position'</span>) === <span class="hljs-string">''</span> || el.parent().css(<span class="hljs-string">'position'</span>) === <span class="hljs-string">'static'</span>) {
                                el.parent().css(<span class="hljs-string">'position'</span>, <span class="hljs-string">'relative'</span>);
                            }
                            el.css(<span class="hljs-string">'position'</span>, <span class="hljs-string">'absolute'</span>).css(<span class="hljs-string">'top'</span>, ref[<span class="hljs-number">0</span>].offsetTop + <span class="hljs-string">'px'</span>).css(<span class="hljs-string">'left'</span>, ref[<span class="hljs-number">0</span>].offsetLeft + <span class="hljs-string">'px'</span>)
                                .css(<span class="hljs-string">'width'</span>, ref[<span class="hljs-number">0</span>].offsetWidth + <span class="hljs-string">'px'</span>).css(<span class="hljs-string">'height'</span>, ref[<span class="hljs-number">0</span>].offsetHeight + <span class="hljs-string">'px'</span>)
                                .css(<span class="hljs-string">'padding'</span>, ref.css(<span class="hljs-string">'padding'</span>)).css(<span class="hljs-string">'margin'</span>, ref.css(<span class="hljs-string">'margin'</span>)).css(<span class="hljs-string">'filter'</span>, <span class="hljs-string">'alpha(opacity=0)'</span>);
                            ref.attr(<span class="hljs-string">'onclick'</span>, <span class="hljs-string">''</span>);
                            el.css(<span class="hljs-string">'z-index'</span>, <span class="hljs-string">'1000'</span>);
                        });
                    }
                }
            }
        };
        <span class="hljs-keyword">var</span> changeFnWrapper = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">fn</span>) </span>{
            <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">evt</span>) </span>{
                <span class="hljs-keyword">var</span> files = FileAPI.getFiles(evt);
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; files.length; i++) {
                    <span class="hljs-keyword">if</span> (files[i].size === <span class="hljs-literal">undefined</span>) files[i].size = <span class="hljs-number">0</span>;
                    <span class="hljs-keyword">if</span> (files[i].name === <span class="hljs-literal">undefined</span>) files[i].name = <span class="hljs-string">'file'</span>;
                    <span class="hljs-keyword">if</span> (files[i].type === <span class="hljs-literal">undefined</span>) files[i].type = <span class="hljs-string">'undefined'</span>;
                }
                <span class="hljs-keyword">if</span> (!evt.target) {
                    evt.target = {};
                }
                evt.target.files = files;
                <span class="hljs-keyword">if</span> (evt.target.files != files) {
                    evt.__files_ = files;
                }
                (evt.__files_ || evt.target.files).item = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">i</span>) </span>{
                    <span class="hljs-keyword">return</span> (evt.__files_ || evt.target.files)[i] || <span class="hljs-literal">null</span>;
                }
                <span class="hljs-keyword">if</span> (fn) fn.apply(<span class="hljs-keyword">this</span>, [evt]);
            };
        };
        <span class="hljs-keyword">var</span> isFileChange = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">elem, e</span>) </span>{
            <span class="hljs-keyword">return</span> (e.toLowerCase() === <span class="hljs-string">'change'</span> || e.toLowerCase() === <span class="hljs-string">'onchange'</span>) &amp;&amp; elem.getAttribute(<span class="hljs-string">'type'</span>) == <span class="hljs-string">'file'</span>;
        }
        <span class="hljs-keyword">if</span> (HTMLInputElement.prototype.addEventListener) {
            HTMLInputElement.prototype.addEventListener = (<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">origAddEventListener</span>) </span>{
                <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e, fn, b, d</span>) </span>{
                    <span class="hljs-keyword">if</span> (isFileChange(<span class="hljs-keyword">this</span>, e)) {
                        addFlash(<span class="hljs-keyword">this</span>);
                        origAddEventListener.apply(<span class="hljs-keyword">this</span>, [e, changeFnWrapper(fn), b, d]);
                    } <span class="hljs-keyword">else</span> {
                        origAddEventListener.apply(<span class="hljs-keyword">this</span>, [e, fn, b, d]);
                    }
                }
            })(HTMLInputElement.prototype.addEventListener);
        }
        <span class="hljs-keyword">if</span> (HTMLInputElement.prototype.attachEvent) {
            HTMLInputElement.prototype.attachEvent = (<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">origAttachEvent</span>) </span>{
                <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e, fn</span>) </span>{
                    <span class="hljs-keyword">if</span> (isFileChange(<span class="hljs-keyword">this</span>, e)) {
                        addFlash(<span class="hljs-keyword">this</span>);
                        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">window</span>.jQuery) {
                            angular.element(<span class="hljs-keyword">this</span>).bind(<span class="hljs-string">'change'</span>, changeFnWrapper(<span class="hljs-literal">null</span>));
                        } <span class="hljs-keyword">else</span> {
                            origAttachEvent.apply(<span class="hljs-keyword">this</span>, [e, changeFnWrapper(fn)]);
                        }
                    } <span class="hljs-keyword">else</span> {
                        origAttachEvent.apply(<span class="hljs-keyword">this</span>, [e, fn]);
                    }
                }
            })(HTMLInputElement.prototype.attachEvent);
        }
        <span class="hljs-built_in">window</span>.FormData = FormData = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">return</span> {
                <span class="hljs-attr">append</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">key, val, name</span>) </span>{
                    <span class="hljs-keyword">if</span> (val.__isFileAPIBlobShim) {
                        val = val.data[<span class="hljs-number">0</span>];
                    }
                    <span class="hljs-keyword">this</span>.data.push({
                        <span class="hljs-attr">key</span>: key,
                        <span class="hljs-attr">val</span>: val,
                        <span class="hljs-attr">name</span>: name
                    });
                },
                <span class="hljs-attr">data</span>: [],
                <span class="hljs-attr">__isFileAPIShim</span>: <span class="hljs-literal">true</span>
            };
        };
        <span class="hljs-built_in">window</span>.Blob = Blob = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">b</span>) </span>{
            <span class="hljs-keyword">return</span> {
                <span class="hljs-attr">data</span>: b,
                <span class="hljs-attr">__isFileAPIBlobShim</span>: <span class="hljs-literal">true</span>
            };
        };
        (<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">window</span>.FileAPI) {
                <span class="hljs-built_in">window</span>.FileAPI = {};
            }
            <span class="hljs-keyword">if</span> (FileAPI.forceLoad) {
                FileAPI.html5 = <span class="hljs-literal">false</span>;
            }
            <span class="hljs-keyword">if</span> (!FileAPI.upload) {
                <span class="hljs-keyword">var</span> jsUrl, basePath, script = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'script'</span>),
                    allScripts = <span class="hljs-built_in">document</span>.getElementsByTagName(<span class="hljs-string">'script'</span>),
                    i, index, src;
                <span class="hljs-keyword">if</span> (<span class="hljs-built_in">window</span>.FileAPI.jsUrl) {
                    jsUrl = <span class="hljs-built_in">window</span>.FileAPI.jsUrl;
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-built_in">window</span>.FileAPI.jsPath) {
                    basePath = <span class="hljs-built_in">window</span>.FileAPI.jsPath;
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; allScripts.length; i++) {
                        src = allScripts[i].src;
                        index = src.search(<span class="hljs-regexp">/\/angular\-file\-upload[\-a-zA-z0-9\.]*\.js/</span>)
                        <span class="hljs-keyword">if</span> (index &gt; <span class="hljs-number">-1</span>) {
                            basePath = src.substring(<span class="hljs-number">0</span>, index + <span class="hljs-number">1</span>);
                            <span class="hljs-keyword">break</span>;
                        }
                    }
                }
                <span class="hljs-keyword">if</span> (FileAPI.staticPath == <span class="hljs-literal">null</span>) FileAPI.staticPath = basePath;
                script.setAttribute(<span class="hljs-string">'src'</span>, jsUrl || basePath + <span class="hljs-string">'FileAPI.min.js'</span>);
                <span class="hljs-built_in">document</span>.getElementsByTagName(<span class="hljs-string">'head'</span>)[<span class="hljs-number">0</span>].appendChild(script);
                FileAPI.hasFlash = hasFlash();
            }
        })();
        FileAPI.disableFileInput = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">elem, disable</span>) </span>{
            <span class="hljs-keyword">if</span> (disable) {
                elem.removeClass(<span class="hljs-string">'js-fileapi-wrapper'</span>)
            } <span class="hljs-keyword">else</span> {
                elem.addClass(<span class="hljs-string">'js-fileapi-wrapper'</span>);
            }
        }
    }
    <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">window</span>.FileReader) {
        <span class="hljs-built_in">window</span>.FileReader = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">var</span> _this = <span class="hljs-keyword">this</span>,
                loadStarted = <span class="hljs-literal">false</span>;
            <span class="hljs-keyword">this</span>.listeners = {};
            <span class="hljs-keyword">this</span>.addEventListener = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">type, fn</span>) </span>{
                _this.listeners[type] = _this.listeners[type] || [];
                _this.listeners[type].push(fn);
            };
            <span class="hljs-keyword">this</span>.removeEventListener = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">type, fn</span>) </span>{
                _this.listeners[type] &amp;&amp; _this.listeners[type].splice(_this.listeners[type].indexOf(fn), <span class="hljs-number">1</span>);
            };
            <span class="hljs-keyword">this</span>.dispatchEvent = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">evt</span>) </span>{
                <span class="hljs-keyword">var</span> list = _this.listeners[evt.type];
                <span class="hljs-keyword">if</span> (list) {
                    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; list.length; i++) {
                        list[i].call(_this, evt);
                    }
                }
            };
            <span class="hljs-keyword">this</span>.onabort = <span class="hljs-keyword">this</span>.onerror = <span class="hljs-keyword">this</span>.onload = <span class="hljs-keyword">this</span>.onloadstart = <span class="hljs-keyword">this</span>.onloadend = <span class="hljs-keyword">this</span>.onprogress = <span class="hljs-literal">null</span>;
            <span class="hljs-keyword">var</span> constructEvent = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">type, evt</span>) </span>{
                <span class="hljs-keyword">var</span> e = {
                    <span class="hljs-attr">type</span>: type,
                    <span class="hljs-attr">target</span>: _this,
                    <span class="hljs-attr">loaded</span>: evt.loaded,
                    <span class="hljs-attr">total</span>: evt.total,
                    <span class="hljs-attr">error</span>: evt.error
                };
                <span class="hljs-keyword">if</span> (evt.result != <span class="hljs-literal">null</span>) e.target.result = evt.result;
                <span class="hljs-keyword">return</span> e;
            };
            <span class="hljs-keyword">var</span> listener = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">evt</span>) </span>{
                <span class="hljs-keyword">if</span> (!loadStarted) {
                    loadStarted = <span class="hljs-literal">true</span>;
                    _this.onloadstart &amp;&amp; _this.onloadstart(constructEvent(<span class="hljs-string">'loadstart'</span>, evt));
                }
                <span class="hljs-keyword">if</span> (evt.type === <span class="hljs-string">'load'</span>) {
                    _this.onloadend &amp;&amp; _this.onloadend(constructEvent(<span class="hljs-string">'loadend'</span>, evt));
                    <span class="hljs-keyword">var</span> e = constructEvent(<span class="hljs-string">'load'</span>, evt);
                    _this.onload &amp;&amp; _this.onload(e);
                    _this.dispatchEvent(e);
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (evt.type === <span class="hljs-string">'progress'</span>) {
                    <span class="hljs-keyword">var</span> e = constructEvent(<span class="hljs-string">'progress'</span>, evt);
                    _this.onprogress &amp;&amp; _this.onprogress(e);
                    _this.dispatchEvent(e);
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">var</span> e = constructEvent(<span class="hljs-string">'error'</span>, evt);
                    _this.onerror &amp;&amp; _this.onerror(e);
                    _this.dispatchEvent(e);
                }
            };
            <span class="hljs-keyword">this</span>.readAsArrayBuffer = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">file</span>) </span>{
                FileAPI.readAsBinaryString(file, listener);
            }
            <span class="hljs-keyword">this</span>.readAsBinaryString = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">file</span>) </span>{
                FileAPI.readAsBinaryString(file, listener);
            }
            <span class="hljs-keyword">this</span>.readAsDataURL = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">file</span>) </span>{
                FileAPI.readAsDataURL(file, listener);
            }
            <span class="hljs-keyword">this</span>.readAsText = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">file</span>) </span>{
                FileAPI.readAsText(file, listener);
            }
        }
    }
})();;
<span class="hljs-comment">/*! RESOURCE: /scripts/angularjs-1.4/sn/common/attachments/_module.js */</span>
angular.module(<span class="hljs-string">'sn.common.attachments'</span>, [
    <span class="hljs-string">'angularFileUpload'</span>,
    <span class="hljs-string">'sn.common.util'</span>
]);;
<span class="hljs-comment">/*! RESOURCE: /scripts/angularjs-1.4/sn/common/attachments/factory.nowAttachmentHandler.js */</span>
angular.module(<span class="hljs-string">"sn.common.attachments"</span>).factory(<span class="hljs-string">"nowAttachmentHandler"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$http, nowServer, $upload, $rootScope, $timeout,
    snNotification</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">setAttachments, appendError</span>) </span>{
        <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;
        self.cardUploading = <span class="hljs-string">''</span>;
        self.setAttachments = setAttachments;
        self.appendError = appendError;
        self.ADDED = <span class="hljs-string">'added'</span>;
        self.DELETED = <span class="hljs-string">'deleted'</span>;
        self.RENAMED = <span class="hljs-string">'renamed'</span>;
        self.getAttachmentList = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">action</span>) </span>{
            <span class="hljs-keyword">var</span> url = nowServer.getURL(<span class="hljs-string">'ngk_attachments'</span>, {
                <span class="hljs-attr">action</span>: <span class="hljs-string">'list'</span>,
                <span class="hljs-attr">sys_id</span>: self.tableId,
                <span class="hljs-attr">table</span>: self.tableName
            });
            $http.get(url).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>) </span>{
                <span class="hljs-keyword">var</span> attachments = response.data.files || [];
                self.setAttachments(attachments, action);
                <span class="hljs-keyword">if</span> (self.startedUploadingTimeout || self.errorTimeout) {
                    self.stopAllUploading();
                    $rootScope.$broadcast(<span class="hljs-string">'board.uploading.end'</span>);
                }
            });
        };
        self.stopAllUploading = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
            $timeout.cancel(self.errorTimeout);
            $timeout.cancel(self.startedUploadingTimeout);
            hideProgressBar();
            $rootScope.$broadcast(<span class="hljs-string">"attachment.upload.stop"</span>);
        };
        self.onFileSelect = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$files</span>) </span>{
            <span class="hljs-keyword">if</span> (!$files.length)
                <span class="hljs-keyword">return</span>;
            <span class="hljs-keyword">var</span> url = nowServer.getURL(<span class="hljs-string">'ngk_attachments'</span>, {
                <span class="hljs-attr">sys_id</span>: self.tableId,
                <span class="hljs-attr">table</span>: self.tableName,
                <span class="hljs-attr">action</span>: <span class="hljs-string">'add'</span>
            });
            self.cardUploading = self.tableId;
            self.maxfiles = $files.length;
            self.fileCount = <span class="hljs-number">1</span>;
            self.filesUploaded = self.maxfiles;
            self.startedUploadingTimeout = $timeout(showUploaderDialog, <span class="hljs-number">1500</span>);
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; self.maxfiles; i++) {
                <span class="hljs-keyword">if</span> (<span class="hljs-built_in">parseInt</span>($files[i].size) &gt; <span class="hljs-built_in">parseInt</span>(self.fileUploadSizeLimit)) {
                    self.stopAllUploading();
                    $rootScope.$broadcast(<span class="hljs-string">'dialog.upload_too_large.show'</span>);
                    <span class="hljs-keyword">return</span>;
                }
            }
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; self.maxfiles; i++) {
                $rootScope.$broadcast(<span class="hljs-string">"attachment.upload.start"</span>);
                <span class="hljs-keyword">var</span> file = $files[i];
                self.filesUploaded--;
                self.upload = $upload.upload({
                    <span class="hljs-attr">url</span>: url,
                    <span class="hljs-attr">fields</span>: {
                        <span class="hljs-attr">attachments_modified</span>: <span class="hljs-string">'true'</span>,
                        <span class="hljs-attr">sysparm_table</span>: self.tableName,
                        <span class="hljs-attr">sysparm_sys_id</span>: self.tableId,
                        <span class="hljs-attr">sysparm_nostack</span>: <span class="hljs-string">'yes'</span>,
                        <span class="hljs-attr">sysparm_encryption_context</span>: <span class="hljs-string">''</span>,
                        <span class="hljs-attr">sysparm_ck</span>: <span class="hljs-built_in">window</span>.g_ck
                    },
                    <span class="hljs-attr">fileFormDataName</span>: <span class="hljs-string">'attachFile'</span>,
                    <span class="hljs-attr">file</span>: file
                }).progress(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">evt</span>) </span>{
                    <span class="hljs-keyword">var</span> percent = <span class="hljs-built_in">parseInt</span>(<span class="hljs-number">100.0</span> * evt.loaded / evt.total, <span class="hljs-number">10</span>);
                    updateProgress(percent);
                }).success(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">data, status, headers, config</span>) </span>{
                    processError(data);
                    self.stopAllUploading();
                    self.getAttachmentList(self.ADDED);
                    <span class="hljs-keyword">if</span> (self.filesUploaded &lt;= <span class="hljs-number">0</span>) {
                        self.cardUploading = <span class="hljs-string">''</span>;
                    }
                });
            }
        };
        self.downloadAttachment = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">attachment</span>) </span>{
            <span class="hljs-built_in">window</span>.location.href = <span class="hljs-string">'/sys_attachment.do?sys_id='</span> + attachment.sys_id;
        };
        self.viewAttachment = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$event, attachment</span>) </span>{
            <span class="hljs-keyword">var</span> url = <span class="hljs-built_in">window</span>.location.protocol + <span class="hljs-string">'//'</span> + <span class="hljs-built_in">window</span>.location.host;
            url += <span class="hljs-string">'/sys_attachment.do?sysparm_referring_url=tear_off&amp;view=true&amp;sys_id='</span> + attachment.sys_id;
            <span class="hljs-built_in">window</span>.open(url, attachment.sys_id,
                <span class="hljs-string">"toolbar=no,menubar=no,personalbar=no,width=800,height=600,scrollbars=yes,resizable=yes"</span>);
        };
        self.editAttachment = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$event, attachment</span>) </span>{
            <span class="hljs-keyword">var</span> parent = $($event.currentTarget).closest(<span class="hljs-string">'.file-attachment'</span>);
            <span class="hljs-keyword">var</span> thumbnail = parent.find(<span class="hljs-string">'.thumbnail'</span>);
            <span class="hljs-keyword">var</span> input = parent.find(<span class="hljs-string">'input'</span>);
            <span class="hljs-keyword">var</span> tools = parent.find(<span class="hljs-string">'.tools'</span>);
            <span class="hljs-keyword">var</span> fileName = attachment.file_name;
            <span class="hljs-keyword">if</span> (attachment.file_name.indexOf(<span class="hljs-string">'.'</span>) !== <span class="hljs-number">-1</span>) {
                attachment.ext = fileName.match(<span class="hljs-regexp">/(\.[^\.]+)$/i</span>)[<span class="hljs-number">0</span>];
                fileName = attachment.file_name.replace(<span class="hljs-regexp">/(\.[^\.]+)$/i</span>, <span class="hljs-string">''</span>);
            }
            input.val(fileName);
            <span class="hljs-keyword">var</span> w = input.prev().width();
            input.width(w);
            input.prev().hide();
            input.css(<span class="hljs-string">'display'</span>, <span class="hljs-string">'block'</span>);
            thumbnail.addClass(<span class="hljs-string">'state-locked'</span>);
            tools.find(<span class="hljs-string">'.delete-edit'</span>).hide();
            tools.find(<span class="hljs-string">'.rename-cancel'</span>).css(<span class="hljs-string">'display'</span>, <span class="hljs-string">'inline-block'</span>);
            input.focus();
        }
        self.onKeyDown = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$event, attachment</span>) </span>{
            <span class="hljs-keyword">var</span> keyCode = $event.keyCode;
            <span class="hljs-keyword">if</span> (keyCode === <span class="hljs-number">13</span>) {
                $event.stopPropagation();
                $event.preventDefault();
                self.updateAttachment($event, attachment);
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (keyCode === <span class="hljs-number">27</span>) {
                $event.stopPropagation();
                self.updateAttachment($event);
            }
        };
        self.updateAttachment = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$event, attachment</span>) </span>{
            <span class="hljs-keyword">var</span> el = $($event.currentTarget);
            <span class="hljs-keyword">var</span> parent = el.closest(<span class="hljs-string">'.file-attachment'</span>);
            <span class="hljs-keyword">var</span> thumbnail = parent.find(<span class="hljs-string">'.thumbnail'</span>);
            <span class="hljs-keyword">var</span> input = parent.find(<span class="hljs-string">'input'</span>);
            <span class="hljs-keyword">var</span> link = parent.find(<span class="hljs-string">'a'</span>);
            <span class="hljs-keyword">var</span> tools = parent.find(<span class="hljs-string">'.tools'</span>);
            <span class="hljs-keyword">if</span> (attachment) {
                <span class="hljs-keyword">var</span> fileName = input.val();
                <span class="hljs-keyword">if</span> (fileName.length) {
                    fileName += attachment.ext;
                    <span class="hljs-keyword">if</span> (fileName !== attachment.file_name) {
                        link.text(fileName);
                        self.renameAttachment(attachment, fileName);
                    }
                }
            }
            input.hide();
            input.prev().show();
            tools.find(<span class="hljs-string">'.rename-cancel'</span>).hide();
            thumbnail.removeClass(<span class="hljs-string">'state-locked'</span>);
            tools.find(<span class="hljs-string">'.delete-edit'</span>).css(<span class="hljs-string">'display'</span>, <span class="hljs-string">'inline-block'</span>);
        };
        self.dismissMsg = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$event, $index, errorMessages</span>) </span>{
            <span class="hljs-keyword">var</span> msg = $($event.currentTarget);
            msg.addClass(<span class="hljs-string">'remove'</span>);
            setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                msg.remove();
                errorMessages.splice($index, <span class="hljs-number">1</span>);
            }, <span class="hljs-number">500</span>);
        };
        $rootScope.$on(<span class="hljs-string">"dialog.comment_form.close"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
            hideProgressBar();
        });
        self.openSelector = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$event</span>) </span>{
            $event.stopPropagation();
            <span class="hljs-keyword">var</span> target = $($event.currentTarget);
            <span class="hljs-keyword">var</span> input = target.parent().find(<span class="hljs-string">'input[type=file]'</span>);
            input.click();
        }
        self.deleteAttachment = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">attachment</span>) </span>{
            <span class="hljs-keyword">if</span> (attachment &amp;&amp; attachment.sys_id) {
                $(<span class="hljs-string">'#'</span> + attachment.sys_id).hide();
                <span class="hljs-keyword">var</span> url = nowServer.getURL(<span class="hljs-string">'ngk_attachments'</span>, {
                    <span class="hljs-attr">action</span>: <span class="hljs-string">'delete'</span>,
                    <span class="hljs-attr">sys_id</span>: attachment.sys_id
                });
                $http.get(url).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>) </span>{
                    processError(response.data);
                    self.getAttachmentList(self.DELETED);
                });
            }
        };
        self.renameAttachment = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">attachment, newName</span>) </span>{
            $http({
                <span class="hljs-attr">url</span>: nowServer.getURL(<span class="hljs-string">'ngk_attachments'</span>),
                <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>,
                <span class="hljs-attr">params</span>: {
                    <span class="hljs-attr">action</span>: <span class="hljs-string">'rename'</span>,
                    <span class="hljs-attr">sys_id</span>: attachment.sys_id,
                    <span class="hljs-attr">new_name</span>: newName
                }
            }).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>) </span>{
                processError(response.data);
                self.getAttachmentList(self.RENAMED);
            });
        };

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">showUploaderDialog</span>(<span class="hljs-params"></span>) </span>{
            $rootScope.$broadcast(<span class="hljs-string">'board.uploading.start'</span>, self.tableId);
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">updateProgress</span>(<span class="hljs-params">percent</span>) </span>{
            <span class="hljs-keyword">if</span> (self.prevPercent === percent &amp;&amp; self.fileCount &lt;= self.maxfiles)
                <span class="hljs-keyword">return</span>;
            <span class="hljs-keyword">if</span> (self.fileCount &lt;= self.maxfiles) {
                <span class="hljs-keyword">if</span> (percent &gt; <span class="hljs-number">99</span>)
                    self.fileCount++;
                <span class="hljs-keyword">if</span> (self.fileCount &lt;= self.maxfiles) {
                    $timeout.cancel(self.errorTimeout);
                    self.errorTimeout = $timeout(broadcastError, <span class="hljs-number">15000</span>);
                    $(<span class="hljs-string">'.progress-label'</span>).text(<span class="hljs-string">'Uploading file '</span> + self.fileCount + <span class="hljs-string">' of '</span> + self.maxfiles);
                    $(<span class="hljs-string">'.upload-progress'</span>).val(percent);
                    $(<span class="hljs-string">'.progress-wrapper'</span>).show();
                }
            }
            self.prevPercent = percent;
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">hideProgressBar</span>(<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">try</span> {
                $(<span class="hljs-string">'.progress-wrapper'</span>).hide();
            } <span class="hljs-keyword">catch</span> (e) {}
        }
        self.setParams = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">tableName, tableId, fileUploadSizeLimit</span>) </span>{
            self.tableName = tableName;
            self.tableId = tableId;
            self.fileUploadSizeLimit = fileUploadSizeLimit;
        };

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">broadcastError</span>(<span class="hljs-params"></span>) </span>{
            $rootScope.$broadcast(<span class="hljs-string">'board.uploading.end'</span>);
            snNotification.show(<span class="hljs-string">'error'</span>, <span class="hljs-string">'An error occured when trying to upload your file. Please try again.'</span>);
            self.stopAllUploading();
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">processError</span>(<span class="hljs-params">data</span>) </span>{
            <span class="hljs-keyword">if</span> (!data.error)
                <span class="hljs-keyword">return</span>;
            <span class="hljs-keyword">var</span> fileName = data.fileName || data.file_name;
            self.appendError({
                <span class="hljs-attr">msg</span>: data.error + <span class="hljs-string">' : '</span>,
                <span class="hljs-attr">fileName</span>: <span class="hljs-string">'"'</span> + fileName + <span class="hljs-string">'"'</span>
            });
        }
    };
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/angularjs-1.4/sn/common/attachments/directive.nowAttachmentsList.js */</span>
angular.module(<span class="hljs-string">'sn.common.attachments'</span>).directive(<span class="hljs-string">'nowAttachmentsList'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">getTemplateUrl</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
        <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">templateUrl</span>: getTemplateUrl(<span class="hljs-string">"attachments_list.xml"</span>),
        <span class="hljs-attr">link</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">scope, elem, attrs, $parse</span>) </span>{
            scope.icons = {
                <span class="hljs-attr">preview</span>: attrs.previewIcon,
                <span class="hljs-attr">edit</span>: attrs.editIcon,
                <span class="hljs-attr">delete</span>: attrs.deleteIcon,
                <span class="hljs-attr">ok</span>: attrs.okIcon,
                <span class="hljs-attr">cancel</span>: attrs.cancelIcon
            };
            scope.listClass = <span class="hljs-string">"list-group"</span>;
            <span class="hljs-keyword">var</span> inline = scope.$<span class="hljs-built_in">eval</span>(attrs.inline);
            <span class="hljs-keyword">if</span> (inline)
                scope.listClass = <span class="hljs-string">"list-inline"</span>;
            scope.entryTemplate = getTemplateUrl(attrs.template || <span class="hljs-string">"attachment"</span>);
        }
    };
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/angularjs-1.4/sn/common/attachments/factory.snAttachmentHandler.js */</span>
angular.module(<span class="hljs-string">'sn.common.attachments'</span>).factory(<span class="hljs-string">'snAttachmentHandler'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">urlTools, $http, $upload, $window, $q</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">getViewUrl</span>: getViewUrl,
        <span class="hljs-attr">create</span>: createAttachmentHandler,
        <span class="hljs-attr">deleteAttachment</span>: deleteAttachmentBySysID,
        <span class="hljs-attr">renameAttachment</span>: renameAttachmentBySysID
    };

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getViewUrl</span>(<span class="hljs-params">sysId</span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">'/sys_attachment.do?sys_id='</span> + sysId;
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">deleteAttachmentBySysID</span>(<span class="hljs-params">sysID</span>) </span>{
        <span class="hljs-keyword">var</span> url = urlTools.getURL(<span class="hljs-string">'ngk_attachments'</span>, {
            <span class="hljs-attr">action</span>: <span class="hljs-string">'delete'</span>,
            <span class="hljs-attr">sys_id</span>: sysID
        });
        <span class="hljs-keyword">return</span> $http.get(url);
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">renameAttachmentBySysID</span>(<span class="hljs-params">sysID, newName</span>) </span>{
        <span class="hljs-keyword">var</span> url = urlTools.getURL(<span class="hljs-string">'ngk_attachments'</span>, {
            <span class="hljs-attr">action</span>: <span class="hljs-string">'rename'</span>,
            <span class="hljs-attr">sys_id</span>: sysID,
            <span class="hljs-attr">new_name</span>: newName
        });
        <span class="hljs-keyword">return</span> $http.post(url);
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createAttachmentHandler</span>(<span class="hljs-params">tableName, sysID, options</span>) </span>{
        <span class="hljs-keyword">var</span> _tableName = tableName;
        <span class="hljs-keyword">var</span> _sysID = sysID;
        <span class="hljs-keyword">var</span> _files = [];

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getTableName</span>(<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">return</span> _tableName;
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getSysID</span>(<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">return</span> _sysID;
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getAttachments</span>(<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">var</span> url = urlTools.getURL(<span class="hljs-string">'ngk_attachments'</span>, {
                <span class="hljs-attr">action</span>: <span class="hljs-string">'list'</span>,
                <span class="hljs-attr">sys_id</span>: _sysID,
                <span class="hljs-attr">table</span>: _tableName
            });
            <span class="hljs-keyword">return</span> $http.get(url).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>) </span>{
                <span class="hljs-keyword">var</span> files = response.data.files;
                <span class="hljs-keyword">if</span> (_files.length == <span class="hljs-number">0</span>) {
                    files.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">file</span>) </span>{
                        <span class="hljs-keyword">if</span> (file &amp;&amp; file.sys_id) {
                            _transformFileResponse(file);
                            _files.push(file);
                        }
                    })
                } <span class="hljs-keyword">else</span> {
                    _files = files;
                }
                <span class="hljs-keyword">return</span> _files;
            });
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addAttachment</span>(<span class="hljs-params">attachment</span>) </span>{
            _files.unshift(attachment);
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">deleteAttachment</span>(<span class="hljs-params">attachment</span>) </span>{
            <span class="hljs-keyword">var</span> index = _files.indexOf(attachment);
            <span class="hljs-keyword">if</span> (index !== <span class="hljs-number">-1</span>) {
                <span class="hljs-keyword">return</span> deleteAttachmentBySysID(attachment.sys_id).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    _files.splice(index, <span class="hljs-number">1</span>);
                });
            }
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">uploadAttachments</span>(<span class="hljs-params">files, uploadFields</span>) </span>{
            <span class="hljs-keyword">var</span> defer = $q.defer();
            <span class="hljs-keyword">var</span> promises = [];
            <span class="hljs-keyword">var</span> fileData = [];
            angular.forEach(files, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">file</span>) </span>{
                promises.push(uploadAttachment(file, uploadFields).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>) </span>{
                    fileData.push(response);
                }));
            });
            $q.all(promises).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                defer.resolve(fileData);
            });
            <span class="hljs-keyword">return</span> defer.promise;
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">uploadAttachment</span>(<span class="hljs-params">file, uploadFields, uploadMethods</span>) </span>{
            <span class="hljs-keyword">var</span> url = urlTools.getURL(<span class="hljs-string">'ngk_attachments'</span>, {
                <span class="hljs-attr">action</span>: <span class="hljs-string">'add'</span>,
                <span class="hljs-attr">sys_id</span>: _sysID,
                <span class="hljs-attr">table</span>: _tableName,
                <span class="hljs-attr">load_attachment_record</span>: <span class="hljs-string">'true'</span>
            });
            <span class="hljs-keyword">var</span> fields = {
                <span class="hljs-attr">attachments_modified</span>: <span class="hljs-string">'true'</span>,
                <span class="hljs-attr">sysparm_table</span>: _tableName,
                <span class="hljs-attr">sysparm_sys_id</span>: _sysID,
                <span class="hljs-attr">sysparm_nostack</span>: <span class="hljs-string">'yes'</span>,
                <span class="hljs-attr">sysparm_encryption_context</span>: <span class="hljs-string">''</span>
            };
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> $<span class="hljs-built_in">window</span>.g_ck !== <span class="hljs-string">'undefined'</span>) {
                fields[<span class="hljs-string">'sysparm_ck'</span>] = $<span class="hljs-built_in">window</span>.g_ck;
            }
            <span class="hljs-keyword">if</span> (uploadFields) {
                angular.extend(fields, uploadFields);
            }
            <span class="hljs-keyword">var</span> upload = $upload.upload({
                <span class="hljs-attr">url</span>: url,
                <span class="hljs-attr">fields</span>: fields,
                <span class="hljs-attr">fileFormDataName</span>: <span class="hljs-string">'attachFile'</span>,
                <span class="hljs-attr">file</span>: file
            });
            <span class="hljs-keyword">if</span> (uploadMethods !== <span class="hljs-literal">undefined</span>) {
                <span class="hljs-keyword">if</span> (uploadMethods.hasOwnProperty(<span class="hljs-string">'progress'</span>)) {
                    upload.progress(uploadMethods.progress);
                }
                <span class="hljs-keyword">if</span> (uploadMethods.hasOwnProperty(<span class="hljs-string">'success'</span>)) {
                    upload.success(uploadMethods.success);
                }
                <span class="hljs-keyword">if</span> (uploadMethods.hasOwnProperty(<span class="hljs-string">'error'</span>)) {
                    upload.error(uploadMethods.error);
                }
            }
            <span class="hljs-keyword">return</span> upload.then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>) </span>{
                <span class="hljs-keyword">var</span> sysFile = response.data;
                <span class="hljs-keyword">if</span> (sysFile.error) {
                    <span class="hljs-keyword">return</span> $q.reject(<span class="hljs-string">"Exception when adding attachment: "</span> + sysFile.error);
                }
                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> sysFile === <span class="hljs-string">"object"</span> &amp;&amp; sysFile.hasOwnProperty(<span class="hljs-string">'sys_id'</span>)) {
                    _transformFileResponse(sysFile);
                    addAttachment(sysFile);
                }
                <span class="hljs-keyword">if</span> (options &amp;&amp; options.onUploadComplete) {
                    options.onUploadComplete(sysFile);
                }
                <span class="hljs-keyword">return</span> sysFile;
            });
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_transformFileResponse</span>(<span class="hljs-params">file</span>) </span>{
            file.isImage = <span class="hljs-literal">false</span>;
            file.canPreview = <span class="hljs-literal">false</span>;
            <span class="hljs-keyword">if</span> (file.content_type.indexOf(<span class="hljs-string">'image'</span>) !== <span class="hljs-number">-1</span>) {
                file.isImage = <span class="hljs-literal">true</span>;
                <span class="hljs-keyword">if</span> (!file.thumbSrc) {} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (file.thumbSrc[<span class="hljs-number">0</span>] !== <span class="hljs-string">'/'</span>) {
                    file.thumbSrc = <span class="hljs-string">'/'</span> + file.thumbSrc;
                }
                file.canPreview = file.content_type.indexOf(<span class="hljs-string">'tiff'</span>) === <span class="hljs-number">-1</span>;
            }
            file.viewUrl = getViewUrl(file.sys_id);
        }
        <span class="hljs-keyword">return</span> {
            <span class="hljs-attr">getSysID</span>: getSysID,
            <span class="hljs-attr">getTableName</span>: getTableName,
            <span class="hljs-attr">getAttachments</span>: getAttachments,
            <span class="hljs-attr">addAttachment</span>: addAttachment,
            <span class="hljs-attr">deleteAttachment</span>: deleteAttachment,
            <span class="hljs-attr">uploadAttachment</span>: uploadAttachment,
            <span class="hljs-attr">uploadAttachments</span>: uploadAttachments
        };
    }
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/angularjs-1.4/sn/common/attachments/directive.snFileUploadInput.js */</span>
angular.module(<span class="hljs-string">'sn.common.attachments'</span>).directive(<span class="hljs-string">'snFileUploadInput'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">cabrillo, $document</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
        <span class="hljs-attr">scope</span>: {
            <span class="hljs-attr">attachmentHandler</span>: <span class="hljs-string">'='</span>,
            <span class="hljs-attr">customClassNames</span>: <span class="hljs-string">'@classNames'</span>
        },
        <span class="hljs-attr">template</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">var</span> inputTemplate;
            <span class="hljs-keyword">if</span> (cabrillo.isNative()) {
                inputTemplate = <span class="hljs-string">'&lt;button class="{{classNames}}" ng-click="showAttachOptions($event)" aria-labelledby="attach-label-{{ ::$id }}"&gt;&lt;span class="upload-label" id="attach-label-{{ ::$id }}"&gt;&lt;translate key="Add Attachment" /&gt;&lt;/span&gt;&lt;/button&gt;'</span>;
            } <span class="hljs-keyword">else</span> {
                inputTemplate = <span class="hljs-string">'&lt;button class="{{classNames}}" ng-file-select="onFileSelect($files)" aria-labelledby="attach-label-{{ ::$id }}"&gt;&lt;span class="upload-label" id="attach-label-{{ ::$id }}"&gt;&lt;translate key="Add Attachment" /&gt;&lt;/span&gt;&lt;/button&gt;'</span>;
            }
            <span class="hljs-keyword">return</span> [
                <span class="hljs-string">'&lt;div class="file-upload-input" role="button" aria-labelledby="attach-label-{{ ::$id }}"&gt;'</span>,
                <span class="hljs-string">'&lt;div role="group" class="injected-contents-break-accessibility" aria-hidden="true"&gt;'</span>,
                inputTemplate,
                <span class="hljs-string">'&lt;/div&gt;'</span>,
                <span class="hljs-string">'&lt;/div&gt;'</span>
            ].join(<span class="hljs-string">''</span>);
        },
        <span class="hljs-attr">controller</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$element, $scope</span>) </span>{
            <span class="hljs-keyword">var</span> classNames = <span class="hljs-string">'btn btn-icon attachment-btn icon-paperclip'</span>;
            <span class="hljs-keyword">if</span> ($scope.customClassNames) {
                classNames += <span class="hljs-string">' '</span> + $scope.customClassNames;
            }
            $scope.classNames = classNames;
            $scope.showAttachOptions = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$event</span>) </span>{
                <span class="hljs-keyword">var</span> handler = $scope.attachmentHandler;
                <span class="hljs-keyword">var</span> target = angular.element($event.currentTarget);
                <span class="hljs-keyword">var</span> elRect = target[<span class="hljs-number">0</span>].getBoundingClientRect();
                <span class="hljs-keyword">var</span> body = $<span class="hljs-built_in">document</span>[<span class="hljs-number">0</span>].body;
                <span class="hljs-keyword">var</span> rect = {
                    <span class="hljs-attr">x</span>: elRect.left + body.scrollLeft,
                    <span class="hljs-attr">y</span>: elRect.top + body.scrollTop,
                    <span class="hljs-attr">width</span>: elRect.width,
                    <span class="hljs-attr">height</span>: elRect.height
                };
                <span class="hljs-keyword">var</span> options = {
                    <span class="hljs-attr">sourceRect</span>: rect
                };
                cabrillo.attachments.addFile(
                    handler.getTableName(),
                    handler.getSysID(),
                    <span class="hljs-literal">null</span>,
                    options
                ).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>) </span>{
                    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Attached new file'</span>, data);
                    handler.addAttachment(data);
                }, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Failed to attach new file'</span>);
                });
            };
            $scope.onFileSelect = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$files</span>) </span>{
                $scope.attachmentHandler.uploadAttachments($files);
            };
            $scope.showFileSelector = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$event</span>) </span>{
                $event.stopPropagation();
                <span class="hljs-keyword">var</span> target = angular.element($event.currentTarget);
                <span class="hljs-keyword">var</span> input = target.parent().find(<span class="hljs-string">'input'</span>);
                input.triggerHandler(<span class="hljs-string">'click'</span>);
            };
        }
    }
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/angularjs-1.4/sn/common/attachments/directive.snPasteFileHandler.js */</span>
angular.module(<span class="hljs-string">'sn.common.attachments'</span>).directive(<span class="hljs-string">'snPasteFileHandler'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$parse</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">restrict</span>: <span class="hljs-string">'A'</span>,
        <span class="hljs-attr">link</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">scope, element, attrs</span>) </span>{
            <span class="hljs-keyword">var</span> snPasteFileHandler = $parse(attrs.snPasteFileHandler);
            element.bind(<span class="hljs-string">"paste"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) </span>{
                event = event.originalEvent || event;
                <span class="hljs-keyword">var</span> item = event.clipboardData.items[<span class="hljs-number">0</span>];
                <span class="hljs-keyword">if</span> (!item)
                    <span class="hljs-keyword">return</span>;
                <span class="hljs-keyword">var</span> file = item.getAsFile();
                <span class="hljs-keyword">if</span> (!file)
                    <span class="hljs-keyword">return</span>;
                snPasteFileHandler(scope, {
                    <span class="hljs-attr">file</span>: file
                });
                event.preventDefault();
                event.stopPropagation();
            });
        }
    };
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/angularjs-1.4/sn/common/attachments/directive.snAttachmentList.js */</span>
angular.module(<span class="hljs-string">'sn.common.attachments'</span>).directive(<span class="hljs-string">'snAttachmentList'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">getTemplateUrl, snAttachmentHandler, $rootScope, $window, $timeout, $q</span>) </span>{
<span class="hljs-meta">        'use strict'</span>;
        <span class="hljs-keyword">return</span> {
            <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
            <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">templateUrl</span>: getTemplateUrl(<span class="hljs-string">"sn_attachment_list.xml"</span>),
            <span class="hljs-attr">scope</span>: {
                <span class="hljs-attr">tableName</span>: <span class="hljs-string">"=?"</span>,
                <span class="hljs-attr">sysID</span>: <span class="hljs-string">"=?sysId"</span>,
                <span class="hljs-attr">attachmentList</span>: <span class="hljs-string">"=?"</span>,
                <span class="hljs-attr">uploadFileFn</span>: <span class="hljs-string">"&amp;"</span>,
                <span class="hljs-attr">deleteFileFn</span>: <span class="hljs-string">"=?"</span>,
                <span class="hljs-attr">canEdit</span>: <span class="hljs-string">"=?"</span>,
                <span class="hljs-attr">canRemove</span>: <span class="hljs-string">"=?"</span>,
                <span class="hljs-attr">canAdd</span>: <span class="hljs-string">"=?"</span>,
                <span class="hljs-attr">canDownload</span>: <span class="hljs-string">"=?"</span>,
                <span class="hljs-attr">showHeader</span>: <span class="hljs-string">"=?"</span>,
                <span class="hljs-attr">clickImageFn</span>: <span class="hljs-string">"&amp;?"</span>,
                <span class="hljs-attr">confirmDelete</span>: <span class="hljs-string">"=?"</span>
            },
            <span class="hljs-attr">controller</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$scope</span>) </span>{
                $scope.canEdit = $scope.canEdit || <span class="hljs-literal">false</span>;
                $scope.canDownload = $scope.canDownload || <span class="hljs-literal">false</span>;
                $scope.canRemove = $scope.canRemove || <span class="hljs-literal">false</span>;
                $scope.canAdd = $scope.canAdd || <span class="hljs-literal">false</span>;
                $scope.showHeader = $scope.showHeader || <span class="hljs-literal">false</span>;
                $scope.clickImageFn = $scope.clickImageFn || <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{};
                $scope.confirmDelete = $scope.confirmDelete || <span class="hljs-literal">false</span>;
                $scope.filesInProgress = {};
                $scope.attachmentToDelete = <span class="hljs-literal">null</span>;

                <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">refreshResources</span>(<span class="hljs-params"></span>) </span>{
                    <span class="hljs-keyword">var</span> handler = snAttachmentHandler.create($scope.tableName, $scope.sysID);
                    handler.getAttachments().then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">files</span>) </span>{
                        $scope.attachmentList = files;
                    });
                }
                <span class="hljs-keyword">if</span> (!$scope.attachmentList) {
                    $scope.attachmentList = [];
                    refreshResources();
                }
                $scope.$on(<span class="hljs-string">'attachments_list.update'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e, tableName, sysID</span>) </span>{
                    <span class="hljs-keyword">if</span> (tableName === $scope.tableName &amp;&amp; sysID === $scope.sysID) {
                        refreshResources();
                    }
                });

                <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">removeFromFileProgress</span>(<span class="hljs-params">fileName</span>) </span>{
                    <span class="hljs-keyword">delete</span> $scope.filesInProgress[fileName];
                }

                <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">updateFileProgress</span>(<span class="hljs-params">file</span>) </span>{
                    <span class="hljs-keyword">if</span> (!$scope.filesInProgress[file.name])
                        $scope.filesInProgress[file.name] = file;
                }
                $scope.$on(<span class="hljs-string">'attachments_list.upload.progress'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e, file</span>) </span>{
                    updateFileProgress(file);
                });
                $scope.$on(<span class="hljs-string">'attachments_list.upload.success'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e, file</span>) </span>{
                    removeFromFileProgress(file.name);
                });
                $scope.attachFiles = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">files</span>) </span>{
                    <span class="hljs-keyword">if</span> ($scope.tableName &amp;&amp; $scope.sysID) {
                        <span class="hljs-keyword">var</span> handler = snAttachmentHandler.create($scope.tableName, $scope.sysID);
                        <span class="hljs-keyword">var</span> promises = [];
                        files.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">file</span>) </span>{
                            <span class="hljs-keyword">var</span> promise = handler.uploadAttachment(file, <span class="hljs-literal">null</span>, {
                                <span class="hljs-attr">progress</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
                                    <span class="hljs-keyword">var</span> file = e.config.file;
                                    file.progress = <span class="hljs-number">100.0</span> * event.loaded / event.total;
                                    updateFileProgress(file);
                                },
                                <span class="hljs-attr">success</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>) </span>{
                                    removeFromFileProgress(data.file_name);
                                }
                            });
                            promises.push(promise);
                        });
                        $q.all(promises).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                            refreshResources();
                        });
                    } <span class="hljs-keyword">else</span> {
                        <span class="hljs-keyword">if</span> ($scope.uploadFileFn)
                            $scope.uploadFileFn({
                                <span class="hljs-attr">files</span>: files
                            });
                    }
                };
                $scope.getProgressStyle = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">fileName</span>) </span>{
                    <span class="hljs-keyword">return</span> {
                        <span class="hljs-string">'width'</span>: $scope.filesInProgress[fileName].progress + <span class="hljs-string">'%'</span>
                    };
                };
                $scope.openSelector = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$event</span>) </span>{
                    $event.stopPropagation();
                    <span class="hljs-keyword">var</span> target = angular.element($event.currentTarget);
                    $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                        target.parent().find(<span class="hljs-string">'input'</span>).click();
                    });
                };
                $scope.confirmDeleteAttachment = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">attachment</span>) </span>{
                    $scope.attachmentToDelete = attachment;
                    $scope.$broadcast(<span class="hljs-string">'dialog.confirm-delete.show'</span>);
                };
                $scope.deleteAttachment = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    snAttachmentHandler.deleteAttachment($scope.attachmentToDelete.sys_id).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                        <span class="hljs-keyword">var</span> index = $scope.attachmentList.indexOf($scope.attachmentToDelete);
                        $scope.attachmentList.splice(index, <span class="hljs-number">1</span>);
                    });
                };
            }
        };
    })
    .directive(<span class="hljs-string">'snAttachmentListItem'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">getTemplateUrl, snAttachmentHandler, $rootScope, $window, $timeout, $parse</span>) </span>{
<span class="hljs-meta">        'use strict'</span>;
        <span class="hljs-keyword">return</span> {
            <span class="hljs-attr">restrict</span>: <span class="hljs-string">"E"</span>,
            <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">templateUrl</span>: getTemplateUrl(<span class="hljs-string">"sn_attachment_list_item.xml"</span>),
            <span class="hljs-attr">link</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">scope, element, attrs</span>) </span>{
                <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">translateAttachment</span>(<span class="hljs-params">att</span>) </span>{
                    <span class="hljs-keyword">return</span> {
                        <span class="hljs-attr">content_type</span>: att.content_type,
                        <span class="hljs-attr">file_name</span>: att.file_name,
                        <span class="hljs-attr">image</span>: (att.thumbSrc !== <span class="hljs-literal">undefined</span>),
                        <span class="hljs-attr">size_bytes</span>: att.size,
                        <span class="hljs-attr">sys_created_by</span>: <span class="hljs-string">""</span>,
                        <span class="hljs-attr">sys_created_on</span>: <span class="hljs-string">""</span>,
                        <span class="hljs-attr">sys_id</span>: att.sys_id,
                        <span class="hljs-attr">thumb_src</span>: att.thumbSrc
                    };
                }
                scope.attachment = ($parse(attrs.attachment.size_bytes)) ?
                    scope.$<span class="hljs-built_in">eval</span>(attrs.attachment) :
                    translateAttachment(attrs.attachment);
                <span class="hljs-keyword">var</span> fileNameView = element.find(<span class="hljs-string">'.sn-widget-list-title_view'</span>);
                <span class="hljs-keyword">var</span> fileNameEdit = element.find(<span class="hljs-string">'.sn-widget-list-title_edit'</span>);

                <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">editFileName</span>(<span class="hljs-params"></span>) </span>{
                    fileNameView.hide();
                    fileNameEdit.show();
                    element.find(<span class="hljs-string">'.edit-text-input'</span>).focus();
                }

                <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">viewFileName</span>(<span class="hljs-params"></span>) </span>{
                    fileNameView.show();
                    fileNameEdit.hide();
                }
                viewFileName();
                scope.editModeToggle = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$event</span>) </span>{
                    $event.preventDefault();
                    $event.stopPropagation();
                    scope.editMode = !scope.editMode;
                    <span class="hljs-keyword">if</span> (scope.editMode)
                        editFileName();
                    <span class="hljs-keyword">else</span>
                        viewFileName();
                };
                scope.updateName = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    scope.editMode = <span class="hljs-literal">false</span>;
                    viewFileName();
                    snAttachmentHandler.renameAttachment(scope.attachment.sys_id, scope.attachment.file_name);
                };
            },
            <span class="hljs-attr">controller</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$scope, snCustomEvent</span>) </span>{
                $scope.editMode = <span class="hljs-literal">false</span>;
                $scope.removeAttachment = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">attachment, index</span>) </span>{
                    <span class="hljs-keyword">if</span> ($scope.deleteFileFn !== <span class="hljs-literal">undefined</span> &amp;&amp; $scope.deleteFileFn <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Function</span>) {
                        $scope.deleteFileFn.apply(<span class="hljs-literal">null</span>, <span class="hljs-built_in">arguments</span>);
                        <span class="hljs-keyword">return</span>;
                    }
                    <span class="hljs-keyword">if</span> ($scope.confirmDelete) {
                        $scope.confirmDeleteAttachment($scope.attachment);
                        <span class="hljs-keyword">return</span>;
                    }
                    snAttachmentHandler.deleteAttachment($scope.attachment.sys_id).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                        $scope.attachmentList.splice($scope.$index, <span class="hljs-number">1</span>);
                    });
                };
                <span class="hljs-keyword">var</span> contentTypeMap = {
                    <span class="hljs-string">"application/pdf"</span>: <span class="hljs-string">"icon-document-pdf"</span>,
                    <span class="hljs-string">"text/plain"</span>: <span class="hljs-string">"icon-document-txt"</span>,
                    <span class="hljs-string">"application/zip"</span>: <span class="hljs-string">"icon-document-zip"</span>,
                    <span class="hljs-string">"application/vnd.openxmlformats-officedocument.wordprocessingml.document"</span>: <span class="hljs-string">"icon-document-doc"</span>,
                    <span class="hljs-string">"application/vnd.openxmlformats-officedocument.presentationml.presentation"</span>: <span class="hljs-string">"icon-document-ppt"</span>,
                    <span class="hljs-string">"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"</span>: <span class="hljs-string">"icon-document-xls"</span>,
                    <span class="hljs-string">"application/vnd.ms-powerpoint"</span>: <span class="hljs-string">"icon-document-ppt"</span>
                };
                $scope.getDocumentType = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">contentType</span>) </span>{
                    <span class="hljs-keyword">return</span> contentTypeMap[contentType] || <span class="hljs-string">"icon-document"</span>;
                };
                $scope.handleAttachmentClick = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) </span>{
                    <span class="hljs-keyword">if</span> (event.keyCode === <span class="hljs-number">9</span>)
                        <span class="hljs-keyword">return</span>;
                    <span class="hljs-keyword">if</span> ($scope.editMode)
                        <span class="hljs-keyword">return</span>;
                    <span class="hljs-keyword">if</span> (!$scope.attachment)
                        <span class="hljs-keyword">return</span>;
                    <span class="hljs-keyword">if</span> ($scope.attachment.image)
                        openImageInLightBox(event);
                    <span class="hljs-keyword">else</span>
                        downloadAttachment();
                };

                <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">downloadAttachment</span>(<span class="hljs-params"></span>) </span>{
                    <span class="hljs-keyword">if</span> (!$scope.attachment.sys_id)
                        <span class="hljs-keyword">return</span>;
                    $<span class="hljs-built_in">window</span>.location.href = <span class="hljs-string">'sys_attachment.do?sys_id='</span> + $scope.attachment.sys_id;
                }

                <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">openImageInLightBox</span>(<span class="hljs-params">event</span>) </span>{
                    <span class="hljs-keyword">if</span> (!$scope.attachment.size)
                        $scope.attachment.size = $scope.getSize($scope.attachment.size_bytes, <span class="hljs-number">2</span>);
                    $scope.clickImageFn({
                        <span class="hljs-attr">file</span>: $scope.attachment
                    });
                    snCustomEvent.fire(<span class="hljs-string">'sn.attachment.preview'</span>, event, $scope.attachment);
                }
                $scope.getSize = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">bytes, precision</span>) </span>{
                    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> bytes === <span class="hljs-string">'string'</span> &amp;&amp; bytes.slice(<span class="hljs-number">-1</span>) === <span class="hljs-string">'B'</span>)
                        <span class="hljs-keyword">return</span> bytes;
                    <span class="hljs-keyword">var</span> kb = <span class="hljs-number">1024</span>;
                    <span class="hljs-keyword">var</span> mb = kb * <span class="hljs-number">1024</span>;
                    <span class="hljs-keyword">var</span> gb = mb * <span class="hljs-number">1024</span>;
                    <span class="hljs-keyword">if</span> ((bytes &gt;= <span class="hljs-number">0</span>) &amp;&amp; (bytes &lt; kb))
                        <span class="hljs-keyword">return</span> bytes + <span class="hljs-string">' B'</span>;
                    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((bytes &gt;= kb) &amp;&amp; (bytes &lt; mb))
                        <span class="hljs-keyword">return</span> (bytes / kb).toFixed(precision) + <span class="hljs-string">' KB'</span>;
                    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((bytes &gt;= mb) &amp;&amp; (bytes &lt; gb))
                        <span class="hljs-keyword">return</span> (bytes / mb).toFixed(precision) + <span class="hljs-string">' MB'</span>;
                    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (bytes &gt;= gb)
                        <span class="hljs-keyword">return</span> (bytes / gb).toFixed(precision) + <span class="hljs-string">' GB'</span>;
                    <span class="hljs-keyword">else</span>
                        <span class="hljs-keyword">return</span> bytes + <span class="hljs-string">' B'</span>;
                }
            }
        };
    });;;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/_ng_chat.js */</span>
(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    <span class="hljs-keyword">var</span> dependencies = [
        <span class="hljs-string">'sn.connect.profile'</span>,
        <span class="hljs-string">'sn.connect.presence'</span>,
        <span class="hljs-string">'sn.connect.conversation'</span>,
        <span class="hljs-string">'sn.connect.document'</span>,
        <span class="hljs-string">'sn.connect.queue'</span>,
        <span class="hljs-string">'ng.amb'</span>,
        <span class="hljs-string">'sn.angularstrap'</span>,
        <span class="hljs-string">'mentio'</span>,
        <span class="hljs-string">'sn.dragdrop'</span>
    ];
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">window</span>.concoursePluginInstalled) {
        dependencies.unshift(<span class="hljs-string">'sn.concourse'</span>);
        dependencies.push(<span class="hljs-string">'sn.overviewhelp'</span>);
    }
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">window</span>.notificationPluginInstalled) {
        dependencies.push(<span class="hljs-string">'sn.notification_preference'</span>);
    }
    angular.module(<span class="hljs-string">'sn.connect'</span>, dependencies)
        .run(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">i18n</span>) </span>{
            i18n.preloadMessages();
        });
})();;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/controller.chat.js */</span>
angular.module(<span class="hljs-string">'sn.connect'</span>).controller(<span class="hljs-string">'chat'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">
    $scope, $rootScope, $location, $window, $q, $element, $timeout, conversations, userPreferences, profiles, queues,
    liveProfileID, snTabActivity, snPresence, snConversationAsideHistory, activeConversation, snNotification,
    screenWidth, messageNotifier, snCustomEvent, audioNotifier, connectDropTargetService</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    $scope.dropTargetService = connectDropTargetService;
    snTabActivity.setAppName(<span class="hljs-string">"sn.connect"</span>);
    messageNotifier.registerMessageServiceWatch(shouldSendNotification);
    audioNotifier.registerMessageServiceWatch(activeConversation, shouldSendNotification);

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">shouldSendNotification</span>(<span class="hljs-params">message</span>) </span>{
        <span class="hljs-keyword">if</span> (snTabActivity.isVisible &amp;&amp; activeConversation.sysID !== message.conversationID) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }
        <span class="hljs-keyword">return</span> !snTabActivity.isVisible;
    }
    $scope.activeConversation = activeConversation;
    $scope.isTopWindow = <span class="hljs-literal">true</span>;
    $scope.hasQueues = queues.hasQueues;
    $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        conversations.loaded.then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
            $element.removeClass(<span class="hljs-string">"loading"</span>);
        })
    }, <span class="hljs-number">1000</span>, <span class="hljs-literal">false</span>);
    <span class="hljs-keyword">try</span> {
        $scope.isTopWindow = <span class="hljs-built_in">window</span>.top == <span class="hljs-built_in">window</span>.self;
        <span class="hljs-keyword">if</span> (!$scope.isTopWindow) {
            $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-built_in">window</span>.top.location = <span class="hljs-string">"/$c.do"</span>
            }, <span class="hljs-number">3000</span>)
        }
    } <span class="hljs-keyword">catch</span> (IGNORED) {
        $scope.isTopWindow = <span class="hljs-literal">false</span>;
    }
    $scope.redirectFrame = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-built_in">window</span>.location = <span class="hljs-string">"/home.do"</span>;
    };
    $rootScope.$on(<span class="hljs-string">'http-error.retry'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        location.reload();
    });
    $scope.$on(<span class="hljs-string">"connect.conversation.attachment_errors"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">evt, data</span>) </span>{
        <span class="hljs-keyword">if</span> (!activeConversation.isActive(data.conversation))
            <span class="hljs-keyword">return</span>;
        $scope.attachmentErrors = data.errors;
        angular.forEach(data.errors, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">error</span>) </span>{
            snNotification.show(<span class="hljs-string">"error"</span>, error)
        })
    });
    <span class="hljs-keyword">var</span> loadPromises = [];
    loadPromises.push(conversations.refreshAll());
    <span class="hljs-keyword">var</span> pageLoadPromise = $q.all(loadPromises).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        profiles.getAsync(liveProfileID).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">profile</span>) </span>{
            $scope.currentUser = profile;
            snPresence.init();
        });
        $scope.resourcesWidth = <span class="hljs-number">285</span>;
        $scope.resourcesWidthHelpDesk = <span class="hljs-string">'49%'</span>;
    });
    $scope.$on(<span class="hljs-string">'pane.collapsed'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event, position, collapsed</span>) </span>{
        userPreferences.setPreference(<span class="hljs-string">'collaboration.'</span> + position + <span class="hljs-string">'.collapsed'</span>, collapsed.toString());
    });
    <span class="hljs-keyword">var</span> initialLocationHandled = <span class="hljs-literal">false</span>;
    $scope.$on(<span class="hljs-string">'$locationChangeSuccess'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        pageLoadPromise.then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
            initialLocationHandled = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">var</span> location = activeConversation.location;
            activeConversation.tab = location.tab || activeConversation.tab;
            $rootScope.$broadcast(<span class="hljs-string">"connect.conversation.select"</span>, activeConversation.tab, location.conversationID);
            <span class="hljs-keyword">if</span> (activeConversation.isEmpty)
                $scope.$broadcast(<span class="hljs-string">"sn.aside.close"</span>, <span class="hljs-literal">true</span>);
            <span class="hljs-keyword">else</span>
                $scope.$broadcast(<span class="hljs-string">'connect.pane.close'</span>);
            <span class="hljs-keyword">if</span> (location.profileID) {
                profiles.openConversation(location.profileID);
                changeLocation();
            }
        });
    });
    $scope.$watch(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> activeConversation.sysID;
    }, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">sysID, old</span>) </span>{
        <span class="hljs-keyword">if</span> (sysID === old)
            <span class="hljs-keyword">return</span>;
        <span class="hljs-keyword">if</span> (!initialLocationHandled)
            <span class="hljs-keyword">return</span>;
        changeLocation();
    });

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">changeLocation</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> path = activeConversation.tab;
        <span class="hljs-keyword">if</span> (!activeConversation.isEmpty)
            path += <span class="hljs-string">'/'</span> + activeConversation.sysID;
        $location.path(path);
    }
    $scope.$watch(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> activeConversation.tab;
    }, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">tab, old</span>) </span>{
        <span class="hljs-keyword">if</span> (tab === old)
            <span class="hljs-keyword">return</span>;
        <span class="hljs-keyword">if</span> (!initialLocationHandled)
            <span class="hljs-keyword">return</span>;
        <span class="hljs-keyword">if</span> (!activeConversation.isEmpty)
            <span class="hljs-keyword">return</span>;
        $location.path(activeConversation.tab);
    });
    CustomEvent.observe(<span class="hljs-string">"glide:nav_open_url"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>) </span>{
        $<span class="hljs-built_in">window</span>.open(data.url, <span class="hljs-string">"_blank"</span>);
    });
    CustomEvent.observe(<span class="hljs-string">"connect:open_group"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>) </span>{
        conversations.followDocumentConversation(data).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">conversation</span>) </span>{
            activeConversation.conversation = conversation;
        })
    });
    CustomEvent.observe(<span class="hljs-string">"connect:follow_document"</span>, conversations.followDocumentConversation);
    CustomEvent.observe(<span class="hljs-string">"connect:unfollow_document"</span>, conversations.unfollowDocumentConversation);

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">passAlongAsideEventInfo</span>(<span class="hljs-params">e, view, widthOverride</span>) </span>{
        <span class="hljs-keyword">if</span> (angular.equals(e.targetScope, $scope))
            <span class="hljs-keyword">return</span>;
        $scope.$broadcast(e.name, view, widthOverride);
        <span class="hljs-keyword">if</span> (view &amp;&amp; !view.isChild &amp;&amp; e.name === <span class="hljs-string">"sn.aside.open"</span>) {
            snConversationAsideHistory.saveHistory(activeConversation.sysID, view);
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (e.name === <span class="hljs-string">"sn.aside.close"</span>)
            snConversationAsideHistory.clearHistory(activeConversation.sysID);
    }
    $scope.$on(<span class="hljs-string">"sn.aside.open"</span>, passAlongAsideEventInfo);
    $scope.$on(<span class="hljs-string">"sn.aside.close"</span>, passAlongAsideEventInfo);
    $scope.$on(<span class="hljs-string">"sn.aside.resize"</span>, passAlongAsideEventInfo);
    $scope.$on(<span class="hljs-string">"sn.aside.historyBack"</span>, passAlongAsideEventInfo);
    $scope.$on(<span class="hljs-string">"sn.aside.controls.active"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e, data</span>) </span>{
        <span class="hljs-keyword">if</span> (!angular.equals(e.targetScope, $scope))
            $scope.$broadcast(<span class="hljs-string">"sn.aside.controls.active"</span>, data);
    });
    $scope.isWideEnough = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> screenWidth.isAbove(<span class="hljs-number">800</span>);
    };
    screenWidth.threshold(<span class="hljs-number">800</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">above</span>) </span>{
        <span class="hljs-keyword">if</span> (above)
            $scope.$broadcast(<span class="hljs-string">'connect.pane.close'</span>);
    });
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/controller.chatFloating.js */</span>
angular.module(<span class="hljs-string">'sn.connect'</span>).controller(<span class="hljs-string">'chatFloating'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">
    $scope, $rootScope, userPreferences, snTabActivity, snConnectAsideManager, messageNotifier, conversations,
    audioNotifier, isRTL, activeConversation, paneManager</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    paneManager.registerPane(<span class="hljs-string">'connect:conversation_list'</span>);
    $scope.conversationListCollapsed = <span class="hljs-literal">true</span>;
    snTabActivity.setAppName(<span class="hljs-string">"sn.connect"</span>);
    messageNotifier.registerMessageServiceWatch(shouldSendNotification);
    audioNotifier.registerMessageServiceWatch(activeConversation, shouldSendNotification);

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">shouldSendNotification</span>(<span class="hljs-params">message</span>) </span>{
        <span class="hljs-keyword">if</span> (!snTabActivity.isVisible)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">var</span> conversation = conversations.indexed[message.conversationID];
        <span class="hljs-keyword">if</span> (snTabActivity.isIdle)
            <span class="hljs-keyword">return</span> (conversation &amp;&amp; conversation.isFrameStateOpen) ? <span class="hljs-literal">false</span> : <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">if</span> (conversation &amp;&amp; conversation.isFrameStateOpen)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">return</span> $scope.conversationListCollapsed;
    }
    $scope.$watch(<span class="hljs-string">"conversationListCollapsed"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">listCollapsed</span>) </span>{
        CustomEvent.fireTop(<span class="hljs-string">"connect:conversation_list:state"</span>, (listCollapsed) ? <span class="hljs-string">"closed"</span> : <span class="hljs-string">"open"</span>);
    });
    CustomEvent.observe(<span class="hljs-string">"connect:conversation_list.toggle"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">manualSave, autoFocusPane</span>) </span>{
        $scope.conversationListCollapsed = !$scope.conversationListCollapsed;
        $rootScope.$broadcast(<span class="hljs-string">"pane.collapsed"</span>, <span class="hljs-string">'right'</span>, $scope.conversationListCollapsed, autoFocusPane);
        <span class="hljs-keyword">if</span> (manualSave)
            userPreferences.setPreference(<span class="hljs-string">"connect:conversation_list.opened"</span>, !$scope.conversationListCollapsed);
    });
    snConnectAsideManager.setup();
    $scope.$on(<span class="hljs-string">'pane.collapsed'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event, position, collapsed, autoFocusPane</span>) </span>{
        <span class="hljs-keyword">var</span> UI15Layout = angular.element(<span class="hljs-built_in">document</span>.body).data().layout,
            $snConnect = angular.element(<span class="hljs-string">'.sn-connect-content'</span>),
            $layout = angular.element(<span class="hljs-string">'.navpage-layout'</span>),
            $pageRight = angular.element(<span class="hljs-string">'.navpage-right'</span>);
        <span class="hljs-keyword">var</span> pane = isRTL ? <span class="hljs-string">'west'</span> : <span class="hljs-string">'east'</span>;
        <span class="hljs-keyword">if</span> (collapsed) {
            <span class="hljs-keyword">if</span> (UI15Layout) {
                UI15Layout.hide(pane);
            } <span class="hljs-keyword">else</span> {
                $layout.addClass(<span class="hljs-string">'navpage-right-hidden'</span>);
                $pageRight.css(<span class="hljs-string">'visibility'</span>, <span class="hljs-string">'hidden'</span>);
            }
            $snConnect.addClass(<span class="hljs-string">'sn-pane-hidden'</span>);
            $snConnect.removeClass(<span class="hljs-string">'sn-pane-visible'</span>);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">if</span> (UI15Layout) {
                UI15Layout.show(pane);
                UI15Layout.sizePane(pane, <span class="hljs-number">285</span>);
            } <span class="hljs-keyword">else</span> {
                $layout.removeClass(<span class="hljs-string">'navpage-right-hidden'</span>);
                $pageRight.css(<span class="hljs-string">'visibility'</span>, <span class="hljs-string">'visible'</span>);
            }
            $snConnect.removeClass(<span class="hljs-string">'sn-pane-hidden'</span>);
            $snConnect.addClass(<span class="hljs-string">'sn-pane-visible'</span>);
            <span class="hljs-keyword">if</span> (autoFocusPane) {
                $snConnect.one(<span class="hljs-string">'transitionend'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    <span class="hljs-keyword">if</span> ($snConnect.hasClass(<span class="hljs-string">'sn-pane-visible'</span>)) {
                        <span class="hljs-keyword">var</span> el = $snConnect.find(<span class="hljs-string">'input'</span>).filter(<span class="hljs-string">':first'</span>);
                        el.focus();
                    }
                });
            }
        }
    });
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/message/js_includes_connect_message.js */</span>
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/message/_module.js */</span>
angular.module(<span class="hljs-string">"sn.connect.message"</span>, [<span class="hljs-string">"ng.common"</span>, <span class="hljs-string">"sn.connect.util"</span>, <span class="hljs-string">"sn.connect.profile"</span>]);;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/message/directive.snAriaChatMessage.js */</span>
angular.module(<span class="hljs-string">'sn.connect.message'</span>).directive(<span class="hljs-string">'snAriaChatMessage'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">getTemplateUrl</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
        <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">templateUrl</span>: getTemplateUrl(<span class="hljs-string">'snAriaChatMessage.xml'</span>),
        <span class="hljs-attr">scope</span>: {
            <span class="hljs-attr">message</span>: <span class="hljs-string">'='</span>
        }
    }
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/message/directive.snCreateMessage.js */</span>
angular.module(<span class="hljs-string">'sn.connect.message'</span>).directive(<span class="hljs-string">'snCreateMessage'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">
    $timeout, $rootScope, getTemplateUrl, i18n, messageFactory, messageService, activeConversation, conversations,
    snTypingTracker, snNotification, inFrameSet, isLoggedIn</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">var</span> i18nText;
    i18n.getMessages([
        <span class="hljs-string">'Worknote'</span>,
        <span class="hljs-string">'Comment (customer visible)'</span>,
        <span class="hljs-string">'Message'</span>,
        <span class="hljs-string">'Attachments cannot be uploaded'</span>,
        <span class="hljs-string">'Upload attachment'</span>
    ], <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">results</span>) </span>{
        i18nText = results;
    });
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
        <span class="hljs-attr">templateUrl</span>: getTemplateUrl(<span class="hljs-string">"snCreateMessage.xml"</span>),
        <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">scope</span>: {
            <span class="hljs-attr">conversation</span>: <span class="hljs-string">"="</span>,
            <span class="hljs-attr">autofocusOnInput</span>: <span class="hljs-string">"=?"</span>
        },
        <span class="hljs-attr">link</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">scope, element</span>) </span>{
            <span class="hljs-keyword">var</span> lastTypeaheadSuggestion;
            <span class="hljs-keyword">var</span> preventSubmitAfterMentioSelection;
            <span class="hljs-keyword">var</span> input = element.find(<span class="hljs-string">'.new-message'</span>);
            <span class="hljs-keyword">if</span> (navigator.userAgent.match(<span class="hljs-regexp">/Android|webOS|iPhone|iPad|iPod|BlackBerry|Windows Phone/i</span>)) {
                scope.autofocusOnInput = <span class="hljs-literal">false</span>;
            }
            <span class="hljs-keyword">if</span> (scope.autofocusOnInput === <span class="hljs-literal">undefined</span>)
                scope.autofocusOnInput = <span class="hljs-literal">true</span>;
            input.typeahead({
                <span class="hljs-attr">hint</span>: <span class="hljs-literal">true</span>,
                <span class="hljs-attr">highlight</span>: <span class="hljs-literal">false</span>,
                <span class="hljs-attr">minLength</span>: <span class="hljs-number">1</span>
            }, {
                <span class="hljs-attr">name</span>: <span class="hljs-string">'commands'</span>,
                <span class="hljs-attr">displayKey</span>: <span class="hljs-string">'hint'</span>,
                <span class="hljs-attr">source</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">q, cb</span>) </span>{
                    <span class="hljs-keyword">if</span> (scope.conversation.pendingMessage &amp;&amp; scope.conversation.pendingMessage.indexOf(<span class="hljs-string">"/"</span>) === <span class="hljs-number">0</span>)
                        cb(scope.conversation.chatActions.getCommands(q));
                    <span class="hljs-keyword">else</span>
                        cb([]);
                },
                <span class="hljs-attr">templates</span>: {
                    <span class="hljs-attr">suggestion</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">command</span>) </span>{
                        <span class="hljs-keyword">return</span> <span class="hljs-string">'&lt;div class="command-row"&gt;&lt;div class="col-sm-4 command-key"&gt;'</span> + command.shortcut + <span class="hljs-string">'&lt;/div&gt;&lt;div class="col-sm-8 command-description"&gt;'</span> + command.description + <span class="hljs-string">'&lt;/div&gt;&lt;/div&gt;'</span>;
                    }
                }
            });
            input[<span class="hljs-number">0</span>].spellcheck = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">var</span> ttTypeahead = input.data(<span class="hljs-string">"ttTypeahead"</span>);
            ttTypeahead.input.off(<span class="hljs-string">"blurred"</span>);
            input.on(<span class="hljs-string">"typeahead:render"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event, suggestion</span>) </span>{
                lastTypeaheadSuggestion = suggestion;
            });
            input.on(<span class="hljs-string">"typeahead:cursorchange"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event, suggestion</span>) </span>{
                lastTypeaheadSuggestion = suggestion;
            });
            ttTypeahead.input._managePreventDefault = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">managePreventDefaultModified</span>(<span class="hljs-params">keyName, $e</span>) </span>{
                <span class="hljs-keyword">var</span> preventDefault = <span class="hljs-literal">false</span>;
                <span class="hljs-keyword">if</span> (keyName === <span class="hljs-string">"up"</span> || keyName === <span class="hljs-string">"down"</span>)
                    preventDefault = !ttTypeahead.menu._allDatasetsEmpty();
                <span class="hljs-keyword">if</span> (preventDefault)
                    $e.preventDefault();
            };
            input.on(<span class="hljs-string">"keydown"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) </span>{
                <span class="hljs-keyword">if</span> (event.keyCode === <span class="hljs-number">13</span> &amp;&amp; !event.shiftKey)
                    event.preventDefault();
                <span class="hljs-keyword">var</span> openMenus = angular.element(<span class="hljs-string">"mentio-menu"</span>).filter(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">index, element</span>) </span>{
                    <span class="hljs-keyword">return</span> element.style.display === <span class="hljs-string">"block"</span>;
                });
                preventSubmitAfterMentioSelection = openMenus.length &gt; <span class="hljs-number">0</span>;
                <span class="hljs-keyword">if</span> (event.keyCode === <span class="hljs-number">27</span> &amp;&amp; !preventSubmitAfterMentioSelection) {
                    <span class="hljs-keyword">if</span> (!scope.conversation.isPending)
                        scope.$emit(<span class="hljs-string">"connect.floatingConversationEscape"</span>);
                    <span class="hljs-keyword">else</span>
                        scope.$emit(<span class="hljs-string">"connect.message_control_key"</span>, <span class="hljs-string">"escape"</span>);
                }
                <span class="hljs-keyword">if</span> (event.keyCode === <span class="hljs-number">13</span> &amp;&amp; !event.shiftKey &amp;&amp; !preventSubmitAfterMentioSelection) {
                    input.trigger(<span class="hljs-string">"enterkey-pressed"</span>);
                    <span class="hljs-keyword">if</span> (!scope.conversation.pendingMessage)
                        <span class="hljs-keyword">return</span>;
                    <span class="hljs-keyword">if</span> (!handleSlashCommand()) {
                        addMessage();
                        <span class="hljs-keyword">if</span> (activeConversation.pendingConversation &amp;&amp; activeConversation.pendingConversation.sysID === scope.conversation.sysID) {
                            conversations.get(activeConversation.pendingConversation.sysID).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">conversation</span>) </span>{
                                <span class="hljs-keyword">if</span> ((inFrameSet &amp;&amp; conversation.isFrameStateOpen) || (!inFrameSet &amp;&amp; conversation.visible)) {
                                    $rootScope.$broadcast(<span class="hljs-string">"connect.new_conversation.cancelled"</span>);
                                }
                            });
                        }
                    }
                    closeTypeahead();
                } <span class="hljs-keyword">else</span> {
                    snTypingTracker.typing()
                }
            });

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">handleSlashCommand</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">var</span> pendingMessage = scope.conversation.pendingMessage;
                <span class="hljs-keyword">if</span> (pendingMessage[<span class="hljs-number">0</span>] !== <span class="hljs-string">"/"</span>)
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
                <span class="hljs-keyword">if</span> (lastTypeaheadSuggestion) {
                    <span class="hljs-keyword">var</span> lastSuggestionIsValid = lastTypeaheadSuggestion.canRun(pendingMessage);
                    $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                        <span class="hljs-keyword">if</span> (lastSuggestionIsValid) {
                            scope.conversation.pendingMessage = lastTypeaheadSuggestion.shortcut + <span class="hljs-string">" "</span>;
                            input.triggerHandler(<span class="hljs-string">"blur"</span>)
                        }
                        lastTypeaheadSuggestion = <span class="hljs-keyword">void</span>(<span class="hljs-number">0</span>);
                    });
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
                }
                <span class="hljs-keyword">if</span> (scope.conversation.chatActions.hasMatchingAction(pendingMessage)) {
                    <span class="hljs-keyword">if</span> (scope.conversation.chatActions.hasRequiredArguments(pendingMessage)) {
                        scope.conversation.chatActions.run(pendingMessage);
                        scope.conversation.pendingMessage = <span class="hljs-string">""</span>;
                        scope.$apply();
                    } <span class="hljs-keyword">else</span> {
                        scope.$emit(<span class="hljs-string">"connect.chat_action.require_options"</span>, scope.conversation);
                    }
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
                }
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            }

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">closeTypeahead</span>(<span class="hljs-params"></span>) </span>{
                ttTypeahead.input.query = <span class="hljs-string">""</span>;
                ttTypeahead.menu.empty();
                ttTypeahead.input.resetInputValue();
                ttTypeahead.input.trigger(<span class="hljs-string">"blurred"</span>);
                input.typeahead(<span class="hljs-string">'close'</span>);
            }

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addMessage</span>(<span class="hljs-params"></span>) </span>{
                $rootScope.$broadcast(<span class="hljs-string">"connect.auto_scroll.jump_to_bottom"</span>);
                snTypingTracker.cancelTyping();
                <span class="hljs-keyword">var</span> newMessageText = scope.conversation.pendingMessage;
                <span class="hljs-keyword">if</span> (!newMessageText)
                    <span class="hljs-keyword">return</span>;
                <span class="hljs-keyword">var</span> message = messageFactory.newPendingMessage(scope.conversation, newMessageText, scope.messageType);
                scope.sendMessage(message);
                scope.conversation.pendingMessage = <span class="hljs-string">""</span>;
            }
            <span class="hljs-keyword">var</span> waitForConversationCreation = <span class="hljs-literal">false</span>;
            scope.sendMessage = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">message</span>) </span>{
                <span class="hljs-keyword">if</span> (!message) {
                    <span class="hljs-keyword">return</span>;
                }
                <span class="hljs-keyword">if</span> (!activeConversation.pendingConversation || (message.conversationID === activeConversation.sysID)) {
                    messageService.send(message);
                    <span class="hljs-keyword">return</span>;
                }
                <span class="hljs-keyword">var</span> conversation = activeConversation.pendingConversation;
                <span class="hljs-keyword">if</span> (!conversation.isPending) {
                    message.conversationID = conversation.sysID;
                    messageService.send(message);
                    done(conversation, <span class="hljs-literal">false</span>);
                    <span class="hljs-keyword">return</span>;
                }
                <span class="hljs-keyword">if</span> (waitForConversationCreation)
                    <span class="hljs-keyword">return</span>;
                waitForConversationCreation = <span class="hljs-literal">true</span>;
                <span class="hljs-keyword">var</span> newConversation = conversations.newConversation;
                <span class="hljs-keyword">if</span> (newConversation.pendingRecipients.length === <span class="hljs-number">0</span>)
                    <span class="hljs-keyword">return</span>;
                <span class="hljs-keyword">var</span> recipients = newConversation.pendingRecipients;
                <span class="hljs-keyword">var</span> groupName = newConversation.getGroupName();
                conversations.beginNewConversation(groupName, recipients, message)
                    .then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">conversation</span>) </span>{
                        waitForConversationCreation = <span class="hljs-literal">false</span>;
                        done(conversation, <span class="hljs-literal">true</span>);
                    });
            };

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">done</span>(<span class="hljs-params">conversation, isNew</span>) </span>{
                activeConversation.conversation = conversation;
                $rootScope.$broadcast(<span class="hljs-string">"connect.new_conversation.complete"</span>, conversation, isNew);
                $rootScope.$broadcast(<span class="hljs-string">"connect.focus"</span>, conversation);
            }
            input.on(<span class="hljs-string">"blur"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                input.val(scope.conversation.pendingMessage);
            });
            scope.$on(<span class="hljs-string">"connect.message.focus"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event, conversation</span>) </span>{
                <span class="hljs-keyword">if</span> (inFrameSet) {
                    <span class="hljs-keyword">if</span> (!conversation)
                        <span class="hljs-keyword">return</span>;
                    <span class="hljs-keyword">if</span> (!scope.conversation)
                        <span class="hljs-keyword">return</span>;
                    <span class="hljs-keyword">if</span> (conversation.sysID !== scope.conversation.sysID)
                        <span class="hljs-keyword">return</span>;
                    <span class="hljs-keyword">if</span> (conversation !== scope.conversation &amp;&amp;
                        scope.conversation.isPending) {
                        <span class="hljs-keyword">return</span>;
                    }
                }
                focus();
            });
            scope.$on(<span class="hljs-string">"connect.message.focus.type"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event, newInputType</span>) </span>{
                <span class="hljs-keyword">if</span> (newInputType !== <span class="hljs-string">"chat"</span>)
                    <span class="hljs-keyword">return</span>;
                focus();
            });

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">focus</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">if</span> (<span class="hljs-built_in">window</span>.getSelection().toString())
                    <span class="hljs-keyword">return</span>;
                $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    input.focus();
                }, <span class="hljs-number">0</span>, <span class="hljs-literal">false</span>);
            }
            scope.focus = focus;
            scope.$on(<span class="hljs-string">"connect.attachment_dialog.open"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e, sysID</span>) </span>{
                <span class="hljs-keyword">if</span> (sysID !== scope.conversation.sysID)
                    <span class="hljs-keyword">return</span>;
                $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    element.find(<span class="hljs-string">'.message-attach-file'</span>).click();
                }, <span class="hljs-number">0</span>, <span class="hljs-literal">false</span>);
            });
            <span class="hljs-keyword">if</span> (element.find(<span class="hljs-string">".document-message-type .dropup"</span>).hideFix)
                element.find(<span class="hljs-string">".document-message-type .dropup"</span>).hideFix();
            $timeout(focus, <span class="hljs-number">0</span>, <span class="hljs-literal">false</span>);
        },
        <span class="hljs-attr">controller</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$scope, liveProfileID, messageService, messageFactory, uploadAttachmentService,
            snConnectMention, inSupportClient</span>) </span>{
            $scope.members = [];
            $scope.members.loading = <span class="hljs-literal">false</span>;
            $scope.searchMembers = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">term</span>) </span>{
                <span class="hljs-keyword">if</span> ($scope.conversation.isDirectMessage) {
                    $scope.members = [];
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">if</span> (!$scope.conversation.document || !$scope.conversation.table)
                        <span class="hljs-keyword">return</span> snConnectMention.retrieveMembers($scope.conversation, term).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">members</span>) </span>{
                            $scope.members = members;
                        });
                    $scope.members.loading = <span class="hljs-literal">true</span>;
                    <span class="hljs-keyword">if</span> (term.length === <span class="hljs-number">0</span>) {
                        $scope.members = [{
                            <span class="hljs-attr">termLengthIsZero</span>: <span class="hljs-literal">true</span>
                        }];
                        $scope.members.loading = <span class="hljs-literal">false</span>;
                    } <span class="hljs-keyword">else</span> {
                        snConnectMention.retrieveMembers($scope.conversation, term).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">members</span>) </span>{
                            $scope.members = members;
                            $scope.members.loading = <span class="hljs-literal">false</span>;
                        });
                    }
                }
            };
            $scope.selectAtMention = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">item</span>) </span>{
                <span class="hljs-keyword">if</span> (item.termLengthIsZero)
                    <span class="hljs-keyword">return</span> item.name;
                <span class="hljs-keyword">return</span> <span class="hljs-string">"@["</span> + item.name + <span class="hljs-string">"]"</span>;
            };
            $scope.openAttachFileDialog = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$event</span>) </span>{
                <span class="hljs-keyword">if</span> ($scope.isAttachmentDisabled())
                    <span class="hljs-keyword">return</span>;
                <span class="hljs-keyword">if</span> ($scope.conversation.amMember || $scope.conversation.isPending)
                    uploadAttachmentService.openFileSelector.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>);
            };
            $scope.$on(<span class="hljs-string">"connect.drop.files"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event, files, conversationID</span>) </span>{
                <span class="hljs-keyword">var</span> isDropable = $scope.conversation.isPending ?
                    !$scope.conversation.isPendingNoRecipients :
                    conversationID === $scope.conversation.sysID;
                <span class="hljs-keyword">if</span> (isDropable)
                    $scope.sendFiles(files);
            });
            $scope.sendFiles = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">files</span>) </span>{
                <span class="hljs-keyword">if</span> ($scope.conversation.isHelpDesk &amp;&amp; $scope.conversation.queueEntry.isTransferringToMe) {
                    $scope.$broadcast(<span class="hljs-string">'dialog.attachment-transfer.show'</span>);
                    <span class="hljs-keyword">return</span>;
                }
                <span class="hljs-keyword">if</span> ($scope.isWorknote()) {
                    $scope.okAttachmentsAsComment = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                        attachFiles(files);
                    };
                    $scope.$broadcast(<span class="hljs-string">'dialog.attachment-work-notes.show'</span>);
                    <span class="hljs-keyword">return</span>;
                }
                attachFiles(files);
            };

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">attachFiles</span>(<span class="hljs-params">files</span>) </span>{
                $rootScope.$broadcast(<span class="hljs-string">"connect.auto_scroll.scroll_to_bottom"</span>);
                messageService.uploadAttachments($scope.conversation, files).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">message</span>) </span>{
                    <span class="hljs-keyword">return</span> $scope.sendMessage(message);
                }).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                        <span class="hljs-keyword">if</span> (activeConversation.conversation.sysID === $scope.conversation.sysID)
                            $scope.focus();
                    }, <span class="hljs-number">0</span>, <span class="hljs-literal">false</span>);
                });
            }
            $scope.isAttachmentDisabled = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> $scope.isWorknote() ||
                    ($scope.conversation.isHelpDesk &amp;&amp; $scope.conversation.queueEntry.isTransferringToMe) || !isLoggedIn;
            };
            $scope.getAttachmentTitle = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> $scope.isAttachmentDisabled() ?
                    i18nText[<span class="hljs-string">'Attachments cannot be uploaded'</span>] :
                    i18nText[<span class="hljs-string">'Upload attachment'</span>];
            };
            $scope.$watch(<span class="hljs-string">"conversation.sysID"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                initializeMessageType();
            });
            $scope.$watch(<span class="hljs-string">'conversation.queueEntry.sysID'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                initializeMessageType();
            });
            $scope.setAsWorkNote = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                $scope.messageType = <span class="hljs-string">"work_notes"</span>;
            };
            $scope.setAsComment = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                $scope.messageType = <span class="hljs-string">"comments"</span>;
            };
            $scope.isWorknote = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> $scope.messageType === <span class="hljs-string">"work_notes"</span>;
            };

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isComment</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> $scope.messageType === <span class="hljs-string">'comments'</span>;
            }
            $scope.isDocumentGroup = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> $scope.conversation.isDocumentGroup &amp;&amp; !inSupportClient;
            };
            $scope.isMessageTypeVisible = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> $scope.isDocumentGroup() &amp;&amp; !hasPendingTransferToMe() &amp;&amp; $scope.conversation.canSaveWorkNotes;
            };
            $scope.isEndChatVisible = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> $scope.conversation.isHelpDesk &amp;&amp; $scope.conversation.queueEntry.isAssignedToMe;
            };

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">hasPendingTransferToMe</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> $scope.conversation.isHelpDesk &amp;&amp;
                    $scope.conversation.queueEntry.isTransferringToMe &amp;&amp;
                    $scope.conversation.queueEntry.isTransferPending;
            }
            $scope.placeholderText = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">if</span> ($scope.isDocumentGroup() &amp;&amp; $scope.conversation.canSaveWorkNotes) {
                    <span class="hljs-keyword">if</span> (isComment())
                        <span class="hljs-keyword">return</span> i18nText[<span class="hljs-string">'Comment (customer visible)'</span>];
                    <span class="hljs-keyword">if</span> ($scope.isWorknote())
                        <span class="hljs-keyword">return</span> i18nText[<span class="hljs-string">'Worknote'</span>];
                }
                <span class="hljs-keyword">return</span> i18nText[<span class="hljs-string">'Message'</span>];
            };

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">initializeMessageType</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">if</span> (hasPendingTransferToMe()) {
                    $scope.setAsWorkNote();
                    <span class="hljs-keyword">return</span>;
                }
                <span class="hljs-keyword">if</span> ($scope.isDocumentGroup() &amp;&amp;
                    !$scope.conversation.isHelpDesk &amp;&amp;
                    $scope.conversation.table !== <span class="hljs-string">"vtb_board"</span> &amp;&amp;
                    $scope.conversation.canSaveWorkNotes) {
                    $scope.setAsWorkNote();
                    <span class="hljs-keyword">return</span>;
                }
                $scope.setAsComment();
            }
            $scope.closeSupportConversation = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                conversations.closeSupport($scope.conversation.sysID, <span class="hljs-literal">false</span>);
            };

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addLinkMessage</span>(<span class="hljs-params">link</span>) </span>{
                $scope.sendMessage(messageFactory.newPendingMessage($scope.conversation, link));
            }
            $scope.$on(<span class="hljs-string">"conversation.resource.add"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event, data</span>) </span>{
                addLinkMessage(data.link);
            });
            $scope.$on(<span class="hljs-string">"connect.drop"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event, data, conversationID</span>) </span>{
                <span class="hljs-keyword">if</span> (conversationID !== $scope.conversation.sysID &amp;&amp; !$scope.conversation.isPending)
                    <span class="hljs-keyword">return</span>;
                <span class="hljs-keyword">var</span> link;
                <span class="hljs-keyword">if</span> (data.type === <span class="hljs-string">"document"</span>) {
                    link = data.href;
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (data.type === <span class="hljs-string">"record"</span>) {
                    link = data.payload.url;
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (data.type === <span class="hljs-string">"link"</span>) {
                    link = data.payload;
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (data.icon &amp;&amp; data.icon === <span class="hljs-string">"form"</span> &amp;&amp; data.url) {
                    link = data.url;
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">return</span>;
                }
                addLinkMessage(link);
            });
        }
    }
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/message/directive.snMessageBatch.js */</span>
angular.module(<span class="hljs-string">'sn.connect.message'</span>).directive(<span class="hljs-string">'snMessageBatch'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">getTemplateUrl</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
        <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">templateUrl</span>: getTemplateUrl(<span class="hljs-string">'snMessageBatch.xml'</span>),
        <span class="hljs-attr">scope</span>: {
            <span class="hljs-attr">batch</span>: <span class="hljs-string">'='</span>,
            <span class="hljs-attr">isGroupConversation</span>: <span class="hljs-string">'='</span>
        },
        <span class="hljs-attr">controller</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$scope, showAgentAvatar, inSupportClient</span>) </span>{
            $scope.isSystemMessage = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> $scope.batch.isSystemMessage;
            };
            $scope.inSupportClient = inSupportClient;
            $scope.isQueueAvatarShowing = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> (inSupportClient &amp;&amp; !showAgentAvatar &amp;&amp; $scope.batch.isFromPeer) || $scope.isFromQueue();
            };
            $scope.isFromQueue = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> $scope.batch.profileData &amp;&amp; $scope.batch.profileData.table === <span class="hljs-string">'chat_queue_entry'</span>;
            };
            $scope.isTextShowing = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">message</span>) </span>{
                <span class="hljs-keyword">return</span> message.isMessageShowing &amp;&amp; !message.uploadingFiles;
            };
            <span class="hljs-keyword">if</span> (!$scope.batch.profileData) {
                <span class="hljs-keyword">var</span> unwatch = $scope.$watch(<span class="hljs-string">'batch.profileData'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">newVal</span>) </span>{
                    <span class="hljs-keyword">if</span> (newVal) {
                        $scope.profileData = newVal;
                        unwatch();
                    }
                })
            } <span class="hljs-keyword">else</span> {
                $scope.profileData = $scope.batch.profileData;
            }
        }
    }
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/message/directive.snUploadAttachmentList.js */</span>
angular.module(<span class="hljs-string">'sn.connect.message'</span>).directive(<span class="hljs-string">'snUploadAttachmentList'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">getTemplateUrl</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
        <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">templateUrl</span>: getTemplateUrl(<span class="hljs-string">"snUploadAttachmentList.xml"</span>),
        <span class="hljs-attr">scope</span>: {
            <span class="hljs-attr">uploadingFiles</span>: <span class="hljs-string">"="</span>
        },
        <span class="hljs-attr">controller</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$scope</span>) </span>{
            $scope.isFileNameShowing = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">file</span>) </span>{
                <span class="hljs-keyword">return</span> file.state !== <span class="hljs-string">'error'</span>;
            };
            $scope.isProgressBarShowing = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">file</span>) </span>{
                <span class="hljs-keyword">return</span> file.state === <span class="hljs-string">'progress'</span>;
            };
            $scope.getProgressStyle = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">file</span>) </span>{
                <span class="hljs-keyword">return</span> {
                    <span class="hljs-string">'width'</span>: file.progress + <span class="hljs-string">'%'</span>
                };
            };
        }
    }
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/message/factory.Message.js */</span>
angular.module(<span class="hljs-string">'sn.connect.message'</span>).factory(<span class="hljs-string">"messageFactory"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">
    liveProfileID, profiles, liveLinkFactory, attachmentFactory, resourcePersister</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">buildMessageFromJSONObject</span>(<span class="hljs-params">jsonObject</span>) </span>{
        jsonObject = jsonObject || {};
        <span class="hljs-keyword">var</span> mentions = jsonObject.mentions || [];
        <span class="hljs-keyword">var</span> links = [];
        <span class="hljs-keyword">var</span> attachments = [];
        <span class="hljs-keyword">var</span> isSystem = jsonObject.created_by === <span class="hljs-string">"system"</span>;
        angular.forEach((jsonObject.links || []), <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">rawLink</span>) </span>{
            <span class="hljs-keyword">var</span> link = liveLinkFactory.fromObject(rawLink, !isSystem);
            resourcePersister.addLink(jsonObject.group, link);
            <span class="hljs-keyword">this</span>.push(link);
        }, links);
        angular.forEach((jsonObject.attachments || []), <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">rawAttachment</span>) </span>{
            <span class="hljs-keyword">var</span> attachment = attachmentFactory.fromObject(rawAttachment);
            resourcePersister.addAttachment(jsonObject.group, attachment);
            <span class="hljs-keyword">this</span>.push(attachment)
        }, attachments);
        <span class="hljs-keyword">var</span> text = jsonObject.formatted_message;
        <span class="hljs-keyword">var</span> escapedText = htmlEscape(text);
        <span class="hljs-keyword">var</span> displayText = replaceText(escapedText,
                <span class="hljs-string">"&lt;a class='at-mention at-mention-user-$1'&gt;@$2&lt;/a&gt;"</span>,
                linkFormatter)
            .replace(<span class="hljs-regexp">/\r/g</span>, <span class="hljs-string">""</span>)
            .replace(<span class="hljs-regexp">/\n/g</span>, <span class="hljs-string">"&lt;br&gt;"</span>);
        <span class="hljs-keyword">var</span> cleanText = replaceText(escapedText, <span class="hljs-string">"@$2"</span>, <span class="hljs-string">"$2"</span>);

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">linkFormatter</span>(<span class="hljs-params">wholeMatch, urlOrSysID, linkText</span>) </span>{
            <span class="hljs-keyword">var</span> isSysID = urlOrSysID.match(<span class="hljs-regexp">/^[0-9A-F]{32}$/i</span>);
            <span class="hljs-keyword">var</span> matchedLink;
            <span class="hljs-keyword">var</span> url;
            <span class="hljs-keyword">if</span> (isSysID) {
                matchedLink = links.filter(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">link</span>) </span>{
                    <span class="hljs-keyword">return</span> link.sysID === urlOrSysID;
                })[<span class="hljs-number">0</span>];
                url = matchedLink &amp;&amp; matchedLink.url;
            } <span class="hljs-keyword">else</span> {
                url = urlOrSysID;
                matchedLink = links.filter(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">link</span>) </span>{
                    <span class="hljs-keyword">var</span> escapedUrl = htmlEscape(link.url);
                    <span class="hljs-keyword">return</span> link.url === url || escapedUrl === url || htmlEscape(escapedUrl) === url;
                })[<span class="hljs-number">0</span>];
            }
            <span class="hljs-keyword">if</span> (matchedLink) {
                <span class="hljs-keyword">try</span> {
                    <span class="hljs-keyword">return</span> matchedLink.aTag(linkText);
                } <span class="hljs-keyword">catch</span> (unused) {}
            }
            <span class="hljs-keyword">return</span> linkText;
        }
        <span class="hljs-keyword">return</span> {
            <span class="hljs-attr">sysID</span>: jsonObject.sys_id,
            <span class="hljs-attr">text</span>: text,
            <span class="hljs-attr">createdOn</span>: jsonObject.created_on,
            <span class="hljs-attr">conversationID</span>: jsonObject.group,
            <span class="hljs-attr">profile</span>: jsonObject.profile,
            <span class="hljs-attr">timestamp</span>: jsonObject.timestamp,
            <span class="hljs-attr">reflectedField</span>: jsonObject.reflected_field,
            <span class="hljs-attr">hasLinks</span>: links.length &gt; <span class="hljs-number">0</span>,
            <span class="hljs-attr">id</span>: jsonObject.id,
            <span class="hljs-attr">pending</span>: <span class="hljs-literal">false</span>,
            get cleanText() {
                <span class="hljs-keyword">return</span> cleanText;
            },
            get profileData() {
                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.profile)
                    <span class="hljs-keyword">return</span> profiles.get(<span class="hljs-keyword">this</span>.profile);
            },
            get isSystemMessage() {
                <span class="hljs-keyword">return</span> isSystem;
            },
            get isFromPeer() {
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.profile !== liveProfileID;
            },
            get attachments() {
                <span class="hljs-keyword">return</span> attachments;
            },
            get links() {
                <span class="hljs-keyword">return</span> links;
            },
            get mentions() {
                <span class="hljs-keyword">return</span> mentions;
            },
            get isMessageShowing() {
                <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>._isMessageShowing)
                    <span class="hljs-keyword">this</span>._isMessageShowing = !shouldHide(<span class="hljs-keyword">this</span>);
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._isMessageShowing;
            },
            get hasSystemLink() {
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.isSystemMessage &amp;&amp; links[<span class="hljs-number">0</span>];
            },
            get displayText() {
                <span class="hljs-keyword">return</span> displayText;
            }
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">shouldHide</span>(<span class="hljs-params">message</span>) </span>{
        <span class="hljs-keyword">if</span> (onlyAttachmentMessage(message))
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">var</span> links = message.links;
        <span class="hljs-keyword">return</span> (links.length === <span class="hljs-number">1</span>) &amp;&amp;
            links[<span class="hljs-number">0</span>].isHideable &amp;&amp;
            (replaceText(message.text, <span class="hljs-string">"X"</span>, <span class="hljs-string">"X"</span>).trim().length === <span class="hljs-number">1</span>);
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onlyAttachmentMessage</span>(<span class="hljs-params">message</span>) </span>{
        <span class="hljs-keyword">var</span> attachments = message.attachments;
        <span class="hljs-keyword">if</span> (attachments.length === <span class="hljs-number">0</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">var</span> text = message.text;
        message.attachments.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">attachment</span>) </span>{
            text = text.replace(<span class="hljs-string">"File: "</span> + attachment.fileName, <span class="hljs-string">""</span>);
        });
        <span class="hljs-keyword">return</span> text.trim().length === <span class="hljs-number">0</span>;
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">replaceText</span>(<span class="hljs-params">text, mentions, links</span>) </span>{
        <span class="hljs-keyword">if</span> (!text)
            <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>;
        <span class="hljs-keyword">return</span> text
            .replace(<span class="hljs-regexp">/@M\[([^|]+?)\|([^\]]+?)]/gi</span>, mentions)
            .replace(<span class="hljs-regexp">/@\[([^:\]]+?):([^\]]+)]/g</span>, mentions)
            .replace(<span class="hljs-regexp">/@L\[([^|]+?)\|([^\]]*)]/gi</span>, links);
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">newPendingAttachmentMessage</span>(<span class="hljs-params">conversation, files</span>) </span>{
        <span class="hljs-keyword">var</span> message = newPendingMessage(conversation, <span class="hljs-string">""</span>);
        message.uploadingFiles = files;
        <span class="hljs-keyword">return</span> message;
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">newPendingMessage</span>(<span class="hljs-params">conversation, text, journalType</span>) </span>{
        <span class="hljs-keyword">var</span> timestamp = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().getTime();
        <span class="hljs-keyword">var</span> message = buildMessageFromJSONObject({
            <span class="hljs-attr">sys_id</span>: timestamp + <span class="hljs-built_in">Math</span>.random(),
            <span class="hljs-attr">profile</span>: liveProfileID,
            <span class="hljs-attr">group</span>: conversation.sysID,
            <span class="hljs-attr">created_on</span>: getLocalCreatedOn(timestamp),
            <span class="hljs-attr">formatted_message</span>: text,
            <span class="hljs-attr">reflected_field</span>: journalType || <span class="hljs-string">"comments"</span>,
            <span class="hljs-attr">timestamp</span>: timestamp
        });
        message.pending = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">return</span> message;
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getLocalCreatedOn</span>(<span class="hljs-params">timestamp</span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(timestamp)
            .toISOString()
            .replace(<span class="hljs-regexp">/(.*?)T(.*?)[.].*/g</span>, <span class="hljs-string">"$1 $2"</span>);
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">htmlEscape</span>(<span class="hljs-params">str</span>) </span>{
        <span class="hljs-keyword">return</span> angular.element(<span class="hljs-string">"&lt;textarea/&gt;"</span>).text(str).html();
    }
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">fromObject</span>: buildMessageFromJSONObject,
        <span class="hljs-attr">newPendingMessage</span>: newPendingMessage,
        <span class="hljs-attr">newPendingAttachmentMessage</span>: newPendingAttachmentMessage
    }
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/message/service.messageBatcher.js */</span>
angular.module(<span class="hljs-string">'sn.connect.message'</span>).service(<span class="hljs-string">"messageBatcherService"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">i18n, $filter, liveProfileID</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">var</span> yesterday = <span class="hljs-string">"Yesterday"</span>;
    <span class="hljs-keyword">var</span> today = <span class="hljs-string">"Today"</span>;
    i18n.getMessages([yesterday, today], <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">results</span>) </span>{
        yesterday = results[yesterday];
        today = results[today];
    });
    <span class="hljs-keyword">var</span> MINIMUM_TIME = <span class="hljs-number">20</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>;

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getMonthCount</span>(<span class="hljs-params">date</span>) </span>{
        <span class="hljs-keyword">return</span> (date.getFullYear() * <span class="hljs-number">12</span> + date.getMonth());
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getDayCount</span>(<span class="hljs-params">date</span>) </span>{
        <span class="hljs-keyword">return</span> (date.getFullYear() * <span class="hljs-number">365</span> + date.getMonth() * <span class="hljs-number">30</span> + date.getDate());
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">MessageBatch</span>(<span class="hljs-params">messages, isLastBatchFn</span>) </span>{
        <span class="hljs-keyword">return</span> {
            <span class="hljs-attr">messages</span>: messages,
            get firstMessage() {
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.messages[<span class="hljs-number">0</span>];
            },
            get lastMessage() {
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.messages[<span class="hljs-keyword">this</span>.messages.length - <span class="hljs-number">1</span>]
            },
            get batchID() {
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.firstMessage.sysID + <span class="hljs-string">""</span> + <span class="hljs-keyword">this</span>.lastMessage.sysID;
            },
            get isFromPeer() {
                <span class="hljs-keyword">return</span> !!<span class="hljs-keyword">this</span>.firstMessage.isFromPeer;
            },
            get isSystemMessage() {
                <span class="hljs-keyword">return</span> !!<span class="hljs-keyword">this</span>.firstMessage.isSystemMessage;
            },
            get profileData() {
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.firstMessage.profileData;
            },
            get createdOn() {
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.lastMessage.createdOn;
            },
            get timestamp() {
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.lastMessage.timestamp;
            },
            get isLastBatch() {
                <span class="hljs-keyword">return</span> isLastBatchFn(<span class="hljs-keyword">this</span>);
            },
            get systemMessageLink() {
                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.lastMessage.hasSystemLink)
                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.lastMessage.links[<span class="hljs-number">0</span>];
            },
            <span class="hljs-attr">getSeparator</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">var</span> timestamp = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(<span class="hljs-keyword">this</span>.lastMessage.timestamp);
                <span class="hljs-keyword">var</span> now = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>();
                <span class="hljs-keyword">var</span> hasYear = now.getFullYear() - timestamp.getFullYear() &gt; <span class="hljs-number">0</span>;
                <span class="hljs-keyword">if</span> (hasYear &amp;&amp; getMonthCount(now) - getMonthCount(timestamp) &gt; <span class="hljs-number">12</span>)
                    <span class="hljs-keyword">return</span> $filter(<span class="hljs-string">'date'</span>)(timestamp, <span class="hljs-string">'yyyy'</span>);
                <span class="hljs-keyword">var</span> hasMonth = now.getMonth() - timestamp.getMonth() &gt; <span class="hljs-number">0</span>;
                <span class="hljs-keyword">if</span> ((hasMonth || hasYear) &amp;&amp; getDayCount(now) - getDayCount(timestamp) &gt; <span class="hljs-number">30</span>)
                    <span class="hljs-keyword">return</span> $filter(<span class="hljs-string">'date'</span>)(timestamp, <span class="hljs-string">'MMMM yyyy'</span>);
                <span class="hljs-keyword">var</span> hasDay = now.getDate() - timestamp.getDate() &gt; <span class="hljs-number">0</span>;
                <span class="hljs-keyword">if</span> (hasMonth || hasYear || hasDay) {
                    <span class="hljs-keyword">if</span> (now.getDate() - timestamp.getDate() === <span class="hljs-number">1</span>)
                        <span class="hljs-keyword">return</span> yesterday;
                    <span class="hljs-keyword">return</span> $filter(<span class="hljs-string">'date'</span>)(timestamp, <span class="hljs-string">'longDate'</span>);
                }
                <span class="hljs-keyword">return</span> today;
            }
        }
    }
    <span class="hljs-keyword">var</span> messageBatchers = {};
    <span class="hljs-keyword">var</span> ariaMessages = {};

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">compare</span>(<span class="hljs-params">message1, message2</span>) </span>{
        <span class="hljs-keyword">if</span> (message1.id &amp;&amp; message2.id)
            <span class="hljs-keyword">return</span> message1.id &lt; message2.id ? <span class="hljs-number">-1</span> : <span class="hljs-number">1</span>;
        <span class="hljs-keyword">return</span> message1.timestamp - message2.timestamp;
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">MessageBatcher</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> messageBatchMap = {};
        <span class="hljs-keyword">var</span> batches = [];

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isLastBatchFn</span>(<span class="hljs-params">batch</span>) </span>{
            <span class="hljs-keyword">return</span> lastBatch() === batch;
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">lastBatch</span>(<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">return</span> batches[batches.length - <span class="hljs-number">1</span>];
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">add</span>(<span class="hljs-params">message</span>) </span>{
            <span class="hljs-keyword">if</span> (batches.length == <span class="hljs-number">0</span>) {
                insertNewBatch(<span class="hljs-number">0</span>, [message]);
                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
            }
            <span class="hljs-keyword">var</span> batch = messageBatchMap[message.sysID];
            <span class="hljs-keyword">if</span> (batch) {
                update(batch, message);
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            }
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; batches.length; ++i) {
                batch = batches[i];
                <span class="hljs-keyword">var</span> insert = insertAt(batch, message);
                <span class="hljs-keyword">if</span> (insert === <span class="hljs-string">"after"</span>)
                    <span class="hljs-keyword">continue</span>;
                <span class="hljs-keyword">if</span> (insert === <span class="hljs-string">"before"</span>) {
                    insertNewBatch(i, [message]);
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
                }
                <span class="hljs-keyword">var</span> isLast = (insert === batch.messages.length);
                <span class="hljs-keyword">if</span> (isBatchable(batch, message)) {
                    <span class="hljs-keyword">if</span> (isLast) {
                        <span class="hljs-keyword">var</span> next = batches[i + <span class="hljs-number">1</span>];
                        <span class="hljs-keyword">if</span> (next &amp;&amp; compare(message, next.firstMessage) &gt; <span class="hljs-number">0</span>)
                            <span class="hljs-keyword">continue</span>;
                    }
                    batch.messages.splice(insert, <span class="hljs-number">0</span>, message);
                    messageBatchMap[message.sysID] = batch;
                    coalesce(i);
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
                }
                <span class="hljs-keyword">if</span> (insert === <span class="hljs-number">0</span>) {
                    insertNewBatch(i, [message]);
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
                }
                <span class="hljs-keyword">if</span> (!isLast) {
                    split(i, insert);
                    insertNewBatch(i + <span class="hljs-number">1</span>, [message]);
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
                }
            }
            insertNewBatch(batches.length, [message]);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">update</span>(<span class="hljs-params">batch, message</span>) </span>{
            <span class="hljs-keyword">if</span> (message.isPlaceholder)
                <span class="hljs-keyword">return</span>;
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; batch.messages.length; ++i) {
                <span class="hljs-keyword">if</span> (batch.messages[i].sysID === message.sysID) {
                    batch.messages[i] = message;
                    <span class="hljs-keyword">break</span>;
                }
            }
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">insertAt</span>(<span class="hljs-params">batch, message</span>) </span>{
            <span class="hljs-keyword">if</span> (!isInRange(message, batch.firstMessage))
                <span class="hljs-keyword">return</span> <span class="hljs-string">"before"</span>;
            <span class="hljs-keyword">if</span> (!isInRange(batch.lastMessage, message))
                <span class="hljs-keyword">return</span> <span class="hljs-string">"after"</span>;
            <span class="hljs-keyword">var</span> messages = batch.messages;
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; messages.length; ++i) {
                <span class="hljs-keyword">if</span> (compare(message, messages[i]) &lt; <span class="hljs-number">0</span>)
                    <span class="hljs-keyword">return</span> i;
            }
            <span class="hljs-keyword">return</span> messages.length;
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isBatchable</span>(<span class="hljs-params">batch, message</span>) </span>{
            <span class="hljs-keyword">if</span> (message.isSystemMessage)
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            <span class="hljs-keyword">var</span> first = batch.firstMessage;
            <span class="hljs-keyword">return</span> !first.isSystemMessage &amp;&amp;
                (message.profile === first.profile);
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">mapMessageToBatch</span>(<span class="hljs-params">batch, messages</span>) </span>{
            messages.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">message</span>) </span>{
                messageBatchMap[message.sysID] = batch;
            });
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">coalesce</span>(<span class="hljs-params">batchIndex</span>) </span>{
            <span class="hljs-keyword">var</span> curr = batches[batchIndex];
            <span class="hljs-keyword">var</span> remove = batchIndex + <span class="hljs-number">1</span>;
            <span class="hljs-keyword">var</span> next = batches[remove];
            <span class="hljs-keyword">if</span> (!next)
                <span class="hljs-keyword">return</span>;
            <span class="hljs-keyword">if</span> (!isBatchable(curr, next.firstMessage))
                <span class="hljs-keyword">return</span>;
            <span class="hljs-keyword">if</span> (!isInRange(curr.lastMessage, next.firstMessage))
                <span class="hljs-keyword">return</span>;
            batches.splice(remove, <span class="hljs-number">1</span>);
            curr.messages = curr.messages.concat(next.messages);
            mapMessageToBatch(curr, next.messages);
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">split</span>(<span class="hljs-params">batchIndex, messageIndex</span>) </span>{
            <span class="hljs-keyword">var</span> batch = batches[batchIndex];
            insertNewBatch(batchIndex + <span class="hljs-number">1</span>, batch.messages.slice(messageIndex));
            batch.messages = batch.messages.slice(<span class="hljs-number">0</span>, messageIndex);
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">insertNewBatch</span>(<span class="hljs-params">batchIndex, messages</span>) </span>{
            <span class="hljs-keyword">var</span> batch = <span class="hljs-keyword">new</span> MessageBatch(messages, isLastBatchFn);
            batches.splice(batchIndex, <span class="hljs-number">0</span>, batch);
            mapMessageToBatch(batch, messages);
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isInRange</span>(<span class="hljs-params">message1, message2</span>) </span>{
            <span class="hljs-keyword">return</span> message1.timestamp + MINIMUM_TIME &gt;= message2.timestamp;
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">removeFromBatch</span>(<span class="hljs-params">batch, messageIndex</span>) </span>{
            <span class="hljs-keyword">var</span> messages = batch.messages;
            messages.splice(messageIndex, <span class="hljs-number">1</span>);
            <span class="hljs-keyword">var</span> batchIndex = batches.indexOf(batch);
            <span class="hljs-keyword">var</span> length = messages.length;
            <span class="hljs-keyword">if</span> (length === <span class="hljs-number">0</span>) {
                batches.splice(batchIndex, <span class="hljs-number">1</span>);
                <span class="hljs-keyword">return</span>;
            }
            <span class="hljs-keyword">if</span> (messageIndex === length)
                <span class="hljs-keyword">return</span>;
            <span class="hljs-keyword">var</span> prev = messages[messageIndex - <span class="hljs-number">1</span>];
            <span class="hljs-keyword">if</span> (!prev)
                <span class="hljs-keyword">return</span>;
            <span class="hljs-keyword">var</span> curr = messages[messageIndex];
            <span class="hljs-keyword">if</span> (isInRange(prev, curr))
                <span class="hljs-keyword">return</span>;
            split(batchIndex, messageIndex);
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">remove</span>(<span class="hljs-params">message</span>) </span>{
            <span class="hljs-keyword">var</span> batch = messageBatchMap[message.sysID];
            <span class="hljs-keyword">if</span> (!batch)
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; batch.messages.length; ++i) {
                <span class="hljs-keyword">if</span> (batch.messages[i].sysID === message.sysID) {
                    removeFromBatch(batch, i);
                    <span class="hljs-keyword">break</span>;
                }
            }
            <span class="hljs-keyword">delete</span> messageBatchMap[message.sysID];
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isSeparator</span>(<span class="hljs-params">index</span>) </span>{
            <span class="hljs-keyword">var</span> currTimestamp = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(batches[index].timestamp);
            <span class="hljs-keyword">if</span> (index === <span class="hljs-number">0</span>) {
                <span class="hljs-keyword">var</span> now = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>();
                <span class="hljs-keyword">return</span> getDayCount(now) - getDayCount(currTimestamp) &gt; <span class="hljs-number">0</span>;
            }
            <span class="hljs-keyword">var</span> prevTimestamp = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(batches[index - <span class="hljs-number">1</span>].timestamp);
            <span class="hljs-keyword">var</span> hasYear = currTimestamp.getFullYear() - prevTimestamp.getFullYear() &gt; <span class="hljs-number">0</span>;
            <span class="hljs-keyword">var</span> hasMonth = currTimestamp.getMonth() - prevTimestamp.getMonth() &gt; <span class="hljs-number">0</span>;
            <span class="hljs-keyword">var</span> hasDay = currTimestamp.getDate() - prevTimestamp.getDate() &gt; <span class="hljs-number">0</span>;
            <span class="hljs-keyword">return</span> hasYear || hasMonth || hasDay;
        }
        <span class="hljs-keyword">return</span> {
            get batches() {
                <span class="hljs-keyword">return</span> batches;
            },
            get lastBatch() {
                <span class="hljs-keyword">return</span> lastBatch();
            },
            <span class="hljs-attr">isSeparator</span>: isSeparator,
            <span class="hljs-attr">addMessage</span>: add,
            <span class="hljs-attr">removeMessage</span>: remove
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">add</span>(<span class="hljs-params">message, results</span>) </span>{
        <span class="hljs-keyword">if</span> (!message.conversationID)
            <span class="hljs-keyword">return</span> results;
        <span class="hljs-keyword">var</span> batcher = messageBatchers[message.conversationID];
        <span class="hljs-keyword">if</span> (!batcher)
            batcher = messageBatchers[message.conversationID] = <span class="hljs-keyword">new</span> MessageBatcher();
        <span class="hljs-keyword">var</span> added = batcher.addMessage(message);
        <span class="hljs-keyword">if</span> (added) {
            results.added.push(message);
            <span class="hljs-keyword">if</span> (message.profile !== liveProfileID || message.isSystemMessage) {
                ariaMessages[message.conversationID] = ariaMessages[message.conversationID] || [];
                ariaMessages[message.conversationID].push(message);
                ariaMessages[message.conversationID].sort(compare);
            }
        } <span class="hljs-keyword">else</span> {
            results.existing.push(message);
        }
        <span class="hljs-keyword">return</span> results;
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">remove</span>(<span class="hljs-params">message, results</span>) </span>{
        <span class="hljs-keyword">var</span> batcher = messageBatchers[message.conversationID];
        <span class="hljs-keyword">if</span> (!batcher)
            <span class="hljs-keyword">return</span> results;
        <span class="hljs-keyword">var</span> removed = batcher.removeMessage(message);
        <span class="hljs-keyword">if</span> (removed)
            results.push(message);
        <span class="hljs-keyword">return</span> results;
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">callActionFn</span>(<span class="hljs-params">messages, isPlaceholder, results, fn</span>) </span>{
        <span class="hljs-keyword">if</span> (angular.isArray(messages)) {
            messages
                .sort(compare)
                .forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">message</span>) </span>{
                    message.isPlaceholder = isPlaceholder;
                    fn(message, results);
                });
            <span class="hljs-keyword">return</span> results;
        }
        messages.isPlaceholder = isPlaceholder;
        <span class="hljs-keyword">return</span> fn(messages, results);
    }
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">addMessages</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">messages, doNotUpdate</span>) </span>{
            <span class="hljs-keyword">return</span> callActionFn(messages, doNotUpdate, {
                <span class="hljs-attr">added</span>: [],
                <span class="hljs-attr">existing</span>: []
            }, add);
        },
        <span class="hljs-attr">removeMessages</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">messages</span>) </span>{
            <span class="hljs-keyword">return</span> callActionFn(messages, <span class="hljs-literal">undefined</span>, [], remove);
        },
        <span class="hljs-attr">getBatcher</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">conversationID</span>) </span>{
            <span class="hljs-keyword">var</span> batcher = messageBatchers[conversationID];
            <span class="hljs-keyword">if</span> (!batcher)
                batcher = messageBatchers[conversationID] = <span class="hljs-keyword">new</span> MessageBatcher();
            <span class="hljs-keyword">return</span> batcher;
        },
        <span class="hljs-attr">removeMessageBatcher</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">conversationID</span>) </span>{
            <span class="hljs-keyword">delete</span> messageBatchers[conversationID];
        },
        <span class="hljs-attr">clearAriaMessages</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">conversationID</span>) </span>{
            ariaMessages[conversationID] = [];
        },
        <span class="hljs-attr">getAriaMessages</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">conversationID, count</span>) </span>{
            <span class="hljs-keyword">if</span> (angular.isUndefined(count))
                count = <span class="hljs-number">1</span>;
            count = -<span class="hljs-built_in">Math</span>.abs(count);
            ariaMessages[conversationID] = ariaMessages[conversationID] || [];
            <span class="hljs-keyword">return</span> ariaMessages[conversationID].slice(count);
        },
        <span class="hljs-attr">getLastMessage</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">conversationID</span>) </span>{
            <span class="hljs-keyword">var</span> batcher = <span class="hljs-keyword">this</span>.getBatcher(conversationID);
            <span class="hljs-keyword">var</span> lastBatch = batcher.lastBatch;
            <span class="hljs-keyword">return</span> lastBatch &amp;&amp; lastBatch.lastMessage;
        },
        <span class="hljs-attr">getFirstMessage</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">conversationID</span>) </span>{
            <span class="hljs-keyword">var</span> batcher = <span class="hljs-keyword">this</span>.getBatcher(conversationID);
            <span class="hljs-keyword">var</span> firstBatch = batcher.batches[<span class="hljs-number">0</span>];
            <span class="hljs-keyword">return</span> firstBatch &amp;&amp; firstBatch.firstMessage;
        },
        <span class="hljs-attr">_wipeOut_</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
            messageBatchers = {};
        }
    }
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/message/service.unreadCount.js */</span>
angular.module(<span class="hljs-string">'sn.connect.message'</span>).service(<span class="hljs-string">'unreadCountService'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">conversationPersister, messageBatcherService</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    <span class="hljs-keyword">var</span> unreadCountObjects = {};

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setCount</span>(<span class="hljs-params">conversationID, lastViewed, count</span>) </span>{
        <span class="hljs-keyword">if</span> (!conversationID)
            <span class="hljs-keyword">return</span>;
        <span class="hljs-keyword">if</span> (angular.isUndefined(lastViewed))
            <span class="hljs-keyword">return</span>;
        unreadCountObjects[conversationID] = {
            <span class="hljs-attr">timestamp</span>: lastViewed,
            <span class="hljs-attr">count</span>: count
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">resetCount</span>(<span class="hljs-params">conversationID, doNotPersist</span>) </span>{
        <span class="hljs-keyword">var</span> batches = messageBatcherService.getBatcher(conversationID).batches;
        <span class="hljs-keyword">var</span> lastMessageTime = (batches.length &gt; <span class="hljs-number">0</span>) ?
            batches[batches.length - <span class="hljs-number">1</span>].lastMessage.timestamp :
            <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().getTime();
        <span class="hljs-keyword">var</span> old = unreadCountObjects[conversationID];
        unreadCountObjects[conversationID] = {
            <span class="hljs-attr">timestamp</span>: lastMessageTime
        };
        <span class="hljs-keyword">if</span> (doNotPersist)
            <span class="hljs-keyword">return</span>;
        <span class="hljs-keyword">if</span> (old &amp;&amp; (old.timestamp === lastMessageTime))
            <span class="hljs-keyword">return</span>;
        conversationPersister.lastViewed(conversationID, lastMessageTime);
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getCount</span>(<span class="hljs-params">conversationID</span>) </span>{
        <span class="hljs-keyword">var</span> unreadCountObject = unreadCountObjects[conversationID];
        <span class="hljs-keyword">if</span> (!unreadCountObject)
            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
        <span class="hljs-keyword">var</span> batches = messageBatcherService.getBatcher(conversationID).batches;
        <span class="hljs-keyword">var</span> count = <span class="hljs-number">0</span>;
        batches.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">batch</span>) </span>{
            <span class="hljs-keyword">if</span> (count &gt; <span class="hljs-number">0</span>) {
                count += batch.messages.length;
                <span class="hljs-keyword">return</span>;
            }
            <span class="hljs-keyword">if</span> (unreadCountObject.timestamp &lt; batch.lastMessage.timestamp) {
                <span class="hljs-keyword">var</span> messages = batch.messages;
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; messages.length; ++i) {
                    <span class="hljs-keyword">if</span> (unreadCountObject.timestamp &lt; messages[i].timestamp) {
                        count = messages.length - i;
                        <span class="hljs-keyword">break</span>;
                    }
                }
            }
        });
        <span class="hljs-keyword">return</span> unreadCountObject.count ?
            <span class="hljs-built_in">Math</span>.max(count, unreadCountObject.count) :
            count;
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getTimestamp</span>(<span class="hljs-params">conversationID</span>) </span>{
        <span class="hljs-keyword">var</span> unreadCounts = unreadCountObjects[conversationID];
        <span class="hljs-keyword">return</span> unreadCounts ?
            unreadCounts.timestamp :
            <span class="hljs-number">0</span>;
    }
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">set</span>: setCount,
        <span class="hljs-attr">get</span>: getCount,
        <span class="hljs-attr">reset</span>: resetCount,
        <span class="hljs-attr">getLastTimestamp</span>: getTimestamp
    };
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/message/service.messages.js */</span>
angular.module(<span class="hljs-string">'sn.connect.message'</span>).value(<span class="hljs-string">'CONNECT_CONTEXT'</span>, <span class="hljs-built_in">Date</span>.now() + <span class="hljs-string">""</span> + <span class="hljs-built_in">Math</span>.random() * <span class="hljs-built_in">Math</span>.pow(<span class="hljs-number">10</span>, <span class="hljs-number">19</span>));
angular.module(<span class="hljs-string">'sn.connect.message'</span>).service(<span class="hljs-string">"messageService"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">
    $q, $rootScope, snHttp, amb, userID, liveProfileID, messageFactory, unreadCountService, messageBatcherService,
    uploadAttachmentService, CONNECT_CONTEXT, snNotification, $timeout, isLoggedIn</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">var</span> CONVERSATIONS_URL = isLoggedIn ? <span class="hljs-string">"/api/now/connect/conversations/"</span> : <span class="hljs-string">"/api/now/connect/support/anonymous/conversations/"</span>;
    <span class="hljs-keyword">var</span> context = CONNECT_CONTEXT;
    <span class="hljs-keyword">var</span> allHistoryLoaded = {};
    <span class="hljs-keyword">var</span> watches = [];
    amb.getChannel(<span class="hljs-string">"/connect/message/"</span> + userID).subscribe(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>) </span>{
        addRawMessage(response.data);
    });
    amb.connect();

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">retrieveMessages</span>(<span class="hljs-params">conversation, time</span>) </span>{
        <span class="hljs-keyword">if</span> (!conversation)
            <span class="hljs-keyword">return</span> $q.when([]);
        <span class="hljs-keyword">if</span> (!conversation.sysID)
            <span class="hljs-keyword">return</span> $q.when([]);
        <span class="hljs-keyword">if</span> (conversation.isPending)
            <span class="hljs-keyword">return</span> $q.when([]);
        <span class="hljs-keyword">if</span> (time &amp;&amp; allHistoryLoaded[conversation.sysID])
            <span class="hljs-keyword">return</span> $q.when([]);
        <span class="hljs-keyword">var</span> conversationID = conversation.sysID;
        <span class="hljs-keyword">var</span> url = CONVERSATIONS_URL + conversationID + <span class="hljs-string">"/messages"</span>;
        <span class="hljs-keyword">if</span> (time)
            url += <span class="hljs-string">"?before="</span> + time;
        <span class="hljs-keyword">return</span> snHttp.get(url).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>) </span>{
            <span class="hljs-keyword">var</span> processedMessages = [];
            angular.forEach(response.data.result, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">messageData</span>) </span>{
                processedMessages.push(messageFactory.fromObject(messageData));
            });
            <span class="hljs-keyword">if</span> (time &amp;&amp; processedMessages.length === <span class="hljs-number">0</span>)
                allHistoryLoaded[conversationID] = <span class="hljs-literal">true</span>;
            conversation.restricted = conversation.restricted || <span class="hljs-literal">false</span>;
            <span class="hljs-keyword">var</span> added = messageBatcherService.addMessages(processedMessages).added;
            $rootScope.$broadcast(<span class="hljs-string">'sn.TimeAgo.tick'</span>);
            <span class="hljs-keyword">return</span> added;
        }, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>) </span>{
            <span class="hljs-keyword">if</span> (response.status === <span class="hljs-number">403</span>)
                conversation.restricted = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">return</span> $q.reject(response)
        });
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addRawMessage</span>(<span class="hljs-params">messageData</span>) </span>{
        <span class="hljs-keyword">var</span> message = messageFactory.fromObject(messageData);
        <span class="hljs-keyword">var</span> isOldMessage = unreadCountService.getLastTimestamp(message.conversationID) &gt; message.timestamp;
        $rootScope.$apply(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
            messageBatcherService.addMessages(message);
            $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                $rootScope.$broadcast(<span class="hljs-string">'sn.TimeAgo.tick'</span>);
            }, <span class="hljs-number">0</span>, <span class="hljs-literal">false</span>);
        });
        <span class="hljs-keyword">if</span> (isOldMessage)
            <span class="hljs-keyword">return</span> message;
        <span class="hljs-keyword">if</span> (message.profileID === liveProfileID)
            <span class="hljs-keyword">return</span> message;
        angular.forEach(watches, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">watch</span>) </span>{
            watch(message);
        });
        <span class="hljs-keyword">return</span> message;
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">send</span>(<span class="hljs-params">message</span>) </span>{
        messageBatcherService.addMessages(message);
        unreadCountService.reset(message.conversationID, <span class="hljs-literal">true</span>);
        <span class="hljs-keyword">return</span> snHttp.post(CONVERSATIONS_URL + message.conversationID + <span class="hljs-string">"/messages"</span>, {
            <span class="hljs-attr">group</span>: message.conversationID,
            <span class="hljs-attr">message</span>: message.text,
            <span class="hljs-attr">reflected_field</span>: message.reflectedField || <span class="hljs-string">"comments"</span>,
            <span class="hljs-attr">attachments</span>: message.attachmentSysIDs,
            <span class="hljs-attr">context</span>: context
        }).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>) </span>{
            <span class="hljs-keyword">var</span> newMessage = messageFactory.fromObject(response.data.result);
            $rootScope.$evalAsync(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                messageBatcherService.removeMessages(message);
                messageBatcherService.addMessages(newMessage);
                unreadCountService.reset(message.conversationID);
            });
            <span class="hljs-keyword">return</span> newMessage;
        }, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>) </span>{
            <span class="hljs-keyword">if</span> (response.status === <span class="hljs-number">403</span>)
                snNotification.show(<span class="hljs-string">"error"</span>, response.data.result);
            <span class="hljs-keyword">return</span> $q.reject(response)
        });
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">uploadAttachments</span>(<span class="hljs-params">conversation, fileList</span>) </span>{
        <span class="hljs-keyword">if</span> (fileList.length === <span class="hljs-number">0</span>)
            <span class="hljs-keyword">return</span> $q.when({});
        <span class="hljs-keyword">var</span> files = [];
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; fileList.length; ++i)
            files.push(fileList[i]);
        <span class="hljs-keyword">var</span> message = messageFactory.newPendingAttachmentMessage(conversation, files);
        messageBatcherService.addMessages(message);
        unreadCountService.reset(message.conversationID, <span class="hljs-literal">true</span>);
        <span class="hljs-keyword">return</span> uploadAttachmentService.attachFiles(conversation, files, {
            <span class="hljs-attr">error</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">file</span>) </span>{
                $rootScope.$broadcast(<span class="hljs-string">"connect.conversation.attachment_errors"</span>, {
                    <span class="hljs-attr">conversation</span>: conversation,
                    <span class="hljs-attr">errors</span>: [file.name + <span class="hljs-string">": "</span> + file.error]
                });
            }
        }).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">files</span>) </span>{
            <span class="hljs-keyword">var</span> array = files.filter(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">file</span>) </span>{
                <span class="hljs-keyword">return</span> !file.error;
            });
            <span class="hljs-keyword">if</span> (array.length === <span class="hljs-number">0</span>) {
                messageBatcherService.removeMessages(message);
                <span class="hljs-keyword">return</span>;
            }
            message.attachmentSysIDs = array.map(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">file</span>) </span>{
                <span class="hljs-keyword">return</span> file.sysID;
            });
            <span class="hljs-keyword">var</span> text = <span class="hljs-string">""</span>;
            array.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">file</span>) </span>{
                text += <span class="hljs-string">"File: "</span> + file.name + <span class="hljs-string">"\n"</span>;
            });
            message.text = text.trim();
            <span class="hljs-keyword">return</span> message;
        });
    }
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">retrieveMessages</span>: retrieveMessages,
        <span class="hljs-attr">uploadAttachments</span>: uploadAttachments,
        <span class="hljs-attr">send</span>: send,
        <span class="hljs-attr">watch</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">callback</span>) </span>{
            watches.push(callback)
        }
    };
});;;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/document/js_includes_connect_document.js */</span>
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/document/_module.js */</span>
angular.module(<span class="hljs-string">"sn.connect.document"</span>, []);;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/document/directive.snLinkCardList.js */</span>
angular.module(<span class="hljs-string">'sn.connect.document'</span>).directive(<span class="hljs-string">'snLinkCardList'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">getTemplateUrl</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
        <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">templateUrl</span>: getTemplateUrl(<span class="hljs-string">'snLinkCardList.xml'</span>),
        <span class="hljs-attr">scope</span>: {
            <span class="hljs-attr">links</span>: <span class="hljs-string">'='</span>
        },
        <span class="hljs-attr">controller</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$scope</span>) </span>{}
    }
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/document/service.documentLinkMatcher.js */</span>
angular.module(<span class="hljs-string">'sn.connect.document'</span>).service(<span class="hljs-string">'documentLinkMatcher'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-meta">    "use strict"</span>;

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">match</span>(<span class="hljs-params">str</span>) </span>{
        <span class="hljs-keyword">if</span> (str.match) {
            <span class="hljs-keyword">return</span> str.match(<span class="hljs-regexp">/([\w_]+).do\?sys_id=(\w{32})/</span>);
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">isLink</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">href</span>) </span>{
            <span class="hljs-keyword">return</span> match(href) !== <span class="hljs-literal">null</span>;
        },
        <span class="hljs-attr">getRecordData</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">href</span>) </span>{
            <span class="hljs-keyword">var</span> linkMatch = match(href);
            <span class="hljs-keyword">if</span> (!linkMatch)
                <span class="hljs-keyword">return</span> {}
            <span class="hljs-keyword">return</span> {
                <span class="hljs-attr">table</span>: linkMatch[<span class="hljs-number">1</span>],
                <span class="hljs-attr">sysID</span>: linkMatch[<span class="hljs-number">2</span>]
            }
        }
    }
});
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/document/service.documents.js */</span>
angular.module(<span class="hljs-string">'sn.connect.document'</span>).service(<span class="hljs-string">'documentsService'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">
    $rootScope, $q, nowServer, snHttp, snCustomEvent, documentFactory, snConversationAsideHistory, inFrameSet</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    <span class="hljs-keyword">var</span> documents = {};

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getDocument</span>(<span class="hljs-params">documentsSysID</span>) </span>{
        <span class="hljs-keyword">return</span> documents[documentsSysID];
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">retrieve</span>(<span class="hljs-params">table, sysId</span>) </span>{
        <span class="hljs-keyword">if</span> (!table || !sysId) {
            <span class="hljs-keyword">var</span> deferred = $q.defer();
            deferred.reject(<span class="hljs-string">"Invalid document parameters -- table: "</span> + table + <span class="hljs-string">" sysId: "</span> + sysId);
            <span class="hljs-keyword">return</span> deferred.promise
        }
        <span class="hljs-keyword">var</span> src = nowServer.getURL(<span class="hljs-string">'record_data'</span>, <span class="hljs-string">'table='</span> + table + <span class="hljs-string">'&amp;sys_id='</span> + sysId);
        <span class="hljs-keyword">return</span> snHttp.get(src).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>) </span>{
            <span class="hljs-keyword">var</span> data = response.data;
            <span class="hljs-keyword">if</span> (!data.sys_id)
                <span class="hljs-keyword">return</span>;
            <span class="hljs-keyword">return</span> documents[data.sys_id] = documentFactory.fromObject(data);
        });
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">show</span>(<span class="hljs-params">table, sysID</span>) </span>{
        <span class="hljs-keyword">if</span> (!inFrameSet) {
            $rootScope.$broadcast(<span class="hljs-string">"sn.aside.trigger_control"</span>, <span class="hljs-string">"record"</span>);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">var</span> url = (table === <span class="hljs-string">'vtb_board'</span>) ?
                <span class="hljs-string">'/$vtb.do?sysparm_board='</span> + sysID :
                <span class="hljs-string">'/'</span> + table + <span class="hljs-string">'.do?sys_id='</span> + sysID;
            snCustomEvent.fire(<span class="hljs-string">'glide:nav_open_url'</span>, {
                <span class="hljs-attr">url</span>: url,
                <span class="hljs-attr">openInForm</span>: <span class="hljs-literal">true</span>
            });
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">create</span>(<span class="hljs-params">conversation, data</span>) </span>{
        conversation.pendingRecord = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">var</span> redirectUrl = <span class="hljs-built_in">encodeURIComponent</span>(<span class="hljs-string">'/$connect_record_created.do?sysparm_conversation='</span> + conversation.sysID +
            <span class="hljs-string">'&amp;sysparm_table='</span> + data.table +
            <span class="hljs-string">'&amp;sysparm_sys_id=$sys_id'</span> +
            <span class="hljs-string">'&amp;sysparm_nostack=yes'</span>);
        <span class="hljs-keyword">var</span> url = data.table + <span class="hljs-string">'.do?sys_id=-1'</span>;
        <span class="hljs-keyword">if</span> (data.view)
            url += (<span class="hljs-string">'&amp;sysparm_view='</span> + data.view);
        url += (<span class="hljs-string">'&amp;sysparm_goto_url='</span> + redirectUrl + <span class="hljs-string">'&amp;sysparm_query='</span> + data.query + <span class="hljs-string">"&amp;sysparm_clear_stack=true"</span>);
        <span class="hljs-keyword">if</span> (inFrameSet) {
            snCustomEvent.fire(<span class="hljs-string">'glide:nav_open_url'</span>, {
                <span class="hljs-attr">url</span>: url,
                <span class="hljs-attr">openInForm</span>: <span class="hljs-literal">true</span>
            })
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">var</span> view = {
                <span class="hljs-attr">template</span>: <span class="hljs-string">'&lt;sn-aside-frame name="pending_record" url="/'</span> + url + <span class="hljs-string">'" title="New Record"&gt;&lt;/sn-aside-frame&gt;'</span>,
                <span class="hljs-attr">width</span>: <span class="hljs-string">'50%'</span>,
                <span class="hljs-attr">cacheKey</span>: conversation.sysID + <span class="hljs-string">'.pending_record.'</span> + data.table
            };
            $rootScope.$broadcast(<span class="hljs-string">'sn.aside.open'</span>, view, <span class="hljs-string">"50%"</span>);
            snConversationAsideHistory.saveHistory(conversation.sysID, view);
        }
    }
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">getDocument</span>: getDocument,
        <span class="hljs-attr">retrieve</span>: retrieve,
        <span class="hljs-attr">show</span>: show,
        <span class="hljs-attr">create</span>: create
    };
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/document/factory.Document.js */</span>
angular.module(<span class="hljs-string">'sn.connect.document'</span>).factory(<span class="hljs-string">'documentFactory'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">liveLinkFactory</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getFieldByName</span>(<span class="hljs-params">fields, name</span>) </span>{
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; fields.length; i++)
            <span class="hljs-keyword">if</span> (fields[i].name == name)
                <span class="hljs-keyword">return</span> fields[i];
        <span class="hljs-keyword">return</span> {};
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fromObject</span>(<span class="hljs-params">data</span>) </span>{
        <span class="hljs-keyword">var</span> fields = data.fields || [];
        <span class="hljs-keyword">var</span> sysID = data.sys_id;
        <span class="hljs-keyword">var</span> table = data.table;
        <span class="hljs-keyword">var</span> number = getFieldByName(fields, <span class="hljs-string">'number'</span>).displayValue;
        <span class="hljs-keyword">var</span> url = (data.table === <span class="hljs-string">"vtb_board"</span>) ?
            <span class="hljs-string">'/'</span> + <span class="hljs-string">"$vtb"</span> + <span class="hljs-string">'.do?sysparm_board='</span> + data.sys_id :
            <span class="hljs-string">'/'</span> + data.table + <span class="hljs-string">'.do?sys_id='</span> + data.sys_id + <span class="hljs-string">'&amp;sysparm_nameofstack='</span> + data.sys_id;
        <span class="hljs-keyword">var</span> link = liveLinkFactory.linkObject(url);
        <span class="hljs-keyword">return</span> {
            get table() {
                <span class="hljs-keyword">return</span> table;
            },
            get sysID() {
                <span class="hljs-keyword">return</span> sysID;
            },
            get fields() {
                <span class="hljs-keyword">return</span> fields;
            },
            get number() {
                <span class="hljs-keyword">return</span> number;
            },
            get link() {
                <span class="hljs-keyword">return</span> link;
            }
        };
    }
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">fromObject</span>: fromObject
    }
});;;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/util/js_includes_connect_util.js */</span>
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/util/_module.js */</span>
angular.module(<span class="hljs-string">"sn.connect.util"</span>, [<span class="hljs-string">"sn.connect.resource"</span>, <span class="hljs-string">"sn.common.attachments"</span>, <span class="hljs-string">"sn.common.accessibility"</span>]);;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/util/directive.connectConversationBarToggle.js */</span>
angular.module(<span class="hljs-string">'sn.connect'</span>).directive(<span class="hljs-string">'connectConversationBarToggle'</span>, [
    <span class="hljs-string">'getTemplateUrl'</span>,
    <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">getTemplateUrl</span>) </span>{
<span class="hljs-meta">        "use strict"</span>;
        <span class="hljs-keyword">return</span> {
            <span class="hljs-attr">templateUrl</span>: getTemplateUrl(<span class="hljs-string">'connectConversationBarToggle.xml'</span>),
            <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
            <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">controller</span>: [<span class="hljs-string">'$scope'</span>, <span class="hljs-string">'paneManager'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$scope, paneManager</span>) </span>{
                $scope.unreadMessages = <span class="hljs-number">0</span>;
                $scope.state = <span class="hljs-string">"closed"</span>;
                $scope.toggleConversationList = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    paneManager.togglePane(<span class="hljs-string">'connect:conversation_list'</span>, <span class="hljs-literal">true</span>);
                };
                CustomEvent.observe(<span class="hljs-string">"connect:conversation_list:state"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">state</span>) </span>{
                    $scope.state = state;
                });
                CustomEvent.observe(<span class="hljs-string">'connect:message_notification.update'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">val</span>) </span>{
                    $scope.unreadMessages = val;
                });
                $scope.formattedUnreadCount = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">count</span>) </span>{
                    <span class="hljs-keyword">return</span> (count &lt;= <span class="hljs-number">99</span>) ? count : <span class="hljs-string">"99+"</span>;
                }
            }],
            <span class="hljs-attr">link</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">scope, element</span>) </span>{
                scope.$on(<span class="hljs-string">'pane.collapsed'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$event, position, isCollapsed, autoFocus</span>) </span>{
                    <span class="hljs-keyword">if</span> (isCollapsed &amp;&amp; autoFocus) {
                        element.focus();
                    }
                });
            }
        }
    }
]);;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/util/directive.snConnectHeader.js */</span>
angular.module(<span class="hljs-string">'sn.connect'</span>).directive(<span class="hljs-string">'snConnectHeader'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">getTemplateUrl, activeConversation</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">templateUrl</span>: getTemplateUrl(<span class="hljs-string">'snConnectHeader.xml'</span>),
        <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
        <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">controller</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$scope</span>) </span>{
            <span class="hljs-keyword">var</span> asideTab = <span class="hljs-string">'members'</span>;
            $scope.toggleAside = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">side</span>) </span>{
                $scope.$root.$broadcast(<span class="hljs-string">'connect.pane.toggle.'</span> + side);
                <span class="hljs-keyword">if</span> (side === <span class="hljs-string">'right'</span>) {
                    $scope.$root.$broadcast(<span class="hljs-string">'sn.aside.trigger_control'</span>, asideTab);
                }
            };
            $scope.$on(<span class="hljs-string">'sn.aside.trigger_control'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event, newAsideTab</span>) </span>{
                asideTab = newAsideTab;
            });
        }
    };
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/util/directive.snConnectContent.js */</span>
angular.module(<span class="hljs-string">'sn.connect'</span>).directive(<span class="hljs-string">'snConnectContent'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">getTemplateUrl</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">templateUrl</span>: getTemplateUrl(<span class="hljs-string">'snConnectContent.xml'</span>),
        <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
        <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">transclude</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">link</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">scope</span>) </span>{
            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">togglePane</span>(<span class="hljs-params">pane</span>) </span>{
                <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    <span class="hljs-keyword">if</span> (scope.activePane !== pane)
                        scope.activePane = pane;
                    <span class="hljs-keyword">else</span>
                        <span class="hljs-keyword">delete</span> scope.activePane;
                };
            }

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">closePane</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">delete</span> scope.activePane;
            }
            scope.$on(<span class="hljs-string">'connect.pane.toggle.left'</span>, togglePane(<span class="hljs-string">'left'</span>));
            scope.$on(<span class="hljs-string">'connect.pane.toggle.right'</span>, togglePane(<span class="hljs-string">'right'</span>));
            scope.$on(<span class="hljs-string">'connect.pane.close'</span>, closePane);
        }
    };
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/util/directive.snActions.js */</span>
angular.module(<span class="hljs-string">'sn.connect.util'</span>).directive(<span class="hljs-string">'snActions'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">getTemplateUrl</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
        <span class="hljs-attr">templateUrl</span>: getTemplateUrl(<span class="hljs-string">"snActions.xml"</span>),
        <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span>
    };
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/util/directive.snActionsMenu.js */</span>
angular.module(<span class="hljs-string">"sn.connect.util"</span>).directive(<span class="hljs-string">"snActionsMenu"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">getTemplateUrl</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
        <span class="hljs-attr">templateUrl</span>: getTemplateUrl(<span class="hljs-string">"snActionsMenu.xml"</span>),
        <span class="hljs-attr">scope</span>: {
            <span class="hljs-attr">conversation</span>: <span class="hljs-string">"="</span>
        },
        <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">link</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">scope, elem</span>) </span>{
            <span class="hljs-keyword">if</span> (elem.hideFix)
                elem.hideFix();
        },
        <span class="hljs-attr">controller</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$scope, $timeout, $rootScope</span>) </span>{
            $scope.runAction = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$event, chatAction</span>) </span>{
                <span class="hljs-keyword">if</span> (chatAction.isActive) {
                    $event.preventDefault();
                    $event.stopPropagation();
                    <span class="hljs-keyword">return</span>;
                }
                <span class="hljs-keyword">if</span> (chatAction.requiresArgs) {
                    $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                        $scope.conversation.chatActions.currentAction = chatAction;
                        $scope.$emit(<span class="hljs-string">"connect.chat_action.require_options"</span>, $scope.conversation);
                    }, <span class="hljs-number">0</span>, <span class="hljs-literal">false</span>)
                } <span class="hljs-keyword">else</span> {
                    chatAction.trigger($scope.conversation);
                }
            };
            $scope.addAttachment = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                $rootScope.$broadcast(<span class="hljs-string">"connect.attachment_dialog.open"</span>, $scope.conversation.sysID);
            }
        }
    }
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/util/directive.snDropTargetPopup.js */</span>
angular.module(<span class="hljs-string">"sn.connect.util"</span>).directive(<span class="hljs-string">"snDropTargetPopup"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">getTemplateUrl, $window</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">restrict</span>: <span class="hljs-string">"E"</span>,
        <span class="hljs-attr">templateUrl</span>: getTemplateUrl(<span class="hljs-string">'snDropTargetPopup.xml'</span>),
        <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">scope</span>: {
            <span class="hljs-attr">conversation</span>: <span class="hljs-string">"="</span>
        },
        <span class="hljs-attr">link</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">scope, element</span>) </span>{
            <span class="hljs-keyword">var</span> messageElement = element.find(<span class="hljs-string">".drop-target-message"</span>);
            scope.showDropTarget = <span class="hljs-literal">false</span>;
            scope.$on(<span class="hljs-string">"connect.drop_target_popup.show"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e, conversationID</span>) </span>{
                <span class="hljs-keyword">if</span> ($<span class="hljs-built_in">window</span>.navigator.userAgent.indexOf(<span class="hljs-string">"Firefox"</span>) &gt; <span class="hljs-number">-1</span>)
                    <span class="hljs-keyword">return</span>;
                <span class="hljs-keyword">if</span> (conversationID !== scope.conversation.sysID)
                    <span class="hljs-keyword">return</span>;
                scope.showDropTarget = <span class="hljs-literal">true</span>;
                element.css({
                    <span class="hljs-string">"z-index"</span>: <span class="hljs-number">10</span>
                });
                element.velocity({
                    <span class="hljs-attr">opacity</span>: <span class="hljs-number">1</span>
                }, {
                    <span class="hljs-attr">duration</span>: <span class="hljs-number">300</span>,
                    <span class="hljs-attr">easing</span>: <span class="hljs-string">"easeOutCubic"</span>
                });
                messageElement.velocity({
                    <span class="hljs-string">"padding-top"</span>: <span class="hljs-string">"0px"</span>
                }, {
                    <span class="hljs-attr">duration</span>: <span class="hljs-number">300</span>,
                    <span class="hljs-attr">easing</span>: <span class="hljs-string">"easeOutCubic"</span>
                });
            });
            scope.$on(<span class="hljs-string">"connect.drop_target_popup.hide"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e, conversationID</span>) </span>{
                <span class="hljs-keyword">if</span> ($<span class="hljs-built_in">window</span>.navigator.userAgent.indexOf(<span class="hljs-string">"Firefox"</span>) &gt; <span class="hljs-number">-1</span>)
                    <span class="hljs-keyword">return</span>;
                <span class="hljs-keyword">if</span> (conversationID !== scope.conversation.sysID)
                    <span class="hljs-keyword">return</span>;
                element.velocity({
                    <span class="hljs-attr">opacity</span>: <span class="hljs-number">0</span>
                }, {
                    <span class="hljs-attr">duration</span>: <span class="hljs-number">300</span>,
                    <span class="hljs-attr">easing</span>: <span class="hljs-string">"easeOutCubic"</span>,
                    <span class="hljs-attr">complete</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                        scope.showDropTarget = <span class="hljs-literal">false</span>;
                        element.css({
                            <span class="hljs-string">"z-index"</span>: <span class="hljs-number">-1</span>
                        })
                    }
                });
                messageElement.velocity({
                    <span class="hljs-attr">paddingTop</span>: <span class="hljs-string">"40px"</span>
                }, {
                    <span class="hljs-attr">duration</span>: <span class="hljs-number">300</span>,
                    <span class="hljs-attr">easing</span>: <span class="hljs-string">"easeOutCubic"</span>
                });
            });
        }
    }
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/util/directive.snLoadingBar.js */</span>
angular.module(<span class="hljs-string">'sn.connect.util'</span>).directive(<span class="hljs-string">'snLoadingBar'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
        <span class="hljs-attr">template</span>: <span class="hljs-string">"&lt;div class='sn-loading-bar'&gt;&lt;/div&gt;"</span>,
        <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">link</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">scope, element</span>) </span>{
            scope.$on(<span class="hljs-string">"connect.loading-bar.start"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                element.velocity({
                    <span class="hljs-attr">width</span>: <span class="hljs-number">90</span> + <span class="hljs-string">"%"</span>
                }, {
                    <span class="hljs-attr">easing</span>: <span class="hljs-string">"linear"</span>,
                    <span class="hljs-attr">duration</span>: <span class="hljs-number">450</span>
                });
            });
            scope.$on(<span class="hljs-string">"connect.loading-bar.finish"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                element.velocity({
                    <span class="hljs-attr">width</span>: <span class="hljs-number">100</span> + <span class="hljs-string">"%"</span>
                }, {
                    <span class="hljs-attr">easing</span>: <span class="hljs-string">"linear"</span>,
                    <span class="hljs-attr">duration</span>: <span class="hljs-number">50</span>
                }).velocity({
                    <span class="hljs-attr">opacity</span>: <span class="hljs-number">0</span>
                }, {
                    <span class="hljs-attr">easing</span>: <span class="hljs-string">"linear"</span>,
                    <span class="hljs-attr">duration</span>: <span class="hljs-number">300</span>
                }).velocity({
                    <span class="hljs-attr">width</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-attr">opacity</span>: <span class="hljs-number">1</span>
                }, {
                    <span class="hljs-attr">duration</span>: <span class="hljs-number">0</span>
                })
            });
        }
    };
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/util/directive.snPulse.js */</span>
angular.module(<span class="hljs-string">'sn.connect.util'</span>).directive(<span class="hljs-string">'snPulse'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$timeout</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">restrict</span>: <span class="hljs-string">'A'</span>,
        <span class="hljs-attr">link</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">scope, element, attrs</span>) </span>{
            <span class="hljs-keyword">var</span> timeouts = scope.pulseTimeouts ? angular.fromJson(attrs.pulseTimeouts) : [<span class="hljs-number">10000</span>, <span class="hljs-number">10000</span>, <span class="hljs-number">10000</span>, <span class="hljs-number">10000</span>];
            <span class="hljs-keyword">var</span> classes = [<span class="hljs-string">'pulse-off'</span>, <span class="hljs-string">'pulse-positive'</span>, <span class="hljs-string">'pulse-warning'</span>, <span class="hljs-string">'pulse-danger'</span>];
            <span class="hljs-keyword">var</span> index = <span class="hljs-number">0</span>;
            <span class="hljs-keyword">var</span> timeout;
            <span class="hljs-keyword">var</span> enabled = <span class="hljs-literal">true</span>;
            scope.$watch(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> attrs.pulseEnabled;
            }, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                enabled = attrs.pulseEnabled === <span class="hljs-string">'true'</span>;
                <span class="hljs-keyword">if</span> (!enabled) {
                    $timeout.cancel(timeout);
                    element.removeClass(classes.join(<span class="hljs-string">' '</span>));
                }
            });
            scope.$watch(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> attrs.pulseTimestamp;
            }, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                index = <span class="hljs-number">0</span>;
                $timeout.cancel(timeout);
                <span class="hljs-keyword">if</span> (attrs.pulseTimestamp &amp;&amp; enabled) {
                    <span class="hljs-keyword">var</span> start = <span class="hljs-built_in">parseInt</span>(attrs.pulseTimestamp, <span class="hljs-number">10</span>);
                    <span class="hljs-keyword">var</span> now = <span class="hljs-built_in">Date</span>.now();
                    <span class="hljs-keyword">var</span> diff = now - start;
                    <span class="hljs-keyword">var</span> elapsedTime = <span class="hljs-number">0</span>;
                    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; timeouts.length; i++) {
                        <span class="hljs-keyword">if</span> (diff &gt;= elapsedTime) {
                            index = i;
                            elapsedTime += timeouts[i];
                        }
                    }
                    updateClass();
                }
            });

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">updateClass</span>(<span class="hljs-params"></span>) </span>{
                element.removeClass(classes.join(<span class="hljs-string">' '</span>));
                <span class="hljs-keyword">if</span> (index &gt; <span class="hljs-number">0</span>) {
                    element.addClass(classes[index]);
                }
                <span class="hljs-keyword">if</span> (index &lt; timeouts.length - <span class="hljs-number">1</span>) {
                    timeout = $timeout(updateClass, timeouts[index + <span class="hljs-number">1</span>]);
                    index++;
                }
            }
        }
    };
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/util/directive.liveIntroduction.js */</span>
angular.module(<span class="hljs-string">'sn.connect'</span>).directive(<span class="hljs-string">'liveIntroduction'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">getTemplateUrl</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
        <span class="hljs-attr">templateUrl</span>: getTemplateUrl(<span class="hljs-string">'liveIntroduction.xml'</span>),
        <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">scope</span>: {},
        <span class="hljs-attr">controller</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$scope, activeConversation</span>) </span>{
            $scope.activeConversation = activeConversation;
        }
    };
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/util/directive.snChatActionOptionsPopup.js */</span>
angular.module(<span class="hljs-string">'sn.connect.util'</span>).directive(<span class="hljs-string">'snChatActionOptionsPopup'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">getTemplateUrl</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
        <span class="hljs-attr">templateUrl</span>: getTemplateUrl(<span class="hljs-string">"snChatActionOptionsPopup.xml"</span>),
        <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">controller</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$scope, $element, hotKeyHandler, snHotKey, $timeout</span>) </span>{
            $scope.currentAction = {};
            $scope.argString = <span class="hljs-string">''</span>;
            $scope.visible = <span class="hljs-literal">false</span>;
            $scope.isShown = <span class="hljs-literal">false</span>;
            $scope.input = $element.find(<span class="hljs-string">'input'</span>);
            <span class="hljs-keyword">var</span> closeHotKey = <span class="hljs-keyword">new</span> snHotKey({
                <span class="hljs-attr">key</span>: <span class="hljs-string">"ESC"</span>,
                <span class="hljs-attr">callback</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    <span class="hljs-keyword">if</span> ($scope.isShown)
                        $scope.close();
                }
            });
            hotKeyHandler.add(closeHotKey);
            $scope.$on(<span class="hljs-string">"connect.chat_action.require_options"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e, conversation</span>) </span>{
                <span class="hljs-keyword">if</span> (conversation.sysID !== $scope.conversation.sysID)
                    <span class="hljs-keyword">return</span>;
                $scope.currentAction = conversation.chatActions.currentAction;
                $scope.isShown = <span class="hljs-literal">true</span>;
                $scope.error = <span class="hljs-literal">false</span>;
                $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    $scope.input.focus();
                }, <span class="hljs-number">0</span>, <span class="hljs-literal">false</span>);
            });
            $scope.close = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">if</span> (!$scope.isShown)
                    <span class="hljs-keyword">return</span>;
                $scope.currentAction = {};
                $scope.isShown = <span class="hljs-literal">false</span>;
                $scope.argString = <span class="hljs-string">''</span>;
                $scope.error = <span class="hljs-literal">false</span>;
                $scope.$evalAsync(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    $scope.$root.$broadcast(<span class="hljs-string">"connect.message.focus"</span>, $scope.conversation);
                });
            };
            $scope.runAction = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">if</span> (!$scope.argString.trim().length) {
                    $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                        $scope.error = <span class="hljs-literal">true</span>;
                    });
                    <span class="hljs-keyword">return</span>;
                }
                <span class="hljs-keyword">var</span> queryString = $scope.currentAction.shortcut + <span class="hljs-string">" "</span> + $scope.argString;
                $scope.conversation.chatActions.run(queryString);
                $scope.close();
            };
            $scope.input.on(<span class="hljs-string">"keydown"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) </span>{
                <span class="hljs-keyword">if</span> (event.keyCode === <span class="hljs-number">13</span> &amp;&amp; !event.shiftKey) {
                    $scope.runAction();
                }
            });
        }
    };
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/util/service.messageNotifier.js */</span>
angular.module(<span class="hljs-string">'sn.connect.util'</span>).service(<span class="hljs-string">'messageNotifier'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">
    $window, $q, snNotifier, i18n, profiles, pageLoadTimestamp, liveProfileID, snTabActivity,
    conversations, userPreferences, notificationPreferences, activeConversation, messageService, titleFlasher</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">var</span> lastMessageTime = pageLoadTimestamp || <span class="hljs-number">0</span>;
    <span class="hljs-keyword">var</span> glideNotificationText;
    <span class="hljs-keyword">var</span> securedLinkNotificationText;
    i18n.getMessages([<span class="hljs-string">"New Message From {0}: {1}"</span>, <span class="hljs-string">"You don't have permission to access this document/content"</span>],
        <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">results</span>) </span>{
            glideNotificationText = results[<span class="hljs-string">"New Message From {0}: {1}"</span>];
            securedLinkNotificationText = results[<span class="hljs-string">"You don't have permission to access this document/content"</span>];
        });

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">notify</span>(<span class="hljs-params">message</span>) </span>{
        <span class="hljs-keyword">var</span> shouldExit = !(message.isFromPeer || message.isSystemMessage) ||
            messageIsOlderThanMostRecentNotification(message);
        <span class="hljs-keyword">if</span> (shouldExit)
            <span class="hljs-keyword">return</span>;
        <span class="hljs-keyword">if</span> (!notificationPreferences.globalPreferences.desktop)
            <span class="hljs-keyword">return</span>;
        lastMessageTime = message.timestamp + <span class="hljs-number">1</span>;
        <span class="hljs-keyword">if</span> (!snTabActivity.isPrimary)
            <span class="hljs-keyword">return</span>;
        <span class="hljs-keyword">var</span> promises = [];
        <span class="hljs-keyword">var</span> allowWebNotifications = <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">var</span> conversationID = message.conversationID;
        promises.push(userPreferences.getPreference(<span class="hljs-string">"connect.notifications.desktop"</span>).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">value</span>) </span>{
            allowWebNotifications = angular.isString(value) ? value === <span class="hljs-string">"true"</span> : value;
        }));
        $q.all(promises).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">if</span> (!allowWebNotifications)
                <span class="hljs-keyword">return</span>;
            <span class="hljs-keyword">var</span> preferences = notificationPreferences.get(message.conversationID);
            <span class="hljs-keyword">if</span> (preferences.desktop === <span class="hljs-string">"off"</span>)
                <span class="hljs-keyword">return</span>;
            <span class="hljs-keyword">if</span> (preferences.desktop === <span class="hljs-string">"mention"</span>) {
                <span class="hljs-keyword">if</span> (!message.mentions || message.mentions.length === <span class="hljs-number">0</span>)
                    <span class="hljs-keyword">return</span>;
                <span class="hljs-keyword">var</span> mentioned = message.mentions.some(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">mention</span>) </span>{
                    <span class="hljs-keyword">return</span> mention.mention === liveProfileID;
                });
                <span class="hljs-keyword">if</span> (!mentioned)
                    <span class="hljs-keyword">return</span>;
            }
            <span class="hljs-keyword">if</span> (message.isSystemMessage &amp;&amp; !preferences.systemMessage)
                <span class="hljs-keyword">return</span>;
            titleFlasher.flash();
            <span class="hljs-keyword">var</span> notifyAvatar = <span class="hljs-literal">null</span>;
            conversations.get(conversationID).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">conversation</span>) </span>{
                <span class="hljs-keyword">var</span> promise;
                <span class="hljs-keyword">if</span> (message.conversationID &amp;&amp; message.isSystemMessage) {
                    <span class="hljs-keyword">var</span> profile = (conversation.profileData || conversation.profile);
                    <span class="hljs-keyword">if</span> (profile)
                        promise = $q.when(profile.name);
                    <span class="hljs-keyword">else</span> {
                        promise = profiles.getAsync(message.profile).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">profile</span>) </span>{
                            <span class="hljs-keyword">return</span> (profile &amp;&amp; profile.name) ? profile.name : <span class="hljs-string">"Unknown User"</span>;
                        });
                    }
                } <span class="hljs-keyword">else</span> {
                    promise = profiles.getAsync(message.profile).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">profile</span>) </span>{
                        <span class="hljs-keyword">if</span> (conversation.isGroup) {
                            notifyAvatar = conversation.avatar || <span class="hljs-literal">null</span>;
                            <span class="hljs-keyword">return</span> (profile &amp;&amp; profile.name) ? profile.name + <span class="hljs-string">" in "</span> + conversation.name : <span class="hljs-string">"Unknown User"</span> + <span class="hljs-string">" in "</span> + conversation.name;
                        } <span class="hljs-keyword">else</span> {
                            notifyAvatar = profile.avatar || <span class="hljs-literal">null</span>;
                            <span class="hljs-keyword">return</span> (profile &amp;&amp; profile.name) ? profile.name : <span class="hljs-string">"Unknown User"</span>;
                        }
                    });
                }
                promise.then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">title</span>) </span>{
                    <span class="hljs-keyword">var</span> body;
                    <span class="hljs-keyword">if</span> (snNotifier().canUseNativeNotifications()) {
                        body = message.cleanText;
                    } <span class="hljs-keyword">else</span> {
                        body = glideNotificationText.replace(<span class="hljs-regexp">/\{0\}/</span>, title).replace(<span class="hljs-regexp">/\{1\}/</span>, message.cleanText);
                    }
                    snNotifier().notify(title, {
                        <span class="hljs-attr">body</span>: body,
                        <span class="hljs-attr">lifespan</span>: <span class="hljs-number">7000</span>,
                        <span class="hljs-attr">icon</span>: notifyAvatar || <span class="hljs-string">'/native_notification_icon.png'</span>,
                        <span class="hljs-attr">tag</span>: message.sysID,
                        <span class="hljs-attr">onClick</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                            activeConversation.conversation = conversation;
                        }
                    });
                });
            });
        });
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">messageIsOlderThanMostRecentNotification</span>(<span class="hljs-params">message</span>) </span>{
        <span class="hljs-keyword">return</span> message.timestamp &lt; lastMessageTime;
    }
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">notify</span>: notify,
        <span class="hljs-attr">registerMessageServiceWatch</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">additionalRequirements</span>) </span>{
            messageService.watch(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">message</span>) </span>{
                <span class="hljs-keyword">if</span> (activeConversation.sysID === message.conversationID &amp;&amp;
                    snTabActivity.idleTime &lt; snTabActivity.defaultIdleTime &amp;&amp;
                    snTabActivity.isVisible)
                    <span class="hljs-keyword">return</span>;
                <span class="hljs-keyword">if</span> (angular.isFunction(additionalRequirements) &amp;&amp; !additionalRequirements(message))
                    <span class="hljs-keyword">return</span>;
                notify(message);
            });
        }
    }
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/util/service.audioNotifier.js */</span>
angular.module(<span class="hljs-string">'sn.connect.util'</span>).service(<span class="hljs-string">'audioNotifier'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">
    notifySound, $timeout, messageService, snTabActivity, pageLoadTimestamp,
    notificationPreferences, userPreferences, $q, liveProfileID</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">var</span> audio = <span class="hljs-keyword">new</span> Audio(notifySound),
        AUDIO_COOLDOWN = <span class="hljs-built_in">Math</span>.max(<span class="hljs-number">1000</span>, (audio.duration * <span class="hljs-number">1000</span> + <span class="hljs-number">100</span>)),
        cdTimer,
        notifyQueued = <span class="hljs-literal">false</span>,
        notifyAvailable = <span class="hljs-literal">true</span>,
        lastMessageTime = pageLoadTimestamp || <span class="hljs-number">0</span>;

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">notify</span>(<span class="hljs-params">message</span>) </span>{
        <span class="hljs-keyword">if</span> (angular.isString(message))
            message = {
                <span class="hljs-attr">conversationID</span>: message,
                <span class="hljs-attr">timestamp</span>: lastMessageTime + <span class="hljs-number">1</span>
            };
        <span class="hljs-keyword">if</span> (message.timestamp &lt; lastMessageTime)
            <span class="hljs-keyword">return</span>;
        <span class="hljs-keyword">if</span> (!notifyAvailable)
            <span class="hljs-keyword">return</span> notifyQueued = <span class="hljs-literal">true</span>;
        lastMessageTime = message.timestamp + <span class="hljs-number">1</span>;
        <span class="hljs-keyword">if</span> (!snTabActivity.isPrimary)
            <span class="hljs-keyword">return</span>;
        notifyAvailable = <span class="hljs-literal">false</span>;
        notifyQueued = <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">var</span> promises = [],
            allowAudioNotifications = <span class="hljs-literal">false</span>;
        promises.push(userPreferences.getPreference(<span class="hljs-string">"connect.notifications.audio"</span>).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">value</span>) </span>{
            allowAudioNotifications = angular.isString(value) ? value === <span class="hljs-string">"true"</span> : value;
        }));
        $q.all(promises).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">if</span> (!allowAudioNotifications)
                <span class="hljs-keyword">return</span>;
            <span class="hljs-keyword">if</span> (message.conversationID) {
                <span class="hljs-keyword">var</span> preferences = notificationPreferences.get(message.conversationID);
                <span class="hljs-keyword">if</span> (preferences.audio === <span class="hljs-string">"off"</span>)
                    <span class="hljs-keyword">return</span>;
                <span class="hljs-keyword">if</span> (preferences.audio === <span class="hljs-string">"mention"</span>) {
                    <span class="hljs-keyword">if</span> (!message.mentions || message.mentions.length === <span class="hljs-number">0</span>)
                        <span class="hljs-keyword">return</span>;
                    <span class="hljs-keyword">var</span> mentioned = message.mentions.some(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">mention</span>) </span>{
                        <span class="hljs-keyword">return</span> mention.mention = liveProfileID;
                    });
                    <span class="hljs-keyword">if</span> (!mentioned)
                        <span class="hljs-keyword">return</span>;
                }
            }
            audio.play();
            cdTimer = $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                notifyAvailable = <span class="hljs-literal">true</span>;
                <span class="hljs-keyword">if</span> (notifyQueued)
                    notify(message);
            }, AUDIO_COOLDOWN, <span class="hljs-literal">false</span>);
        });
    }
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">notify</span>: notify,
        <span class="hljs-attr">registerMessageServiceWatch</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">activeConversation, additionalRequirements</span>) </span>{
            messageService.watch(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">message</span>) </span>{
                <span class="hljs-keyword">if</span> (activeConversation.sysID === message.conversationID &amp;&amp;
                    snTabActivity.idleTime &lt; snTabActivity.defaultIdleTime &amp;&amp;
                    snTabActivity.isVisible)
                    <span class="hljs-keyword">return</span>;
                <span class="hljs-keyword">if</span> (angular.isFunction(additionalRequirements) &amp;&amp; !additionalRequirements(message))
                    <span class="hljs-keyword">return</span>;
                notify(message);
            });
        }
    }
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/util/service.uploadAttachment.js */</span>
angular.module(<span class="hljs-string">'sn.connect.util'</span>).service(<span class="hljs-string">'uploadAttachmentService'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">
    $q, $rootScope, $timeout, snAttachmentHandler, maxAttachmentSize, liveProfileID, i18n, screenReaderStatus</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">var</span> MAX_SIZE = maxAttachmentSize * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>;
    <span class="hljs-keyword">var</span> attachmentHandlers = [];
    <span class="hljs-keyword">var</span> filesInProgress = [];
    <span class="hljs-keyword">var</span> uploadSuccess = <span class="hljs-string">"{0} successfully uploaded"</span>;
    <span class="hljs-keyword">var</span> uploadFailure = <span class="hljs-string">"Failed to upload {0}: {1}"</span>;
    i18n.getMessages([uploadSuccess, uploadFailure], <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">results</span>) </span>{
        uploadSuccess = results[uploadSuccess];
        uploadFailure = results[uploadFailure];
    });

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">remove</span>(<span class="hljs-params">file</span>) </span>{
        <span class="hljs-keyword">var</span> index = filesInProgress.indexOf(file);
        <span class="hljs-keyword">if</span> (index &lt; <span class="hljs-number">0</span>)
            <span class="hljs-keyword">return</span>;
        <span class="hljs-keyword">return</span> filesInProgress.splice(index, <span class="hljs-number">1</span>)[<span class="hljs-number">0</span>];
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">apply</span>(<span class="hljs-params">fileFns, fnType, file</span>) </span>{
        <span class="hljs-keyword">var</span> fn = fileFns[fnType];
        <span class="hljs-keyword">if</span> (fn)
            fn(file);
        file.state = fnType;
        $rootScope.$broadcast(<span class="hljs-string">'attachments_list.upload.'</span> + fnType, file);
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">progress</span>(<span class="hljs-params">fileFns, file, loaded, total</span>) </span>{
        total = total || file.size;
        <span class="hljs-keyword">if</span> (angular.isDefined(loaded)) {
            file.loaded = loaded;
            file.progress = <span class="hljs-built_in">Math</span>.min(<span class="hljs-number">100.0</span> * loaded / total, <span class="hljs-number">100.0</span>);
        } <span class="hljs-keyword">else</span> {
            file.loaded = total;
            file.progress = <span class="hljs-number">100.0</span>;
        }
        apply(fileFns, <span class="hljs-string">"progress"</span>, file);
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getAttachmentHandler</span>(<span class="hljs-params">conversation</span>) </span>{
        <span class="hljs-keyword">var</span> sysID = conversation.sysID;
        <span class="hljs-keyword">var</span> attachmentHandler = attachmentHandlers[sysID];
        <span class="hljs-keyword">if</span> (!attachmentHandler)
            attachmentHandler = attachmentHandlers[sysID] = conversation.isPending ?
            snAttachmentHandler.create(<span class="hljs-string">"live_profile"</span>, liveProfileID) :
            snAttachmentHandler.create(<span class="hljs-string">"live_group_profile"</span>, sysID);
        <span class="hljs-keyword">return</span> attachmentHandler;
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">attachFile</span>(<span class="hljs-params">conversation, file, fileFns</span>) </span>{
        <span class="hljs-keyword">if</span> (file.size &gt; MAX_SIZE) {
            file.error = file.name + <span class="hljs-string">' size exceeds the limit of '</span> + maxAttachmentSize + <span class="hljs-string">' MB'</span>;
            apply(fileFns, <span class="hljs-string">"error"</span>, file);
            <span class="hljs-keyword">return</span> $q.when(file);
        }
        filesInProgress.push(file);
        apply(fileFns, <span class="hljs-string">"start"</span>, file);
        progress(fileFns, file, <span class="hljs-number">0</span>);
        <span class="hljs-keyword">return</span> getAttachmentHandler(conversation).uploadAttachment(file, <span class="hljs-literal">null</span>, {
            <span class="hljs-attr">progress</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) </span>{
                progress(fileFns, event.config.file, event.loaded, event.total);
            }
        }).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>) </span>{
            remove(file);
            file.sysID = response.sys_id;
            progress(fileFns, file);
            apply(fileFns, <span class="hljs-string">"success"</span>, file);
            screenReaderStatus.announce(i18n.format(uploadSuccess, file.name));
            <span class="hljs-keyword">return</span> file;
        }, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">errorMessage</span>) </span>{
            remove(file);
            file.error = errorMessage;
            apply(fileFns, <span class="hljs-string">"error"</span>, file);
            screenReaderStatus.announce(i18n.format(uploadFailure, file.name, errorMessage));
            <span class="hljs-keyword">return</span> file;
        });
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">openFileSelector</span>(<span class="hljs-params">$event</span>) </span>{
        $event.stopPropagation();
        <span class="hljs-keyword">var</span> target = angular.element($event.currentTarget);
        $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
            target.parent().find(<span class="hljs-string">'input'</span>).click();
        });
    }
    <span class="hljs-keyword">return</span> {
        get filesInProgress() {
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">Object</span>.keys(filesInProgress).map(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">key</span>) </span>{
                <span class="hljs-keyword">return</span> filesInProgress[key];
            });
        },
        <span class="hljs-attr">attachFiles</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">conversation, files, fileFns</span>) </span>{
            fileFns = fileFns || {};
            <span class="hljs-keyword">var</span> promises = [];
            angular.forEach(files, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">file</span>) </span>{
                promises.push(attachFile(conversation, file, fileFns));
            });
            <span class="hljs-keyword">return</span> $q.all(promises);
        },
        <span class="hljs-attr">openFileSelector</span>: openFileSelector
    };
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/util/service.fileSizeConverter.js */</span>
angular.module(<span class="hljs-string">"sn.connect.util"</span>).service(<span class="hljs-string">"fileSizeConverter"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">getByteCount</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">bytes, precision</span>) </span>{
            <span class="hljs-keyword">if</span> (bytes.slice(<span class="hljs-number">-1</span>) === <span class="hljs-string">'B'</span>)
                <span class="hljs-keyword">return</span> bytes;
            <span class="hljs-keyword">var</span> kb = <span class="hljs-number">1024</span>;
            <span class="hljs-keyword">var</span> mb = kb * <span class="hljs-number">1024</span>;
            <span class="hljs-keyword">var</span> gb = mb * <span class="hljs-number">1024</span>;
            <span class="hljs-keyword">if</span> ((bytes &gt;= <span class="hljs-number">0</span>) &amp;&amp; (bytes &lt; kb))
                <span class="hljs-keyword">return</span> bytes + <span class="hljs-string">' B'</span>;
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((bytes &gt;= kb) &amp;&amp; (bytes &lt; mb))
                <span class="hljs-keyword">return</span> (bytes / kb).toFixed(precision) + <span class="hljs-string">' KB'</span>;
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((bytes &gt;= mb) &amp;&amp; (bytes &lt; gb))
                <span class="hljs-keyword">return</span> (bytes / mb).toFixed(precision) + <span class="hljs-string">' MB'</span>;
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (bytes &gt;= gb)
                <span class="hljs-keyword">return</span> (bytes / gb).toFixed(precision) + <span class="hljs-string">' GB'</span>;
            <span class="hljs-keyword">else</span>
                <span class="hljs-keyword">return</span> bytes + <span class="hljs-string">' B'</span>;
        }
    };
});
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/util/service.notificationPreferences.js */</span>
angular.module(<span class="hljs-string">'sn.common.glide'</span>).factory(<span class="hljs-string">"notificationPreferences"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">
    snHttp, $q, amb, unwrappedHTTPPromise, snNotifier, initGlobalNotificationPreferences, urlTools, snCustomEvent, isLoggedIn</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">var</span> BASE_URL = isLoggedIn ? <span class="hljs-string">"/api/now/connect/conversations/"</span> : <span class="hljs-string">"/api/now/connect/support/anonymous/conversations/"</span>;
    <span class="hljs-keyword">var</span> preferencesCache = {};

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fromGlobalObject</span>(<span class="hljs-params">rawGlobalPreference</span>) </span>{
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">update</span>(<span class="hljs-params">field, preferenceValue</span>) </span>{
            rawGlobalPreference[field] = preferenceValue;
            <span class="hljs-keyword">var</span> eventName = <span class="hljs-string">'connect.notifications.'</span> + field;
            <span class="hljs-keyword">var</span> targetURL = urlTools.getURL(<span class="hljs-string">'user_preference'</span>, {
                <span class="hljs-string">"sysparm_pref_name"</span>: eventName,
                <span class="hljs-string">"sysparm_action"</span>: <span class="hljs-string">"set"</span>,
                <span class="hljs-string">"sysparm_pref_value"</span>: <span class="hljs-string">""</span> + !!preferenceValue
            });
            snHttp.get(targetURL).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                snCustomEvent.fireAll(eventName + <span class="hljs-string">'.update'</span>, preferenceValue);
            });
        }
        snCustomEvent.on(<span class="hljs-string">'connect.notifications.mobile.update'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">newVal</span>) </span>{
            rawGlobalPreference.mobile = newVal;
        });
        snCustomEvent.on(<span class="hljs-string">'connect.notifications.desktop.update'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">newVal</span>) </span>{
            rawGlobalPreference.desktop = newVal;
            updateDesktopNotificationPermission();
        });
        snCustomEvent.on(<span class="hljs-string">'connect.notifications.email.update'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">newVal</span>) </span>{
            rawGlobalPreference.email = newVal;
        });
        snCustomEvent.on(<span class="hljs-string">'connect.notifications.audio.update'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">newVal</span>) </span>{
            rawGlobalPreference.audio = newVal;
        });

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">updateDesktopNotificationPermission</span>(<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">if</span> (!rawGlobalPreference.desktop)
                <span class="hljs-keyword">return</span>;
            <span class="hljs-keyword">if</span> (snNotifier().canUseNativeNotifications())
                <span class="hljs-keyword">return</span>;
            snNotifier().requestNotificationPermission();
        }
        updateDesktopNotificationPermission();
        <span class="hljs-keyword">return</span> {
            get mobile() {
                <span class="hljs-keyword">return</span> rawGlobalPreference.mobile
            },
            get desktop() {
                <span class="hljs-keyword">return</span> rawGlobalPreference.desktop;
            },
            get email() {
                <span class="hljs-keyword">return</span> rawGlobalPreference.email;
            },
            get audio() {
                <span class="hljs-keyword">return</span> rawGlobalPreference.audio;
            },
            set mobile(value) {
                <span class="hljs-keyword">return</span> update(<span class="hljs-string">'mobile'</span>, value);
            },
            set desktop(value) {
                <span class="hljs-keyword">return</span> update(<span class="hljs-string">'desktop'</span>, value);
            },
            set email(value) {
                <span class="hljs-keyword">return</span> update(<span class="hljs-string">'email'</span>, value);
            },
            set audio(value) {
                <span class="hljs-keyword">return</span> update(<span class="hljs-string">'audio'</span>, value);
            }
        }
    }
    <span class="hljs-keyword">var</span> globalPreferences = fromGlobalObject(initGlobalNotificationPreferences);

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fromObject</span>(<span class="hljs-params">rawPreferences</span>) </span>{
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">update</span>(<span class="hljs-params">field, value</span>) </span>{
            rawPreferences[field] = value;
            <span class="hljs-keyword">if</span> (rawPreferences.loading)
                <span class="hljs-keyword">return</span>;
            snHttp.post(BASE_URL + rawPreferences.sys_id + <span class="hljs-string">"/notifications"</span>, rawPreferences).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>) </span>{
                addRaw(response.data.result);
            });
        }
        <span class="hljs-keyword">return</span> {
            get loading() {
                <span class="hljs-keyword">return</span> rawPreferences.loading;
            },
            get mobile() {
                <span class="hljs-keyword">return</span> rawPreferences.push_notification_preference;
            },
            get desktop() {
                <span class="hljs-keyword">return</span> rawPreferences.browser_notification_preference;
            },
            get email() {
                <span class="hljs-keyword">return</span> rawPreferences.email_notification_preference;
            },
            get audio() {
                <span class="hljs-keyword">return</span> rawPreferences.audio_notification_preference;
            },
            get canEmail() {
                <span class="hljs-keyword">return</span> rawPreferences.can_email;
            },
            get systemMessage() {
                <span class="hljs-keyword">return</span> rawPreferences.system_message_notification_preference;
            },
            set mobile(value) {
                update(<span class="hljs-string">'push_notification_preference'</span>, value);
            },
            set desktop(value) {
                update(<span class="hljs-string">'browser_notification_preference'</span>, value);
            },
            set email(value) {
                update(<span class="hljs-string">'email_notification_preference'</span>, value);
            },
            set audio(value) {
                update(<span class="hljs-string">'audio_notification_preference'</span>, value);
            },
            set canEmail(value) {
                update(<span class="hljs-string">'can_email'</span>, value);
            },
            set systemMessage(value) {
                update(<span class="hljs-string">'system_message_notification_preference'</span>, value);
            }
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getPreferences</span>(<span class="hljs-params">conversationID</span>) </span>{
        <span class="hljs-keyword">if</span> (!preferencesCache[conversationID]) {
            addRaw({
                <span class="hljs-attr">sys_id</span>: conversationID,
                <span class="hljs-attr">push_notification_preference</span>: <span class="hljs-string">'all'</span>,
                <span class="hljs-attr">browser_notification_preference</span>: <span class="hljs-string">'all'</span>,
                <span class="hljs-attr">email_notification_preference</span>: <span class="hljs-string">'all'</span>,
                <span class="hljs-attr">audio_notification_preference</span>: <span class="hljs-string">'all'</span>,
                <span class="hljs-attr">can_email</span>: <span class="hljs-literal">true</span>,
                <span class="hljs-attr">system_message_notification_preference</span>: <span class="hljs-literal">true</span>,
                <span class="hljs-attr">loading</span>: <span class="hljs-literal">true</span>
            });
            snHttp.get(BASE_URL + conversationID + <span class="hljs-string">"/notifications"</span>).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>) </span>{
                addRaw(response.data.result);
            });
        }
        <span class="hljs-keyword">return</span> preferencesCache[conversationID];
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addRaw</span>(<span class="hljs-params">preference</span>) </span>{
        preferencesCache[preference.sys_id] = fromObject(preference);
    }
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">get</span>: getPreferences,
        <span class="hljs-attr">addRaw</span>: addRaw,
        <span class="hljs-attr">globalPreferences</span>: globalPreferences
    };
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/util/directive.snAutoScroll.js */</span>
angular.module(<span class="hljs-string">"sn.connect.util"</span>).directive(<span class="hljs-string">'snAutoScroll'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$timeout, $window, $q, inFrameSet, activeConversation</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">throttle</span>(<span class="hljs-params">func, wait</span>) </span>{
        <span class="hljs-keyword">var</span> initialCall = <span class="hljs-literal">true</span>,
            deferred = $q.defer(),
            timerId;
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> func != <span class="hljs-string">'function'</span>) {
            <span class="hljs-keyword">return</span>;
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">throttled</span>(<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">if</span> (timerId) {
                <span class="hljs-keyword">return</span>;
            }
            <span class="hljs-keyword">if</span> (initialCall) {
                initialCall = <span class="hljs-literal">false</span>;
                deferred.resolve(func());
                <span class="hljs-keyword">return</span> deferred.promise;
            }
            timerId = $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                timerId = <span class="hljs-literal">undefined</span>;
                deferred.resolve(func());
            }, wait, <span class="hljs-literal">false</span>);
            <span class="hljs-keyword">return</span> deferred.promise;
        }
        <span class="hljs-keyword">return</span> throttled;
    }
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">restrict</span>: <span class="hljs-string">'A'</span>,
        <span class="hljs-attr">scope</span>: {
            <span class="hljs-attr">onScrollToTop</span>: <span class="hljs-string">"&amp;"</span>
        },
        <span class="hljs-attr">link</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">scope, element</span>) </span>{
            <span class="hljs-keyword">var</span> HISTORY_THROTTLE_MS = <span class="hljs-number">100</span>;
            <span class="hljs-keyword">var</span> SCROLL_THROTTLE_MS = <span class="hljs-number">500</span>;
            <span class="hljs-keyword">var</span> RESIZE_THROTTLE_MS = <span class="hljs-number">500</span>;
            <span class="hljs-keyword">var</span> STICKY_ZONE_HEIGHT = <span class="hljs-number">32</span>;
            <span class="hljs-keyword">var</span> shouldStick = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">var</span> activeTopRequest = <span class="hljs-literal">false</span>;
            <span class="hljs-keyword">var</span> resizeTrigger = <span class="hljs-literal">false</span>;
            <span class="hljs-keyword">var</span> el = element[<span class="hljs-number">0</span>];
            <span class="hljs-keyword">var</span> prevScrollPos = el.scrollTop;
            <span class="hljs-keyword">var</span> lastScrollHeight = el.scrollHeight;
            <span class="hljs-keyword">var</span> onScrollTop, heightAdjustUnwatch;

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">enforceSticky</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">if</span> (shouldStick) {
                    el.scrollTop = el.scrollHeight;
                }
            }

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">forceScroll</span>(<span class="hljs-params"></span>) </span>{
                shouldStick = <span class="hljs-literal">true</span>;
                enforceSticky();
            }
            <span class="hljs-keyword">var</span> scrollHandler = throttle(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">if</span> (resizeTrigger) {
                    resizeTrigger = <span class="hljs-literal">false</span>;
                    <span class="hljs-keyword">return</span>;
                }
                <span class="hljs-keyword">var</span> scrollPos = el.scrollTop;
                <span class="hljs-keyword">var</span> scrollHeight = el.scrollHeight;
                <span class="hljs-keyword">var</span> scrollUp = prevScrollPos &gt; scrollPos;
                prevScrollPos = scrollPos;
                <span class="hljs-keyword">if</span> (scrollUp) {
                    shouldStick = <span class="hljs-literal">false</span>;
                    <span class="hljs-keyword">if</span> (angular.isFunction(scope.onScrollToTop) &amp;&amp; !onScrollTop) {
                        onScrollTop = throttle(scope.onScrollToTop, HISTORY_THROTTLE_MS);
                    }
                    <span class="hljs-keyword">if</span> (scrollPos === <span class="hljs-number">0</span>) {
                        <span class="hljs-keyword">var</span> oldScrollHeight = scrollHeight;
                        <span class="hljs-keyword">if</span> (!activeTopRequest) {
                            activeTopRequest = <span class="hljs-literal">true</span>;
                            <span class="hljs-keyword">var</span> topBatch = element.find(<span class="hljs-string">".sn-feed-message-holder:first-child"</span>);
                            <span class="hljs-keyword">var</span> topBatchLastMessage = topBatch.scope().batch.lastMessage;
                            onScrollTop().finally(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">result</span>) </span>{
                                activeTopRequest = <span class="hljs-literal">false</span>;
                                <span class="hljs-keyword">if</span> (!heightAdjustUnwatch) {
                                    heightAdjustUnwatch = scope.$on(<span class="hljs-string">"ngRepeat.complete"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                                        <span class="hljs-keyword">var</span> heightAdjust = <span class="hljs-number">0</span>;
                                        <span class="hljs-keyword">var</span> potentialConflict = topBatch.prev();
                                        <span class="hljs-keyword">var</span> newTopBatch = element.find(<span class="hljs-string">".sn-feed-message-holder:first-child"</span>);
                                        <span class="hljs-keyword">if</span> (potentialConflict.length &amp;&amp; potentialConflict.scope().batch.lastMessage.sysID === topBatchLastMessage.sysID) {
                                            heightAdjust = topBatch[<span class="hljs-number">0</span>].clientHeight;
                                        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (topBatch[<span class="hljs-number">0</span>] !== newTopBatch[<span class="hljs-number">0</span>]) {
                                            heightAdjust = topBatch.find(<span class="hljs-string">'.sn-feed-message_date'</span>).outerHeight(<span class="hljs-literal">true</span>);
                                        }
                                        el.scrollTop = el.scrollHeight - oldScrollHeight - heightAdjust;
                                        heightAdjustUnwatch();
                                        heightAdjustUnwatch = <span class="hljs-keyword">void</span>(<span class="hljs-number">0</span>);
                                    });
                                }
                                <span class="hljs-keyword">return</span> result;
                            });
                        }
                    }
                    <span class="hljs-keyword">return</span>;
                }
                <span class="hljs-keyword">if</span> (scrollPos + el.clientHeight + STICKY_ZONE_HEIGHT &gt;= scrollHeight) {
                    shouldStick = <span class="hljs-literal">true</span>;
                    enforceSticky();
                }
                lastScrollHeight = scrollHeight;
            }, SCROLL_THROTTLE_MS);
            <span class="hljs-keyword">var</span> resizeHandler = throttle(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                resizeTrigger = <span class="hljs-literal">true</span>;
                <span class="hljs-keyword">if</span> (el.scrollTop &lt;= STICKY_ZONE_HEIGHT) {
                    shouldStick = <span class="hljs-literal">true</span>;
                }
                enforceSticky();
            }, RESIZE_THROTTLE_MS);
            el.scrollTop = el.scrollHeight;
            $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                el.scrollTop = el.scrollHeight;
                prevScrollPos = el.scrollTop;
            }, <span class="hljs-number">0</span>, <span class="hljs-literal">false</span>);
            angular.element(el).on(<span class="hljs-string">'scroll'</span>, scrollHandler);
            angular.element($<span class="hljs-built_in">window</span>).on(<span class="hljs-string">'resize'</span>, resizeHandler);
            scope.$on(<span class="hljs-string">'connect.auto_scroll.scroll_to_bottom'</span>, forceScroll);
            scope.$on(<span class="hljs-string">'connect.auto_scroll.jump_to_bottom'</span>, forceScroll);
            scope.$watch(enforceSticky);
            <span class="hljs-keyword">if</span> (!inFrameSet)
                scope.$watch(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    <span class="hljs-keyword">return</span> activeConversation.sysID;
                }, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">newVal, oldVal</span>) </span>{
                    <span class="hljs-keyword">if</span> (newVal === oldVal)
                        <span class="hljs-keyword">return</span>;
                    forceScroll();
                });
            scope.$on(<span class="hljs-string">"$destroy"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                angular.element(el).off(<span class="hljs-string">'scroll'</span>, scrollHandler);
                angular.element($<span class="hljs-built_in">window</span>).off(<span class="hljs-string">'resize'</span>, resizeHandler);
            });
        }
    }
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/util/directive.snClickToEdit.js */</span>
angular.module(<span class="hljs-string">'sn.connect.util'</span>).directive(<span class="hljs-string">'snClickToEdit'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$timeout, getTemplateUrl</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
        <span class="hljs-attr">scope</span>: {
            <span class="hljs-attr">currText</span>: <span class="hljs-string">"=text"</span>,
            <span class="hljs-attr">onSaveText</span>: <span class="hljs-string">"&amp;onsavetext"</span>,
            <span class="hljs-attr">canEdit</span>: <span class="hljs-string">"=condition"</span>
        },
        <span class="hljs-attr">transclude</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">templateUrl</span>: getTemplateUrl(<span class="hljs-string">"snClickToEdit.xml"</span>),
        <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">controller</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$scope</span>) </span>{
            $scope.editingText = <span class="hljs-literal">false</span>;
            $scope.inputClick = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$event</span>) </span>{
                $event.stopPropagation();
                <span class="hljs-keyword">if</span> (!$scope.canEdit) <span class="hljs-keyword">return</span>;
                $scope.editingText = <span class="hljs-literal">true</span>;
                $scope.prevText = $scope.currText;
            }
            $scope.saveText = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">if</span> (!$scope.editingText || ($scope.prevText === $scope.currText) || !$scope.canEdit) {
                    $scope.editingText = <span class="hljs-literal">false</span>
                    <span class="hljs-keyword">return</span>;
                }
                $scope.editingText = <span class="hljs-literal">false</span>;
                <span class="hljs-keyword">if</span> ($scope.onSaveText) $scope.onSaveText({
                    <span class="hljs-attr">text</span>: $scope.currText
                });
            }
            $scope.cancelEdit = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                $scope.editingText = <span class="hljs-literal">false</span>;
                $scope.currText = $scope.prevText;
            }
        }
    }
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/util/directive.snEscape.js */</span>
angular.module(<span class="hljs-string">'sn.connect.util'</span>).directive(<span class="hljs-string">'snEscape'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">scope, element, attrs</span>) </span>{
        element.bind(<span class="hljs-string">"keyup"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) </span>{
            <span class="hljs-keyword">if</span> (event.which !== <span class="hljs-number">27</span>)
                <span class="hljs-keyword">return</span>;
            scope.$apply(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                scope.$<span class="hljs-built_in">eval</span>(attrs.snEscape);
            });
            event.preventDefault();
        });
    };
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/util/directive.snFocusOnConversation.js */</span>
angular.module(<span class="hljs-string">'sn.connect.util'</span>).directive(<span class="hljs-string">'snFocusOnConversation'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$timeout, $parse, $window, activeConversation</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">restrict</span>: <span class="hljs-string">"A"</span>,
        <span class="hljs-attr">link</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">scope, element, attr</span>) </span>{
            <span class="hljs-keyword">if</span> (attr.disableAutofocus)
                <span class="hljs-keyword">return</span>;
            scope.snFocusOnConversation = $parse(attr.snFocusOnConversation)(scope);
            scope.$watch(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> activeConversation.conversation;
            }, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">conversation</span>) </span>{
                <span class="hljs-keyword">if</span> (<span class="hljs-built_in">window</span>.getSelection().toString() !== <span class="hljs-string">""</span>)
                    <span class="hljs-keyword">return</span>;
                <span class="hljs-keyword">if</span> (!scope.snFocusOnConversation)
                    <span class="hljs-keyword">return</span>;
                <span class="hljs-keyword">if</span> (!conversation)
                    <span class="hljs-keyword">return</span>;
                <span class="hljs-keyword">if</span> (conversation.sysID !== scope.snFocusOnConversation.sysID)
                    <span class="hljs-keyword">return</span>;
                $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    focusOnMessageInput();
                });
            });

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">focusOnMessageInput</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">if</span> ($<span class="hljs-built_in">window</span>.ontouchstart)
                    <span class="hljs-keyword">return</span>;
                $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    element.focus();
                });
            }
            focusOnMessageInput();
        }
    }
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/util/directive.snLoadingIndicator.js */</span>
angular.module(<span class="hljs-string">'sn.connect.util'</span>).directive(<span class="hljs-string">'snLoadingIndicator'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">getTemplateUrl</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
        <span class="hljs-attr">scope</span>: {
            <span class="hljs-attr">active</span>: <span class="hljs-string">"="</span>
        },
        <span class="hljs-attr">transclude</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">templateUrl</span>: getTemplateUrl(<span class="hljs-string">"snLoadingIndicator.xml"</span>),
        <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span>
    }
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/util/directive.snOnload.js */</span>
angular.module(<span class="hljs-string">'sn.connect.util'</span>).directive(<span class="hljs-string">'snOnload'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">scope</span>: {
            <span class="hljs-attr">callBack</span>: <span class="hljs-string">'&amp;snOnload'</span>
        },
        <span class="hljs-attr">link</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">scope, element</span>) </span>{
            element.on(<span class="hljs-string">'load'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                scope.callBack();
                scope.$apply();
            });
        }
    };
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/util/directive.snOptions.js */</span>
angular.module(<span class="hljs-string">'sn.connect.util'</span>).directive(<span class="hljs-string">'snOptions'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">getTemplateUrl</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
        <span class="hljs-attr">templateUrl</span>: getTemplateUrl(<span class="hljs-string">"snOptions.xml"</span>),
        <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span>
    };
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/util/directive.snPane.js */</span>
angular.module(<span class="hljs-string">'sn.connect.util'</span>).directive(<span class="hljs-string">'snPane'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$timeout, getTemplateUrl, paneManager</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
        <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">transclude</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">templateUrl</span>: getTemplateUrl(<span class="hljs-string">'snPane.xml'</span>),
        <span class="hljs-attr">scope</span>: {
            <span class="hljs-attr">paneCollapsed</span>: <span class="hljs-string">'='</span>,
            <span class="hljs-attr">panePosition</span>: <span class="hljs-string">'@'</span>,
            <span class="hljs-attr">paneResizeable</span>: <span class="hljs-string">'@'</span>,
            <span class="hljs-attr">paneWidth</span>: <span class="hljs-string">'='</span>,
            <span class="hljs-attr">paneToggle</span>: <span class="hljs-string">'@'</span>
        },
        <span class="hljs-attr">link</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">scope, element</span>) </span>{
            <span class="hljs-keyword">var</span> scrollPromise;
            <span class="hljs-keyword">var</span> mouseHeldDown = <span class="hljs-literal">false</span>;
            <span class="hljs-keyword">var</span> mouseClicked = <span class="hljs-literal">true</span>;
            scope.toggleConversationList = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$event</span>) </span>{
                <span class="hljs-keyword">if</span> ($event &amp;&amp; $event.keyCode === <span class="hljs-number">9</span>)
                    <span class="hljs-keyword">return</span>;
                paneManager.togglePane(<span class="hljs-string">'connect:conversation_list'</span>, <span class="hljs-literal">true</span>);
            };
            scope.$watch(<span class="hljs-string">'paneWidth'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">if</span> (scope.paneWidth) {
                    element.width(scope.paneWidth);
                }
            });
            scope.isMobile = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> angular.element(<span class="hljs-string">'html'</span>).width() &lt;= <span class="hljs-number">800</span>;
            };
            scope.scrollMousedown = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">moveBy</span>) </span>{
                scrollPromise = $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    mouseHeldDown = <span class="hljs-literal">true</span>;
                    mouseClicked = <span class="hljs-literal">false</span>;
                    updateScrollPosition(moveBy);
                }, <span class="hljs-number">300</span>);
            };
            scope.scrollMouseup = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                $timeout.cancel(scrollPromise);
                scrollPromise = <span class="hljs-keyword">void</span>(<span class="hljs-number">0</span>);
                <span class="hljs-keyword">if</span> (!mouseClicked) {
                    mouseHeldDown = <span class="hljs-literal">false</span>;
                }
            };
            scope.scrollUpCick = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">if</span> (mouseClicked) {
                    <span class="hljs-keyword">var</span> scrollContainer = element.find(<span class="hljs-string">'.pane-scroll-container'</span>);
                    updateScrollPosition(-scrollContainer.height());
                }
                mouseClicked = <span class="hljs-literal">true</span>;
                mouseHeldDown = <span class="hljs-literal">false</span>;
            };
            scope.scrollDownCick = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">if</span> (mouseClicked) {
                    <span class="hljs-keyword">var</span> scrollContainer = element.find(<span class="hljs-string">'.pane-scroll-container'</span>);
                    updateScrollPosition(scrollContainer.height());
                }
                mouseClicked = <span class="hljs-literal">true</span>;
                mouseHeldDown = <span class="hljs-literal">false</span>;
            };
            scope.openConnect = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$event</span>) </span>{
                $event.stopPropagation();
                <span class="hljs-keyword">if</span> ($event &amp;&amp; $event.keyCode === <span class="hljs-number">9</span>)
                    <span class="hljs-keyword">return</span>;
                <span class="hljs-built_in">window</span>.open(<span class="hljs-string">"$c.do"</span>, <span class="hljs-string">"_blank"</span>);
            };

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">updateScrollPosition</span>(<span class="hljs-params">moveBy</span>) </span>{
                <span class="hljs-keyword">var</span> scrollContainer = element.find(<span class="hljs-string">'.pane-scroll-container'</span>);
                scrollContainer.animate({
                    <span class="hljs-attr">scrollTop</span>: scrollContainer[<span class="hljs-number">0</span>].scrollTop + moveBy
                }, <span class="hljs-number">300</span>, <span class="hljs-string">'linear'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    <span class="hljs-keyword">if</span> (mouseHeldDown) {
                        updateScrollPosition(moveBy);
                    }
                });
            }

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">updateScrollButtons</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">var</span> scrollContainer = element.find(<span class="hljs-string">'.pane-scroll-container'</span>);
                <span class="hljs-keyword">if</span> (scope.paneCollapsed &amp;&amp; !scope.isMobile() &amp;&amp; scrollContainer.get(<span class="hljs-number">0</span>)) {
                    <span class="hljs-keyword">if</span> (scrollContainer.outerHeight() &lt; scrollContainer.get(<span class="hljs-number">0</span>).scrollHeight) {} <span class="hljs-keyword">else</span> {}
                } <span class="hljs-keyword">else</span> {}
            }
            scope.togglePane = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                scope.paneCollapsed = !scope.paneCollapsed;
                scope.$root.$broadcast(<span class="hljs-string">'pane.collapsed'</span>, scope.panePosition, scope.paneCollapsed);
                updateScrollButtons();
            }
            angular.element(<span class="hljs-built_in">window</span>).on(<span class="hljs-string">'resize'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                updateScrollButtons();
            });
            $timeout(updateScrollButtons);
        }
    };
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/util/directive.snPaneManager.js */</span>
angular.module(<span class="hljs-string">'sn.connect.util'</span>).directive(<span class="hljs-string">'snPaneManager'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">restrict</span>: <span class="hljs-string">'A'</span>,
        <span class="hljs-attr">link</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">scope, element, attrs</span>) </span>{
            scope.resourcePaneClass = attrs.snPaneManager;
            scope.resourcePaneClasses = {
                <span class="hljs-string">'closed'</span>: <span class="hljs-string">'pane-closed'</span>,
                <span class="hljs-string">'large'</span>: <span class="hljs-string">'pane-large large-resource-pane'</span>,
                <span class="hljs-string">'compact'</span>: <span class="hljs-string">'pane-compact compact-resource-pane'</span>
            };
            scope.$on(<span class="hljs-string">'conversation.resource.open'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$evt, data</span>) </span>{
                scope.$broadcast(<span class="hljs-string">'conversation.resource.show'</span>, data);
                scope.resizePane(data.type);
            });
            scope.$on(<span class="hljs-string">'conversation.resource.close'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                scope.resizePane(<span class="hljs-string">'closed'</span>);
            });
            scope.resizePane = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">type</span>) </span>{
                angular.forEach(scope.resourcePaneClasses, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">resourcePaneClass</span>) </span>{
                    element.removeClass(resourcePaneClass);
                });
                scope.resourcePaneClass = scope.resourcePaneClasses[type || <span class="hljs-string">'closed'</span>];
                element.addClass(scope.resourcePaneClass);
            };
            scope.resizePane(attrs.snPaneManager);
        }
    }
});
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/util/directive.snPod.js */</span>
angular.module(<span class="hljs-string">'sn.connect.util'</span>).directive(<span class="hljs-string">'snPod'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">getTemplateUrl</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
        <span class="hljs-attr">templateUrl</span>: getTemplateUrl(<span class="hljs-string">"snPod.xml"</span>),
        <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">scope</span>: {
            <span class="hljs-attr">user</span>: <span class="hljs-string">'='</span>,
            <span class="hljs-attr">label</span>: <span class="hljs-string">'=label'</span>,
            <span class="hljs-attr">showLabel</span>: <span class="hljs-string">'=showLabel'</span>,
            <span class="hljs-attr">removeTitle</span>: <span class="hljs-string">'@removeTitle'</span>,
            <span class="hljs-attr">removeClick</span>: <span class="hljs-string">'&amp;removeClick'</span>
        },
        <span class="hljs-attr">controller</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$scope</span>) </span>{
            $scope.onRemove = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$event</span>) </span>{
                <span class="hljs-keyword">if</span> ($scope.removeClick) {
                    $event.stopPropagation();
                    $scope.removeClick({
                        <span class="hljs-attr">$event</span>: $event
                    });
                }
            };
        }
    };
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/util/directive.snPopOver.js */</span>
angular.module(<span class="hljs-string">'sn.connect.util'</span>).directive(<span class="hljs-string">'snPopover'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$window, $rootScope</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    <span class="hljs-keyword">if</span> ($<span class="hljs-built_in">window</span>.jQuery)
        $<span class="hljs-built_in">window</span>.jQuery(<span class="hljs-string">'html'</span>).on(<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
            $rootScope.$broadcast(<span class="hljs-string">"popover-html-click"</span>, e);
        });
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">restrict</span>: <span class="hljs-string">'A'</span>,
        <span class="hljs-attr">scope</span>: {
            <span class="hljs-attr">options</span>: <span class="hljs-string">'=snPopover'</span>,
            <span class="hljs-attr">enabled</span>: <span class="hljs-string">'=snPopoverEnabled'</span>
        },
        <span class="hljs-attr">link</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">scope, element</span>) </span>{
            scope.popoverID = scope.$id;

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getContent</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">if</span> (!$content) {
                    <span class="hljs-keyword">if</span> (angular.isObject(scope.options) &amp;&amp; scope.options.target) {
                        $content = angular.element(scope.options.target).detach().show();
                    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> scope.options == <span class="hljs-string">"string"</span>) {
                        $content = angular.element(scope.options).detach().show();
                    } <span class="hljs-keyword">else</span> {
                        $content = element.siblings(<span class="hljs-string">'.popover-body'</span>).eq(<span class="hljs-number">0</span>).detach().show();
                    }
                }
                <span class="hljs-keyword">return</span> $content;
            }
            <span class="hljs-keyword">var</span> $content = getContent();
            <span class="hljs-keyword">if</span> (!angular.element(<span class="hljs-string">'html'</span>).hasClass(<span class="hljs-string">'touch'</span>)) {
                <span class="hljs-keyword">if</span> (scope.options &amp;&amp; scope.options.popoverID)
                    scope.popoverID = scope.options.popoverID;
                <span class="hljs-keyword">var</span> options = {
                    <span class="hljs-attr">placement</span>: <span class="hljs-string">'left'</span>,
                    <span class="hljs-attr">html</span>: <span class="hljs-literal">true</span>,
                    <span class="hljs-attr">content</span>: getContent,
                    <span class="hljs-attr">container</span>: <span class="hljs-string">'body'</span>,
                    <span class="hljs-attr">template</span>: <span class="hljs-string">'&lt;div scope-id="'</span> + scope.popoverID + <span class="hljs-string">'" class="popover" role="tooltip" onClick="event.stopPropagation();"&gt;&lt;div class="arrow"&gt;&lt;/div&gt;&lt;h3 class="popover-title"&gt;&lt;/h3&gt;&lt;div class="popover-content"&gt;&lt;/div&gt;&lt;/div&gt;'</span>,
                    <span class="hljs-attr">trigger</span>: <span class="hljs-string">'hover'</span>,
                    <span class="hljs-attr">hideOnBlur</span>: <span class="hljs-literal">true</span>,
                    <span class="hljs-attr">onShow</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{},
                    <span class="hljs-attr">onHide</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{}
                };
                angular.extend(options, scope.options);
                <span class="hljs-keyword">var</span> oldHide = element[<span class="hljs-number">0</span>].hide;
                <span class="hljs-keyword">if</span> (oldHide) {
                    element[<span class="hljs-number">0</span>].prototypeHide = oldHide;
                    element[<span class="hljs-number">0</span>].hide = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                        <span class="hljs-keyword">if</span> (!jQuery.event.triggered &amp;&amp; <span class="hljs-keyword">this</span>.prototypeHide) {
                            <span class="hljs-keyword">this</span>.prototypeHide();
                        }
                    }
                }
                <span class="hljs-keyword">if</span> (!element.popover)
                    <span class="hljs-keyword">return</span>;
                scope.$popover = element.popover(options);
                scope.$popover.on(<span class="hljs-string">"hidden.bs.popover"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
                    options.onHide(e);
                });
                scope.$popover.on(<span class="hljs-string">"shown.bs.popover"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
                    options.onShow(e);
                });
                scope.$watch(<span class="hljs-string">'enabled'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    element.popover(scope.enabled || scope.enabled == <span class="hljs-literal">undefined</span> ? <span class="hljs-string">'enable'</span> : <span class="hljs-string">'disable'</span>);
                });
                scope.$on(<span class="hljs-string">'$destroy'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    angular.element(<span class="hljs-string">'[scope-id='</span> + scope.popoverID + <span class="hljs-string">']'</span>).remove();
                });
                scope.$on(<span class="hljs-string">'popover-html-click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$evt, e</span>) </span>{
                    <span class="hljs-keyword">if</span> (element.find(e.target).length &gt; <span class="hljs-number">0</span> || options.hideOnBlur === <span class="hljs-literal">false</span>)
                        <span class="hljs-keyword">return</span>;
                    element.popover(<span class="hljs-string">'hide'</span>);
                });
            }
        }
    }
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/util/directive.snAriaUnreadNotifications.js */</span>
angular.module(<span class="hljs-string">'sn.connect.util'</span>).directive(<span class="hljs-string">'snAriaUnreadNotifications'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">getTemplateUrl</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
        <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">templateUrl</span>: getTemplateUrl(<span class="hljs-string">'snAriaUnreadNotifications.xml'</span>),
        <span class="hljs-attr">controller</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$scope, $timeout</span>) </span>{
            $scope.messages = [];
            $scope.$on(<span class="hljs-string">"connect.aria.new_unread_message"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">evt, message</span>) </span>{
                $scope.messages.push(message);
                $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    $scope.messages.shift();
                }, <span class="hljs-number">5000</span>, <span class="hljs-literal">false</span>);
            });
        }
    }
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/util/directive.snRepeatEventEmitter.js */</span>
angular.module(<span class="hljs-string">'sn.connect.util'</span>).directive(<span class="hljs-string">'snRepeatEventEmitter'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">restrict</span>: <span class="hljs-string">'A'</span>,
        <span class="hljs-attr">link</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">scope</span>) </span>{
            <span class="hljs-keyword">if</span> (scope.$first === <span class="hljs-literal">true</span>) {
                scope.$evalAsync(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    scope.$emit(<span class="hljs-string">"ngRepeat.complete"</span>);
                });
            }
        }
    };
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/util/filter.truncate.js */</span>
angular.module(<span class="hljs-string">'sn.connect.util'</span>).filter(<span class="hljs-string">'truncate'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">var</span> MAX_LENGTH = <span class="hljs-number">75</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">text</span>) </span>{
        <span class="hljs-keyword">if</span> (text) {
            <span class="hljs-keyword">if</span> (text.length &lt;= MAX_LENGTH) {
                <span class="hljs-keyword">return</span> text;
            }
            <span class="hljs-keyword">return</span> text.substring(<span class="hljs-number">0</span>, MAX_LENGTH).trim() + <span class="hljs-string">"..."</span>;
        }
    };
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/util/service.snHttp.js */</span>
angular.module(<span class="hljs-string">'sn.connect.util'</span>).factory(<span class="hljs-string">'snHttp'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$http, $q, $rootScope, $timeout</span>) </span>{
    $http.defaults.headers.common[<span class="hljs-string">"Cache-Control"</span>] = <span class="hljs-string">"no-cache"</span>;
    $http.defaults.headers.common[<span class="hljs-string">"Pragma"</span>] = <span class="hljs-string">"no-cache"</span>;
    <span class="hljs-keyword">var</span> http = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">arguments</span>.length) {
            <span class="hljs-keyword">var</span> deferred = $q.defer();
            $http.apply($http, <span class="hljs-built_in">arguments</span>).then(success(deferred), error(deferred));
            <span class="hljs-keyword">return</span> deferred.promise;
        }
    };
    <span class="hljs-keyword">var</span> retryCodes = [<span class="hljs-number">0</span>];
    <span class="hljs-keyword">var</span> errorCount = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">var</span> responseWithError;
    <span class="hljs-keyword">var</span> retryPromise;
    <span class="hljs-keyword">var</span> pollPeriods = [<span class="hljs-number">10</span>, <span class="hljs-number">20</span>, <span class="hljs-number">30</span>, <span class="hljs-number">60</span>, <span class="hljs-number">90</span>, <span class="hljs-number">120</span>];
    <span class="hljs-keyword">var</span> retryListener;

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">success</span>(<span class="hljs-params">deferred</span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>) </span>{
            <span class="hljs-keyword">if</span> (errorCount &gt; <span class="hljs-number">0</span>) {
                errorCount = <span class="hljs-number">0</span>;
                responseWithError = <span class="hljs-keyword">void</span>(<span class="hljs-number">0</span>);
                $rootScope.$broadcast(<span class="hljs-string">'http-error.hide'</span>);
                pollPeriods = [<span class="hljs-number">10</span>, <span class="hljs-number">20</span>, <span class="hljs-number">30</span>, <span class="hljs-number">60</span>, <span class="hljs-number">90</span>, <span class="hljs-number">120</span>];
                <span class="hljs-keyword">if</span> (retryListener)
                    retryListener();
            }
            deferred.resolve(response);
        };
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">error</span>(<span class="hljs-params">deferred</span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>) </span>{
            <span class="hljs-keyword">if</span> (retryCodes.indexOf(response.status) &lt; <span class="hljs-number">0</span>) {
                deferred.reject(response);
                <span class="hljs-keyword">return</span>;
            }
            errorCount++;
            <span class="hljs-keyword">if</span> (errorCount === <span class="hljs-number">2</span> || (response.config &amp;&amp; response.config.retry)) {
                responseWithError = response;
                <span class="hljs-keyword">var</span> pollTime = pollPeriods.shift() || <span class="hljs-number">120</span>;
                $rootScope.$broadcast(<span class="hljs-string">'http-error.show'</span>, pollTime);
                retryPromise = $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    response.config.retry = <span class="hljs-literal">true</span>;
                    http(response.config);
                }, pollTime * <span class="hljs-number">1000</span>);
                retryListener = $rootScope.$on(<span class="hljs-string">'http-error.retry'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    $timeout.cancel(retryPromise);
                    retryPromise = <span class="hljs-keyword">void</span>(<span class="hljs-number">0</span>);
                    responseWithError.config.retry = <span class="hljs-literal">true</span>;
                    http(responseWithError.config);
                    retryListener();
                });
            }
            deferred.reject(response);
        };
    }
    <span class="hljs-keyword">var</span> methods = [<span class="hljs-string">'get'</span>, <span class="hljs-string">'post'</span>, <span class="hljs-string">'put'</span>, <span class="hljs-string">'patch'</span>, <span class="hljs-string">'delete'</span>, <span class="hljs-string">'head'</span>, <span class="hljs-string">'options'</span>, <span class="hljs-string">'jsonp'</span>, <span class="hljs-string">'trace'</span>];
    angular.forEach(methods, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">method</span>) </span>{
        http[method] = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">var</span> deferred = $q.defer();
            $http[method].apply($http, <span class="hljs-built_in">arguments</span>).then(success(deferred), error(deferred));
            <span class="hljs-keyword">return</span> deferred.promise;
        };
    });
    <span class="hljs-keyword">return</span> http;
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/util/service.sysNumberData.js */</span>
angular.module(<span class="hljs-string">"sn.connect.util"</span>).factory(<span class="hljs-string">"sysNumberData"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">snHttp, nowServer</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">getListPrefixes</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">var</span> url = nowServer.getURL(<span class="hljs-string">"number_data"</span>);
            <span class="hljs-keyword">return</span> snHttp.get(url).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">result</span>) </span>{
                <span class="hljs-keyword">return</span> result.data
            });
        }
    }
});
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/util/factory.commandFactory.js */</span>
angular.module(<span class="hljs-string">'sn.connect.util'</span>).factory(<span class="hljs-string">'commandFactory'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$http, $rootScope</span>) </span>{
    <span class="hljs-keyword">var</span> service = {};
    <span class="hljs-keyword">var</span> SN_Commands = {
        <span class="hljs-string">"commands"</span>: {
            <span class="hljs-string">'key'</span>: <span class="hljs-string">'commands'</span>,
            <span class="hljs-string">'args'</span>: <span class="hljs-number">0</span>,
            <span class="hljs-string">'value'</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                angular.element(<span class="hljs-string">"#commandPopupModal"</span>).detach().appendTo(<span class="hljs-string">"body"</span>).modal()
            },
            <span class="hljs-string">'description'</span>: <span class="hljs-string">"Displays a list of all available commands. If unknown command is entered, defaults to this."</span>
        },
        <span class="hljs-string">"snip"</span>: {
            <span class="hljs-string">'key'</span>: <span class="hljs-string">'snip'</span>,
            <span class="hljs-string">'args'</span>: <span class="hljs-number">0</span>,
            <span class="hljs-string">'value'</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                $rootScope.$broadcast(<span class="hljs-string">"conversation.enable_snippet_search"</span>, <span class="hljs-literal">true</span>);
            },
            <span class="hljs-string">'description'</span>: <span class="hljs-string">"Opens snippet search window"</span>
        }
    };
    <span class="hljs-keyword">var</span> Customer_Commands = {};
    <span class="hljs-keyword">var</span> commands = angular.extend(SN_Commands, Customer_Commands);
    service.commands = commands;
    service.commandNames = [];
    service.arr = <span class="hljs-built_in">Object</span>.keys(commands);
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; service.arr.length; i++)
        service.arr[i] = <span class="hljs-string">"/"</span> + service.arr[i];
    service.commandNames = <span class="hljs-built_in">Object</span>.keys(commands);
    service.setMessageFilter = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">m</span>) </span>{
        service.messageFilter = m;
    };
    service.getMessageFilter = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> service.messageFilter;
    }
    service.addSNCommand = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">key, args, value, description</span>) </span>{
        <span class="hljs-keyword">if</span> (commands[key])
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        commands[key] = {
            <span class="hljs-string">'key'</span>: key,
            <span class="hljs-string">'args'</span>: args,
            <span class="hljs-string">'value'</span>: value,
            <span class="hljs-string">'official'</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-string">'description'</span>: description
        };
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    };
    service.getCommand = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">entry</span>) </span>{
        <span class="hljs-keyword">var</span> tokens = entry.split(<span class="hljs-string">" "</span>);
        tokens[<span class="hljs-number">0</span>] = tokens[<span class="hljs-number">0</span>].slice(<span class="hljs-number">1</span>);
        <span class="hljs-keyword">var</span> key = tokens[<span class="hljs-number">0</span>] || <span class="hljs-string">"commands"</span>;
        <span class="hljs-keyword">var</span> comm = commands[key] || commands[<span class="hljs-string">"commands"</span>];
        <span class="hljs-keyword">var</span> f = comm[<span class="hljs-string">'value'</span>];
        <span class="hljs-keyword">return</span> f(entry);
    };
    <span class="hljs-keyword">return</span> service;
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/util/factory.snHotKey.js */</span>
angular.module(<span class="hljs-string">"sn.connect.util"</span>).factory(<span class="hljs-string">"snHotKey"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">var</span> commonKeys = {
        <span class="hljs-string">"ENTER"</span>: <span class="hljs-number">13</span>,
        <span class="hljs-string">"TAB"</span>: <span class="hljs-number">9</span>,
        <span class="hljs-string">"ESC"</span>: <span class="hljs-number">27</span>,
        <span class="hljs-string">"ESCAPE"</span>: <span class="hljs-number">27</span>,
        <span class="hljs-string">"SPACE"</span>: <span class="hljs-number">32</span>,
        <span class="hljs-string">"LEFT"</span>: <span class="hljs-number">37</span>,
        <span class="hljs-string">"UP"</span>: <span class="hljs-number">38</span>,
        <span class="hljs-string">"RIGHT"</span>: <span class="hljs-number">39</span>,
        <span class="hljs-string">"DOWN"</span>: <span class="hljs-number">40</span>
    };
    <span class="hljs-keyword">var</span> modKeys = {
        <span class="hljs-string">"SHIFT"</span>: <span class="hljs-string">"shiftKey"</span>,
        <span class="hljs-string">"CTRL"</span>: <span class="hljs-string">"ctrlKey"</span>,
        <span class="hljs-string">"CONTROL"</span>: <span class="hljs-string">"ctrlKey"</span>,
        <span class="hljs-string">"ALT"</span>: <span class="hljs-string">"altKey"</span>,
        <span class="hljs-string">"OPT"</span>: <span class="hljs-string">"altKey"</span>,
        <span class="hljs-string">"OPTION"</span>: <span class="hljs-string">"altKey"</span>,
        <span class="hljs-string">"CMD"</span>: <span class="hljs-string">"metaKey"</span>,
        <span class="hljs-string">"COMMAND"</span>: <span class="hljs-string">"metaKey"</span>,
        <span class="hljs-string">"APPLE"</span>: <span class="hljs-string">"metaKey"</span>,
        <span class="hljs-string">"META"</span>: <span class="hljs-string">"metaKey"</span>
    };

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">HotKey</span>(<span class="hljs-params">options</span>) </span>{
        options = options || {};
        <span class="hljs-keyword">this</span>.callback = angular.isFunction(options.callback) ? options.callback : <span class="hljs-keyword">void</span>(<span class="hljs-number">0</span>);
        <span class="hljs-keyword">this</span>.modifiers = {
            <span class="hljs-attr">shiftKey</span>: <span class="hljs-literal">false</span>,
            <span class="hljs-attr">ctrlKey</span>: <span class="hljs-literal">false</span>,
            <span class="hljs-attr">altKey</span>: <span class="hljs-literal">false</span>,
            <span class="hljs-attr">metaKey</span>: <span class="hljs-literal">false</span>
        };
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> options.key === <span class="hljs-string">"number"</span>)
            <span class="hljs-keyword">this</span>.key = options.key;
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> options.key === <span class="hljs-string">"string"</span>) {
            <span class="hljs-keyword">if</span> (options.key.length === <span class="hljs-number">1</span>)
                <span class="hljs-keyword">this</span>.key = options.key.toUpperCase().charCodeAt(<span class="hljs-number">0</span>);
            <span class="hljs-keyword">else</span>
                <span class="hljs-keyword">this</span>.key = commonKeys[options.key.toUpperCase()];
        }
        <span class="hljs-keyword">if</span> (options.modifiers) {
            <span class="hljs-keyword">var</span> modifier;
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> options.modifiers === <span class="hljs-string">"string"</span>) {
                modifier = modKeys[options.modifiers.toUpperCase()];
                <span class="hljs-keyword">this</span>.modifiers[modifier] = <span class="hljs-literal">true</span>;
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (angular.isArray(options.modifiers)) {
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, len = options.modifiers.length; i &lt; len; i++) {
                    modifier = modKeys[options.modifiers[i].toUpperCase()];
                    <span class="hljs-keyword">this</span>.modifiers[modifier] = <span class="hljs-literal">true</span>;
                }
            }
        }
    }
    HotKey.prototype.trigger = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> key <span class="hljs-keyword">in</span> <span class="hljs-keyword">this</span>.modifiers)
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.modifiers.hasOwnProperty(key))
                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.modifiers[key] !== e[key])
                    <span class="hljs-keyword">return</span>;
        <span class="hljs-keyword">this</span>.callback(e);
    };
    <span class="hljs-keyword">return</span> HotKey;
});
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/util/service.hotKeyHandler.js */</span>
angular.module(<span class="hljs-string">"sn.connect.util"</span>).factory(<span class="hljs-string">"hotKeyHandler"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">snHotKey</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">var</span> activeHotKeys = {};
    <span class="hljs-keyword">var</span> html = angular.element(<span class="hljs-string">'html'</span>)[<span class="hljs-number">0</span>];
    <span class="hljs-keyword">var</span> oldKeyDown = html.onkeydown;

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addHotKey</span>(<span class="hljs-params">hotKey</span>) </span>{
        <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">arguments</span>.length)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">if</span> (!hotKey <span class="hljs-keyword">instanceof</span> snHotKey)
            hotKey = <span class="hljs-keyword">new</span> snHotKey(hotKey);
        activeHotKeys[hotKey.key] = activeHotKeys[hotKey.key] || [];
        activeHotKeys[hotKey.key].push(hotKey);
        <span class="hljs-keyword">return</span> hotKey;
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">removeHotKey</span>(<span class="hljs-params">hotKey</span>) </span>{
        <span class="hljs-keyword">if</span> (!hotKey <span class="hljs-keyword">instanceof</span> snHotKey || !activeHotKeys[hotKey.key].length)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">var</span> loc = activeHotKeys[hotKey.key].indexOf(hotKey);
        <span class="hljs-keyword">if</span> (loc !== <span class="hljs-number">-1</span>)
            <span class="hljs-keyword">return</span> activeHotKeys[hotKey.key].splice(loc, <span class="hljs-number">1</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
    html.onkeydown = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> oldKeyDown === <span class="hljs-string">"function"</span>)
            oldKeyDown();
        angular.forEach(activeHotKeys[e.keyCode], <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">handler</span>) </span>{
            handler.trigger(e)
        })
    };
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">add</span>: addHotKey,
        <span class="hljs-attr">remove</span>: removeHotKey
    }
});
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/util/factory.snChatAction.js */</span>
angular.module(<span class="hljs-string">"sn.connect.util"</span>).factory(<span class="hljs-string">"snChatAction"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">snHotKey</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">var</span> order = <span class="hljs-number">100</span>;

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">defaultOrder</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> order += <span class="hljs-number">10</span>;
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ChatAction</span>(<span class="hljs-params">config</span>) </span>{
        <span class="hljs-keyword">this</span>.name = config.name || <span class="hljs-string">""</span>;
        <span class="hljs-keyword">this</span>.id = config.id || <span class="hljs-keyword">this</span>.name;
        <span class="hljs-keyword">this</span>.icon = config.icon || <span class="hljs-string">""</span>;
        <span class="hljs-keyword">if</span> (config.order &amp;&amp; <span class="hljs-keyword">typeof</span> config.order === <span class="hljs-string">"string"</span>)
            config.order = <span class="hljs-built_in">parseInt</span>(config.order);
        <span class="hljs-keyword">this</span>.$order = <span class="hljs-keyword">typeof</span> config.order === <span class="hljs-string">"number"</span> ? config.order : defaultOrder();
        <span class="hljs-keyword">this</span>.numArgs = config.numArgs || <span class="hljs-number">0</span>;
        <span class="hljs-keyword">this</span>.requiresArgs = !!config.requiresArgs;
        <span class="hljs-keyword">this</span>.description = config.description || <span class="hljs-string">""</span>;
        <span class="hljs-keyword">this</span>.isActive = config.isActive || <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">this</span>.showInMenu = angular.isUndefined(config.showInMenu) ? <span class="hljs-literal">true</span> : !!config.showInMenu;
        <span class="hljs-keyword">if</span> (angular.isFunction(config.isVisible))
            <span class="hljs-keyword">this</span>.isVisible = config.isVisible;
        <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">var</span> isVisibleValue = angular.isUndefined(config.isVisible) ? <span class="hljs-literal">true</span> : config.isVisible;
            <span class="hljs-keyword">this</span>.isVisible = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> isVisibleValue;
            };
        }
        <span class="hljs-keyword">this</span>.shortcut = <span class="hljs-string">"/"</span> + config.shortcut;
        <span class="hljs-keyword">this</span>.hint = <span class="hljs-keyword">this</span>.shortcut;
        <span class="hljs-keyword">this</span>.argumentHint = config.argumentHint || <span class="hljs-string">''</span>;
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.requiresArgs)
            <span class="hljs-keyword">this</span>.hint += <span class="hljs-string">"     "</span> + <span class="hljs-keyword">this</span>.argumentHint;
        <span class="hljs-keyword">this</span>.action = angular.isFunction(config.action) ? config.action : <span class="hljs-keyword">void</span>(<span class="hljs-number">0</span>);
        <span class="hljs-keyword">if</span> (config.hotKey) {
            <span class="hljs-keyword">if</span> (config.hotKey <span class="hljs-keyword">instanceof</span> snHotKey)
                <span class="hljs-keyword">this</span>.hotKey = config.hotKey;
            <span class="hljs-keyword">else</span>
                <span class="hljs-keyword">this</span>.hotKey = <span class="hljs-keyword">new</span> snHotKey(config.hotKey);
            <span class="hljs-keyword">this</span>.hotKey.callback = <span class="hljs-keyword">this</span>.trigger;
        }
    }
    ChatAction.prototype.trigger = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.isValid() &amp;&amp; <span class="hljs-keyword">this</span>.isVisible(<span class="hljs-built_in">arguments</span>[<span class="hljs-number">0</span>]))
            <span class="hljs-keyword">this</span>.action.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>);
    };
    ChatAction.prototype.isValid = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.action &amp;&amp; <span class="hljs-keyword">this</span>.id;
    };
    ChatAction.prototype.canRun = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">commandText</span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.shortcut.toLowerCase().indexOf(commandText.trim().toLowerCase()) === <span class="hljs-number">0</span>;
    };
    <span class="hljs-keyword">return</span> ChatAction;
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/util/service.ChatActionHandler.js */</span>
angular.module(<span class="hljs-string">"sn.connect.util"</span>).factory(<span class="hljs-string">"ChatActionHandler"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">
    $http, $q, $rootScope, i18n, snChatAction, hotKeyHandler, isLoggedIn</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">var</span> i18nDeferred = $q.defer();
    i18n.getMessages([
        <span class="hljs-string">'Transfer'</span>, <span class="hljs-string">'Transfer the support conversation to another agent or queue'</span>,
        <span class="hljs-string">'Escalate'</span>, <span class="hljs-string">'Escalate the support conversation to another queue'</span>,
        <span class="hljs-string">'End Session'</span>, <span class="hljs-string">'End the support conversation session'</span>,
        <span class="hljs-string">'Create VTB Task'</span>, <span class="hljs-string">'Creates a VTB Task on the conversations VTB'</span>
    ], <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">i18nNames</span>) </span>{
        <span class="hljs-keyword">var</span> actions = [
            <span class="hljs-keyword">new</span> snChatAction({
                <span class="hljs-attr">id</span>: <span class="hljs-string">'transfer'</span>,
                <span class="hljs-attr">name</span>: i18nNames[<span class="hljs-string">'Transfer'</span>],
                <span class="hljs-attr">shortcut</span>: <span class="hljs-string">"transfer"</span>,
                <span class="hljs-attr">description</span>: i18nNames[<span class="hljs-string">'Transfer the support conversation to another agent or queue'</span>],
                <span class="hljs-attr">icon</span>: <span class="hljs-string">'icon-arrow-right'</span>,
                <span class="hljs-attr">order</span>: <span class="hljs-number">70</span>,
                <span class="hljs-attr">isVisible</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">conversation</span>) </span>{
                    <span class="hljs-keyword">return</span> conversation.isHelpDesk &amp;&amp;
                        conversation.queueEntry.isAssignedToMe &amp;&amp;
                        !conversation.queueEntry.isTransferPending;
                },
                <span class="hljs-attr">action</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">conversation</span>) </span>{
                    $rootScope.$broadcast(<span class="hljs-string">'connect.support.conversation.transfer'</span>, conversation);
                }
            }),
            <span class="hljs-keyword">new</span> snChatAction({
                <span class="hljs-attr">id</span>: <span class="hljs-string">'escalate'</span>,
                <span class="hljs-attr">name</span>: i18nNames[<span class="hljs-string">'Escalate'</span>],
                <span class="hljs-attr">shortcut</span>: <span class="hljs-string">"escalate"</span>,
                <span class="hljs-attr">description</span>: i18nNames[<span class="hljs-string">'Escalate the support conversation to another queue'</span>],
                <span class="hljs-attr">icon</span>: <span class="hljs-string">'icon-my-feed'</span>,
                <span class="hljs-attr">order</span>: <span class="hljs-number">60</span>,
                <span class="hljs-attr">isVisible</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">conversation</span>) </span>{
                    <span class="hljs-keyword">if</span> (!conversation.isHelpDesk)
                        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
                    <span class="hljs-keyword">var</span> queueEntry = conversation.queueEntry;
                    <span class="hljs-keyword">if</span> (!queueEntry.isAssignedToMe)
                        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
                    <span class="hljs-keyword">if</span> (queueEntry.isTransferPending)
                        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
                    <span class="hljs-keyword">var</span> queue = queueEntry.queue;
                    <span class="hljs-keyword">return</span> queue &amp;&amp; queue.escalateTo &amp;&amp; queue.escalationQueue.available;
                },
                <span class="hljs-attr">action</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    $rootScope.$broadcast(<span class="hljs-string">'dialog.escalation-confirm.show'</span>);
                }
            }),
            <span class="hljs-keyword">new</span> snChatAction({
                <span class="hljs-attr">id</span>: <span class="hljs-string">'End Session'</span>,
                <span class="hljs-attr">name</span>: i18nNames[<span class="hljs-string">'End Session'</span>],
                <span class="hljs-attr">shortcut</span>: <span class="hljs-string">"end"</span>,
                <span class="hljs-attr">description</span>: i18nNames[<span class="hljs-string">'End the support conversation session'</span>],
                <span class="hljs-attr">icon</span>: <span class="hljs-string">'icon-cross'</span>,
                <span class="hljs-attr">order</span>: <span class="hljs-number">9999</span>,
                <span class="hljs-attr">isVisible</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">conversation</span>) </span>{
                    <span class="hljs-keyword">return</span> conversation.isHelpDesk &amp;&amp;
                        conversation.queueEntry.isAssignedToMe;
                },
                <span class="hljs-attr">action</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">conversation</span>) </span>{
                    $rootScope.$broadcast(<span class="hljs-string">'connect.support_conversation.close_prompt'</span>, conversation, <span class="hljs-literal">false</span>);
                }
            })
        ];
        i18nDeferred.resolve(actions);
    });
    <span class="hljs-keyword">var</span> actionHandlers = {};

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createHandler</span>(<span class="hljs-params">conversation</span>) </span>{
        <span class="hljs-keyword">var</span> actionHandler = actionHandlers[conversation.sysID];
        <span class="hljs-keyword">if</span> (!actionHandler)
            actionHandler = actionHandlers[conversation.sysID] = <span class="hljs-keyword">new</span> Handler(conversation);
        actionHandler.reload();
        <span class="hljs-keyword">return</span> actionHandler;
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Handler</span>(<span class="hljs-params">conversation</span>) </span>{
        <span class="hljs-keyword">if</span> (!conversation)
            <span class="hljs-keyword">throw</span> <span class="hljs-string">"conversation object must be set"</span>;
        <span class="hljs-keyword">var</span> shortcutMap = {};
        <span class="hljs-keyword">var</span> idMap = {};
        <span class="hljs-keyword">var</span> actions = [];
        <span class="hljs-keyword">var</span> currentAction;
        <span class="hljs-keyword">var</span> loading;
        i18nDeferred.promise.then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">actions</span>) </span>{
            angular.forEach(actions, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">action</span>) </span>{
                add(action);
            });
        });

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">reload</span>(<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">if</span> (!conversation.sysID)
                <span class="hljs-keyword">return</span>;
            <span class="hljs-keyword">if</span> (loading)
                <span class="hljs-keyword">return</span>;
            loading = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">var</span> url = isLoggedIn ? <span class="hljs-string">'api/now/connect/conversations/'</span> + conversation.sysID + <span class="hljs-string">'/actions'</span> :
                <span class="hljs-string">'api/now/connect/support/anonymous/conversations/'</span> + conversation.sysID + <span class="hljs-string">'/actions'</span>;
            $http.get(url).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>) </span>{
                loading = <span class="hljs-literal">false</span>;
                shortcutMap = {};
                idMap = {};
                actions = [];
                currentAction = <span class="hljs-literal">undefined</span>;
                i18nDeferred.promise.then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">actions</span>) </span>{
                    angular.forEach(actions, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">action</span>) </span>{
                        add(action);
                    });
                });
                angular.forEach(response.data.result, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">actionData</span>) </span>{
                    actionData.action = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">conversation, argString</span>) </span>{
                        $http.post(url, {
                            <span class="hljs-attr">action</span>: actionData.sys_id,
                            <span class="hljs-attr">text</span>: argString
                        }).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">resp</span>) </span>{
                            <span class="hljs-keyword">if</span> (!resp.data)
                                <span class="hljs-keyword">return</span>;
                            <span class="hljs-keyword">if</span> (!resp.data.result)
                                <span class="hljs-keyword">return</span>;
                            <span class="hljs-keyword">var</span> result = resp.data.result;
                            $rootScope.$emit(result.event, result.data);
                        });
                    };
                    actionData.name = actionData.name || actionData.title;
                    add(<span class="hljs-keyword">new</span> snChatAction(actionData));
                });
            });
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">add</span>(<span class="hljs-params">action</span>) </span>{
            <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">arguments</span>.length)
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            <span class="hljs-keyword">if</span> (!action <span class="hljs-keyword">instanceof</span> snChatAction)
                action = <span class="hljs-keyword">new</span> snChatAction(action);
            actions.push(action);
            idMap[action.id] = action;
            <span class="hljs-keyword">if</span> (action.shortcut) {
                shortcutMap[action.shortcut] = shortcutMap[action.shortcut] || [];
                shortcutMap[action.shortcut].push(action);
            }
            <span class="hljs-keyword">if</span> (action.hotKey)
                hotKeyHandler.add(action.hotKey);
            <span class="hljs-keyword">return</span> action;
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">clearAction</span>(<span class="hljs-params"></span>) </span>{
            currentAction = <span class="hljs-literal">undefined</span>;
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getVisible</span>(<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">return</span> actions
                .filter(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">chatAction</span>) </span>{
                    <span class="hljs-keyword">return</span> chatAction.isVisible(conversation);
                });
        }
        <span class="hljs-keyword">return</span> {
            <span class="hljs-attr">reload</span>: reload,
            <span class="hljs-attr">get</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">id</span>) </span>{
                <span class="hljs-keyword">return</span> idMap[id];
            },
            <span class="hljs-attr">run</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">cmdString</span>) </span>{
                cmdString = cmdString.toLowerCase();
                <span class="hljs-keyword">var</span> cmdArray = cmdString.split(<span class="hljs-string">" "</span>);
                <span class="hljs-keyword">var</span> possibleActions = shortcutMap[cmdArray[<span class="hljs-number">0</span>]];
                <span class="hljs-keyword">var</span> args = cmdArray.slice(<span class="hljs-number">1</span>);
                <span class="hljs-keyword">var</span> argString = args.join(<span class="hljs-string">" "</span>);
                <span class="hljs-keyword">if</span> (currentAction) {
                    currentAction.trigger.call(currentAction, conversation, argString);
                    currentAction = <span class="hljs-keyword">void</span>(<span class="hljs-number">0</span>);
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
                }
                <span class="hljs-keyword">if</span> (possibleActions &amp;&amp; possibleActions.length) {
                    <span class="hljs-keyword">var</span> selectedAction = possibleActions[<span class="hljs-number">0</span>];
                    selectedAction.trigger.call(selectedAction, conversation, argString);
                    clearAction();
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
                }
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            },
            <span class="hljs-attr">hasRequiredArguments</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">cmdString</span>) </span>{
                cmdString = cmdString.toLowerCase();
                <span class="hljs-keyword">var</span> cmdArray = cmdString.split(<span class="hljs-string">" "</span>);
                <span class="hljs-keyword">var</span> possibleActions = shortcutMap[cmdArray[<span class="hljs-number">0</span>]];
                <span class="hljs-keyword">var</span> args = cmdArray.slice(<span class="hljs-number">1</span>);
                <span class="hljs-keyword">if</span> (!possibleActions || !possibleActions.length)
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
                currentAction = possibleActions[<span class="hljs-number">0</span>];
                <span class="hljs-keyword">if</span> (currentAction.requiresArgs)
                    <span class="hljs-keyword">return</span> args.length &gt; <span class="hljs-number">0</span>;
                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
            },
            <span class="hljs-attr">hasMatchingAction</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">text</span>) </span>{
                <span class="hljs-keyword">if</span> (!text)
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
                text = text.trim().toLowerCase();
                <span class="hljs-keyword">return</span> getVisible().some(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">action</span>) </span>{
                    <span class="hljs-keyword">var</span> shortcut = action.shortcut.toLowerCase();
                    <span class="hljs-keyword">return</span> text === shortcut || text.indexOf(shortcut + <span class="hljs-string">" "</span>) === <span class="hljs-number">0</span>;
                })
            },
            <span class="hljs-attr">getCommands</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">filterText</span>) </span>{
                <span class="hljs-keyword">if</span> (filterText)
                    filterText = filterText.toLowerCase();
                <span class="hljs-keyword">return</span> getVisible()
                    .filter(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">command</span>) </span>{
                        <span class="hljs-keyword">return</span> filterText ? command.shortcut.toLowerCase().indexOf(filterText) === <span class="hljs-number">0</span> : <span class="hljs-literal">true</span>;
                    })
                    .sort(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">a, b</span>) </span>{
                        <span class="hljs-keyword">return</span> a.shortcut &gt; b.shortcut;
                    });
            },
            <span class="hljs-attr">getMenuActions</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> getVisible()
                    .filter(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">chatAction</span>) </span>{
                        <span class="hljs-keyword">return</span> chatAction.showInMenu;
                    })
                    .sort(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">a, b</span>) </span>{
                        <span class="hljs-keyword">return</span> a.$order - b.$order;
                    });
            }
        }
    }
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">create</span>: createHandler
    }
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/util/service.connectDropTarget.js */</span>
angular.module(<span class="hljs-string">'sn.connect.util'</span>).service(<span class="hljs-string">'connectDropTargetService'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$rootScope, activeConversation</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isIgnoreDrop</span>(<span class="hljs-params">conversation</span>) </span>{
        <span class="hljs-keyword">if</span> (!conversation.amMember)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">if</span> (conversation.isPending &amp;&amp; !conversation.isPendingNoRecipients)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">return</span> (conversation.isHelpDesk &amp;&amp; conversation.queueEntry.isPermanentlyClosed)
    }
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">activateDropTarget</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">conversation</span>) </span>{
            conversation = conversation || activeConversation.conversation;
            <span class="hljs-keyword">if</span> (isIgnoreDrop(conversation))
                <span class="hljs-keyword">return</span>;
            $rootScope.$broadcast(<span class="hljs-string">"connect.drop_target_popup.show"</span>, conversation.sysID);
        },
        <span class="hljs-attr">deactivateDropTarget</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">conversation</span>) </span>{
            conversation = conversation || activeConversation.conversation;
            <span class="hljs-keyword">if</span> (isIgnoreDrop(conversation))
                <span class="hljs-keyword">return</span>;
            $rootScope.$broadcast(<span class="hljs-string">"connect.drop_target_popup.hide"</span>, conversation.sysID);
        },
        <span class="hljs-attr">onFileDrop</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">files, conversation</span>) </span>{
            conversation = conversation || activeConversation.conversation;
            <span class="hljs-keyword">if</span> (isIgnoreDrop(conversation))
                <span class="hljs-keyword">return</span>;
            <span class="hljs-keyword">this</span>.deactivateDropTarget(conversation);
            $rootScope.$broadcast(<span class="hljs-string">"connect.drop.files"</span>, files, conversation.sysID);
        },
        <span class="hljs-attr">handleDropEvent</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">data, conversation</span>) </span>{
            conversation = conversation || activeConversation.conversation;
            <span class="hljs-keyword">if</span> (isIgnoreDrop(conversation))
                <span class="hljs-keyword">return</span>;
            <span class="hljs-keyword">this</span>.deactivateDropTarget(conversation);
            $rootScope.$broadcast(<span class="hljs-string">"connect.drop"</span>, data, conversation.sysID);
        }
    };
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/util/service.durationFormatter.js */</span>
angular.module(<span class="hljs-string">'sn.connect.util'</span>).service(<span class="hljs-string">'durationFormatter'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$filter, i18n</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    <span class="hljs-keyword">var</span> units = {
        <span class="hljs-attr">years</span>: <span class="hljs-number">365</span> * <span class="hljs-number">24</span> * <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>,
        <span class="hljs-attr">months</span>: <span class="hljs-number">30</span> * <span class="hljs-number">24</span> * <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>,
        <span class="hljs-attr">weeks</span>: <span class="hljs-number">7</span> * <span class="hljs-number">24</span> * <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>,
        <span class="hljs-attr">days</span>: <span class="hljs-number">24</span> * <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>,
        <span class="hljs-attr">hours</span>: <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>,
        <span class="hljs-attr">minutes</span>: <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>,
        <span class="hljs-attr">seconds</span>: <span class="hljs-number">1000</span>
    };
    <span class="hljs-keyword">var</span> names;
    i18n.getMessages([
            <span class="hljs-string">'month'</span>, <span class="hljs-string">'months'</span>,
            <span class="hljs-string">'week'</span>, <span class="hljs-string">'weeks'</span>,
            <span class="hljs-string">'day'</span>, <span class="hljs-string">'days'</span>,
            <span class="hljs-string">'hour'</span>, <span class="hljs-string">'hours'</span>
        ],
        <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">results</span>) </span>{
            names = results;
        });

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">durationYearFn</span>(<span class="hljs-params">duration, startTimestamp, endTimestamp</span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">if</span> (duration.years &gt; <span class="hljs-number">0</span>) {
                <span class="hljs-keyword">var</span> start = <span class="hljs-built_in">Math</span>.abs(<span class="hljs-built_in">Date</span>.now() - startTimestamp);
                <span class="hljs-keyword">var</span> end = <span class="hljs-built_in">Math</span>.abs(<span class="hljs-built_in">Date</span>.now() - endTimestamp);
                <span class="hljs-keyword">var</span> date = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>((start &gt; end) ? startTimestamp : endTimestamp);
                <span class="hljs-keyword">return</span> $filter(<span class="hljs-string">'date'</span>)(date, <span class="hljs-string">'mediumDate'</span>);
            }
        };
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">durationGeneralFn</span>(<span class="hljs-params">duration, single, plural, format</span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">if</span> (duration)
                <span class="hljs-keyword">return</span> stringFormat(duration + <span class="hljs-string">' '</span> + ((duration === <span class="hljs-number">1</span>) ? single : plural), format);
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">stringFormat</span>(<span class="hljs-params">value, format</span>) </span>{
        <span class="hljs-keyword">return</span> format.replace(<span class="hljs-regexp">/\{0}/</span>, value);
    }
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">format</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">timestamp, format</span>) </span>{
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.formatWithRange(<span class="hljs-built_in">Date</span>.now(), timestamp, format);
        },
        <span class="hljs-attr">formatWithRange</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">startTimestamp, endTimestamp, format</span>) </span>{
            format = format || <span class="hljs-string">"{0}"</span>;
            <span class="hljs-keyword">var</span> duration = {};
            <span class="hljs-keyword">var</span> remaining = <span class="hljs-built_in">Math</span>.abs(startTimestamp - endTimestamp);
            angular.forEach(units, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">value, key</span>) </span>{
                duration[key] = <span class="hljs-built_in">Math</span>.floor(remaining / value);
                remaining -= duration[key] * value;
            });
            <span class="hljs-keyword">var</span> durationFunction = [
                durationYearFn(duration.years, startTimestamp, endTimestamp),
                durationGeneralFn(duration.months, names[<span class="hljs-string">'month'</span>], names[<span class="hljs-string">'months'</span>], format),
                durationGeneralFn(duration.weeks, names[<span class="hljs-string">'week'</span>], names[<span class="hljs-string">'weeks'</span>], format),
                durationGeneralFn(duration.days, names[<span class="hljs-string">'day'</span>], names[<span class="hljs-string">'days'</span>], format),
                durationGeneralFn(duration.hours, names[<span class="hljs-string">'hour'</span>], names[<span class="hljs-string">'hours'</span>], format)
            ];
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; durationFunction.length; ++i) {
                <span class="hljs-keyword">var</span> value = durationFunction[i]();
                <span class="hljs-keyword">if</span> (value)
                    <span class="hljs-keyword">return</span> value;
            }
            <span class="hljs-keyword">return</span> stringFormat(duration.minutes + <span class="hljs-string">':'</span> +
                (duration.seconds &lt; <span class="hljs-number">10</span> ? <span class="hljs-string">'0'</span> + duration.seconds : duration.seconds), format);
        }
    }
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/util/directive.snConnectDuration.js */</span>
angular.module(<span class="hljs-string">'sn.connect.util'</span>).directive(<span class="hljs-string">'snConnectDuration'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$interval, $sanitize, durationFormatter</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    <span class="hljs-keyword">var</span> listenerCount = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">var</span> listeners = {};
    $interval(tick, <span class="hljs-number">1000</span>, <span class="hljs-number">0</span>, <span class="hljs-literal">false</span>);

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">tick</span>(<span class="hljs-params"></span>) </span>{
        angular.forEach(listeners, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">listenerFn</span>) </span>{
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> listenerFn !== <span class="hljs-string">"function"</span>)
                <span class="hljs-keyword">return</span>;
            listenerFn();
        })
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onTick</span>(<span class="hljs-params">fn</span>) </span>{
        listenerCount++;
        listeners[listenerCount] = fn;
        <span class="hljs-keyword">return</span> listenerCount;
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">remove</span>(<span class="hljs-params">listenerCount</span>) </span>{
        <span class="hljs-keyword">delete</span> listeners[listenerCount];
    }
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">template</span>: <span class="hljs-string">'&lt;span&gt;&lt;/span&gt;'</span>,
        <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
        <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">scope</span>: {
            <span class="hljs-attr">startTimestamp</span>: <span class="hljs-string">'=?'</span>,
            <span class="hljs-attr">endTimestamp</span>: <span class="hljs-string">'=?'</span>,
            <span class="hljs-attr">placeholder</span>: <span class="hljs-string">'@'</span>
        },
        <span class="hljs-attr">link</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">scope, element, attrs</span>) </span>{
            <span class="hljs-keyword">var</span> listenerIndex;

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">calculate</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">var</span> duration = attrs.placeholder || <span class="hljs-string">''</span>;
                <span class="hljs-keyword">if</span> (scope.startTimestamp &amp;&amp; scope.endTimestamp) {
                    duration = durationFormatter.formatWithRange(scope.startTimestamp, scope.endTimestamp);
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (scope.startTimestamp) {
                    duration = durationFormatter.format(scope.startTimestamp);
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (scope.endTimestamp) {
                    duration = durationFormatter.format(scope.endTimestamp);
                }
                element.html($sanitize(duration));
            }
            listenerIndex = onTick(calculate);
            scope.$on(<span class="hljs-string">'$destroy'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                remove(listenerIndex);
            });
            calculate();
        }
    };
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/util/service.snConversationAsideHistory.js */</span>
angular.module(<span class="hljs-string">"sn.connect.util"</span>).service(<span class="hljs-string">"snConversationAsideHistory"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">var</span> conversationAsides = {};

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getHistory</span>(<span class="hljs-params">conversation</span>) </span>{
        <span class="hljs-keyword">if</span> (conversationAsides.hasOwnProperty(conversation))
            <span class="hljs-keyword">return</span> conversationAsides[conversation];
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">saveAsideHistory</span>(<span class="hljs-params">conversation, view</span>) </span>{
        conversationAsides[conversation] = view;
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">clearAsideHistory</span>(<span class="hljs-params">conversation</span>) </span>{
        <span class="hljs-keyword">delete</span> conversationAsides[conversation];
    }
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">getHistory</span>: getHistory,
        <span class="hljs-attr">saveHistory</span>: saveAsideHistory,
        <span class="hljs-attr">clearHistory</span>: clearAsideHistory
    }
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/util/service.snConnectAsideManager.js */</span>
angular.module(<span class="hljs-string">"sn.connect.util"</span>).service(<span class="hljs-string">"snConnectAsideManager"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">paneManager</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">setup</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">if</span> (angular.element(<span class="hljs-string">'body'</span>).data().layout)
                paneManager.registerPane(<span class="hljs-string">'connect:conversation_list'</span>);
        }
    };
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/util/service.snTypingTracker.js */</span>
angular.module(<span class="hljs-string">'sn.connect.util'</span>).service(<span class="hljs-string">"snTypingTracker"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$rootScope, $timeout</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">var</span> typingTimeout;
    <span class="hljs-keyword">var</span> newKeystroke = <span class="hljs-literal">false</span>;

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">notifyTyping</span>(<span class="hljs-params"></span>) </span>{
        newKeystroke = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">if</span> (!typingTimeout) {
            $rootScope.$broadcast(<span class="hljs-string">"record.typing"</span>, {
                <span class="hljs-attr">status</span>: <span class="hljs-string">"typing"</span>
            });
            waitForTypingToStop();
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">cancelTypingTimer</span>(<span class="hljs-params"></span>) </span>{
        $rootScope.$broadcast(<span class="hljs-string">"record.typing"</span>, {
            <span class="hljs-attr">status</span>: <span class="hljs-string">"viewing"</span>
        });
        newKeystroke = <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">if</span> (!typingTimeout)
            <span class="hljs-keyword">return</span>;
        $timeout.cancel(typingTimeout);
        typingTimeout = <span class="hljs-keyword">void</span>(<span class="hljs-number">0</span>);
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">waitForTypingToStop</span>(<span class="hljs-params"></span>) </span>{
        newKeystroke = <span class="hljs-literal">false</span>;
        typingTimeout = $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">if</span> (newKeystroke) {
                waitForTypingToStop()
            } <span class="hljs-keyword">else</span> {
                cancelTypingTimer();
            }
        }, <span class="hljs-number">3000</span>)
    }
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">typing</span>: notifyTyping,
        <span class="hljs-attr">cancelTyping</span>: cancelTypingTimer
    }
});
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/util/service.screenWidth.js */</span>
angular.module(<span class="hljs-string">"sn.connect.util"</span>).service(<span class="hljs-string">"screenWidth"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$window, $timeout</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">var</span> <span class="hljs-built_in">window</span> = angular.element($<span class="hljs-built_in">window</span>);
    <span class="hljs-keyword">var</span> thresholdTimeout;
    <span class="hljs-keyword">return</span> {
        get width() {
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">window</span>.width();
        },
        <span class="hljs-attr">onResize</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">fn</span>) </span>{
            <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;
            <span class="hljs-built_in">window</span>.on(<span class="hljs-string">'resize'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                fn(self.width);
            });
        },
        <span class="hljs-attr">isAbove</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">width</span>) </span>{
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.width &gt; width;
        },
        <span class="hljs-attr">threshold</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">threshold, fn, debounce</span>) </span>{
            <span class="hljs-keyword">var</span> lastState;
            <span class="hljs-keyword">this</span>.onResize(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">curr</span>) </span>{
                $timeout.cancel(thresholdTimeout);
                thresholdTimeout = $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    <span class="hljs-keyword">var</span> state = curr &gt;= threshold;
                    <span class="hljs-keyword">if</span> (state === lastState)
                        <span class="hljs-keyword">return</span>;
                    fn(state, curr);
                    lastState = state;
                }, debounce);
            });
        }
    }
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/util/service.titleFlasher.js */</span>
angular.module(<span class="hljs-string">'sn.connect.util'</span>).service(<span class="hljs-string">'titleFlasher'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$document, $window, i18n, snTabActivity</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">var</span> singleMessage = <span class="hljs-string">"1 New Message"</span>,
        manyMessages = <span class="hljs-string">"{0} New Messages"</span>;
    i18n.getMessages([<span class="hljs-string">"1 New Message"</span>, <span class="hljs-string">"{0} New Messages"</span>], <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">results</span>) </span>{
        singleMessage = results[singleMessage];
        manyMessages = results[manyMessages];
    });
    <span class="hljs-keyword">var</span> initialTitle,
        FLASH_DELAY = <span class="hljs-number">500</span>,
        numMessages = <span class="hljs-number">0</span>,
        changedTitle = <span class="hljs-literal">false</span>,
        flashTimer;

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">flash</span>(<span class="hljs-params">doNotIncrement</span>) </span>{
        <span class="hljs-keyword">if</span> (snTabActivity.isVisible || !snTabActivity.isPrimary)
            <span class="hljs-keyword">return</span> reset();
        <span class="hljs-keyword">if</span> (!doNotIncrement)
            numMessages++;
        <span class="hljs-keyword">if</span> (doNotIncrement &amp;&amp; changedTitle)
            setTitle(initialTitle);
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (numMessages - <span class="hljs-number">1</span>)
            setTitle(manyMessages);
        <span class="hljs-keyword">else</span>
            setTitle(singleMessage);
        <span class="hljs-keyword">if</span> (flashTimer)
            $<span class="hljs-built_in">window</span>.clearTimeout(flashTimer);
        flashTimer = $<span class="hljs-built_in">window</span>.setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
            flash(<span class="hljs-literal">true</span>);
        }, FLASH_DELAY);
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">reset</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">if</span> (!flashTimer) {
            <span class="hljs-keyword">return</span>;
        }
        numMessages = <span class="hljs-number">0</span>;
        setTitle(initialTitle);
        $<span class="hljs-built_in">window</span>.clearTimeout(flashTimer);
        flashTimer = <span class="hljs-keyword">void</span>(<span class="hljs-number">0</span>);
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setTitle</span>(<span class="hljs-params">newTitle</span>) </span>{
        <span class="hljs-keyword">if</span> (newTitle.indexOf(<span class="hljs-string">"{0}"</span>) &gt;= <span class="hljs-number">0</span>)
            newTitle = newTitle.replace(<span class="hljs-string">"{0}"</span>, numMessages);
        changedTitle = newTitle !== initialTitle;
        $<span class="hljs-built_in">document</span>[<span class="hljs-number">0</span>].title = newTitle;
    }
    snTabActivity.on(<span class="hljs-string">"tab.primary"</span>, reset);
    snTabActivity.on(<span class="hljs-string">"tab.secondary"</span>, reset);
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">flash</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">if</span> (!flashTimer) {
                initialTitle = $<span class="hljs-built_in">document</span>[<span class="hljs-number">0</span>].title;
            }
            flash(<span class="hljs-literal">false</span>);
        }
    }
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/util/service.snConnectMention.js */</span>
angular.module(<span class="hljs-string">"sn.connect.util"</span>).factory(<span class="hljs-string">"snConnectMention"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">liveProfileID, $q, snMention</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">retrieveMembers</span>(<span class="hljs-params">conversation, term</span>) </span>{
        <span class="hljs-keyword">if</span> (!conversation.table || !conversation.document) {
            <span class="hljs-keyword">var</span> deferred = $q.defer();
            deferred.resolve(conversation.members.filter(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">mem</span>) </span>{
                <span class="hljs-keyword">return</span> (mem.name.toUpperCase().indexOf(term.toUpperCase()) &gt;= <span class="hljs-number">0</span> &amp;&amp; liveProfileID !== mem.sysID);
            }).slice(<span class="hljs-number">0</span>, <span class="hljs-number">5</span>));
            <span class="hljs-keyword">return</span> deferred.promise;
        }
        <span class="hljs-keyword">return</span> snMention.retrieveMembers(conversation.table, conversation.document, term);
    }
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">retrieveMembers</span>: retrieveMembers
    }
});;;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/profile/js_includes_connect_profile.js */</span>
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/profile/_module.js */</span>
angular.module(<span class="hljs-string">"sn.connect.profile"</span>, []);;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/profile/service.profiles.js */</span>
angular.module(<span class="hljs-string">'sn.connect.profile'</span>).service(<span class="hljs-string">'profiles'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">snHttp, $q, i18n, snCustomEvent, snNotification, isLoggedIn</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">var</span> errorText = <span class="hljs-string">"User profile was not found"</span>;
    i18n.getMessages([errorText], <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">array</span>) </span>{
        errorText = array[errorText];
    });
    <span class="hljs-keyword">var</span> PROFILES_URL = isLoggedIn ? <span class="hljs-string">'/api/now/live/profiles/'</span> : <span class="hljs-string">'/api/now/connect/support/anonymous/live/profiles/'</span>;
    <span class="hljs-keyword">var</span> activeRequests = {};
    <span class="hljs-keyword">var</span> profiles = {};

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fromObject</span>(<span class="hljs-params">config</span>) </span>{
        <span class="hljs-keyword">if</span> (!config)
            <span class="hljs-keyword">return</span>;
        <span class="hljs-keyword">if</span> (!profiles[config.sys_id]) {
            config.name = config.name || <span class="hljs-string">''</span>;
            config.sysID = config.sys_id;
            config.avatar = config.avatar || <span class="hljs-string">''</span>;
            config.userID = config.document;
            profiles[config.sys_id] = config;
        }
        profiles[config.sys_id].supportConversationCount = config.supportConversationCount;
        <span class="hljs-keyword">return</span> profiles[config.sys_id];
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getAsync</span>(<span class="hljs-params">id</span>) </span>{
        <span class="hljs-keyword">if</span> (!id)
            <span class="hljs-keyword">return</span> $q.when(<span class="hljs-literal">null</span>);
        <span class="hljs-keyword">if</span> (angular.isObject(id))
            id = id.sysID || id.userID;
        <span class="hljs-keyword">if</span> (profiles[id])
            <span class="hljs-keyword">return</span> $q.when(profiles[id]);
        <span class="hljs-keyword">var</span> url = PROFILES_URL + id;
        <span class="hljs-keyword">if</span> (!activeRequests[url]) {
            activeRequests[url] = snHttp.get(url).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>) </span>{
                <span class="hljs-keyword">delete</span> activeRequests[url];
                <span class="hljs-keyword">return</span> fromObject(response.data.result);
            });
        }
        <span class="hljs-keyword">return</span> activeRequests[url];
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">openConversation</span>(<span class="hljs-params">profileID</span>) </span>{
        getAsync(profileID).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">profile</span>) </span>{
            snCustomEvent.fireTop(<span class="hljs-string">'chat:open_conversation'</span>, profile);
        }, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>) </span>{
            <span class="hljs-keyword">if</span> (response.status === <span class="hljs-number">404</span>)
                snNotification.show(<span class="hljs-string">"error"</span>, errorText);
        });
    }
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">fromObject</span>: fromObject,
        <span class="hljs-attr">get</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">id</span>) </span>{
            <span class="hljs-keyword">if</span> (!profiles[id])
                <span class="hljs-keyword">this</span>.getAsync(id);
            <span class="hljs-keyword">return</span> profiles[id];
        },
        <span class="hljs-attr">getAsync</span>: getAsync,
        <span class="hljs-attr">addMembers</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">members</span>) </span>{
            angular.forEach(members, fromObject);
        },
        <span class="hljs-attr">openConversation</span>: openConversation
    };
});;;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/presence/js_includes_connect_presence.js */</span>
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/presence/_module.js */</span>
angular.module(<span class="hljs-string">"sn.connect.presence"</span>, []);;;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/conversation/js_includes_connect_conversation.js */</span>
<span class="hljs-comment">/*! RESOURCE: /scripts/sn/common/ui/popover/js_includes_ui_popover.js */</span>
<span class="hljs-comment">/*! RESOURCE: /scripts/sn/common/ui/popover/_module.js */</span>
angular.module(<span class="hljs-string">'sn.common.ui.popover'</span>, []);;
<span class="hljs-comment">/*! RESOURCE: /scripts/sn/common/ui/popover/directive.snBindPopoverSelection.js */</span>
angular.module(<span class="hljs-string">'sn.common.ui.popover'</span>).directive(<span class="hljs-string">'snBindPopoverSelection'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">snCustomEvent</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">restrict</span>: <span class="hljs-string">"A"</span>,
        <span class="hljs-attr">controller</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$scope, $element, $attrs, snCustomEvent</span>) </span>{
            snCustomEvent.observe(<span class="hljs-string">'list.record_select'</span>, recordSelectDataHandler);

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">recordSelectDataHandler</span>(<span class="hljs-params">data, event</span>) </span>{
                <span class="hljs-keyword">if</span> (!data || !event)
                    <span class="hljs-keyword">return</span>;
                event.stopPropagation();
                <span class="hljs-keyword">var</span> ref = ($scope.field) ? $scope.field.ref : $attrs.ref;
                <span class="hljs-keyword">if</span> (data.ref === ref) {
                    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">window</span>.g_form) {
                        <span class="hljs-keyword">if</span> ($attrs.addOption) {
                            addGlideListChoice(<span class="hljs-string">'select_0'</span> + $attrs.ref, data.value, data.displayValue);
                        } <span class="hljs-keyword">else</span> {
                            <span class="hljs-keyword">var</span> fieldValue = <span class="hljs-keyword">typeof</span> $attrs.ref === <span class="hljs-string">'undefined'</span> ? data.ref : $attrs.ref;
                            <span class="hljs-built_in">window</span>.g_form._setValue(fieldValue, data.value, data.displayValue);
                            clearDerivedFields(data.value);
                        }
                    }
                    <span class="hljs-keyword">if</span> ($scope.field) {
                        $scope.field.value = data.value;
                        $scope.field.displayValue = data.displayValue;
                    }
                }
            }

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">clearDerivedFields</span>(<span class="hljs-params">value</span>) </span>{
                <span class="hljs-keyword">if</span> (<span class="hljs-built_in">window</span>.DerivedFields) {
                    <span class="hljs-keyword">var</span> df = <span class="hljs-keyword">new</span> DerivedFields($scope.field ? $scope.field.ref : $attrs.ref);
                    df.clearRelated();
                    df.updateRelated(value);
                }
            }
        }
    };
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/sn/common/ui/popover/directive.snComplexPopover.js */</span>
angular.module(<span class="hljs-string">'sn.common.ui.popover'</span>).directive(<span class="hljs-string">'snComplexPopover'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">getTemplateUrl, $q, $http, $templateCache, $compile, $timeout</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
        <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">templateUrl</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">elem, attrs</span>) </span>{
            <span class="hljs-keyword">return</span> getTemplateUrl(attrs.buttonTemplate);
        },
        <span class="hljs-attr">controller</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$scope, $element, $attrs, $q, $document, snCustomEvent, snComplexPopoverService</span>) </span>{
            $scope.type = $attrs.complexPopoverType || <span class="hljs-string">"complex_popover"</span>;
            <span class="hljs-keyword">if</span> ($scope.closeEvent) {
                snCustomEvent.observe($scope.closeEvent, destroyPopover);
                $scope.$on($scope.closeEvent, destroyPopover);
            }
            $scope.$parent.$on(<span class="hljs-string">'$destroy'</span>, destroyPopover);
            <span class="hljs-keyword">var</span> newScope;
            <span class="hljs-keyword">var</span> open;
            <span class="hljs-keyword">var</span> popover;
            <span class="hljs-keyword">var</span> content;
            <span class="hljs-keyword">var</span> popoverDefaults = {
                <span class="hljs-attr">container</span>: <span class="hljs-string">'body'</span>,
                <span class="hljs-attr">html</span>: <span class="hljs-literal">true</span>,
                <span class="hljs-attr">placement</span>: <span class="hljs-string">'auto'</span>,
                <span class="hljs-attr">trigger</span>: <span class="hljs-string">'manual'</span>,
                <span class="hljs-attr">template</span>: <span class="hljs-string">'&lt;div class="complex_popover popover" role="dialog"&gt;&lt;div class="arrow"&gt;&lt;/div&gt;&lt;div class="popover-content"&gt;&lt;/div&gt;&lt;/div&gt;'</span>
            };
            <span class="hljs-keyword">var</span> popoverConfig = angular.extend(popoverDefaults, $scope.popoverConfig);
            $scope.loading = <span class="hljs-literal">false</span>;
            $scope.initialized = <span class="hljs-literal">false</span>;
            $scope.togglePopover = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) </span>{
                <span class="hljs-keyword">if</span> (!open) {
                    showPopover(event);
                } <span class="hljs-keyword">else</span> {
                    destroyPopover();
                }
            };

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">showPopover</span>(<span class="hljs-params">e</span>) </span>{
                <span class="hljs-keyword">if</span> ($scope.loading)
                    <span class="hljs-keyword">return</span>;
                $scope.$toggleButton = angular.element(e.target);
                $scope.loading = <span class="hljs-literal">true</span>;
                $scope.$emit(<span class="hljs-string">'list.toggleLoadingState'</span>, <span class="hljs-literal">true</span>);
                _getTemplate()
                    .then(_insertTemplate)
                    .then(_createPopover)
                    .then(_bindHtml)
                    .then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                        $scope.initialized = <span class="hljs-literal">true</span>;
                        <span class="hljs-keyword">if</span> (!$scope.loadEvent)
                            _openPopover();
                    });
            }

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">destroyPopover</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">if</span> (!newScope)
                    <span class="hljs-keyword">return</span>;
                $scope.$toggleButton.on(<span class="hljs-string">'hidden.bs.popover'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    open = <span class="hljs-literal">false</span>;
                    $scope.$toggleButton.data(<span class="hljs-string">'bs.popover'</span>).$element.removeData(<span class="hljs-string">'bs.popover'</span>).off(<span class="hljs-string">'.popover'</span>);
                    $scope.$toggleButton = <span class="hljs-literal">null</span>;
                    snCustomEvent.fire(<span class="hljs-string">'hidden.complexpopover.'</span> + $scope.ref);
                });
                $scope.$toggleButton.popover(<span class="hljs-string">'hide'</span>);
                snCustomEvent.fire(<span class="hljs-string">'hide.complexpopover.'</span> + $scope.ref, $scope.$toggleButton);
                newScope.$broadcast(<span class="hljs-string">'$destroy'</span>);
                newScope.$destroy();
                newScope = <span class="hljs-literal">null</span>;
                $scope.initialized = <span class="hljs-literal">false</span>;
                angular.element(<span class="hljs-built_in">window</span>).off({
                    <span class="hljs-string">'click'</span>: complexHtmlHandler,
                    <span class="hljs-string">'keydown'</span>: keyDownHandler
                });
            }

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_getTemplate</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> snComplexPopoverService.getTemplate(getTemplateUrl($attrs.template));
            }

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_createPopover</span>(<span class="hljs-params"></span>) </span>{
                $scope.$toggleButton.popover(popoverConfig);
                <span class="hljs-keyword">return</span> $q.when(<span class="hljs-literal">true</span>);
            }

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_insertTemplate</span>(<span class="hljs-params">response</span>) </span>{
                newScope = $scope.$<span class="hljs-keyword">new</span>();
                <span class="hljs-keyword">if</span> ($scope.loadEvent)
                    newScope.$on($scope.loadEvent, _openPopover);
                content = $compile(response.data)(newScope);
                popoverConfig.content = content;
                newScope.open = <span class="hljs-literal">true</span>;
                snCustomEvent.fire(<span class="hljs-string">'inserted.complexpopover.'</span> + $scope.ref, $scope.$toggleButton);
                <span class="hljs-keyword">return</span> $q.when(<span class="hljs-literal">true</span>);
            }

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_bindHtml</span>(<span class="hljs-params"></span>) </span>{
                angular.element(<span class="hljs-built_in">window</span>).on({
                    <span class="hljs-string">'click'</span>: complexHtmlHandler,
                    <span class="hljs-string">'keydown'</span>: keyDownHandler
                });
                <span class="hljs-keyword">return</span> $q.when(<span class="hljs-literal">true</span>);
            }

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">complexHtmlHandler</span>(<span class="hljs-params">e</span>) </span>{
                <span class="hljs-keyword">var</span> parentComplexPopoverScope = angular.element(e.target).parents(<span class="hljs-string">'.popover-content'</span>).children().scope();
                <span class="hljs-keyword">if</span> (parentComplexPopoverScope &amp;&amp; (parentComplexPopoverScope.type = <span class="hljs-string">"complex_popover"</span>) &amp;&amp; $scope.type === <span class="hljs-string">"complex_popover"</span>)
                    <span class="hljs-keyword">return</span>;
                <span class="hljs-keyword">if</span> (!open || angular.element(e.target).parents(<span class="hljs-string">'html'</span>).length === <span class="hljs-number">0</span>)
                    <span class="hljs-keyword">return</span>;
                <span class="hljs-keyword">if</span> ($scope.initialized &amp;&amp; !$scope.loading &amp;&amp; !$scope.$toggleButton.is(e.target) &amp;&amp; content.parents(<span class="hljs-string">'.popover'</span>).has(angular.element(e.target)).length === <span class="hljs-number">0</span>) {
                    _eventClosePopover(e);
                    destroyPopover(e);
                }
            }

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">keyDownHandler</span>(<span class="hljs-params">e</span>) </span>{
                <span class="hljs-keyword">if</span> (e.keyCode != <span class="hljs-number">27</span>)
                    <span class="hljs-keyword">return</span>;
                <span class="hljs-keyword">if</span> (!open || angular.element(e.target).parents(<span class="hljs-string">'html'</span>).length === <span class="hljs-number">0</span>)
                    <span class="hljs-keyword">return</span>;
                <span class="hljs-keyword">if</span> ($scope.initialized &amp;&amp; !$scope.loading &amp;&amp; !$scope.$toggleButton.is(e.target) &amp;&amp; content.parents(<span class="hljs-string">'.popover'</span>).has(angular.element(e.target)).length &gt; <span class="hljs-number">0</span>) {
                    _eventClosePopover(e);
                    destroyPopover();
                }
            }

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_eventClosePopover</span>(<span class="hljs-params">e</span>) </span>{
                e.preventDefault();
                e.stopPropagation();
            }

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createAndActivateFocusTrap</span>(<span class="hljs-params">popover</span>) </span>{
                <span class="hljs-keyword">var</span> deferred = $q.defer();
                <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">window</span>.focusTrap) {
                    deferred.reject(<span class="hljs-string">'Focus trap not found'</span>);
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">if</span> (!$scope.focusTrap) {
                        $scope.focusTrap = <span class="hljs-built_in">window</span>.focusTrap(popover, {
                            <span class="hljs-attr">clickOutsideDeactivates</span>: <span class="hljs-literal">true</span>
                        });
                    }
                    <span class="hljs-keyword">try</span> {
                        $scope.focusTrap.activate({
                            <span class="hljs-attr">onActivate</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                                deferred.resolve();
                            }
                        });
                    } <span class="hljs-keyword">catch</span> (e) {
                        <span class="hljs-built_in">console</span>.warn(<span class="hljs-string">"Unable to activate focus trap"</span>, e);
                    }
                }
                <span class="hljs-keyword">return</span> deferred.promise;
            }

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">deactivateAndDestroyFocusTrap</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">var</span> deferred = $q.defer();
                <span class="hljs-keyword">if</span> (!$scope.focusTrap) {
                    deferred.reject(<span class="hljs-string">"Focus trap not found"</span>);
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">try</span> {
                        $scope.focusTrap.deactivate({
                            <span class="hljs-attr">returnFocus</span>: <span class="hljs-literal">false</span>,
                            <span class="hljs-attr">onDeactivate</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                                deferred.resolve();
                            }
                        });
                    } <span class="hljs-keyword">catch</span> (e) {
                        <span class="hljs-built_in">console</span>.warn(<span class="hljs-string">"Unable to deactivate focus trap"</span>, e);
                    }
                    $scope.focusTrap = <span class="hljs-literal">null</span>;
                }
                <span class="hljs-keyword">return</span> deferred.promise;
            }

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_openPopover</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">if</span> (open) {
                    <span class="hljs-keyword">return</span>;
                }
                open = <span class="hljs-literal">true</span>;
                $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    $scope.$toggleButton.popover(<span class="hljs-string">'show'</span>);
                    $scope.loading = <span class="hljs-literal">false</span>;
                    snCustomEvent.fire(<span class="hljs-string">'show.complexpopover.'</span> + $scope.ref, $scope.$toggleButton);
                    $scope.$toggleButton.on(<span class="hljs-string">'shown.bs.popover'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">evt</span>) </span>{
                        <span class="hljs-keyword">var</span> popoverObject = angular.element(evt.target).data(<span class="hljs-string">'bs.popover'</span>),
                            $tooltip,
                            popover;
                        $tooltip = popoverObject &amp;&amp; popoverObject.$tip;
                        popover = $tooltip &amp;&amp; $tooltip[<span class="hljs-number">0</span>];
                        <span class="hljs-keyword">if</span> (popover) {
                            createAndActivateFocusTrap(popover);
                        }
                        snCustomEvent.fire(<span class="hljs-string">'shown.complexpopover.'</span> + $scope.ref, $scope.$toggleButton);
                    });
                    $scope.$toggleButton.on(<span class="hljs-string">'hide.bs.popover'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                        deactivateAndDestroyFocusTrap().finally(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                            $scope.$toggleButton.focus();
                        });
                    });
                }, <span class="hljs-number">0</span>);
            }
        }
    };
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/sn/common/ui/popover/service.snComplexPopoverService.js */</span>
angular.module(<span class="hljs-string">'sn.common.ui.popover'</span>).service(<span class="hljs-string">'snComplexPopoverService'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$http, $q, $templateCache</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">getTemplate</span>: getTemplate
    };

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getTemplate</span>(<span class="hljs-params">template</span>) </span>{
        <span class="hljs-keyword">return</span> $http.get(template, {
            <span class="hljs-attr">cache</span>: $templateCache
        });
    }
});;;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/conversation/_module.js */</span>
angular.module(<span class="hljs-string">"sn.connect.conversation"</span>, [<span class="hljs-string">"ng.common"</span>, <span class="hljs-string">"sn.connect.util"</span>, <span class="hljs-string">"sn.connect.profile"</span>, <span class="hljs-string">"sn.connect.message"</span>, <span class="hljs-string">"sn.connect.resource"</span>, <span class="hljs-string">'sn.connect.presence'</span>, <span class="hljs-string">'sn.common.ui.popover'</span>]);;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/conversation/factory.Conversation.js */</span>
angular.module(<span class="hljs-string">'sn.connect.conversation'</span>).factory(<span class="hljs-string">'conversationFactory'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">
    conversationPersister, unreadCountService, profiles, messageFactory, ChatActionHandler, liveProfileID,
    notificationPreferences, queueEntries, documentsService, resourcePersister, messageBatcherService, inSupportClient</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">formatUnreadCount</span>(<span class="hljs-params">count</span>) </span>{
        <span class="hljs-keyword">return</span> count &gt; <span class="hljs-number">99</span> ? <span class="hljs-string">"99+"</span> : count;
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fromObject</span>(<span class="hljs-params">data</span>) </span>{
        <span class="hljs-keyword">var</span> frameState = data.frame_state || <span class="hljs-string">'open'</span>;
        <span class="hljs-keyword">var</span> frameOrder = data.frame_order || <span class="hljs-number">0</span>;
        <span class="hljs-keyword">var</span> amMember = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">var</span> visible = data.visible;
        <span class="hljs-keyword">var</span> pendingMessage = <span class="hljs-string">""</span>;
        <span class="hljs-keyword">try</span> {
            pendingMessage = sessionStorage.getItem(<span class="hljs-string">"messagePersist."</span> + data.sys_id) || <span class="hljs-string">""</span>;
        } <span class="hljs-keyword">catch</span> (ignored) {}
        unreadCountService.set(data.sys_id, data.last_viewed, data.unread_messages);
        messageBatcherService.addMessages(messageFactory.fromObject(data.last_message), <span class="hljs-literal">true</span>);

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getMemberIndexByID</span>(<span class="hljs-params">id</span>) </span>{
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, len = data.members.length; i &lt; len; i++)
                <span class="hljs-keyword">if</span> (data.members[i].sys_id === id)
                    <span class="hljs-keyword">return</span> i;
            <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setFrameState</span>(<span class="hljs-params">value</span>) </span>{
            <span class="hljs-keyword">if</span> (frameState === value)
                <span class="hljs-keyword">return</span>;
            frameState = value;
            conversationPersister.frameState(data.sys_id, value);
        }
        <span class="hljs-keyword">if</span> (!data.members) {
            data.members = [];
        }
        <span class="hljs-keyword">var</span> memberProfiles = [];
        profiles.addMembers(data.members);
        <span class="hljs-keyword">if</span> (data.queueEntry)
            queueEntries.addRaw(data.queueEntry);
        <span class="hljs-keyword">return</span> {
            get name() {
                <span class="hljs-keyword">return</span> (!data.group &amp;&amp; <span class="hljs-keyword">this</span>.peer) ? <span class="hljs-keyword">this</span>.peer.name : data.name;
            },
            set name(newName) {
                <span class="hljs-keyword">if</span> (!data.group)
                    <span class="hljs-keyword">return</span>;
                data.name = newName;
            },
            get access() {
                <span class="hljs-keyword">return</span> data.access || <span class="hljs-string">"unlisted"</span>;
            },
            set access(newAccess) {
                data.access = newAccess;
            },
            get peer() {
                <span class="hljs-keyword">if</span> (data.group || !<span class="hljs-keyword">this</span>.members || <span class="hljs-keyword">this</span>.members.length &lt; <span class="hljs-number">2</span>) {
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
                }
                <span class="hljs-keyword">return</span> (<span class="hljs-keyword">this</span>.members[<span class="hljs-number">0</span>].sysID === liveProfileID) ? <span class="hljs-keyword">this</span>.members[<span class="hljs-number">1</span>] : <span class="hljs-keyword">this</span>.members[<span class="hljs-number">0</span>];
            },
            get members() {
                <span class="hljs-keyword">if</span> (memberProfiles.length !== data.members.length) {
                    memberProfiles.length = <span class="hljs-number">0</span>;
                    angular.forEach(data.members, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">member</span>) </span>{
                        <span class="hljs-keyword">if</span> (member.table !== <span class="hljs-string">'sys_user'</span>)
                            <span class="hljs-keyword">return</span>;
                        <span class="hljs-keyword">var</span> memberProfile = profiles.get(member.sys_id || member);
                        <span class="hljs-keyword">if</span> (!memberProfile)
                            <span class="hljs-keyword">return</span>;
                        <span class="hljs-keyword">if</span> (memberProfiles.indexOf(memberProfile) &gt;= <span class="hljs-number">0</span>)
                            <span class="hljs-keyword">return</span>;
                        memberProfiles.push(memberProfile);
                    });
                }
                <span class="hljs-keyword">return</span> memberProfiles;
            },
            get avatarMembers() {
                <span class="hljs-keyword">if</span> (!data.isHelpDesk)
                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.members;
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.members.filter(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">member</span>) </span>{
                    <span class="hljs-keyword">return</span> member.sys_id !== liveProfileID;
                });
            },
            get pendingMessage() {
                <span class="hljs-keyword">return</span> pendingMessage
            },
            set pendingMessage(message) {
                pendingMessage = message;
                <span class="hljs-keyword">try</span> {
                    sessionStorage.setItem(<span class="hljs-string">"messagePersist."</span> + <span class="hljs-keyword">this</span>.sysID, message);
                } <span class="hljs-keyword">catch</span> (ignored) {}
            },
            get description() {
                <span class="hljs-keyword">return</span> data.description;
            },
            set description(newDescription) {
                data.description = newDescription;
            },
            <span class="hljs-attr">resetUnreadCount</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.sysID)
                    unreadCountService.reset(<span class="hljs-keyword">this</span>.sysID);
            },
            get messageBatcher() {
                <span class="hljs-keyword">return</span> messageBatcherService.getBatcher(<span class="hljs-keyword">this</span>.sysID);
            },
            get ariaMessages() {
                <span class="hljs-keyword">var</span> messages = messageBatcherService.getAriaMessages(<span class="hljs-keyword">this</span>.sysID, <span class="hljs-number">5</span>);
                <span class="hljs-keyword">return</span> messages.filter(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">message</span>) </span>{
                    <span class="hljs-keyword">return</span> message.timestamp &gt;= data.last_viewed;
                });
            },
            get lastMessage() {
                <span class="hljs-keyword">return</span> messageBatcherService.getLastMessage(<span class="hljs-keyword">this</span>.sysID) || {};
            },
            get firstMessage() {
                <span class="hljs-keyword">return</span> messageBatcherService.getFirstMessage(<span class="hljs-keyword">this</span>.sysID) || {};
            },
            get hasUnreadMessages() {
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.unreadCount &gt; <span class="hljs-number">0</span>;
            },
            get unreadCount() {
                <span class="hljs-keyword">return</span> unreadCountService.get(<span class="hljs-keyword">this</span>.sysID);
            },
            get lastReadMessageTime() {
                <span class="hljs-keyword">return</span> unreadCountService.getLastTimestamp(<span class="hljs-keyword">this</span>.sysID);
            },
            get formattedUnreadCount() {
                <span class="hljs-keyword">return</span> formatUnreadCount(<span class="hljs-keyword">this</span>.unreadCount);
            },
            get isDirectMessage() {
                <span class="hljs-keyword">return</span> !(<span class="hljs-keyword">this</span>.isGroup || <span class="hljs-keyword">this</span>.isDocumentGroup || <span class="hljs-keyword">this</span>.isHelpDesk);
            },
            get isGroup() {
                <span class="hljs-keyword">return</span> data.group;
            },
            get isHelpDesk() {
                <span class="hljs-keyword">return</span> !!<span class="hljs-keyword">this</span>.queueEntry &amp;&amp; !!<span class="hljs-keyword">this</span>.queueEntry.sysID;
            },
            get queueEntry() {
                <span class="hljs-keyword">return</span> queueEntries.get(<span class="hljs-keyword">this</span>.sysID);
            },
            get isDocumentGroup() {
                <span class="hljs-keyword">return</span> !!data.document || <span class="hljs-keyword">this</span>.isHelpDesk;
            },
            <span class="hljs-attr">restricted</span>: data.restricted,
            <span class="hljs-attr">avatar</span>: data.avatar,
            get sysID() {
                <span class="hljs-keyword">return</span> data.sys_id;
            },
            get href() {
                <span class="hljs-keyword">return</span> <span class="hljs-string">'/$c.do#/'</span> + (<span class="hljs-keyword">this</span>.isHelpDesk ? <span class="hljs-string">'support'</span> : <span class="hljs-string">'chat'</span>) + <span class="hljs-string">'/'</span> + <span class="hljs-keyword">this</span>.sysID;
            },
            get <span class="hljs-built_in">document</span>() {
                <span class="hljs-keyword">return</span> data.document;
            },
            get table() {
                <span class="hljs-keyword">return</span> data.table;
            },
            get hasRecord() {
                <span class="hljs-keyword">var</span> documentDetails = <span class="hljs-keyword">this</span>.documentDetails;
                <span class="hljs-keyword">return</span> documentDetails &amp;&amp; !!documentDetails.sysID;
            },
            get documentDetails() {
                <span class="hljs-keyword">if</span> (data.table === <span class="hljs-string">'chat_queue_entry'</span>)
                    <span class="hljs-keyword">return</span>;
                <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>._documentsServiceRetrieve) {
                    <span class="hljs-keyword">this</span>._documentsServiceRetrieve = <span class="hljs-literal">true</span>;
                    documentsService.retrieve(data.table, data.document);
                }
                <span class="hljs-keyword">return</span> documentsService.getDocument(data.document);
            },
            get resources() {
                <span class="hljs-keyword">return</span> resourcePersister.get(<span class="hljs-keyword">this</span>.sysID);
            },
            get preferences() {
                <span class="hljs-keyword">return</span> notificationPreferences.get(<span class="hljs-keyword">this</span>.sysID);
            },
            get chatActions() {
                <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.chatActionHandler)
                    <span class="hljs-keyword">this</span>.chatActionHandler = ChatActionHandler.create(<span class="hljs-keyword">this</span>);
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.chatActionHandler;
            },
            <span class="hljs-attr">frameOrder</span>: frameOrder,
            <span class="hljs-attr">openFrameState</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                setFrameState(<span class="hljs-string">'open'</span>);
            },
            get isFrameStateOpen() {
                <span class="hljs-keyword">return</span> frameState === <span class="hljs-string">'open'</span>;
            },
            <span class="hljs-attr">minimizeFrameState</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                setFrameState(<span class="hljs-string">'minimized'</span>);
            },
            get isFrameStateMinimize() {
                <span class="hljs-keyword">return</span> frameState === <span class="hljs-string">'minimized'</span>;
            },
            <span class="hljs-attr">closeFrameState</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                setFrameState(<span class="hljs-string">'closed'</span>);
            },
            get isFrameStateClosed() {
                <span class="hljs-keyword">return</span> frameState === <span class="hljs-string">'closed'</span>;
            },
            get amMember() {
                <span class="hljs-keyword">return</span> amMember || getMemberIndexByID(liveProfileID) !== <span class="hljs-number">-1</span>;
            },
            get visible() {
                <span class="hljs-keyword">return</span> visible;
            },
            set visible(value) {
                <span class="hljs-keyword">if</span> (visible === value)
                    <span class="hljs-keyword">return</span>;
                visible = value;
                conversationPersister.visible(<span class="hljs-keyword">this</span>.sysID, visible);
            },
            get sortIndex() {
                <span class="hljs-keyword">if</span> (inSupportClient &amp;&amp; <span class="hljs-keyword">this</span>.isHelpDesk) {
                    <span class="hljs-keyword">var</span> queueEntry = <span class="hljs-keyword">this</span>.queueEntry;
                    <span class="hljs-keyword">if</span> (queueEntry.workEnd)
                        <span class="hljs-keyword">return</span> queueEntry.workEnd;
                    <span class="hljs-keyword">if</span> (queueEntry.workStart)
                        <span class="hljs-keyword">return</span> queueEntry.workStart;
                }
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.lastMessage.timestamp || <span class="hljs-number">0</span>;
            },
            get canSaveWorkNotes() {
                <span class="hljs-keyword">return</span> data.can_save_work_notes;
            },
            <span class="hljs-attr">addMember</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">member</span>) </span>{
                <span class="hljs-keyword">if</span> (getMemberIndexByID(member.sys_id) &lt; <span class="hljs-number">0</span>) {
                    data.members.push(member);
                    <span class="hljs-keyword">if</span> (member.sys_id === liveProfileID)
                        amMember = <span class="hljs-literal">true</span>;
                }
            },
            <span class="hljs-attr">removeMember</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">member</span>) </span>{
                <span class="hljs-keyword">var</span> memberIndex = getMemberIndexByID(member.sys_id);
                <span class="hljs-keyword">if</span> (memberIndex &lt; <span class="hljs-number">0</span>)
                    <span class="hljs-keyword">return</span>;
                data.members.splice(memberIndex, <span class="hljs-number">1</span>);
                memberProfiles.splice(memberIndex, <span class="hljs-number">1</span>);
                <span class="hljs-keyword">if</span> (member.sys_id === liveProfileID)
                    amMember = <span class="hljs-literal">false</span>;
            }
        };
    }
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">fromObject</span>: fromObject,
        <span class="hljs-attr">fromRawConversation</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>) </span>{
            data.memberData = data.members;
            <span class="hljs-keyword">var</span> preference = data.notification_preference;
            preference.sys_id = data.sys_id;
            notificationPreferences.addRaw(preference);
            <span class="hljs-keyword">return</span> fromObject(data);
        },
        <span class="hljs-attr">formatUnreadCount</span>: formatUnreadCount
    };
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/conversation/service.activeConversation.js */</span>
angular.module(<span class="hljs-string">'sn.connect.conversation'</span>).service(<span class="hljs-string">'activeConversation'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">
    $rootScope, $filter, $location, $q, i18n, userPreferences, conversations, documentsService, messageService,
    snTabActivity, startingTab, inFrameSet, inSupportClient, supportEnabled, chatEnabled, supportAddMembers, messageBatcherService,
    snNotification</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">var</span> WINDOW_TYPE = inFrameSet ? <span class="hljs-string">'frameSet'</span> : <span class="hljs-string">'standAlone'</span>;
    <span class="hljs-keyword">var</span> PREFERENCE_ROOT = <span class="hljs-string">'connect.conversation_list.active_list.'</span> + WINDOW_TYPE;
    <span class="hljs-keyword">var</span> restrictedConversationText = <span class="hljs-string">'The conversation you requested could not be found'</span>;
    i18n.getMessages([restrictedConversationText], <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">array</span>) </span>{
        restrictedConversationText = array[restrictedConversationText];
    });

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ConversationHandler</span>(<span class="hljs-params">preferenceName, isSupport</span>) </span>{
        <span class="hljs-keyword">var</span> conversationID;

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">contains</span>(<span class="hljs-params">conversation</span>) </span>{
            <span class="hljs-keyword">if</span> (!conversation)
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            <span class="hljs-keyword">if</span> (!conversation.sysID)
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            <span class="hljs-keyword">if</span> (conversation.isPending)
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            <span class="hljs-keyword">var</span> isSupportConv = (supportEnabled || !supportAddMembers) ? isSupport : <span class="hljs-literal">undefined</span>;
            <span class="hljs-keyword">var</span> conversationList = $filter(<span class="hljs-string">'conversation'</span>)(conversations.all, <span class="hljs-literal">true</span>, isSupportConv);
            <span class="hljs-keyword">return</span> conversations.find(conversation, conversationList).index &gt;= <span class="hljs-number">0</span>;
        }
        <span class="hljs-keyword">return</span> {
            get sysID() {
                <span class="hljs-keyword">return</span> conversationID;
            },
            set sysID(newSysID) {
                conversationID = newSysID;
                setPreference(preferenceName, conversationID);
            },
            get conversation() {
                <span class="hljs-keyword">return</span> conversations.indexed[<span class="hljs-keyword">this</span>.sysID] || conversations.emptyConversation;
            },
            set conversation(newConversation) {
                <span class="hljs-keyword">this</span>.sysID = contains(newConversation) ? newConversation.sysID : <span class="hljs-literal">undefined</span>;
            }
        };
    }
    <span class="hljs-keyword">var</span> inFrameSetConversationHandler;
    <span class="hljs-keyword">if</span> (inFrameSet)
        inFrameSetConversationHandler = <span class="hljs-keyword">new</span> ConversationHandler(PREFERENCE_ROOT + <span class="hljs-string">".id"</span>);

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">TabData</span>(<span class="hljs-params">isSupport</span>) </span>{
        <span class="hljs-keyword">var</span> tab = isSupport ? <span class="hljs-string">"support"</span> : <span class="hljs-string">"chat"</span>;
        <span class="hljs-keyword">var</span> preferenceName = PREFERENCE_ROOT + <span class="hljs-string">'.'</span> + tab + <span class="hljs-string">'.id'</span>;
        <span class="hljs-keyword">var</span> conversationHandler = inFrameSetConversationHandler || <span class="hljs-keyword">new</span> ConversationHandler(preferenceName, isSupport);
        <span class="hljs-keyword">if</span> (!inSupportClient) {
            <span class="hljs-keyword">var</span> startingLocation = location();
            <span class="hljs-keyword">if</span> (!inFrameSet &amp;&amp; (startingLocation.tab === tab) &amp;&amp; startingLocation.conversationID) {
                initialize(startingLocation.conversationID, <span class="hljs-literal">true</span>).catch(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    snNotification.show(<span class="hljs-string">'error'</span>, restrictedConversationText);
                    setPreference(preferenceName);
                });
            } <span class="hljs-keyword">else</span> {
                userPreferences.getPreference(preferenceName).then(initialize).catch(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    setPreference(preferenceName);
                });
            }
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">initialize</span>(<span class="hljs-params">id, makeVisible</span>) </span>{
            <span class="hljs-keyword">if</span> (!id || id === <span class="hljs-string">"null"</span>)
                <span class="hljs-keyword">return</span> $q.when();
            <span class="hljs-keyword">return</span> conversations.get(id).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">conversation</span>) </span>{
                <span class="hljs-keyword">if</span> (!conversation)
                    <span class="hljs-keyword">return</span>;
                <span class="hljs-keyword">if</span> (!conversation.visible &amp;&amp; !makeVisible)
                    <span class="hljs-keyword">return</span>;
                conversationHandler.sysID = conversation.sysID;
            });
        }
        <span class="hljs-keyword">return</span> {
            get tab() {
                <span class="hljs-keyword">return</span> tab;
            },
            get isSupport() {
                <span class="hljs-keyword">return</span> isSupport;
            },
            get sysID() {
                <span class="hljs-keyword">return</span> conversationHandler.sysID;
            },
            get conversation() {
                <span class="hljs-keyword">return</span> conversationHandler.conversation;
            },
            set conversation(conv) {
                conversationHandler.conversation = conv;
            }
        };
    }
    <span class="hljs-keyword">var</span> tabDataList = {
        <span class="hljs-attr">chat</span>: <span class="hljs-keyword">new</span> TabData(<span class="hljs-literal">false</span>),
        <span class="hljs-attr">support</span>: <span class="hljs-keyword">new</span> TabData(<span class="hljs-literal">true</span>)
    };
    <span class="hljs-keyword">var</span> tab = checkedLocation().tab || (inSupportClient ? tabDataList.support.tab : startingTab[WINDOW_TYPE]);
    <span class="hljs-keyword">if</span> (tab == <span class="hljs-string">"chat"</span> &amp;&amp; !chatEnabled)
        tab = <span class="hljs-string">"support"</span>;
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (tab == <span class="hljs-string">"support"</span> &amp;&amp; !supportEnabled)
        tab = <span class="hljs-string">"chat"</span>;
    <span class="hljs-keyword">var</span> activeTabData = tabDataList[tab];
    $rootScope.$on(<span class="hljs-string">"connect.action.create_record"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">evt, data</span>) </span>{
        documentsService.create(activeTabData.conversation, data);
    });

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setPreference</span>(<span class="hljs-params">name, value</span>) </span>{
        <span class="hljs-keyword">if</span> (inSupportClient)
            <span class="hljs-keyword">return</span>;
        userPreferences.setPreference(name, value || <span class="hljs-string">''</span>);
    }
    messageService.watch(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">message</span>) </span>{
        <span class="hljs-keyword">if</span> (activeTabData.sysID !== message.conversationID)
            $rootScope.$broadcast(<span class="hljs-string">"connect.aria.new_unread_message"</span>, message);
        conversations.get(message.conversationID).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">conversation</span>) </span>{
            <span class="hljs-keyword">if</span> (!conversation)
                <span class="hljs-keyword">return</span>;
            <span class="hljs-keyword">if</span> (conversation.isGroup)
                message.groupName = conversation.name;
            <span class="hljs-keyword">if</span> (!message.isSystemMessage &amp;&amp; (message.timestamp &gt; conversation.lastReadMessageTime))
                conversation.visible = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">if</span> (conversation.sysID !== activeTabData.sysID)
                <span class="hljs-keyword">return</span>;
            <span class="hljs-keyword">if</span> (snTabActivity.idleTime &gt;= snTabActivity.defaultIdleTime)
                <span class="hljs-keyword">return</span>;
            <span class="hljs-keyword">if</span> (!snTabActivity.isVisible)
                <span class="hljs-keyword">return</span>;
            conversation.resetUnreadCount();
        });
    });
    snTabActivity.on(<span class="hljs-string">"tab.primary"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">if</span> (snTabActivity.isActive())
            activeTabData.conversation.resetUnreadCount();
    });

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">location</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> path = $location.path().split(<span class="hljs-string">'/'</span>);
        <span class="hljs-keyword">return</span> {
            <span class="hljs-attr">tab</span>: path[<span class="hljs-number">1</span>],
            <span class="hljs-attr">conversationID</span>: path[<span class="hljs-number">2</span>]
        };
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">checkedLocation</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> path = location();
        <span class="hljs-keyword">if</span> (path.tab === <span class="hljs-string">'with'</span>)
            <span class="hljs-keyword">return</span> {
                <span class="hljs-attr">profileID</span>: path.conversationID
            };
        <span class="hljs-keyword">return</span> isValidTab(path.tab) ? path : {};
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isValidTab</span>(<span class="hljs-params">tab</span>) </span>{
        <span class="hljs-keyword">return</span> angular.isDefined(tabDataList[tab])
    }
    <span class="hljs-keyword">var</span> pendingConversation;
    <span class="hljs-keyword">return</span> {
        get tab() {
            <span class="hljs-keyword">return</span> activeTabData.tab;
        },
        get sysID() {
            <span class="hljs-keyword">return</span> activeTabData.sysID;
        },
        get conversation() {
            <span class="hljs-keyword">return</span> activeTabData.conversation;
        },
        get isEmpty() {
            <span class="hljs-keyword">return</span> !<span class="hljs-keyword">this</span>.sysID || <span class="hljs-keyword">this</span>.conversation.isEmpty;
        },
        get isSupport() {
            <span class="hljs-keyword">return</span> activeTabData.isSupport;
        },
        get location() {
            <span class="hljs-keyword">return</span> checkedLocation();
        },
        <span class="hljs-attr">getTab</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">tab</span>) </span>{
            <span class="hljs-keyword">if</span> (!isValidTab(tab))
                <span class="hljs-keyword">throw</span> <span class="hljs-string">"Not a valid tab name"</span>;
            <span class="hljs-keyword">return</span> tabDataList[tab];
        },
        set conversation(conv) {
            <span class="hljs-keyword">if</span> (conv)
                conv.visible = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">else</span>
                conv = conversations.emptyConversation;
            <span class="hljs-keyword">var</span> old = activeTabData.conversation;
            <span class="hljs-keyword">if</span> (!old.isEmpty) {
                old.resetUnreadCount();
                <span class="hljs-keyword">if</span> (conv.sysID !== old.sysID)
                    messageBatcherService.clearAriaMessages(old.sysID);
            }
            activeTabData.conversation = conv;
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.isEmpty)
                <span class="hljs-keyword">return</span>;
            <span class="hljs-keyword">if</span> (inFrameSet)
                conv.openFrameState();
            <span class="hljs-keyword">this</span>.conversation.resetUnreadCount();
            $rootScope.$broadcast(<span class="hljs-string">"connect.message.focus"</span>, <span class="hljs-keyword">this</span>.conversation);
        },
        set tab(newTab) {
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.tab === newTab)
                <span class="hljs-keyword">return</span>;
            activeTabData = <span class="hljs-keyword">this</span>.getTab(newTab);
            <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.isEmpty)
                <span class="hljs-keyword">this</span>.conversation.resetUnreadCount();
            setPreference(PREFERENCE_ROOT, newTab);
        },
        <span class="hljs-attr">clear</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">check</span>) </span>{
            <span class="hljs-keyword">if</span> (!check || check.sysID === <span class="hljs-keyword">this</span>.sysID)
                <span class="hljs-keyword">this</span>.conversation = <span class="hljs-literal">undefined</span>;
        },
        <span class="hljs-attr">isActive</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">conversation</span>) </span>{
            <span class="hljs-keyword">return</span> !<span class="hljs-keyword">this</span>.pendingConversation &amp;&amp; !<span class="hljs-keyword">this</span>.isEmpty &amp;&amp; conversation &amp;&amp; conversation.sysID === <span class="hljs-keyword">this</span>.sysID;
        },
        get pendingConversation() {
            <span class="hljs-keyword">return</span> pendingConversation;
        },
        set pendingConversation(pending) {
            pendingConversation = pending;
        }
    };
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/conversation/service.conversationPersister.js */</span>
angular.module(<span class="hljs-string">'sn.connect.conversation'</span>).service(<span class="hljs-string">'conversationPersister'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">
    snHttp, CONNECT_CONTEXT, isLoggedIn</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">var</span> REST_API_PATH = isLoggedIn ? <span class="hljs-string">'/api/now/connect/conversations'</span> : <span class="hljs-string">'/api/now/connect/support/anonymous/conversations'</span>;

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createGroup</span>(<span class="hljs-params">optionalParams</span>) </span>{
        optionalParams = optionalParams || {};
        <span class="hljs-keyword">return</span> snHttp.post(REST_API_PATH, optionalParams).then(extractResult);
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addUser</span>(<span class="hljs-params">conversationID, profileID</span>) </span>{
        <span class="hljs-keyword">return</span> snHttp.post(REST_API_PATH + <span class="hljs-string">'/'</span> + conversationID + <span class="hljs-string">'/members'</span>, {
            <span class="hljs-string">"member_id"</span>: profileID
        }).then(extractResult);
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">removeUser</span>(<span class="hljs-params">conversationID, profileID</span>) </span>{
        <span class="hljs-keyword">return</span> snHttp.delete(REST_API_PATH + <span class="hljs-string">'/'</span> + conversationID + <span class="hljs-string">'/members/'</span> + profileID).then(extractResult);
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">update</span>(<span class="hljs-params">conversationID, data</span>) </span>{
        <span class="hljs-keyword">return</span> snHttp.put(REST_API_PATH + <span class="hljs-string">'/'</span> + conversationID, data).then(extractResult);
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">extractResult</span>(<span class="hljs-params">response</span>) </span>{
        <span class="hljs-keyword">return</span> response.data.result;
    }
    <span class="hljs-keyword">var</span> conversationURL = REST_API_PATH;
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">createGroup</span>: createGroup,
        <span class="hljs-attr">addUser</span>: addUser,
        <span class="hljs-attr">removeUser</span>: removeUser,
        <span class="hljs-attr">update</span>: update,
        <span class="hljs-attr">getConversations</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">queueID</span>) </span>{
            <span class="hljs-keyword">if</span> (queueID) {
                conversationURL = isLoggedIn ? <span class="hljs-string">'/api/now/connect/support/queues/'</span> + queueID + <span class="hljs-string">'/sessions'</span> :
                    <span class="hljs-string">'/api/now/connect/support/anonymous/queues/'</span> + queueID + <span class="hljs-string">'/sessions'</span>;
            }
            <span class="hljs-keyword">return</span> snHttp.get(conversationURL).then(extractResult);
        },
        <span class="hljs-attr">getConversation</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">conversationID</span>) </span>{
            <span class="hljs-keyword">return</span> snHttp.get(REST_API_PATH + <span class="hljs-string">'/'</span> + conversationID)
                .then(extractResult)
        },
        <span class="hljs-attr">lastViewed</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">conversationID, timestamp</span>) </span>{
            <span class="hljs-keyword">return</span> update(conversationID, {
                <span class="hljs-attr">last_viewed</span>: timestamp
            })
        },
        <span class="hljs-attr">visible</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">conversationID, visible</span>) </span>{
            <span class="hljs-keyword">return</span> update(conversationID, {
                <span class="hljs-attr">visible</span>: visible
            });
        },
        <span class="hljs-attr">frameState</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">conversationID, state</span>) </span>{
            <span class="hljs-keyword">var</span> data = {
                <span class="hljs-attr">frame_state</span>: state
            };
            <span class="hljs-keyword">if</span> (state === <span class="hljs-string">'closed'</span>)
                data.frame_order = <span class="hljs-number">-1</span>;
            <span class="hljs-keyword">return</span> update(conversationID, data);
        },
        <span class="hljs-attr">changeFrameOrder</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">conversations</span>) </span>{
            <span class="hljs-keyword">var</span> data = {
                <span class="hljs-attr">frame_order</span>: conversations.join(<span class="hljs-string">','</span>)
            };
            <span class="hljs-keyword">return</span> snHttp.post(REST_API_PATH + <span class="hljs-string">'/order'</span>, data).then(extractResult);
        },
        <span class="hljs-attr">createConversation</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">groupName, recipients, message</span>) </span>{
            <span class="hljs-keyword">var</span> recipientJIDs = recipients.map(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">recipient</span>) </span>{
                <span class="hljs-keyword">return</span> recipient.jid;
            });
            <span class="hljs-keyword">var</span> data = {
                <span class="hljs-attr">group_name</span>: groupName,
                <span class="hljs-attr">recipients</span>: recipientJIDs,
                <span class="hljs-attr">message</span>: message.text,
                <span class="hljs-attr">reflected_field</span>: message.reflectedField || <span class="hljs-string">"comments"</span>,
                <span class="hljs-attr">attachments</span>: message.attachmentSysIDs,
                <span class="hljs-attr">context</span>: CONNECT_CONTEXT
            };
            <span class="hljs-keyword">return</span> snHttp.post(REST_API_PATH, data).then(extractResult);
        },
        <span class="hljs-attr">createDocumentConversation</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">table, sysID</span>) </span>{
            <span class="hljs-keyword">var</span> data = {
                <span class="hljs-attr">table</span>: table,
                <span class="hljs-attr">sys_id</span>: sysID
            };
            <span class="hljs-keyword">return</span> snHttp.post(REST_API_PATH + <span class="hljs-string">'/records'</span>, data).then(extractResult);
        },
        <span class="hljs-attr">setDocument</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">profileID, table, document</span>) </span>{
            <span class="hljs-keyword">var</span> data = {
                <span class="hljs-attr">table</span>: table,
                <span class="hljs-attr">document</span>: <span class="hljs-built_in">document</span>
            };
            <span class="hljs-keyword">return</span> snHttp.put(REST_API_PATH + <span class="hljs-string">'/'</span> + profileID + <span class="hljs-string">'/records'</span>, data);
        }
    };
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/conversation/service.conversations.js */</span>
angular.module(<span class="hljs-string">'sn.connect.conversation'</span>).service(<span class="hljs-string">'conversations'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">
    $rootScope, $q, $timeout, amb, i18n, conversationFactory, conversationPersister, documentsService, liveProfileID,
    userID, snHttp, queueEntries, snComposingPresence, snCustomEvent, snTabActivity, snNotification, profiles,
    snNotifier, userPreferences, messageBatcherService, isLoggedIn, sessionID, supportEnabled</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">var</span> i18nText;
    i18n.getMessages([<span class="hljs-string">'and'</span>, <span class="hljs-string">'more'</span>, <span class="hljs-string">'You have been mentioned'</span>], <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">i18nNames</span>) </span>{
        i18nText = i18nNames;
    });
    <span class="hljs-keyword">var</span> currentLiveProfile;
    profiles.getAsync(liveProfileID).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">liveProfile</span>) </span>{
        currentLiveProfile = liveProfile;
    });
    <span class="hljs-keyword">var</span> conversationsIndex = {};
    <span class="hljs-keyword">var</span> onNextUpdate = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{};
    <span class="hljs-keyword">var</span> lastRefresh = $q.when();
    <span class="hljs-keyword">var</span> firstRefresh = $q.defer();
    <span class="hljs-keyword">var</span> loaded = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">var</span> channelId = isLoggedIn ? userID : sessionID;
    amb.getChannel(<span class="hljs-string">"/connect/"</span> + channelId).subscribe(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>) </span>{
        <span class="hljs-keyword">var</span> event = response.data;
        <span class="hljs-keyword">var</span> type = event.event_type;
        <span class="hljs-keyword">var</span> data = event.event_data;
        <span class="hljs-keyword">var</span> conversationID = event.event_target || event.group || data.conversation_id;
        <span class="hljs-keyword">var</span> conversation = conversationsIndex[conversationID];
        <span class="hljs-keyword">if</span> (!conversation)
            <span class="hljs-keyword">return</span>;
        <span class="hljs-keyword">if</span> (type === <span class="hljs-string">"conversation_member_removed"</span>) {
            conversation.removeMember(data);
            <span class="hljs-keyword">if</span> (data.sys_id !== liveProfileID)
                <span class="hljs-keyword">return</span>;
            <span class="hljs-keyword">if</span> (conversation.isPending)
                <span class="hljs-keyword">return</span>;
            snComposingPresence.set(conversation.sysID, [], []);
            <span class="hljs-keyword">delete</span> conversationsIndex[conversation.sysID];
            <span class="hljs-keyword">return</span>;
        }
        <span class="hljs-keyword">if</span> (type === <span class="hljs-string">"conversation_member_added"</span>) {
            conversation.addMember(data);
            <span class="hljs-keyword">if</span> (data.sys_id === liveProfileID) {
                $rootScope.$broadcast(<span class="hljs-string">"conversation.refresh_messages"</span>, conversation);
            }
            <span class="hljs-keyword">return</span>;
        }
        <span class="hljs-keyword">if</span> (type === <span class="hljs-string">"conversation_deauthorized"</span>) {
            conversation.restricted = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">return</span>;
        }
        <span class="hljs-keyword">if</span> (type === <span class="hljs-string">"conversation_updated"</span>)
            refreshConversation(conversationID).then(onNextUpdate).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                onNextUpdate = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{};
            });
    });
    amb.getChannel(<span class="hljs-string">"/notifications/"</span> + liveProfileID).subscribe(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">message</span>) </span>{
        userPreferences.getPreference(<span class="hljs-string">"connect.notifications.desktop"</span>).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">value</span>) </span>{
            <span class="hljs-keyword">var</span> allowWebNotifications = angular.isString(value) ? value === <span class="hljs-string">"true"</span> : value;
            <span class="hljs-keyword">if</span> (allowWebNotifications &amp;&amp; snTabActivity.isPrimary) {
                <span class="hljs-keyword">var</span> body = i18nText[message.data.message] || message.data.message;
                snNotifier().notify(message.data.title, {
                    <span class="hljs-attr">body</span>: body,
                    <span class="hljs-attr">lifespan</span>: <span class="hljs-number">7000</span>,
                    <span class="hljs-attr">onClick</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                        <span class="hljs-built_in">window</span>.open(<span class="hljs-string">"/nav_to.do?uri=/"</span> + message.data.table + <span class="hljs-string">".do?sys_id="</span> + message.data.document, <span class="hljs-string">"_blank"</span>);
                    }
                });
            }
        });
    });
    amb.connect();
    snCustomEvent.observe(<span class="hljs-string">'connect:set_document'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>) </span>{
        conversationPersister.setDocument(data.conversation, data.table, data.document)
            .then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                onNextUpdate = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">conversation</span>) </span>{
                    documentsService.show(conversation.table, conversation.document);
                };
            });
    });
    $rootScope.$on(<span class="hljs-string">"amb.connection.recovered"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        refreshAll();
    });
    snTabActivity.on(<span class="hljs-string">"tab.primary"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        refreshAll();
    });

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">refreshAll</span>(<span class="hljs-params">queueID</span>) </span>{
        <span class="hljs-keyword">var</span> deferred = $q.defer();
        lastRefresh = deferred.promise;
        conversationPersister.getConversations(queueID).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">conversations</span>) </span>{
            <span class="hljs-keyword">if</span> (!loaded) {
                loaded = <span class="hljs-literal">true</span>;
                firstRefresh.resolve();
            }
            conversationsIndex = {};
            angular.forEach(conversations, addRawConversation);
            deferred.resolve();
        });
        <span class="hljs-keyword">return</span> lastRefresh;
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">refreshConversation</span>(<span class="hljs-params">id</span>) </span>{
        <span class="hljs-keyword">return</span> conversationPersister.getConversation(id).then(addRawConversation,
            <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>) </span>{
                <span class="hljs-keyword">if</span> (response.status === <span class="hljs-number">403</span>)
                    snNotification.show(<span class="hljs-string">"error"</span>, response.data.result);
                <span class="hljs-keyword">return</span> $q.reject(response)
            });
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addRawConversation</span>(<span class="hljs-params">conversationData</span>) </span>{
        <span class="hljs-keyword">if</span> (!conversationData)
            <span class="hljs-keyword">return</span>;
        <span class="hljs-keyword">var</span> conversation = <span class="hljs-keyword">new</span> conversationFactory.fromRawConversation(conversationData);
        <span class="hljs-keyword">return</span> conversationsIndex[conversation.sysID] = conversation;
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_get</span>(<span class="hljs-params">conversationID</span>) </span>{
        <span class="hljs-keyword">if</span> (conversationsIndex[conversationID])
            <span class="hljs-keyword">return</span> $q.when(conversationsIndex[conversationID]);
        <span class="hljs-keyword">return</span> refreshConversation(conversationID).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">if</span> (conversationID === <span class="hljs-string">'pending'</span>)
                <span class="hljs-keyword">return</span> NewConversation();
            <span class="hljs-keyword">if</span> (!conversationsIndex[conversationID])
                <span class="hljs-keyword">throw</span> <span class="hljs-string">"Conversation "</span> + conversationID + <span class="hljs-string">" does not exist"</span>;
            <span class="hljs-keyword">return</span> conversationsIndex[conversationID];
        })
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get</span>(<span class="hljs-params">conversationID</span>) </span>{
        <span class="hljs-keyword">return</span> lastRefresh.then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">return</span> _get(conversationID);
        }, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">return</span> _get(conversationID);
        })
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getCachedPeerConversations</span>(<span class="hljs-params">userSysID</span>) </span>{
        <span class="hljs-keyword">return</span> allConversations().filter(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">conversation</span>) </span>{
            <span class="hljs-keyword">return</span> conversation.isDirectMessage &amp;&amp; conversation.members.some(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">member</span>) </span>{
                <span class="hljs-keyword">return</span> member.userID === userSysID;
            });
        });
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">allConversations</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">Object</span>.keys(conversationsIndex).map(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">key</span>) </span>{
            <span class="hljs-keyword">return</span> conversationsIndex[key];
        });
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">find</span>(<span class="hljs-params">conversation, conversationList</span>) </span>{
        conversationList = conversationList || allConversations();
        <span class="hljs-keyword">var</span> sysID = conversation.sysID || conversation;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; conversationList.length; ++i) {
            <span class="hljs-keyword">var</span> conv = conversationList[i];
            <span class="hljs-keyword">if</span> (conv.sysID === sysID)
                <span class="hljs-keyword">return</span> {
                    <span class="hljs-attr">conversation</span>: conv,
                    <span class="hljs-attr">index</span>: i
                };
        }
        <span class="hljs-keyword">return</span> {
            <span class="hljs-attr">index</span>: <span class="hljs-number">-1</span>
        };
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">close</span>(<span class="hljs-params">conversationID</span>) </span>{
        <span class="hljs-keyword">var</span> conversation = conversationsIndex[conversationID];
        <span class="hljs-keyword">if</span> (!conversation)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">if</span> (!conversation.isHelpDesk) {
            remove(conversation);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }
        <span class="hljs-keyword">var</span> queueEntry = conversation.queueEntry;
        <span class="hljs-keyword">if</span> (queueEntry.isWaiting || queueEntry.isEscalated || queueEntry.isTransferRejected || queueEntry.isTransferCancelled) {
            removeSupport(conversation.sysID);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }
        <span class="hljs-keyword">if</span> (queueEntry.isClosedByAgent || !queueEntry.isAssignedToMe) {
            <span class="hljs-keyword">if</span> (!supportEnabled &amp;&amp; !conversation.restricted) {
                $rootScope.$broadcast(<span class="hljs-string">'connect.non_agent_conversation.close_prompt'</span>, conversation);
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            }
            closeSupport(conversationID, <span class="hljs-literal">true</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }
        $rootScope.$broadcast(<span class="hljs-string">'connect.support_conversation.close_prompt'</span>, conversation, <span class="hljs-literal">true</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">remove</span>(<span class="hljs-params">conversation</span>) </span>{
        conversation.closeFrameState();
        conversation.resetUnreadCount();
        conversation.visible = <span class="hljs-literal">false</span>;
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">closeSupport</span>(<span class="hljs-params">conversationID, agentLeave</span>) </span>{
        queueEntries.close(conversationID, agentLeave);
        <span class="hljs-keyword">if</span> (agentLeave)
            removeSupport(conversationID);
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">removeSupport</span>(<span class="hljs-params">conversationID</span>) </span>{
        queueEntries.remove(conversationID);
        <span class="hljs-keyword">delete</span> conversationsIndex[conversationID];
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">removeUser</span>(<span class="hljs-params">conversationID, userID</span>) </span>{
        <span class="hljs-keyword">var</span> conversation = conversationsIndex[conversationID];
        <span class="hljs-keyword">if</span> (userID === liveProfileID) {
            remove(conversation);
            <span class="hljs-keyword">if</span> (conversation.isHelpDesk)
                removeSupport(conversation.sysID);
        }
        conversationPersister.removeUser(conversationID, userID);
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">exists</span>(<span class="hljs-params">conversationID</span>) </span>{
        <span class="hljs-keyword">return</span> conversationID <span class="hljs-keyword">in</span> conversationsIndex;
    }
    <span class="hljs-keyword">var</span> NewConversation = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        messageBatcherService.removeMessageBatcher(<span class="hljs-string">"pending"</span>);

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">listRecipients</span>(<span class="hljs-params">recipients, shorten</span>) </span>{
            <span class="hljs-keyword">var</span> names = recipients.map(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">recipient</span>) </span>{
                <span class="hljs-keyword">return</span> shorten ?
                    recipient.name.split(<span class="hljs-string">" "</span>)[<span class="hljs-number">0</span>] :
                    recipient.name;
            });
            <span class="hljs-keyword">var</span> and = shorten ?
                <span class="hljs-string">" &amp; "</span> :
                (<span class="hljs-string">" "</span> + i18nText[<span class="hljs-string">"and"</span>] + <span class="hljs-string">" "</span>);
            <span class="hljs-keyword">var</span> more = shorten ?
                (<span class="hljs-string">" +"</span> + (recipients.length - <span class="hljs-number">3</span>)) :
                (and + (recipients.length - <span class="hljs-number">3</span>));
            more += <span class="hljs-string">" "</span> + i18nText[<span class="hljs-string">"more"</span>];
            <span class="hljs-keyword">switch</span> (recipients.length) {
                <span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:
                    <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:
                    <span class="hljs-keyword">return</span> names[<span class="hljs-number">0</span>];
                <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:
                    <span class="hljs-keyword">return</span> names[<span class="hljs-number">0</span>] + and + names[<span class="hljs-number">1</span>];
                <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:
                    <span class="hljs-keyword">return</span> names[<span class="hljs-number">0</span>] + <span class="hljs-string">", "</span> + names[<span class="hljs-number">1</span>] + <span class="hljs-string">", "</span> + and + names[<span class="hljs-number">2</span>];
                <span class="hljs-keyword">case</span> <span class="hljs-number">4</span>:
                    <span class="hljs-keyword">return</span> names[<span class="hljs-number">0</span>] + <span class="hljs-string">", "</span> + names[<span class="hljs-number">1</span>] + <span class="hljs-string">", "</span> + names[<span class="hljs-number">2</span>] + <span class="hljs-string">", "</span> + and + names[<span class="hljs-number">3</span>];
                <span class="hljs-keyword">default</span>:
                    <span class="hljs-keyword">return</span> names[<span class="hljs-number">0</span>] + <span class="hljs-string">", "</span> + names[<span class="hljs-number">1</span>] + <span class="hljs-string">", "</span> + names[<span class="hljs-number">2</span>] + <span class="hljs-string">", "</span> + more;
            }
        }
        <span class="hljs-keyword">return</span> {
            <span class="hljs-attr">sysID</span>: <span class="hljs-string">"pending"</span>,
            <span class="hljs-attr">isPending</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">pendingRecipients</span>: [],
            <span class="hljs-attr">name</span>: <span class="hljs-string">"New Conversation"</span>,
            <span class="hljs-attr">frameState</span>: <span class="hljs-string">'open'</span>,
            <span class="hljs-attr">frameOrder</span>: <span class="hljs-number">0</span>,
            get messageBatcher() {
                <span class="hljs-keyword">return</span> messageBatcherService.getBatcher(<span class="hljs-keyword">this</span>.sysID);
            },
            get firstMessage() {
                <span class="hljs-keyword">return</span> messageBatcherService.getFirstMessage(<span class="hljs-keyword">this</span>.sysID);
            },
            get isPendingNoRecipients() {
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.pendingRecipients.length === <span class="hljs-number">0</span>;
            },
            <span class="hljs-attr">getGroupName</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">var</span> nameArray = <span class="hljs-keyword">this</span>.pendingRecipients.slice();
                nameArray.unshift(currentLiveProfile);
                <span class="hljs-keyword">return</span> listRecipients(nameArray, <span class="hljs-literal">true</span>);
            },
            get displayRecipients() {
                <span class="hljs-keyword">return</span> listRecipients(<span class="hljs-keyword">this</span>.pendingRecipients, <span class="hljs-literal">false</span>);
            },
            <span class="hljs-attr">closeFrameState</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{},
            <span class="hljs-attr">openFrameState</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{},
            <span class="hljs-attr">$reset</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> newConversation = <span class="hljs-keyword">new</span> NewConversation();
            }
        };
    };
    <span class="hljs-keyword">var</span> newConversation = <span class="hljs-keyword">new</span> NewConversation();
    <span class="hljs-keyword">var</span> emptyConversation = conversationFactory.fromObject({});
    emptyConversation.isEmpty = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">return</span> {
        get all() {
            <span class="hljs-keyword">return</span> allConversations();
        },
        get indexed() {
            <span class="hljs-keyword">return</span> conversationsIndex;
        },
        <span class="hljs-attr">loaded</span>: firstRefresh.promise,
        <span class="hljs-attr">get</span>: get,
        <span class="hljs-attr">getCachedPeerConversations</span>: getCachedPeerConversations,
        <span class="hljs-attr">refreshAll</span>: refreshAll,
        <span class="hljs-attr">refreshConversation</span>: refreshConversation,
        <span class="hljs-attr">exists</span>: exists,
        <span class="hljs-attr">find</span>: find,
        <span class="hljs-attr">addUser</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">conversationID, userID</span>) </span>{
            <span class="hljs-keyword">return</span> conversationPersister.addUser(conversationID, userID).then(get, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>) </span>{
                <span class="hljs-keyword">if</span> (response.status === <span class="hljs-number">403</span>)
                    snNotification.show(<span class="hljs-string">"error"</span>, response.data.result);
                <span class="hljs-keyword">return</span> $q.reject(response)
            });
        },
        <span class="hljs-attr">removeUser</span>: removeUser,
        <span class="hljs-attr">followDocumentConversation</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>) </span>{
            <span class="hljs-keyword">return</span> conversationPersister.createDocumentConversation(data.table, data.sysID).then(addRawConversation);
        },
        <span class="hljs-attr">unfollowDocumentConversation</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>) </span>{
            <span class="hljs-keyword">var</span> conversationID = data.conversationID;
            <span class="hljs-keyword">if</span> (conversationID === <span class="hljs-string">"undefined"</span>)
                conversationID = <span class="hljs-literal">undefined</span>;
            <span class="hljs-keyword">if</span> (!conversationID) {
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> id <span class="hljs-keyword">in</span> conversationsIndex) {
                    <span class="hljs-keyword">if</span> (!conversationsIndex.hasOwnProperty(id))
                        <span class="hljs-keyword">continue</span>;
                    <span class="hljs-keyword">var</span> conversation = conversationsIndex[id];
                    <span class="hljs-keyword">if</span> (conversation.document === data.sysID) {
                        conversationID = conversation.sysID;
                        <span class="hljs-keyword">break</span>;
                    }
                }
            }
            <span class="hljs-keyword">return</span> removeUser(conversationID, liveProfileID);
        },
        <span class="hljs-attr">close</span>: close,
        <span class="hljs-attr">closeSupport</span>: closeSupport,
        <span class="hljs-attr">update</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">conversationID, data</span>) </span>{
            <span class="hljs-keyword">var</span> conversation = conversationsIndex[conversationID];
            data.name = data.name.trim();
            <span class="hljs-keyword">if</span> (data.name.length === <span class="hljs-number">0</span>)
                data.name = conversation.name;
            data.description = data.description.trim();
            <span class="hljs-keyword">if</span> (data.description.length === <span class="hljs-number">0</span>)
                data.description = conversation.description;
            <span class="hljs-keyword">if</span> ((data.name === conversation.name) &amp;&amp;
                (data.description === conversation.description) &amp;&amp;
                (data.access === conversation.access))
                <span class="hljs-keyword">return</span>;
            conversation.name = data.name;
            conversation.description = data.description;
            conversation.access = data.access;
            <span class="hljs-keyword">var</span> element = {
                <span class="hljs-attr">name</span>: data.name,
                <span class="hljs-attr">short_description</span>: data.description,
                <span class="hljs-attr">access</span>: data.access
            };
            <span class="hljs-keyword">return</span> conversationPersister.update(conversationID, element).then(addRawConversation);
        },
        <span class="hljs-attr">beginNewConversation</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">groupName, recipients, message</span>) </span>{
            messageBatcherService.addMessages(message);
            <span class="hljs-keyword">return</span> conversationPersister.createConversation(groupName, recipients, message).then(addRawConversation);
        },
        get newConversation() {
            <span class="hljs-keyword">return</span> newConversation;
        },
        get emptyConversation() {
            <span class="hljs-keyword">return</span> emptyConversation;
        }
    }
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/conversation/directive.snConversation.js */</span>
angular.module(<span class="hljs-string">'sn.connect.conversation'</span>).directive(<span class="hljs-string">'snConversation'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">
    getTemplateUrl, $rootScope, $timeout, messageService, activeConversation, profiles</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
        <span class="hljs-attr">templateUrl</span>: getTemplateUrl(<span class="hljs-string">"snConversation.xml"</span>),
        <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">scope</span>: {
            <span class="hljs-attr">conversation</span>: <span class="hljs-string">"="</span>,
            <span class="hljs-attr">shouldAnnounce</span>: <span class="hljs-string">"=readmessages"</span>,
            <span class="hljs-attr">showSenderPresence</span>: <span class="hljs-string">"@"</span>
        },
        <span class="hljs-attr">link</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">scope, element</span>) </span>{
            scope.loading = <span class="hljs-literal">false</span>;
            scope.$watch(<span class="hljs-string">"messagesLoadedOnce"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">var</span> isConversationActive = !activeConversation.pendingConversation;
                <span class="hljs-keyword">if</span> (isConversationActive)
                    $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                        <span class="hljs-keyword">var</span> el = element.find(<span class="hljs-string">'.new-message'</span>);
                        el.focus()
                    }, <span class="hljs-number">0</span>, <span class="hljs-literal">false</span>);
                $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    scope.loading = !scope.messagesLoadedOnce &amp;&amp; isConversationActive;
                }, <span class="hljs-number">0</span>, <span class="hljs-literal">true</span>);
            });
            scope.checkForUnloadedMessages = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    <span class="hljs-keyword">var</span> scrollHeight = element.find(<span class="hljs-string">".sn-feed-messages"</span>)[<span class="hljs-number">0</span>].scrollHeight;
                    <span class="hljs-keyword">var</span> containerHeight = element.find(<span class="hljs-string">".sn-feed-messages"</span>).height();
                    <span class="hljs-keyword">if</span> (scrollHeight &lt; containerHeight) {
                        scope.retrieveMessageHistory().then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">retrievedMessages</span>) </span>{
                            <span class="hljs-keyword">if</span> (retrievedMessages.length === <span class="hljs-number">30</span>)
                                scope.checkForUnloadedMessages();
                            <span class="hljs-keyword">else</span>
                                $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                                    scope.$broadcast(<span class="hljs-string">'connect.auto_scroll.jump_to_bottom'</span>);
                                }, <span class="hljs-number">0</span>, <span class="hljs-literal">false</span>);
                        });
                    }
                });
            };

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onClick</span>(<span class="hljs-params">evt</span>) </span>{
                $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    <span class="hljs-keyword">var</span> profileID = angular.element(evt.target).attr(<span class="hljs-string">'class'</span>).substring(<span class="hljs-string">"at-mention at-mention-user-"</span>.length);
                    profiles.getAsync(profileID).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">profile</span>) </span>{
                        scope.showPopover = <span class="hljs-literal">true</span>;
                        scope.mentionPopoverProfile = profile;
                        scope.clickEvent = evt;
                    });
                }, <span class="hljs-number">0</span>, <span class="hljs-literal">false</span>);
            }
            element.on(<span class="hljs-string">"click"</span>, <span class="hljs-string">".at-mention"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">evt</span>) </span>{
                <span class="hljs-keyword">if</span> (scope.showPopover) {
                    <span class="hljs-keyword">var</span> off = scope.$on(<span class="hljs-string">"snMentionPopover.showPopoverIsFalse"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                        onClick(evt);
                        off();
                    });
                } <span class="hljs-keyword">else</span> {
                    onClick(evt);
                }
            });
            element.on(<span class="hljs-string">"click"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">evt</span>) </span>{
                scope.focusOnConversation();
            });
        },
        <span class="hljs-attr">controller</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$scope, $element, $q, snRecordPresence, queueEntries, hotKeyHandler, snHotKey,
            snComposingPresence, userID, inFrameSet</span>) </span>{
            $scope.messagesLoadedOnce = <span class="hljs-literal">false</span>;
            $scope.showLoading = <span class="hljs-literal">true</span>;
            $scope.rawMessages = [];
            $scope.asideOpen = <span class="hljs-literal">false</span>;
            $scope.$on(<span class="hljs-string">"sn.aside.open"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                $scope.asideOpen = <span class="hljs-literal">true</span>;
            });
            $scope.$on(<span class="hljs-string">"sn.aside.close"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                $scope.asideOpen = <span class="hljs-literal">false</span>;
            });
            $scope.isComposingHidden = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> $scope.conversation.isHelpDesk &amp;&amp; !$scope.conversation.queueEntry.isActive;
            };
            <span class="hljs-keyword">var</span> closeHotKey = <span class="hljs-keyword">new</span> snHotKey({
                <span class="hljs-attr">key</span>: <span class="hljs-string">"ESC"</span>,
                <span class="hljs-attr">callback</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    $scope.$broadcast(<span class="hljs-string">"snippets.hide"</span>, $scope.conversation);
                    hotKeyHandler.remove(closeHotKey);
                }
            });
            $scope.escalateOk = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                queueEntries.escalate($scope.conversation);
            };
            $rootScope.$on(<span class="hljs-string">'http-error.hide'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                messageService.retrieveMessages($scope.conversation);
            });
            $scope.isNoRecipientsMessageShowing = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> hasNoMessage() &amp;&amp; $scope.conversation.pendingRecipients.length === <span class="hljs-number">0</span>;
            };
            $scope.isOneRecipientsMessageShowing = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> hasNoMessage() &amp;&amp; $scope.conversation.pendingRecipients.length === <span class="hljs-number">1</span>;
            };
            $scope.isGroupMessageShowing = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> hasNoMessage() &amp;&amp; $scope.conversation.pendingRecipients.length &gt; <span class="hljs-number">1</span>;
            };

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">hasNoMessage</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> !$scope.conversation.firstMessage;
            }

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isVisible</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> ($element[<span class="hljs-number">0</span>].offsetWidth !== <span class="hljs-number">0</span>) &amp;&amp; ($element[<span class="hljs-number">0</span>].offsetHeight !== <span class="hljs-number">0</span>);
            }
            $scope.$watch(isVisible, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">visible</span>) </span>{
                <span class="hljs-keyword">if</span> (!visible || $scope.conversation.isPending)
                    <span class="hljs-keyword">return</span>;
                <span class="hljs-keyword">if</span> (inFrameSet &amp;&amp; $scope.conversation.isFrameStateMinimize)
                    <span class="hljs-keyword">return</span>;
                $scope.conversation.resetUnreadCount();
            });
            $scope.$watch(<span class="hljs-string">"conversation.sysID"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">newSysID</span>) </span>{
                <span class="hljs-keyword">if</span> (!newSysID)
                    <span class="hljs-keyword">return</span>;
                <span class="hljs-keyword">if</span> ($scope.conversation.isPending)
                    <span class="hljs-keyword">return</span>;
                $scope.messagesLoadedOnce = <span class="hljs-literal">false</span>;
                $scope.conversationAlreadyViewed = $scope.conversation.unreadCount &gt; <span class="hljs-number">0</span>;
                $scope.rawMessages = [];
                $scope.previousProfileID = <span class="hljs-keyword">void</span>(<span class="hljs-number">0</span>);
                <span class="hljs-keyword">if</span> (!$scope.conversation)
                    <span class="hljs-keyword">return</span>;
                <span class="hljs-keyword">if</span> ($scope.conversation.sysID) {
                    snComposingPresence.set($scope.conversation.sysID, {
                        <span class="hljs-attr">viewing</span>: [],
                        <span class="hljs-attr">typing</span>: []
                    });
                    snRecordPresence.initPresence(<span class="hljs-string">"live_group_profile"</span>, $scope.conversation.sysID);
                }
                refreshMessages().then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">loadedMessages</span>) </span>{
                    <span class="hljs-keyword">if</span> (loadedMessages.length === <span class="hljs-number">30</span>)
                        $scope.checkForUnloadedMessages();
                });
            });
            $scope.$root.$on(<span class="hljs-string">"sn.sessions"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">name, data</span>) </span>{
                <span class="hljs-keyword">if</span> (!$scope.conversation || !$scope.conversation.members)
                    <span class="hljs-keyword">return</span>;
                <span class="hljs-keyword">var</span> viewing = {};
                <span class="hljs-keyword">var</span> typing = {};
                angular.forEach(data, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">value</span>) </span>{
                    <span class="hljs-keyword">if</span> (value.user_id === userID)
                        <span class="hljs-keyword">return</span>;
                    <span class="hljs-keyword">var</span> conversationID = $scope.conversation.sysID;
                    <span class="hljs-keyword">if</span> (value.sys_id === conversationID) {
                        <span class="hljs-keyword">if</span> (value.status === <span class="hljs-string">"typing"</span>) {
                            typing[value.user_id] = <span class="hljs-literal">true</span>;
                            <span class="hljs-keyword">delete</span> viewing[value.user_id];
                        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((value.status === <span class="hljs-string">"viewing"</span> || value.status === <span class="hljs-string">"entered"</span>) &amp;&amp; !typing[value.user_id]) {
                            viewing[value.user_id] = <span class="hljs-literal">true</span>;
                        }
                    }
                });
                <span class="hljs-keyword">var</span> conversationViewing = [];
                <span class="hljs-keyword">var</span> conversationTyping = [];
                <span class="hljs-keyword">if</span> ($scope.conversation.amMember) {
                    angular.forEach($scope.conversation.members, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">member</span>) </span>{
                        <span class="hljs-keyword">if</span> (viewing[member.document])
                            conversationViewing.push(member);
                        <span class="hljs-keyword">if</span> (typing[member.document])
                            conversationTyping.push(member);
                    });
                    snComposingPresence.set($scope.conversation.sysID, {
                        <span class="hljs-attr">viewing</span>: conversationViewing,
                        <span class="hljs-attr">typing</span>: conversationTyping
                    });
                }
            });
            $scope.$on(<span class="hljs-string">"conversation.refresh_messages"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e, data</span>) </span>{
                <span class="hljs-keyword">if</span> ($scope.conversation.sysID !== data.sysID)
                    <span class="hljs-keyword">return</span>;
                refreshMessages();
            });
            $scope.$on(<span class="hljs-string">"amb.connection.recovered"</span>, refreshMessages);

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">refreshMessages</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> messageService.retrieveMessages($scope.conversation)
                    .then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">loadedMessages</span>) </span>{
                        $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                            $scope.$broadcast(<span class="hljs-string">'connect.auto_scroll.jump_to_bottom'</span>);
                        }, <span class="hljs-number">500</span>);
                        $scope.messagesLoadedOnce = <span class="hljs-literal">true</span>;
                        <span class="hljs-keyword">return</span> loadedMessages;
                    })
                    .catch(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                        $scope.messagesLoadedOnce = <span class="hljs-literal">true</span>;
                        <span class="hljs-keyword">return</span> [];
                    });
            }
            $scope.focusOnConversation = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">if</span> (activeConversation.pendingConversation)
                    $rootScope.$broadcast(<span class="hljs-string">"connect.message.focus"</span>, <span class="hljs-keyword">this</span>.conversation);
                <span class="hljs-keyword">else</span>
                    activeConversation.conversation = $scope.conversation;
            };
            $scope.retrieveMessageHistory = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">if</span> ($scope.conversation.isPending ||
                    $scope.conversation.restricted ||
                    !$scope.conversation.messageBatcher.batches.length)
                    <span class="hljs-keyword">return</span> $q.when([]);
                <span class="hljs-keyword">var</span> earliestReceivedTime = $scope.conversation.firstMessage.timestamp;
                <span class="hljs-keyword">var</span> promise = messageService.retrieveMessages($scope.conversation, earliestReceivedTime);
                <span class="hljs-keyword">if</span> (!promise)
                    <span class="hljs-keyword">return</span> $q.when([]);
                <span class="hljs-keyword">var</span> deferred = $q.defer();
                promise.then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">retrievedMessages</span>) </span>{
                    $scope.messagesLoadedOnce = <span class="hljs-literal">false</span>;
                    $scope.rawMessages = [];
                    $scope.messagesLoadedOnce = <span class="hljs-literal">true</span>;
                    deferred.resolve(retrievedMessages);
                });
                <span class="hljs-keyword">return</span> deferred.promise;
            };
            $scope.$on(<span class="hljs-string">"ngRepeat.complete"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
                <span class="hljs-keyword">if</span> (angular.equals(e.targetScope, $scope))
                    <span class="hljs-keyword">return</span>;
                $scope.$broadcast(<span class="hljs-string">"ngRepeat.complete"</span>);
            });
        }
    }
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/conversation/directive.snConversationFooter.js */</span>
angular.module(<span class="hljs-string">'sn.connect.conversation'</span>).directive(<span class="hljs-string">'snConversationFooter'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">getTemplateUrl</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
        <span class="hljs-attr">templateUrl</span>: getTemplateUrl(<span class="hljs-string">"snConversationFooter.xml"</span>),
        <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">scope</span>: {
            <span class="hljs-attr">conversation</span>: <span class="hljs-string">"="</span>
        },
        <span class="hljs-attr">controller</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$scope, $rootScope, amb, uploadAttachmentService, queueEntries, inSupportClient, showActionsForClosedCases</span>) </span>{
            $scope.amb = amb;
            <span class="hljs-keyword">var</span> snHttpError = <span class="hljs-literal">false</span>;
            $scope.$on(<span class="hljs-string">'http-error.show'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                snHttpError = <span class="hljs-literal">true</span>;
            });
            $scope.$on(<span class="hljs-string">'http-error.hide'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                snHttpError = <span class="hljs-literal">false</span>;
            });

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getNoticeType</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">if</span> (isQueueEntry(<span class="hljs-string">"isClosedByAgent"</span>))
                    <span class="hljs-keyword">return</span> <span class="hljs-string">"closed session"</span>;
                <span class="hljs-keyword">if</span> ($scope.conversation.restricted)
                    <span class="hljs-keyword">return</span> <span class="hljs-string">"restricted"</span>;
                <span class="hljs-keyword">if</span> (amb.interrupted || snHttpError)
                    <span class="hljs-keyword">return</span> <span class="hljs-string">"connection error"</span>;
                <span class="hljs-keyword">if</span> (inSupportClient &amp;&amp; !isQueueEntry(<span class="hljs-string">"isActive"</span>) &amp;&amp; !isQueueEntry(<span class="hljs-string">"isClosedByAgent"</span>))
                    <span class="hljs-keyword">return</span> <span class="hljs-string">"rejoin"</span>;
                <span class="hljs-keyword">if</span> (!inSupportClient &amp;&amp; isQueueEntry(<span class="hljs-string">"isWaiting"</span>))
                    <span class="hljs-keyword">return</span> <span class="hljs-string">"agent waiting"</span>;
                <span class="hljs-keyword">if</span> ($scope.conversation.isPendingNoRecipients)
                    <span class="hljs-keyword">return</span> <span class="hljs-string">"no recipients"</span>;
                <span class="hljs-keyword">if</span> (uploadAttachmentService.filesInProgress.length &gt; <span class="hljs-number">0</span>)
                    <span class="hljs-keyword">return</span> <span class="hljs-string">"upload in progress"</span>;
            }
            $scope.isNoticeShowing = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> !!getNoticeType();
            };
            $scope.isClosedSessionShowing = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> getNoticeType() === <span class="hljs-string">"closed session"</span>;
            };
            $scope.isConnectionErrorShowing = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> getNoticeType() === <span class="hljs-string">"connection error"</span>;
            };
            $scope.isRestrictedShowing = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> getNoticeType() === <span class="hljs-string">"restricted"</span>;
            };
            $scope.isRejoinShowing = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> getNoticeType() === <span class="hljs-string">"rejoin"</span>;
            };
            $scope.isAgentWaitingShowing = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> getNoticeType() === <span class="hljs-string">"agent waiting"</span>;
            };
            $scope.isNewConversationNoRecipientsShowing = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> getNoticeType() === <span class="hljs-string">"no recipients"</span>;
            };
            $scope.isUploadInProgressShowing = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> getNoticeType() === <span class="hljs-string">"upload in progress"</span>;
            };
            $scope.isError = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> $scope.isRestrictedShowing() || $scope.isConnectionErrorShowing();
            };
            $scope.isQueueNameShowing = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> isQueueEntry(<span class="hljs-string">"queue"</span>);
            };
            $scope.isQueueNumberShowing = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> $scope.conversation.table == <span class="hljs-string">'chat_queue_entry'</span>;
            };
            $scope.isDocumentNumberShowing = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> $scope.conversation.hasRecord;
            };

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isQueueEntry</span>(<span class="hljs-params">field</span>) </span>{
                <span class="hljs-keyword">return</span> $scope.conversation.isHelpDesk &amp;&amp; $scope.conversation.queueEntry[field];
            }
            $scope.selectSnippet = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">snippet</span>) </span>{
                $scope.$broadcast(<span class="hljs-string">"connect.conversation.insert_snippet"</span>, snippet);
            };
            $scope.rejoin = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                queueEntries.rejoin($scope.conversation.sysID);
            };
            $scope.isMenuVisible = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> !inSupportClient &amp;&amp;
                    !$scope.conversation.isEmpty &amp;&amp;
                    $scope.conversation.chatActions &amp;&amp;
                    $scope.conversation.chatActions.getMenuActions().length &gt; <span class="hljs-number">0</span> &amp;&amp;
                    (!isQueueEntry(<span class="hljs-string">"isClosedByAgent"</span>) || showActionsForClosedCases);
            };
        }
    }
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/conversation/directive.snConversationAddUserButton.js */</span>
angular.module(<span class="hljs-string">'sn.connect.conversation'</span>).directive(<span class="hljs-string">'snConversationAddUserButton'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">getTemplateUrl</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
        <span class="hljs-attr">scope</span>: {
            <span class="hljs-attr">conversation</span>: <span class="hljs-string">"="</span>
        },
        <span class="hljs-attr">templateUrl</span>: getTemplateUrl(<span class="hljs-string">"snConversationAddUserButton.xml"</span>),
        <span class="hljs-attr">controller</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$scope, $rootScope, conversations, activeConversation</span>) </span>{
            $scope.userSelected = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">user</span>) </span>{
                conversations.addUser($scope.conversation.sysID, user)
                    .then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">conversation</span>) </span>{
                        activeConversation.conversation = conversation;
                    })
            };
        }
    }
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/conversation/directive.snConversationContainer.js */</span>
angular.module(<span class="hljs-string">'sn.connect.conversation'</span>).directive(<span class="hljs-string">'snConversationContainer'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">getTemplateUrl</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
        <span class="hljs-attr">templateUrl</span>: getTemplateUrl(<span class="hljs-string">'snConversationContainer.xml'</span>),
        <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">scope</span>: {},
        <span class="hljs-attr">controller</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$scope, $timeout, conversations, activeConversation, screenWidth</span>) </span>{
            $scope.activeConversation = activeConversation;
            <span class="hljs-keyword">var</span> loading = <span class="hljs-literal">true</span>;
            conversations.loaded.then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                loading = <span class="hljs-literal">false</span>;
            });
            $scope.$on(<span class="hljs-string">"connect.new_conversation.cancelled"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                activeConversation.pendingConversation = <span class="hljs-literal">undefined</span>;
            });
            $scope.$on(<span class="hljs-string">"connect.new_conversation.complete"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                activeConversation.pendingConversation = <span class="hljs-literal">undefined</span>;
            });
            $scope.$on(<span class="hljs-string">"connect.show_create_conversation_screen"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">unused, preloadedMember</span>) </span>{
                activeConversation.pendingConversation = conversations.newConversation.$reset();
                activeConversation.tab = <span class="hljs-string">'chat'</span>;
                <span class="hljs-keyword">if</span> (preloadedMember)
                    $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                        $scope.$emit(<span class="hljs-string">"connect.member_profile.direct_message"</span>, preloadedMember);
                    });
            });
            $scope.showLoading = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> loading;
            };
            $scope.showIntroduction = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> !loading &amp;&amp; activeConversation.isEmpty;
            };
            $scope.showConversation = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> !loading &amp;&amp; !activeConversation.isEmpty;
            };
            $scope.showSidePanel = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> $scope.showConversation() &amp;&amp; screenWidth.isAbove(<span class="hljs-number">800</span>);
            };
            $scope.isCloseNewConversationShowing = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> !conversations.newConversation.firstMessage;
            };
            $scope.closeNewConversation = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                $scope.$emit(<span class="hljs-string">"connect.new_conversation.cancelled"</span>);
            };
        }
    }
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/conversation/directive.snConversationHeader.js */</span>
angular.module(<span class="hljs-string">'sn.connect'</span>).directive(<span class="hljs-string">'snConversationHeader'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">getTemplateUrl</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
        <span class="hljs-attr">templateUrl</span>: getTemplateUrl(<span class="hljs-string">'snConversationHeader.xml'</span>),
        <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">scope</span>: {
            <span class="hljs-attr">conversation</span>: <span class="hljs-string">'='</span>
        },
        <span class="hljs-attr">controller</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$scope, $element, $timeout, conversations, snAttachmentHandler, userID</span>) </span>{
            $scope.conversationTemp = {};
            $scope.middleAlignName = <span class="hljs-literal">false</span>;
            $scope.userID = userID;
            $scope.canEdit = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> $scope.conversation &amp;&amp; $scope.conversation.isGroup;
            };
            $scope.getPrimaryUser = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> $scope.conversation.isGroup ?
                    $scope.conversation.lastMessage.profileData :
                    $scope.conversation.peer;
            };
            $scope.onlyShowName = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">if</span> ($scope.conversation.isHelpDesk)
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
                <span class="hljs-keyword">if</span> ($scope.conversation.isGroup)
                    <span class="hljs-keyword">return</span> !$scope.showDescription();
                <span class="hljs-keyword">if</span> (!$scope.conversation.peer)
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
                <span class="hljs-keyword">var</span> detail = $scope.conversation.peer.detail;
                <span class="hljs-keyword">return</span> !detail || !(detail.department || detail.city);
            };
            $scope.showDescription = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> $scope.conversation.isGroup &amp;&amp; !(!$scope.conversation.description || $scope.conversation.description === <span class="hljs-string">""</span>) &amp;&amp;
                    !($scope.conversation.isHelpDesk &amp;&amp; $scope.conversation.queueEntry.isTransferPending);
            };
            $scope.isEditable = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> $scope.conversation.isGroup &amp;&amp; !$scope.conversation.isHelpDesk &amp;&amp; $scope.conversation.amMember;
            };
            $scope.saveGroupEdit = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                conversations.update($scope.conversation.sysID, $scope.conversationTemp);
            };
            $scope.openModal = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">evt</span>) </span>{
                <span class="hljs-keyword">if</span> (evt.keyCode === <span class="hljs-number">9</span> || !$scope.isEditable())
                    <span class="hljs-keyword">return</span>;
                $scope.conversationTemp = {
                    <span class="hljs-attr">name</span>: $scope.conversation.name,
                    <span class="hljs-attr">description</span>: $scope.conversation.description,
                    <span class="hljs-attr">access</span>: $scope.conversation.access
                };
                angular.element(<span class="hljs-string">"#chatGroupPopupModal"</span>).modal(<span class="hljs-string">'show'</span>).find(<span class="hljs-string">"#groupName"</span>).focus();
            };
            $scope.stopProp = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) </span>{
                event.stopPropagation();
            };
            $scope.uploadNewGroupImage = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">if</span> ($scope.conversation.amMember)
                    $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                        $element.find(<span class="hljs-string">".message-attach-file"</span>).click();
                    }, <span class="hljs-number">0</span>, <span class="hljs-literal">false</span>);
            };
            $scope.getImageBackground = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> {
                    <span class="hljs-string">'background-image'</span>: <span class="hljs-string">"url('"</span> + $scope.conversation.avatar + <span class="hljs-string">"')"</span>
                }
            };
            $scope.attachFiles = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">files</span>) </span>{
                $scope.uploading = <span class="hljs-literal">true</span>;
                snAttachmentHandler.create(<span class="hljs-string">"live_group_profile"</span>, $scope.conversation.sysID).uploadAttachment(files.files[<span class="hljs-number">0</span>], {
                    <span class="hljs-attr">sysparm_fieldname</span>: <span class="hljs-string">"photo"</span>
                }).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>) </span>{
                    conversations.refreshConversation($scope.conversation.sysID);
                    $scope.conversation.avatar = response.sys_id + <span class="hljs-string">".iix"</span>;
                    $scope.uploading = <span class="hljs-literal">false</span>;
                });
            }
        }
    };
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/conversation/directive.snConversationHeaderControls.js */</span>
angular.module(<span class="hljs-string">'sn.connect'</span>).directive(<span class="hljs-string">'snConversationHeaderControls'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">getTemplateUrl, i18n</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    <span class="hljs-keyword">var</span> knowledgeBaseTitle = <span class="hljs-string">""</span>;
    <span class="hljs-keyword">var</span> documentTitle = <span class="hljs-string">""</span>;
    i18n.getMessages([<span class="hljs-string">"Knowledge Base"</span>, <span class="hljs-string">"Document"</span>], <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">results</span>) </span>{
        knowledgeBaseTitle = results[<span class="hljs-string">"Knowledge Base"</span>];
        documentTitle = results[<span class="hljs-string">"Document"</span>];
    });
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
        <span class="hljs-attr">templateUrl</span>: getTemplateUrl(<span class="hljs-string">'snConversationHeaderControls.xml'</span>),
        <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">scope</span>: {
            <span class="hljs-attr">conversation</span>: <span class="hljs-string">'='</span>,
            <span class="hljs-attr">collapsible</span>: <span class="hljs-string">'@'</span>
        },
        <span class="hljs-attr">link</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">scope, element, attrs</span>) </span>{
            attrs.$observe(<span class="hljs-string">'collapsible'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">value</span>) </span>{
                scope.collapsible = scope.$<span class="hljs-built_in">eval</span>(value || <span class="hljs-string">'true'</span>);
            });
        },
        <span class="hljs-attr">controller</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$scope, $element, $animate, snConversationAsideHistory, $timeout</span>) </span>{
            $scope.expandDirection = <span class="hljs-string">"left"</span>;
            $scope.activeAside = <span class="hljs-string">""</span>;
            $scope.buttons = $element.find(<span class="hljs-string">'#conversationAsideButtons'</span>);
            <span class="hljs-keyword">var</span> activeAsideButton;
            <span class="hljs-keyword">var</span> helpDeskAsides = [<span class="hljs-string">"knowledge"</span>, <span class="hljs-string">"record"</span>, <span class="hljs-string">"pending_record"</span>];
            <span class="hljs-keyword">var</span> pendingRecordKeys = {};
            <span class="hljs-keyword">var</span> defaultAsideScope = $scope.$<span class="hljs-keyword">new</span>();
            <span class="hljs-keyword">var</span> asideViews = {
                <span class="hljs-attr">members</span>: {
                    <span class="hljs-attr">template</span>: <span class="hljs-string">"&lt;sn-aside-member-list&gt;&lt;/sn-aside-member-list&gt;"</span>,
                    <span class="hljs-attr">scope</span>: defaultAsideScope
                },
                <span class="hljs-attr">info</span>: {
                    <span class="hljs-attr">template</span>: <span class="hljs-string">"&lt;sn-aside-info&gt;&lt;/sn-aside-info&gt;"</span>,
                    <span class="hljs-attr">scope</span>: defaultAsideScope
                },
                <span class="hljs-attr">attachments</span>: {
                    <span class="hljs-attr">template</span>: <span class="hljs-string">"&lt;sn-aside-attachments&gt;&lt;/sn-aside-attachments&gt;"</span>,
                    <span class="hljs-attr">scope</span>: defaultAsideScope
                },
                <span class="hljs-attr">notifications</span>: {
                    <span class="hljs-attr">template</span>: <span class="hljs-string">"&lt;sn-aside-notifications&gt;&lt;/sn-aside-notifications&gt;"</span>,
                    <span class="hljs-attr">scope</span>: defaultAsideScope
                },
                <span class="hljs-attr">knowledge</span>: {
                    <span class="hljs-attr">template</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                        <span class="hljs-keyword">return</span> <span class="hljs-string">"&lt;sn-aside-frame name='knowledge' url=\"/$knowledge.do\" title='"</span> + knowledgeBaseTitle + <span class="hljs-string">"'&gt;&lt;/sn-aside-frame&gt;"</span>;
                    },
                    <span class="hljs-attr">width</span>: <span class="hljs-string">"50%"</span>,
                    <span class="hljs-attr">cacheKey</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                        <span class="hljs-keyword">return</span> $scope.conversation.sysID + <span class="hljs-string">".knowledgeBase"</span>;
                    }
                },
                <span class="hljs-attr">record</span>: {
                    <span class="hljs-attr">template</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                        <span class="hljs-keyword">return</span> <span class="hljs-string">"&lt;sn-aside-frame name='record' url=\"/"</span> + $scope.conversation.table + <span class="hljs-string">".do?sys_id="</span> + $scope.conversation.document + <span class="hljs-string">"\" title=\""</span> + documentTitle + <span class="hljs-string">"\"&gt;&lt;/sn-aside-frame&gt;"</span>;
                    },
                    <span class="hljs-attr">width</span>: <span class="hljs-string">"50%"</span>,
                    <span class="hljs-attr">cacheKey</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                        <span class="hljs-keyword">return</span> $scope.conversation.sysID + <span class="hljs-string">".record"</span>;
                    }
                },
                <span class="hljs-attr">pending_record</span>: {
                    <span class="hljs-attr">template</span>: <span class="hljs-string">""</span>,
                    <span class="hljs-attr">width</span>: <span class="hljs-string">"50%"</span>,
                    <span class="hljs-attr">cacheKey</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                        <span class="hljs-keyword">return</span> pendingRecordKeys[$scope.conversation.sysID] ? pendingRecordKeys[$scope.conversation.sysID] : $scope.conversation.sysID + <span class="hljs-string">".pending_record"</span>;
                    }
                }
            };
            $scope.isShowInfo = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> !$scope.conversation.isHelpDesk &amp;&amp; ($scope.conversation.document || $scope.conversation.resources.links.length &gt; <span class="hljs-number">0</span> || $scope.conversation.resources.records.length &gt; <span class="hljs-number">0</span>);
            };
            $scope.isShowRecord = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> $scope.conversation.isHelpDesk &amp;&amp; $scope.conversation.document &amp;&amp; $scope.conversation.table != <span class="hljs-string">'chat_queue_entry'</span>
            };

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">stringFunction</span>(<span class="hljs-params">stringOrFunction</span>) </span>{
                <span class="hljs-keyword">if</span> (angular.isFunction(stringOrFunction))
                    <span class="hljs-keyword">return</span> stringOrFunction();
                <span class="hljs-keyword">return</span> stringOrFunction;
            }
            $scope.$on(<span class="hljs-string">"sn.aside.open"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e, view</span>) </span>{
                <span class="hljs-keyword">var</span> cacheKey = stringFunction(view.cacheKey);
                <span class="hljs-keyword">if</span> (cacheKey &amp;&amp; cacheKey.indexOf(<span class="hljs-string">"pending_record"</span>) &gt; <span class="hljs-number">-1</span>) {
                    pendingRecordKeys[$scope.conversation.sysID] = cacheKey;
                }
            });
            $scope.$watch(<span class="hljs-string">"conversation.sysID"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">var</span> historicalAside = snConversationAsideHistory.getHistory($scope.conversation.sysID);
                <span class="hljs-keyword">if</span> ($scope.conversation.restricted) {
                    $scope.$emit(<span class="hljs-string">"sn.aside.close"</span>);
                    <span class="hljs-keyword">return</span>;
                }
                <span class="hljs-keyword">var</span> historicalAsideScopeValid = (historicalAside &amp;&amp; historicalAside.scope &amp;&amp; historicalAside.scope.$parent &amp;&amp; !historicalAside.scope.$parent[<span class="hljs-string">"$$destroyed"</span>]);
                <span class="hljs-keyword">if</span> (historicalAside &amp;&amp; historicalAsideScopeValid) {
                    $scope.$evalAsync(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                        $scope.$emit(<span class="hljs-string">"sn.aside.open"</span>, historicalAside);
                    });
                    <span class="hljs-keyword">return</span>;
                }
                <span class="hljs-keyword">if</span> (!$scope.activeAside)
                    <span class="hljs-keyword">return</span>;
                <span class="hljs-keyword">if</span> (!$scope.showInfo &amp;&amp; $scope.activeAside === <span class="hljs-string">"info"</span>) {
                    $scope.$emit(<span class="hljs-string">"sn.aside.close"</span>);
                    <span class="hljs-keyword">return</span>;
                }
                <span class="hljs-keyword">if</span> (helpDeskAsides.indexOf($scope.activeAside) &gt;= <span class="hljs-number">0</span> &amp;&amp; !$scope.conversation.isHelpDesk) {
                    $scope.$emit(<span class="hljs-string">"sn.aside.close"</span>);
                    <span class="hljs-keyword">return</span>;
                }
                <span class="hljs-keyword">if</span> ($scope.activeAside === <span class="hljs-string">"record"</span> &amp;&amp; $scope.conversation.table === <span class="hljs-string">"chat_queue_entry"</span>) {
                    $scope.$emit(<span class="hljs-string">"sn.aside.close"</span>);
                    <span class="hljs-keyword">return</span>;
                }
                <span class="hljs-keyword">if</span> ($scope.activeAside === <span class="hljs-string">"pending_record"</span> &amp;&amp; !$scope.conversation.pendingRecord) {
                    $scope.$emit(<span class="hljs-string">"sn.aside.close"</span>);
                    <span class="hljs-keyword">return</span>;
                }
                $scope.$emit(<span class="hljs-string">"sn.aside.open"</span>, asideViews[$scope.activeAside], asideWidth($scope.activeAside));
            });

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">asideWidth</span>(<span class="hljs-params">view</span>) </span>{
                <span class="hljs-keyword">return</span> asideViews[view].width || $scope.buttons.width();
            }
            $scope.$on(<span class="hljs-string">"sn.aside.trigger_control"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e, view</span>) </span>{
                <span class="hljs-keyword">if</span> (!asideViews.hasOwnProperty(view))
                    <span class="hljs-keyword">return</span>;
                <span class="hljs-keyword">if</span> ($scope.activeAside === view) {
                    <span class="hljs-keyword">if</span> ($scope.collapsible)
                        $scope.$emit(<span class="hljs-string">"sn.aside.close"</span>);
                    <span class="hljs-keyword">return</span>;
                }
                $scope.activeAside = view;
                $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    $scope.$emit(<span class="hljs-string">"sn.aside.open"</span>, asideViews[view], asideWidth(view));
                }, <span class="hljs-number">0</span>, <span class="hljs-literal">false</span>);
            });
            $scope.openAside = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">view</span>) </span>{
                $scope.$emit(<span class="hljs-string">"sn.aside.trigger_control"</span>, view);
            };
            $scope.$on(<span class="hljs-string">"sn.aside.controls.active"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e, data</span>) </span>{
                activeAsideButton = $element.find(<span class="hljs-string">'[aside-view-name="'</span> + data + <span class="hljs-string">'"]'</span>);
                $scope.activeAside = data;
            });
            $scope.$on(<span class="hljs-string">"sn.aside.close"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">if</span> (activeAsideButton) {
                    activeAsideButton.focus();
                }
                $scope.activeAside = <span class="hljs-keyword">void</span>(<span class="hljs-number">0</span>);
                activeAsideButton = <span class="hljs-keyword">void</span>(<span class="hljs-number">0</span>);
            });

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">resizeAside</span>(<span class="hljs-params">unused, phase</span>) </span>{
                <span class="hljs-keyword">if</span> (phase === <span class="hljs-string">"close"</span> &amp;&amp; $scope.activeAside &amp;&amp; asideViews[$scope.activeAside]) {
                    $scope.$emit(<span class="hljs-string">"sn.aside.resize"</span>, asideWidth($scope.activeAside));
                }
            }
            $animate.on(<span class="hljs-string">'addClass'</span>, $scope.buttons, resizeAside);
            $animate.on(<span class="hljs-string">'removeClass'</span>, $scope.buttons, resizeAside);
            $scope.close = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">evt</span>) </span>{
                <span class="hljs-keyword">if</span> (evt.keyCode === <span class="hljs-number">9</span>)
                    <span class="hljs-keyword">return</span>;
                $scope.$emit(<span class="hljs-string">"sn.aside.close"</span>);
            }
        }
    };
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/conversation/directive.snConversationItem.js */</span>
angular.module(<span class="hljs-string">'sn.connect.conversation'</span>).directive(<span class="hljs-string">'snConversationItem'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">
    getTemplateUrl, inSupportClient, conversations, activeConversation</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
        <span class="hljs-attr">templateUrl</span>: getTemplateUrl(inSupportClient ? <span class="hljs-string">'snConversationItem-SupportClient.xml'</span> : <span class="hljs-string">'snConversationItem.xml'</span>),
        <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">scope</span>: {
            <span class="hljs-attr">conversation</span>: <span class="hljs-string">'='</span>
        },
        <span class="hljs-attr">controller</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$scope, $rootScope</span>) </span>{
            $scope.isBadgeVisible = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> ($scope.conversation.unreadCount &gt; <span class="hljs-number">0</span>) &amp;&amp; !$scope.isTransferPending();
            };
            $scope.getUserFromProfile = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">conversation</span>) </span>{
                <span class="hljs-keyword">return</span> conversation.isGroup ? conversation.lastMessage.profileData : conversation.peer;
            };
            $scope.remove = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$event</span>) </span>{
                <span class="hljs-keyword">if</span> ($event &amp;&amp; $event.keyCode === <span class="hljs-number">9</span>)
                    <span class="hljs-keyword">return</span>;
                $event.stopPropagation();
                closeConversation();
            };

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">closeConversation</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">if</span> (conversations.close($scope.conversation.sysID)) {
                    $rootScope.$broadcast(<span class="hljs-string">"sn.aside.clearCache"</span>, $scope.conversation.sysID);
                    activeConversation.clear($scope.conversation);
                }
            }
            <span class="hljs-keyword">return</span> {
                <span class="hljs-attr">closeConversation</span>: closeConversation
            }
        }
    };
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/conversation/directive.snSupportConversationItem.js */</span>
angular.module(<span class="hljs-string">'sn.connect.conversation'</span>).directive(<span class="hljs-string">'snSupportConversationItem'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">getTemplateUrl, inSupportClient</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
        <span class="hljs-attr">templateUrl</span>: getTemplateUrl(inSupportClient ? <span class="hljs-string">'snConversationItem-SupportClient.xml'</span> : <span class="hljs-string">'snSupportConversationItem.xml'</span>),
        <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">require</span>: <span class="hljs-string">'snConversationItem'</span>,
        <span class="hljs-attr">scope</span>: {
            <span class="hljs-attr">conversation</span>: <span class="hljs-string">'='</span>
        },
        <span class="hljs-attr">controller</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$scope, $rootScope, activeConversation, queueEntries,
            queueEntryNotifier, supportEnabled, inFrameSet, snConversationItemDirective</span>) </span>{
            <span class="hljs-keyword">var</span> parent = snConversationItemDirective[<span class="hljs-number">0</span>].controller.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>);
            $scope.supportEnabled = supportEnabled || <span class="hljs-literal">false</span>;
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; $scope.conversation.members.length; i++)
                <span class="hljs-keyword">if</span> ($scope.conversation.members[i].document === $scope.conversation.queueEntry.openedBy)
                    $scope.openedBy = $scope.conversation.members[i];
            $scope.acceptTransfer = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$event</span>) </span>{
                $event.stopPropagation();
                $scope.conversation.queueEntry.clearTransferState();
                queueEntries.accept($scope.conversation.sysID);
                activeConversation.conversation = $scope.conversation;
            };
            $scope.rejectTransfer = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$event</span>) </span>{
                $event.stopPropagation();
                $scope.conversation.queueEntry.clearTransferState();
                queueEntries.reject($scope.conversation.sysID);
                <span class="hljs-keyword">if</span> ($scope.conversation.queueEntry.transferShouldClose)
                    parent.closeConversation();
            };
            $scope.cancelTransfer = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$event</span>) </span>{
                $event.stopPropagation();
                $scope.conversation.queueEntry.clearTransferState();
                queueEntries.cancel($scope.conversation.sysID);
            };
            $scope.isTransferPending = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> !!$scope.conversation.isHelpDesk &amp;&amp; $scope.conversation.queueEntry.isTransferPending;
            };
            $scope.isSendingTransfer = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> $scope.isTransferPending() &amp;&amp; $scope.conversation.queueEntry.isTransferringFromMe;
            };
            $scope.isReceivingTransfer = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> $scope.isTransferPending() &amp;&amp; $scope.conversation.queueEntry.isTransferringToMe;
            };
            $rootScope.$on(<span class="hljs-string">"connect.queueEntry.updated"</span>, queueEntryUpdated);
            queueEntryUpdated(<span class="hljs-literal">undefined</span>, $scope.conversation.queueEntry);

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">queueEntryUpdated</span>(<span class="hljs-params">event, queueEntry, old</span>) </span>{
                <span class="hljs-keyword">if</span> (queueEntry.conversationID !== $scope.conversation.sysID)
                    <span class="hljs-keyword">return</span>;
                <span class="hljs-keyword">if</span> (!queueEntry)
                    <span class="hljs-keyword">return</span>;
                <span class="hljs-keyword">var</span> initial = angular.isUndefined(old);
                <span class="hljs-keyword">if</span> (!queueEntry.isTransferStateChanged &amp;&amp; !initial)
                    <span class="hljs-keyword">return</span>;
                <span class="hljs-keyword">if</span> ((inFrameSet || activeConversation.isEmpty) &amp;&amp;
                    queueEntry.isTransferringToMe &amp;&amp; queueEntry.isTransferPending)
                    activeConversation.conversation = $scope.conversation;
                <span class="hljs-keyword">var</span> isTransferNegative = queueEntry.isTransferCancelled || queueEntry.isTransferRejected;
                <span class="hljs-keyword">if</span> (queueEntry.isTransferringToMe &amp;&amp;
                    queueEntry.transferShouldClose &amp;&amp;
                    isTransferNegative)
                    parent.closeConversation();
                queueEntryNotifier.notify($scope.conversation);
            }
        }
    };
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/conversation/directive.snChatTab.js */</span>
angular.module(<span class="hljs-string">'sn.connect.conversation'</span>).directive(<span class="hljs-string">'snChatTab'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">getTemplateUrl</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
        <span class="hljs-attr">templateUrl</span>: getTemplateUrl(<span class="hljs-string">'snChatTab.xml'</span>),
        <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">scope</span>: {},
        <span class="hljs-attr">controller</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$scope, $rootScope, $filter, conversations, activeConversation,
            inFrameSet, supportEnabled, supportAddMembers</span>) </span>{
            $scope.isSupportListEnabled = !supportEnabled &amp;&amp; supportAddMembers;
            <span class="hljs-keyword">if</span> (!inFrameSet) {
                <span class="hljs-keyword">var</span> index = <span class="hljs-number">0</span>;
                $scope.$watch(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    <span class="hljs-keyword">return</span> activeConversation.sysID;
                }, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">sysID</span>) </span>{
                    <span class="hljs-keyword">if</span> (!sysID)
                        <span class="hljs-keyword">return</span>;
                    index = conversations.find(activeConversation.conversation, filterConversations(<span class="hljs-literal">true</span>)).index;
                    <span class="hljs-keyword">if</span> (index &lt; <span class="hljs-number">0</span>)
                        index = <span class="hljs-number">0</span>;
                });
                $scope.$watchCollection(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    <span class="hljs-keyword">return</span> filterConversations(<span class="hljs-literal">true</span>);
                }, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">conversationList</span>) </span>{
                    <span class="hljs-keyword">if</span> (activeConversation.isSupport)
                        <span class="hljs-keyword">return</span>;
                    <span class="hljs-keyword">if</span> (conversationList.length === <span class="hljs-number">0</span>)
                        <span class="hljs-keyword">return</span>;
                    <span class="hljs-keyword">if</span> (!activeConversation.isEmpty)
                        <span class="hljs-keyword">return</span>;
                    activeConversation.conversation = getIndexConversation(conversationList);
                });
                $scope.$on(<span class="hljs-string">'connect.conversation.select'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">unused, tab, conversationID</span>) </span>{
                    <span class="hljs-keyword">if</span> (activeConversation.getTab(tab).isSupport)
                        <span class="hljs-keyword">return</span>;
                    conversationID = conversationID || activeConversation.sysID;
                    <span class="hljs-keyword">var</span> conversationList = filterConversations(!conversationID);
                    <span class="hljs-keyword">var</span> conversation;
                    <span class="hljs-keyword">if</span> (conversationID)
                        conversation = conversations.find(conversationID, conversationList).conversation;
                    activeConversation.conversation = conversation || getIndexConversation(conversationList);
                });
                <span class="hljs-keyword">var</span> getIndexConversation = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">conversationList</span>) </span>{
                    <span class="hljs-keyword">if</span> (index &gt;= conversationList.length)
                        index = conversationList.length - <span class="hljs-number">1</span>;
                    <span class="hljs-keyword">if</span> (index &lt; <span class="hljs-number">0</span>)
                        index = <span class="hljs-number">0</span>;
                    <span class="hljs-keyword">return</span> conversationList[index];
                }
            }
            $scope.supportConversationsFilter = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">conversations</span>) </span>{
                <span class="hljs-keyword">return</span> supportEnabled ?
                    [] :
                    getConversations(conversations, <span class="hljs-literal">true</span>, <span class="hljs-literal">true</span>, $scope.searchTerm);
            };
            $scope.openConversationsFilter = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">conversations</span>) </span>{
                <span class="hljs-keyword">return</span> getConversations(conversations, <span class="hljs-literal">true</span>, <span class="hljs-literal">false</span>, $scope.searchTerm);
            };
            $scope.closedConversationsFilter = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">conversations</span>) </span>{
                <span class="hljs-keyword">return</span> getConversations(conversations, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>, $scope.searchTerm);
            };

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getConversations</span>(<span class="hljs-params">conversations, visible, support, searchTerm</span>) </span>{
                <span class="hljs-keyword">var</span> searchFiltered = $filter(<span class="hljs-string">'searchTerm'</span>)(conversations, searchTerm);
                <span class="hljs-keyword">if</span> (searchFiltered.length === <span class="hljs-number">0</span>)
                    <span class="hljs-keyword">return</span> [];
                <span class="hljs-keyword">return</span> $filter(<span class="hljs-string">'conversation'</span>)(searchFiltered, visible, support);
            }

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">filterConversations</span>(<span class="hljs-params">visible</span>) </span>{
                <span class="hljs-keyword">if</span> (!visible)
                    <span class="hljs-keyword">return</span> getConversations(conversations.all);
                <span class="hljs-keyword">return</span> $scope.supportConversationsFilter(conversations.all)
                    .concat($scope.openConversationsFilter(conversations.all));
            }
            $scope.triggerCreateConversation = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">evt</span>) </span>{
                <span class="hljs-keyword">if</span> (evt &amp;&amp; evt.keyCode === <span class="hljs-number">9</span>)
                    <span class="hljs-keyword">return</span>;
                $rootScope.$broadcast(<span class="hljs-string">"connect.show_create_conversation_screen"</span>);
                $rootScope.$broadcast(<span class="hljs-string">'connect.pane.close'</span>);
            };
            $scope.clearFilterText = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                $scope.searchTerm = <span class="hljs-string">""</span>;
            };
            $scope.hasSearchText = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> $scope.searchTerm &amp;&amp; $scope.searchTerm.length &gt; <span class="hljs-number">0</span>;
            };
            $scope.showOpenHeader = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> ($scope.hasSearchText() || hasSupportConversations()) &amp;&amp;
                    hasOpenConversations();
            };
            $scope.showClosedHeader = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> $scope.hasSearchText() &amp;&amp;
                    hasClosedConversations();
            };
            $scope.showMessageBlock = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> ($scope.showNoChatConversations() ||
                    $scope.showNoSearchResults());
            };
            $scope.showNoChatConversations = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> !$scope.hasSearchText() &amp;&amp;
                    filterConversations(<span class="hljs-literal">true</span>).length === <span class="hljs-number">0</span>;
            };
            $scope.showNoSearchResults = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> $scope.hasSearchText() &amp;&amp;
                    !hasSupportConversations() &amp;&amp;
                    !hasOpenConversations() &amp;&amp;
                    !hasClosedConversations();
            };

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">hasSupportConversations</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> $scope.supportConversationsFilter(conversations.all).length &gt; <span class="hljs-number">0</span>;
            }

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">hasOpenConversations</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> $scope.openConversationsFilter(conversations.all).length &gt; <span class="hljs-number">0</span>;
            }

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">hasClosedConversations</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> $scope.closedConversationsFilter(conversations.all).length &gt; <span class="hljs-number">0</span>;
            }
        }
    };
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/conversation/directive.snSupportTab.js */</span>
angular.module(<span class="hljs-string">'sn.connect.conversation'</span>).directive(<span class="hljs-string">'snSupportTab'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">getTemplateUrl</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
        <span class="hljs-attr">templateUrl</span>: getTemplateUrl(<span class="hljs-string">'snSupportTab.xml'</span>),
        <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">scope</span>: {},
        <span class="hljs-attr">controller</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$scope, $filter, conversations, activeConversation, inFrameSet</span>) </span>{
            <span class="hljs-keyword">if</span> (!inFrameSet) {
                $scope.$watchCollection(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    <span class="hljs-keyword">return</span> filterConversations();
                }, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">conversationList</span>) </span>{
                    <span class="hljs-keyword">if</span> (!activeConversation.isSupport)
                        <span class="hljs-keyword">return</span>;
                    <span class="hljs-keyword">if</span> (conversationList.length === <span class="hljs-number">0</span>)
                        <span class="hljs-keyword">return</span>;
                    <span class="hljs-keyword">if</span> (activeConversation.isEmpty)
                        activeConversation.conversation = conversationList[<span class="hljs-number">0</span>];
                });
            }
            $scope.primarySupportConversationsFilter = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">conversations</span>) </span>{
                <span class="hljs-keyword">return</span> supportConversationsFilter(conversations, <span class="hljs-literal">true</span>);
            };
            $scope.secondarySupportConversationsFilter = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">conversations</span>) </span>{
                <span class="hljs-keyword">return</span> supportConversationsFilter(conversations, <span class="hljs-literal">false</span>);
            };

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">supportConversationsFilter</span>(<span class="hljs-params">conversations, primary</span>) </span>{
                <span class="hljs-keyword">return</span> $filter(<span class="hljs-string">'conversation'</span>)(conversations, <span class="hljs-literal">true</span>, <span class="hljs-literal">true</span>).filter(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">conversation</span>) </span>{
                    <span class="hljs-keyword">var</span> queueEntry = conversation.queueEntry;
                    <span class="hljs-keyword">return</span> primary === (queueEntry.isAssignedToMe || queueEntry.isTransferringToMe);
                });
            };

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">filterConversations</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> $scope.primarySupportConversationsFilter(conversations.all)
                    .concat($scope.secondarySupportConversationsFilter(conversations.all));
            }
            $scope.$on(<span class="hljs-string">'connect.conversation.select'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">unused, tab, conversationID</span>) </span>{
                <span class="hljs-keyword">if</span> (!activeConversation.getTab(tab).isSupport)
                    <span class="hljs-keyword">return</span>;
                <span class="hljs-keyword">if</span> (!activeConversation.isEmpty &amp;&amp; activeConversation.sysID === conversationID)
                    <span class="hljs-keyword">return</span>;
                conversationID = conversationID || activeConversation.sysID;
                <span class="hljs-keyword">var</span> conversationList = filterConversations();
                <span class="hljs-keyword">var</span> conversation;
                <span class="hljs-keyword">if</span> (conversationID)
                    conversation = conversations.find(conversationID, conversationList).conversation;
                activeConversation.conversation = conversation || conversationList[<span class="hljs-number">0</span>];
            });
            $scope.showNoSupportSession = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> filterConversations().length === <span class="hljs-number">0</span>;
            };
        }
    };
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/conversation/directive.snConversationList.js */</span>
angular.module(<span class="hljs-string">'sn.connect.conversation'</span>).directive(<span class="hljs-string">'snConversationList'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">getTemplateUrl, i18n</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    <span class="hljs-keyword">var</span> unreadMessage = <span class="hljs-string">'Unread Messages'</span>;
    i18n.getMessages([unreadMessage], <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">i18nNames</span>) </span>{
        unreadMessage = i18nNames[unreadMessage];
    });
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
        <span class="hljs-attr">templateUrl</span>: getTemplateUrl(<span class="hljs-string">'snConversationList.xml'</span>),
        <span class="hljs-attr">scope</span>: {
            <span class="hljs-attr">headerText</span>: <span class="hljs-string">'@'</span>,
            <span class="hljs-attr">isHelpDesk</span>: <span class="hljs-string">'=?'</span>,
            <span class="hljs-attr">filter</span>: <span class="hljs-string">'&amp;?'</span>,
            <span class="hljs-attr">isHeaderVisible</span>: <span class="hljs-string">'&amp;?'</span>
        },
        <span class="hljs-attr">controller</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$scope, $rootScope, conversations, activeConversation, inSupportClient</span>) </span>{
            $scope.isHelpDesk = $scope.isHelpDesk || <span class="hljs-literal">false</span>;
            $scope.conversations = [];
            <span class="hljs-keyword">if</span> (angular.isUndefined($scope.isHeaderVisible)) {
                $scope.isHeaderVisible = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                        <span class="hljs-keyword">return</span> $scope.conversations.length &gt; <span class="hljs-number">0</span>;
                    };
                }
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">var</span> value = $scope.isHeaderVisible();
                <span class="hljs-keyword">if</span> (!angular.isFunction(value)) {
                    $scope.isHeaderVisible = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                            <span class="hljs-keyword">return</span> value;
                        };
                    }
                }
            }
            $scope.$watchCollection(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">if</span> ($scope.filter)
                    <span class="hljs-keyword">return</span> $scope.filter()(conversations.all);
                <span class="hljs-keyword">return</span> conversations.all;
            }, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">conversations</span>) </span>{
                $scope.conversations = conversations || [];
            });
            $scope.isActive = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">conversation</span>) </span>{
                <span class="hljs-keyword">return</span> activeConversation.isActive(conversation);
            };
            $scope.selectConversation = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event, conversation</span>) </span>{
                <span class="hljs-keyword">if</span> (event &amp;&amp; event.keyCode === <span class="hljs-number">9</span>)
                    <span class="hljs-keyword">return</span>;
                $rootScope.$broadcast(<span class="hljs-string">'connect.open.floating'</span>, conversation);
                $rootScope.$broadcast(<span class="hljs-string">"connect.new_conversation.cancelled"</span>);
                activeConversation.conversation = conversation;
            };
            $scope.getAriaText = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">conversation</span>) </span>{
                <span class="hljs-keyword">var</span> text = inSupportClient ?
                    conversation.description :
                    conversation.name;
                text += conversation.unreadCount ?
                    <span class="hljs-string">' '</span> + conversation.formattedUnreadCount + <span class="hljs-string">' '</span> + unreadMessage :
                    <span class="hljs-string">''</span>;
                <span class="hljs-keyword">return</span> text;
            }
            $scope.conversationDelta = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">conversation</span>) </span>{
                <span class="hljs-keyword">return</span> conversation.sysID + conversation.avatar + conversation.name;
            }
        }
    };
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/conversation/directive.snConversationListContainer.js */</span>
angular.module(<span class="hljs-string">'sn.connect.conversation'</span>).directive(<span class="hljs-string">'snConversationListContainer'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">
    getTemplateUrl, conversations, i18n</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    <span class="hljs-keyword">var</span> supportTabAriaLabel = <span class="hljs-string">"Support Conversations - {0} Unread Messages"</span>;
    i18n.getMessages([supportTabAriaLabel], <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">results</span>) </span>{
        supportTabAriaLabel = results[supportTabAriaLabel];
    });
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
        <span class="hljs-attr">templateUrl</span>: getTemplateUrl(<span class="hljs-string">'snConversationListContainer.xml'</span>),
        <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">scope</span>: {},
        <span class="hljs-attr">link</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">scope, element</span>) </span>{
            conversations.loaded.then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                element.removeClass(<span class="hljs-string">"loading"</span>);
            })
        },
        <span class="hljs-attr">controller</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$scope, $rootScope, $filter, snCustomEvent, conversationFactory, queues,
            activeConversation, supportEnabled, inFrameSet, chatEnabled</span>) </span>{
            $scope.inFrameSet = inFrameSet;
            $scope.supportEnabled = supportEnabled;
            $scope.chatEnabled = chatEnabled;
            $scope.showTabs = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> supportEnabled &amp;&amp; chatEnabled;
            };
            $scope.getSupportTabAriaLabel = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> i18n.format(supportTabAriaLabel, $scope.getSupportUnreadCount());
            };
            $scope.isUsersWaitingIndicatorShowing = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> (queues.getAllWaitingCount() &gt; <span class="hljs-number">0</span>) &amp;&amp; !$scope.isSupport();
            };
            snCustomEvent.observe(<span class="hljs-string">'chat:open_conversation'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">profile</span>) </span>{
                <span class="hljs-keyword">var</span> cachedPeerConversations = conversations.getCachedPeerConversations(profile.userID || profile.sys_id);
                <span class="hljs-keyword">if</span> (cachedPeerConversations[<span class="hljs-number">0</span>]) {
                    activeConversation.tab = <span class="hljs-string">'chat'</span>;
                    activeConversation.conversation = cachedPeerConversations[<span class="hljs-number">0</span>];
                } <span class="hljs-keyword">else</span> {
                    $rootScope.$broadcast(<span class="hljs-string">"connect.show_create_conversation_screen"</span>, profile);
                }
            });
            $scope.isSupport = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> activeConversation.isSupport;
            };
            $scope.openChat = openTab(<span class="hljs-string">'chat'</span>);
            $scope.openSupport = openTab(<span class="hljs-string">'support'</span>);

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">openTab</span>(<span class="hljs-params">tab</span>) </span>{
                <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    activeConversation.tab = tab;
                }
            }
            $scope.getChatUnreadCount = getUnreadCount(<span class="hljs-literal">false</span>);
            $scope.getSupportUnreadCount = getUnreadCount(<span class="hljs-literal">true</span>);

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getUnreadCount</span>(<span class="hljs-params">isSupport</span>) </span>{
                <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    <span class="hljs-keyword">var</span> unreadCount = <span class="hljs-number">0</span>;
                    $filter(<span class="hljs-string">'conversation'</span>)(conversations.all, <span class="hljs-literal">true</span>, isSupport)
                        .forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">conversation</span>) </span>{
                            <span class="hljs-keyword">if</span> (isSupport &amp;&amp; conversation.queueEntry &amp;&amp; conversation.queueEntry.isTransferringToMe)
                                <span class="hljs-keyword">return</span>;
                            unreadCount += conversation.unreadCount;
                        });
                    <span class="hljs-keyword">return</span> conversationFactory.formatUnreadCount(unreadCount);
                }
            }
            $scope.$watch(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> $scope.getChatUnreadCount() + $scope.getSupportUnreadCount();
            }, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">unreadCount</span>) </span>{
                CustomEvent.fireTop(<span class="hljs-string">'connect:message_notification.update'</span>, unreadCount);
            });
        }
    };
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/conversation/directive.snConversationSearch.js */</span>
angular.module(<span class="hljs-string">'sn.connect.conversation'</span>).directive(<span class="hljs-string">'snConversationSearch'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">getTemplateUrl, $timeout</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
        <span class="hljs-attr">scope</span>: {
            <span class="hljs-attr">title</span>: <span class="hljs-string">"@"</span>,
            <span class="hljs-attr">table</span>: <span class="hljs-string">"="</span>,
            <span class="hljs-attr">name</span>: <span class="hljs-string">"="</span>,
            <span class="hljs-attr">icon</span>: <span class="hljs-string">"@"</span>,
            <span class="hljs-attr">qualifier</span>: <span class="hljs-string">"=?"</span>,
            <span class="hljs-attr">searchField</span>: <span class="hljs-string">"=?"</span>,
            <span class="hljs-attr">onSelect</span>: <span class="hljs-string">"&amp;"</span>
        },
        <span class="hljs-attr">templateUrl</span>: getTemplateUrl(<span class="hljs-string">'snConversationSearch.xml'</span>),
        <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">link</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">scope, element</span>) </span>{
            scope.search = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">evt</span>) </span>{
                $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    element.find(<span class="hljs-string">".select2-choice"</span>).triggerHandler(<span class="hljs-string">"mousedown"</span>);
                    evt.preventDefault();
                }, <span class="hljs-number">0</span>, <span class="hljs-literal">false</span>);
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            }
        },
        <span class="hljs-attr">controller</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$scope</span>) </span>{
            $scope.descriptor = {
                <span class="hljs-attr">reference</span>: $scope.table,
                <span class="hljs-attr">attributes</span>: <span class="hljs-string">''</span>,
                <span class="hljs-attr">name</span>: $scope.name,
                <span class="hljs-attr">searchField</span>: $scope.searchField,
                <span class="hljs-attr">qualifier</span>: $scope.qualifier
            };
            $scope.valueSelected = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                $scope.onSelect({
                    <span class="hljs-attr">value</span>: <span class="hljs-string">"live_profile."</span> + $scope.field.value
                })
            };
            $scope.field = {};
        }
    }
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/conversation/directive.snCreateNewConversationHeader.js */</span>
angular.module(<span class="hljs-string">'sn.connect.conversation'</span>).directive(<span class="hljs-string">'snCreateNewConversationHeader'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">getTemplateUrl, $timeout</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
        <span class="hljs-attr">templateUrl</span>: getTemplateUrl(<span class="hljs-string">'snCreateNewConversationHeader.xml'</span>),
        <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">link</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">scope, elem</span>) </span>{
            <span class="hljs-keyword">var</span> input;
            scope.focusOnInput = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">if</span> (!input)
                    input = elem.find(<span class="hljs-string">"input"</span>);
                input.focus();
            };
            scope.scrollRecipientListToBottom = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    <span class="hljs-keyword">var</span> recipientListElem = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">"create-conversation-recipient-list"</span>);
                    recipientListElem.scrollTop = recipientListElem.scrollHeight;
                }, <span class="hljs-number">0</span>, <span class="hljs-literal">false</span>);
            };
            <span class="hljs-keyword">var</span> unWatch = scope.$on(<span class="hljs-string">"live.search.control.ready"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">evt, control</span>) </span>{
                <span class="hljs-keyword">if</span> (control)
                    input = control;
                $timeout(scope.focusOnInput, <span class="hljs-number">0</span>, <span class="hljs-literal">false</span>);
                unWatch();
            });
        },
        <span class="hljs-attr">controller</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$scope, $rootScope, activeConversation, conversations, snCustomEvent</span>) </span>{
            snCustomEvent.observe(<span class="hljs-string">'connect:member_profile.direct_message'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">suggestion</span>) </span>{
                $scope.selectedMember(<span class="hljs-literal">null</span>, suggestion);
                <span class="hljs-keyword">if</span> (suggestion)
                    $scope.$broadcast(<span class="hljs-string">"connect.message.focus"</span>, $scope.newConversation);
            });
            $rootScope.$on(<span class="hljs-string">"connect.member_profile.direct_message"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">evt, suggestion</span>) </span>{
                $scope.selectedMember(<span class="hljs-literal">null</span>, suggestion);
                <span class="hljs-keyword">if</span> (suggestion)
                    $scope.$broadcast(<span class="hljs-string">"connect.message.focus"</span>, $scope.newConversation);
            });

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">updatePendingConversation</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">var</span> conversation = conversations.newConversation;
                <span class="hljs-keyword">var</span> pendingRecipients = conversation.pendingRecipients;
                <span class="hljs-keyword">if</span> (pendingRecipients.length === <span class="hljs-number">1</span>) {
                    <span class="hljs-keyword">var</span> userSysID = pendingRecipients[<span class="hljs-number">0</span>].sysID;
                    <span class="hljs-keyword">var</span> cachedPeerConversation = conversations.getCachedPeerConversations(userSysID)[<span class="hljs-number">0</span>];
                    <span class="hljs-keyword">if</span> (cachedPeerConversation) {
                        conversation = angular.copy(cachedPeerConversation);
                        conversation.isPending = <span class="hljs-literal">true</span>;
                    }
                }
                activeConversation.pendingConversation = conversation;
            }
            $scope.pendingRecipients = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> conversations.newConversation.pendingRecipients;
            };
            $scope.isAddUserShowing = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> !conversations.newConversation.firstMessage;
            };
            $scope.ignoreList = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> conversations.newConversation.pendingRecipients.map(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">recipient</span>) </span>{
                    <span class="hljs-keyword">return</span> recipient.sysID;
                }).join(<span class="hljs-string">','</span>);
            };
            $scope.selectedMember = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">id, suggestion</span>) </span>{
                <span class="hljs-keyword">var</span> sys_id = suggestion.sys_id || suggestion.userID || suggestion.jid.split(<span class="hljs-string">"."</span>)[<span class="hljs-number">1</span>];
                <span class="hljs-keyword">var</span> recipient = {
                    <span class="hljs-attr">name</span>: suggestion.name,
                    <span class="hljs-attr">jid</span>: suggestion.jid || (suggestion.table + <span class="hljs-string">"."</span> + sys_id),
                    <span class="hljs-attr">sysID</span>: sys_id
                };
                <span class="hljs-keyword">var</span> alreadyAdded = conversations.newConversation.pendingRecipients
                    .some(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">obj</span>) </span>{
                        <span class="hljs-keyword">return</span> angular.equals(obj, recipient);
                    });
                <span class="hljs-keyword">if</span> (!alreadyAdded) {
                    conversations.newConversation.pendingRecipients.push(recipient);
                    updatePendingConversation();
                }
                $scope.scrollRecipientListToBottom();
            };
            $scope.removeRecipient = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event, index</span>) </span>{
                <span class="hljs-keyword">if</span> (event &amp;&amp; event.keyCode === <span class="hljs-number">9</span>)
                    <span class="hljs-keyword">return</span>;
                conversations.newConversation.pendingRecipients.splice(index, <span class="hljs-number">1</span>);
                updatePendingConversation();
                $scope.focusOnInput();
            };
            $scope.$on(<span class="hljs-string">"connect.search_control_key"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">evt, key</span>) </span>{
                $scope.$evalAsync(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    <span class="hljs-keyword">if</span> (key === <span class="hljs-string">"backspace"</span>) {
                        conversations.newConversation.pendingRecipients.pop();
                        updatePendingConversation();
                    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (key === <span class="hljs-string">"enter"</span>)
                        $rootScope.$broadcast(<span class="hljs-string">"connect.message.focus"</span>, activeConversation.pendingConversation);
                    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (key === <span class="hljs-string">"escape"</span>)
                        $scope.$emit(<span class="hljs-string">"connect.new_conversation.cancelled"</span>);
                });
            });
            $scope.$on(<span class="hljs-string">"connect.message_control_key"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">evt, key</span>) </span>{
                <span class="hljs-keyword">if</span> (key === <span class="hljs-string">"escape"</span>)
                    $scope.$emit(<span class="hljs-string">"connect.new_conversation.cancelled"</span>);
            });
        }
    };
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/conversation/directive.snFloatingConversation.js */</span>
angular.module(<span class="hljs-string">'sn.connect.conversation'</span>).directive(<span class="hljs-string">'snFloatingConversation'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">getTemplateUrl, $timeout, $animate, isRTL</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
        <span class="hljs-attr">templateUrl</span>: getTemplateUrl(<span class="hljs-string">'snFloatingConversation.xml'</span>),
        <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">scope</span>: {
            <span class="hljs-attr">position</span>: <span class="hljs-string">'='</span>,
            <span class="hljs-attr">conversation</span>: <span class="hljs-string">'='</span>
        },
        <span class="hljs-attr">link</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">scope, element</span>) </span>{
            scope.$watch(<span class="hljs-string">'position'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    <span class="hljs-keyword">var</span> property = isRTL ? <span class="hljs-string">'left'</span> : <span class="hljs-string">'right'</span>;
                    element.css(property, scope.position);
                    element.addClass(<span class="hljs-string">'loaded'</span>);
                }, <span class="hljs-number">0</span>, <span class="hljs-literal">false</span>);
            });
            scope.animateClose = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> $animate.addClass(element, <span class="hljs-string">"state-closing"</span>);
            };
            scope.$watch(<span class="hljs-string">'conversation.isFrameStateOpen'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">value, old</span>) </span>{
                <span class="hljs-keyword">if</span> (value === old)
                    <span class="hljs-keyword">return</span>;
                scope.$broadcast(<span class="hljs-string">'connect.auto_scroll.scroll_to_bottom'</span>, scope.conversation);
            });
            element.on(<span class="hljs-string">"click"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">evt</span>) </span>{
                scope.focusOnConversation();
            });
        },
        <span class="hljs-attr">controller</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$scope, $rootScope, activeConversation, resourcePersister, profiles, queueEntries,
            documentsService, userID, $timeout, snCustomEvent, audioNotifier, supportAddMembers,
            connectDropTargetService</span>) </span>{
            $scope.activeConversation = activeConversation;
            $scope.userID = userID;
            $scope.popoverOpen = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">evt</span>) </span>{
                <span class="hljs-keyword">var</span> el = angular.element(evt.target).closest(<span class="hljs-string">".sn-navhub-content"</span>).find(<span class="hljs-string">".sub-avatar"</span>);
                $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    angular.element(el).trigger(<span class="hljs-string">'click'</span>)
                }, <span class="hljs-number">0</span>);
            };
            CustomEvent.observe(<span class="hljs-string">'glide:nav_sync_list_with_form'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">conversation</span>) </span>{
                $scope.$apply(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    setSpotlighted(conversation);
                })
            });
            $scope.$on(<span class="hljs-string">"connect.spotlight"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">evt, conversation</span>) </span>{
                setSpotlighted(conversation);
            });

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setSpotlighted</span>(<span class="hljs-params">conversation</span>) </span>{
                $scope.isSpotlighted =
                    conversation.table === $scope.conversation.table &amp;&amp;
                    conversation.sysID === $scope.conversation.document;
            }
            $scope.focusOnConversation = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) </span>{
                activeConversation.conversation = $scope.conversation;
                <span class="hljs-keyword">if</span> (!event)
                    <span class="hljs-keyword">return</span>;
                <span class="hljs-keyword">if</span> (!$scope.conversation.isPending)
                    <span class="hljs-keyword">return</span>;
                <span class="hljs-keyword">if</span> (angular.element(event.target).parents(<span class="hljs-string">".sn-add-users"</span>).length !== <span class="hljs-number">0</span>)
                    <span class="hljs-keyword">return</span>;
                $rootScope.$broadcast(<span class="hljs-string">"connect.message.focus"</span>, $scope.conversation);
            };
            $scope.isCurrentConversation = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> activeConversation.isActive($scope.conversation);
            };
            $scope.isReadMessages = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> $scope.isCurrentConversation() &amp;&amp; $scope.conversation.isFrameStateOpen;
            };
            $scope.isTransferPending = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">var</span> queueEntry = $scope.conversation.queueEntry;
                <span class="hljs-keyword">return</span> queueEntry &amp;&amp; queueEntry.isTransferPending &amp;&amp; queueEntry.isTransferringToMe;
            };
            $scope.isCloseButtonShowing = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> !$scope.conversation.isPending || !$scope.conversation.firstMessage;
            };
            <span class="hljs-keyword">if</span> ($scope.isTransferPending())
                audioNotifier.notify($scope.conversation.sysID);
            $scope.$on(<span class="hljs-string">"connect.floatingConversationEscape"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">evt</span>) </span>{
                $scope.removeConversation(evt);
            });
            $scope.removeConversation = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$event</span>) </span>{
                <span class="hljs-keyword">if</span> ($event &amp;&amp; $event.keyCode === <span class="hljs-number">9</span>)
                    <span class="hljs-keyword">return</span>;
                snCustomEvent.fireTop(<span class="hljs-string">'snAvatar.closePopover'</span>);
                $rootScope.$broadcast(<span class="hljs-string">'mentio.closeMenu'</span>);
                $scope.stopPropagation($event);
                $scope.animateClose().then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    <span class="hljs-keyword">if</span> ($scope.conversation.isPending) {
                        $rootScope.$broadcast(<span class="hljs-string">"connect.new_conversation.cancelled"</span>);
                        <span class="hljs-keyword">return</span>;
                    }
                    $scope.conversation.closeFrameState();
                    activeConversation.clear($scope.conversation);
                })
            };
            $scope.getWindowTarget = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> <span class="hljs-string">'_blank'</span>;
            };
            $scope.showDocument = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">table, sysID, $event</span>) </span>{
                $scope.stopPropagation($event);
                documentsService.show(table, sysID);
            };
            $scope.showDocumentIfExists = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$event</span>) </span>{
                <span class="hljs-keyword">if</span> ($scope.isDocumentConversation())
                    $scope.showDocument($scope.conversation.table, $scope.conversation.document, $event);
            };
            $scope.stopPropagation = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$event</span>) </span>{
                <span class="hljs-keyword">if</span> ($event)
                    $event.stopPropagation();
            };
            <span class="hljs-keyword">var</span> toggleOpenLock;
            $scope.toggleOpen = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$event</span>) </span>{
                $scope.stopPropagation($event);
                <span class="hljs-keyword">if</span> (toggleOpenLock &amp;&amp; $event.timeStamp === toggleOpenLock) {
                    toggleOpenLock = <span class="hljs-literal">null</span>;
                    <span class="hljs-keyword">return</span>;
                } <span class="hljs-keyword">else</span>
                    toggleOpenLock = $event.timeStamp;
                <span class="hljs-keyword">if</span> ($scope.conversation.isFrameStateOpen) {
                    snCustomEvent.fireTop(<span class="hljs-string">'snAvatar.closePopover'</span>);
                    $scope.conversation.minimizeFrameState();
                    <span class="hljs-keyword">if</span> (activeConversation.isActive($scope.conversation))
                        activeConversation.clear();
                } <span class="hljs-keyword">else</span> {
                    $scope.conversation.openFrameState();
                    $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                        activeConversation.conversation = $scope.conversation;
                    }, <span class="hljs-number">0</span>, <span class="hljs-literal">false</span>);
                }
            };
            $scope.isPendingVisible = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> $scope.isTransferPending() || $scope.conversation.isPending;
            };
            $scope.isAddUserButtonVisible = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">var</span> conversation = $scope.conversation;
                <span class="hljs-keyword">if</span> (!conversation.isHelpDesk)
                    <span class="hljs-keyword">return</span> conversation.isGroup;
                <span class="hljs-keyword">return</span> supportAddMembers &amp;&amp;
                    conversation.queueEntry.isActive;
            };
            $scope.activateDropTarget = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                connectDropTargetService.activateDropTarget($scope.conversation);
            };
            $scope.deactivateDropTarget = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                connectDropTargetService.deactivateDropTarget($scope.conversation);
            };
            $scope.onFileDrop = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">files</span>) </span>{
                connectDropTargetService.onFileDrop(files, $scope.conversation);
            };
            $scope.handleDropEvent = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>) </span>{
                connectDropTargetService.handleDropEvent(data, $scope.conversation);
            };
            $scope.getPrimary = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> $scope.conversation.isGroup ?
                    $scope.conversation.lastMessage.profileData :
                    $scope.conversation.peer;
            };
            $scope.$watch(<span class="hljs-string">'conversation'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">conversation</span>) </span>{
                <span class="hljs-keyword">if</span> (activeConversation.isActive(conversation) &amp;&amp; !conversation.isFrameStateOpen)
                    activeConversation.clear();
            });
            $scope.$watch(<span class="hljs-string">'conversation.queueEntry'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">updateAssignedToProfile</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">if</span> (!$scope.conversation.isHelpDesk)
                    <span class="hljs-keyword">return</span>;
                profiles.getAsync(<span class="hljs-string">'sys_user.'</span> + $scope.conversation.queueEntry.assignedTo).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">profile</span>) </span>{
                    $scope.assignedToProfile = profile;
                });
            });
            $scope.acceptTransfer = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$event</span>) </span>{
                $scope.stopPropagation($event);
                queueEntries.accept($scope.conversation.sysID);
            };
            $scope.rejectTransfer = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$event</span>) </span>{
                $scope.stopPropagation($event);
                queueEntries.reject($scope.conversation.sysID);
                $scope.removeConversation();
            };
            $scope.isDocumentConversation = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> $scope.conversation.document !== <span class="hljs-string">''</span>;
            }
        }
    }
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/conversation/directive.snFloatingConversationCompressed.js */</span>
angular.module(<span class="hljs-string">'sn.connect.conversation'</span>).directive(<span class="hljs-string">'snFloatingConversationCompressed'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">getTemplateUrl, $timeout, isRTL</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
        <span class="hljs-attr">templateUrl</span>: getTemplateUrl(<span class="hljs-string">"snFloatingConversationCompressed.xml"</span>),
        <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">scope</span>: {
            <span class="hljs-attr">start</span>: <span class="hljs-string">'='</span>,
            <span class="hljs-attr">position</span>: <span class="hljs-string">'='</span>
        },
        <span class="hljs-attr">link</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">scope, element</span>) </span>{
            <span class="hljs-keyword">var</span> positionProperty = isRTL ? <span class="hljs-string">'left'</span> : <span class="hljs-string">'right'</span>;
            <span class="hljs-keyword">if</span> (element.hideFix) {
                element.hideFix();
            }
            scope.$watch(<span class="hljs-string">"start"</span>, setRightCoordinate);

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setRightCoordinate</span>(<span class="hljs-params"></span>) </span>{
                $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    element.css(positionProperty, scope.position);
                }, <span class="hljs-number">0</span>, <span class="hljs-literal">false</span>);
            }
            setRightCoordinate();
        },
        <span class="hljs-attr">controller</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$scope, $rootScope, $filter, conversations, activeConversation</span>) </span>{
            $scope.filterConversations = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> $filter(<span class="hljs-string">'frameSet'</span>)(conversations.all);
            };
            $scope.isVisible = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> $scope.compressConversations.length &gt; <span class="hljs-number">0</span>;
            };
            $scope.openConversation = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">conversation, $event</span>) </span>{
                <span class="hljs-keyword">if</span> ($event &amp;&amp; $event.keyCode === <span class="hljs-number">9</span>)
                    <span class="hljs-keyword">return</span>;
                $rootScope.$broadcast(<span class="hljs-string">'connect.open.floating'</span>, conversation);
            };
            $scope.closeConversation = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">conversation, $event</span>) </span>{
                <span class="hljs-keyword">if</span> ($event &amp;&amp; $event.keyCode === <span class="hljs-number">9</span>)
                    <span class="hljs-keyword">return</span>;
                conversation.closeFrameState();
                activeConversation.clear();
            };
            $scope.toggleOpen = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                $scope.open = !$scope.open;
            };
        }
    }
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/conversation/directive.snFloatingConversationContainer.js */</span>
angular.module(<span class="hljs-string">'sn.connect.conversation'</span>).directive(<span class="hljs-string">'snFloatingConversationContainer'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">
    getTemplateUrl, $rootScope, documentLinkMatcher, conversations, activeConversation</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
        <span class="hljs-attr">templateUrl</span>: getTemplateUrl(<span class="hljs-string">'snFloatingConversationContainer.xml'</span>),
        <span class="hljs-attr">scope</span>: {},
        <span class="hljs-attr">link</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">scope</span>) </span>{
            <span class="hljs-keyword">var</span> mainFrame = angular.element(<span class="hljs-string">"#gsft_main"</span>);
            <span class="hljs-keyword">if</span> (mainFrame.length &gt; <span class="hljs-number">0</span>) {
                scope.$watch(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    <span class="hljs-keyword">return</span> mainFrame[<span class="hljs-number">0</span>].contentDocument.location.href;
                }, checkForRecord);
                mainFrame.on(<span class="hljs-string">"load"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    scope.$digest();
                });
                mainFrame.on(<span class="hljs-string">"click"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    scope.$apply(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                        checkForRecord(mainFrame[<span class="hljs-number">0</span>].contentDocument.location.href)
                    })
                })
            }
            CustomEvent.observe(<span class="hljs-string">"connect:open_group"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>) </span>{
                conversations.followDocumentConversation(data).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">conversation</span>) </span>{
                    activeConversation.conversation = conversation;
                })
            });
            CustomEvent.observe(<span class="hljs-string">"connect:follow_document"</span>, conversations.followDocumentConversation);
            CustomEvent.observe(<span class="hljs-string">"connect:unfollow_document"</span>, conversations.unfollowDocumentConversation);

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">checkForRecord</span>(<span class="hljs-params">newValue</span>) </span>{
                <span class="hljs-keyword">if</span> (!documentLinkMatcher.isLink(newValue))
                    <span class="hljs-keyword">return</span>;
                $rootScope.$broadcast(<span class="hljs-string">"connect.spotlight"</span>, documentLinkMatcher.getRecordData(newValue));
            }
        },
        <span class="hljs-attr">controller</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$scope, $element, $filter, $timeout, $window, snRecordPresence, conversationPersister, isRTL</span>) </span>{
            angular.element(<span class="hljs-string">'document'</span>).append($element);
            <span class="hljs-keyword">var</span> FRAME_SPACING = <span class="hljs-number">350</span>;
            <span class="hljs-keyword">var</span> FRAME_COMPRESSED = <span class="hljs-number">60</span>;
            <span class="hljs-keyword">var</span> FRAME_SEPARATOR = <span class="hljs-number">10</span>;
            <span class="hljs-keyword">var</span> ASIDE_WIDTH = <span class="hljs-number">285</span>;
            $scope.activeConversation = activeConversation;
            conversations.refreshAll().then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                activeConversation.conversation = getFirstFocusConversation();
            });
            $scope.filterConversations = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> $filter(<span class="hljs-string">'frameSet'</span>)(conversations.all);
            };
            <span class="hljs-keyword">var</span> isAsideOpen = <span class="hljs-literal">false</span>;
            CustomEvent.observe(<span class="hljs-string">"connect:conversation_list:state"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">state</span>) </span>{
                isAsideOpen = state === <span class="hljs-string">"open"</span>;
                resize();
            });
            angular.element($<span class="hljs-built_in">window</span>).bind(<span class="hljs-string">'resize'</span>, resize);
            <span class="hljs-keyword">var</span> conversationDisplayCount = calculateConversationDisplayCount();
            <span class="hljs-keyword">var</span> resizeTimeout;

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">resize</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">if</span> (resizeTimeout)
                    $timeout.cancel(resizeTimeout);
                resizeTimeout = $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    conversationDisplayCount = calculateConversationDisplayCount();
                }, <span class="hljs-number">100</span>);
            }

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">calculateConversationDisplayCount</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">var</span> frameWidth = $<span class="hljs-built_in">window</span>.innerWidth;
                <span class="hljs-keyword">if</span> (isAsideOpen)
                    frameWidth -= ASIDE_WIDTH;
                <span class="hljs-keyword">var</span> allWidth = $scope.filterConversations().length * FRAME_SPACING;
                frameWidth -= (allWidth &gt; frameWidth) ? FRAME_COMPRESSED : FRAME_SEPARATOR;
                <span class="hljs-keyword">return</span> <span class="hljs-built_in">Math</span>.max(<span class="hljs-built_in">Math</span>.floor(frameWidth / FRAME_SPACING), <span class="hljs-number">1</span>);
            }
            $scope.getConversationDisplayCount = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> conversationDisplayCount - (activeConversation.pendingConversation ? <span class="hljs-number">1</span> : <span class="hljs-number">0</span>);
            };
            $scope.getCompressPosition = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> $scope.getContainerPosition(conversationDisplayCount);
            };
            $scope.getContainerPosition = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">index</span>) </span>{
                <span class="hljs-keyword">return</span> index * FRAME_SPACING + FRAME_SEPARATOR;
            };
            $scope.newConversation = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> conversations.newConversation;
            };
            $scope.$watch(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> activeConversation.sysID;
            }, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">sysID</span>) </span>{
                <span class="hljs-keyword">if</span> (!sysID) {
                    activeConversation.conversation = getFirstFocusConversation();
                    sysID = activeConversation.sysID;
                }
                <span class="hljs-keyword">if</span> (sysID)
                    snRecordPresence.initPresence(<span class="hljs-string">"live_group_profile"</span>, sysID);
            });

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getFirstFocusConversation</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">if</span> (activeConversation.pendingConversation)
                    <span class="hljs-keyword">return</span> activeConversation.pendingConversation;
                <span class="hljs-keyword">var</span> first = <span class="hljs-literal">undefined</span>;
                $scope.filterConversations()
                    .some(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">conversation, index</span>) </span>{
                        <span class="hljs-keyword">if</span> (!conversation.isFrameStateOpen)
                            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
                        <span class="hljs-keyword">if</span> (index &gt; conversationDisplayCount)
                            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
                        first = conversation;
                        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
                    });
                <span class="hljs-keyword">return</span> first;
            }
            $scope.$on(<span class="hljs-string">"connect.show_create_conversation_screen"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">evt, preloadedMember</span>) </span>{
                <span class="hljs-keyword">if</span> (activeConversation.pendingConversation)
                    <span class="hljs-keyword">return</span>;
                activeConversation.pendingConversation = conversations.newConversation.$reset();
                <span class="hljs-keyword">if</span> (preloadedMember)
                    $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                        $rootScope.$broadcast(<span class="hljs-string">"connect.member_profile.direct_message"</span>, preloadedMember);
                        $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                            $rootScope.$broadcast(<span class="hljs-string">"connect.member_profile.direct_message"</span>, preloadedMember)
                        }, <span class="hljs-number">0</span>, <span class="hljs-literal">false</span>);
                    });
            });
            $scope.$on(<span class="hljs-string">"connect.new_conversation.cancelled"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                activeConversation.pendingConversation = <span class="hljs-literal">undefined</span>;
                <span class="hljs-keyword">if</span> (activeConversation.isEmpty)
                    activeConversation.conversation = getFirstFocusConversation();
            });
            $scope.$on(<span class="hljs-string">"connect.new_conversation.complete"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event, conversation</span>) </span>{
                activeConversation.pendingConversation = <span class="hljs-literal">undefined</span>;
                moveToTop(conversation);
            });
            $scope.$on(<span class="hljs-string">"connect.open.floating"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event, conversation</span>) </span>{
                moveToTop(conversation);
            });

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">moveToTop</span>(<span class="hljs-params">conversation</span>) </span>{
                <span class="hljs-keyword">if</span> (conversation.isPending)
                    <span class="hljs-keyword">return</span>;
                <span class="hljs-keyword">if</span> (!conversation)
                    <span class="hljs-keyword">return</span>;
                conversation.openFrameState();
                <span class="hljs-keyword">var</span> conversationList = $scope.filterConversations();
                <span class="hljs-keyword">var</span> position = conversations.find(conversation, conversationList).index;
                <span class="hljs-keyword">if</span> (position &lt; <span class="hljs-number">1</span>) {
                    activeConversation.conversation = conversation;
                    $scope.$broadcast(<span class="hljs-string">'connect.auto_scroll.jump_to_bottom'</span>);
                    <span class="hljs-keyword">return</span>;
                }
                conversationList.splice(position, <span class="hljs-number">1</span>);
                conversationList.unshift(conversation);
                conversationPersister.changeFrameOrder(conversationList.map(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">conversation, index</span>) </span>{
                    conversation.frameOrder = index;
                    <span class="hljs-keyword">return</span> conversation.sysID;
                }));
                activeConversation.conversation = conversation;
                $scope.$broadcast(<span class="hljs-string">'connect.auto_scroll.jump_to_bottom'</span>);
            }
            <span class="hljs-keyword">if</span> (angular.element(<span class="hljs-built_in">document</span>.body).data().layout) {
                <span class="hljs-keyword">var</span> $connectFloating = $element.find(<span class="hljs-string">'.sn-connect-floating'</span>);
                <span class="hljs-keyword">var</span> positionProperty = isRTL ? <span class="hljs-string">'left'</span> : <span class="hljs-string">'right'</span>;
                $connectFloating.css(positionProperty, <span class="hljs-string">"5px"</span>);
                $scope.$on(<span class="hljs-string">"pane.collapsed"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">evt, position, collapsed</span>) </span>{
                    $connectFloating.css(positionProperty, collapsed ? <span class="hljs-string">"5px"</span> : <span class="hljs-string">"290px"</span>);
                });
            }
        }
    }
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/conversation/filter.searchTerm.js */</span>
angular.module(<span class="hljs-string">'sn.connect.conversation'</span>).filter(<span class="hljs-string">'searchTerm'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">input, searchTerm</span>) </span>{
        <span class="hljs-keyword">if</span> (!searchTerm || searchTerm.length === <span class="hljs-number">0</span>)
            <span class="hljs-keyword">return</span> input;
        <span class="hljs-keyword">var</span> directMessages = [],
            groupMessages = [];
        input.filter(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">item</span>) </span>{
            <span class="hljs-keyword">if</span> (item.isGroup)
                groupMessages.push(item);
            <span class="hljs-keyword">else</span>
                directMessages.push(item);
        });
        <span class="hljs-keyword">var</span> tempA = [],
            tempB = [];
        directMessages.filter(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">item</span>) </span>{
            <span class="hljs-keyword">if</span> (item.name.indexOf(searchTerm) === <span class="hljs-number">0</span>) {
                tempA.push(item);
            } <span class="hljs-keyword">else</span> {
                tempB.push(item);
            }
        });
        directMessages = tempA.concat(tempB);
        tempA = [];
        tempB = [];
        groupMessages.filter(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">item</span>) </span>{
            <span class="hljs-keyword">if</span> (item.name.indexOf(searchTerm) === <span class="hljs-number">0</span> || item.description.indexOf(searchTerm) === <span class="hljs-number">0</span>) {
                tempA.push(item);
            } <span class="hljs-keyword">else</span> {
                tempB.push(item);
            }
        });
        groupMessages = tempA.concat(tempB);
        <span class="hljs-keyword">var</span> newInput = directMessages.concat(groupMessages);

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">contains</span>(<span class="hljs-params">s, t</span>) </span>{
            <span class="hljs-keyword">var</span> s2 = s.toUpperCase();
            <span class="hljs-keyword">var</span> t2 = t.toUpperCase();
            <span class="hljs-keyword">return</span> s2.indexOf(t2) &gt; <span class="hljs-number">-1</span>;
        }
        <span class="hljs-keyword">return</span> newInput.filter(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">entry</span>) </span>{
            <span class="hljs-keyword">return</span> contains(entry.name, searchTerm) || contains(entry.description, searchTerm)
        });
    }
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/conversation/filter.conversation.js */</span>
angular.module(<span class="hljs-string">'sn.connect.conversation'</span>).filter(<span class="hljs-string">'conversation'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">
    inSupportClient, supportEnabled, supportAddMembers, closedConversationLimit</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isConversationDisplayable</span>(<span class="hljs-params">conversation, isHelpDesk</span>) </span>{
        <span class="hljs-keyword">if</span> (inSupportClient)
            <span class="hljs-keyword">return</span> conversation.isHelpDesk &amp;&amp; conversation.queueEntry.isOpenedByMe;
        <span class="hljs-keyword">if</span> (isHelpDesk !== conversation.isHelpDesk)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">if</span> (!isHelpDesk)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">return</span> (supportEnabled || supportAddMembers) &amp;&amp;
            !conversation.queueEntry.isOpenedByMe;
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isOpenSession</span>(<span class="hljs-params">conversation, isOpenSession</span>) </span>{
        <span class="hljs-keyword">if</span> (!conversation.isHelpDesk)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">return</span> !isOpenSession ===
            (conversation.queueEntry.isClosedByAgent || conversation.queueEntry.isAbandoned);
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isVisible</span>(<span class="hljs-params">conversation, visible</span>) </span>{
        <span class="hljs-keyword">return</span> conversation.visible === visible;
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">filter</span>(<span class="hljs-params">input, filter, fn</span>) </span>{
        <span class="hljs-keyword">return</span> angular.isUndefined(filter) ?
            input :
            input.filter(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">conversation</span>) </span>{
                <span class="hljs-keyword">return</span> fn(conversation, filter);
            });
    }
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">input, visible, helpDesk, openSession</span>) </span>{
        <span class="hljs-keyword">if</span> (angular.isObject(visible)) {
            <span class="hljs-keyword">var</span> object = visible;
            visible = object.visible;
            helpDesk = object.helpDesk;
            openSession = object.openSession;
        }
        input = filter(input, visible, isVisible);
        input = filter(input, helpDesk, isConversationDisplayable);
        input = filter(input, openSession, isOpenSession);
        input.sort(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">conv1, conv2</span>) </span>{
            <span class="hljs-keyword">return</span> conv2.sortIndex - conv1.sortIndex;
        });
        <span class="hljs-keyword">if</span> (angular.isDefined(openSession) &amp;&amp; !openSession &amp;&amp; closedConversationLimit)
            input = input.slice(<span class="hljs-number">0</span>, closedConversationLimit);
        <span class="hljs-keyword">return</span> input;
    }
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/conversation/filter.frameSet.js */</span>
angular.module(<span class="hljs-string">'sn.connect.conversation'</span>).filter(<span class="hljs-string">'frameSet'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">input</span>) </span>{
        <span class="hljs-keyword">return</span> input.filter(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">conversation</span>) </span>{
            <span class="hljs-keyword">return</span> !conversation.isFrameStateClosed &amp;&amp; conversation.visible;
        }).sort(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">conv1, conv2</span>) </span>{
            <span class="hljs-keyword">return</span> conv1.frameOrder - conv2.frameOrder;
        });
    }
});;;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/resource/js_includes_connect_resource.js */</span>
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/resource/_module.js */</span>
angular.module(<span class="hljs-string">"sn.connect.resource"</span>, [<span class="hljs-string">"ng.common"</span>]);;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/resource/factory.LiveLink.js */</span>
angular.module(<span class="hljs-string">"sn.connect.resource"</span>).factory(<span class="hljs-string">"liveLinkFactory"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">
    $sce, $window, attachmentFactory, inFrameSet</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">linkObject</span>(<span class="hljs-params">link, external, type</span>) </span>{
        <span class="hljs-keyword">var</span> isConnectType = (type === <span class="hljs-string">'connect'</span>);
        external |= isConnectType;
        <span class="hljs-keyword">var</span> url = (inFrameSet || external) ?
            link :
            <span class="hljs-string">"/nav_to.do?uri="</span> + <span class="hljs-built_in">encodeURIComponent</span>(link);
        <span class="hljs-keyword">var</span> target =
            (!inFrameSet &amp;&amp; isConnectType) ? <span class="hljs-string">"_self"</span> :
            (inFrameSet &amp;&amp; !external) ? <span class="hljs-string">'gsft_main'</span> :
            <span class="hljs-string">"_blank"</span>;
        <span class="hljs-keyword">var</span> classType = external ? <span class="hljs-string">"external-link"</span> : <span class="hljs-string">"internal-link"</span>;
        <span class="hljs-keyword">return</span> {
            <span class="hljs-attr">url</span>: url,
            <span class="hljs-attr">target</span>: target,
            <span class="hljs-attr">classType</span>: classType
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fromObject</span>(<span class="hljs-params">data, visible</span>) </span>{
        <span class="hljs-keyword">if</span> (angular.isUndefined(visible))
            visible = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">var</span> attachment = data.type_metadata &amp;&amp; data.type_metadata.attachment;
        <span class="hljs-keyword">if</span> (attachment)
            attachment = attachmentFactory.fromObject(attachment);
        <span class="hljs-keyword">return</span> {
            <span class="hljs-attr">sysID</span>: data.sys_id,
            <span class="hljs-attr">type</span>: data.type,
            <span class="hljs-attr">url</span>: data.url,
            <span class="hljs-attr">display</span>: data.title || data.url,
            <span class="hljs-attr">displayUrl</span>: data.url.replace(<span class="hljs-regexp">/^(?:https?:\/)?\//</span>, <span class="hljs-string">''</span>),
            <span class="hljs-attr">title</span>: data.title,
            <span class="hljs-attr">shortDescription</span>: data.short_description,
            <span class="hljs-attr">siteName</span>: data.site_name,
            <span class="hljs-attr">timestamp</span>: data.timestamp,
            <span class="hljs-attr">external</span>: data.external,
            <span class="hljs-attr">displayFields</span>: data.type_metadata &amp;&amp; data.type_metadata.display_fields,
            <span class="hljs-attr">embedLink</span>: data.type_metadata &amp;&amp; data.type_metadata.embed_link,
            <span class="hljs-attr">imageLink</span>: data.type_metadata &amp;&amp; data.type_metadata.image_link,
            <span class="hljs-attr">avatarID</span>: data.type_metadata &amp;&amp; data.type_metadata.avatar_id,
            <span class="hljs-attr">avatarDisplay</span>: data.type_metadata &amp;&amp; data.type_metadata.avatar_display,
            <span class="hljs-attr">createdOn</span>: data.type_metadata &amp;&amp; data.type_metadata.sys_created_on,
            <span class="hljs-attr">updatedOn</span>: data.type_metadata &amp;&amp; data.type_metadata.sys_updated_on,
            <span class="hljs-attr">isActive</span>: data.state === <span class="hljs-string">"active"</span>,
            <span class="hljs-attr">isPending</span>: data.state === <span class="hljs-string">"pending"</span>,
            <span class="hljs-attr">isError</span>: data.state === <span class="hljs-string">"error"</span>,
            <span class="hljs-attr">isUnauthorized</span>: data.state === <span class="hljs-string">"unauthorized"</span>,
            <span class="hljs-attr">isDeleted</span>: data.state === <span class="hljs-string">"deleted"</span>,
            <span class="hljs-attr">visible</span>: visible,
            <span class="hljs-attr">isRecord</span>: data.type == <span class="hljs-string">"record"</span>,
            <span class="hljs-attr">isImage</span>: data.type === <span class="hljs-string">"image"</span>,
            <span class="hljs-attr">attachment</span>: attachment,
            get isHideable() {
                <span class="hljs-keyword">return</span> ((attachment || <span class="hljs-keyword">this</span>.isRecord) &amp;&amp; <span class="hljs-keyword">this</span>.isActive) || <span class="hljs-keyword">this</span>.isImage;
            },
            <span class="hljs-attr">open</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) </span>{
                <span class="hljs-keyword">if</span> (event.keyCode === <span class="hljs-number">9</span>)
                    <span class="hljs-keyword">return</span>;
                <span class="hljs-keyword">var</span> link = linkObject(<span class="hljs-keyword">this</span>.url, <span class="hljs-keyword">this</span>.external, <span class="hljs-keyword">this</span>.type);
                $<span class="hljs-built_in">window</span>.open(link.url, link.target);
            },
            <span class="hljs-attr">aTag</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">text</span>) </span>{
                <span class="hljs-keyword">var</span> link = linkObject(<span class="hljs-keyword">this</span>.url, <span class="hljs-keyword">this</span>.external, <span class="hljs-keyword">this</span>.type);
                <span class="hljs-keyword">var</span> aTag = angular.element(<span class="hljs-string">"&lt;a /&gt;"</span>);
                aTag.attr(<span class="hljs-string">'class'</span>, link.classType);
                aTag.attr(<span class="hljs-string">'target'</span>, link.target);
                aTag.attr(<span class="hljs-string">'href'</span>, link.url);
                aTag[<span class="hljs-number">0</span>].innerHTML = text;
                <span class="hljs-keyword">return</span> $sce.getTrustedHtml(aTag[<span class="hljs-number">0</span>].outerHTML);
            }
        };
    }
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">fromObject</span>: fromObject,
        <span class="hljs-attr">linkObject</span>: linkObject
    }
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/resource/factory.attachment.js */</span>
angular.module(<span class="hljs-string">"sn.connect.resource"</span>).factory(<span class="hljs-string">"attachmentFactory"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">fileSizeConverter, $window</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fromObject</span>(<span class="hljs-params">data</span>) </span>{
        data.size = fileSizeConverter.getByteCount(<span class="hljs-string">""</span> + data.size_bytes, <span class="hljs-number">2</span>);
        <span class="hljs-keyword">var</span> downloadSource = <span class="hljs-string">"/sys_attachment.do?sys_id="</span> + data.sys_id;
        <span class="hljs-keyword">var</span> newTabSource = <span class="hljs-string">"/"</span> + data.sys_id + <span class="hljs-string">".iix"</span>;
        <span class="hljs-keyword">return</span> {
            <span class="hljs-attr">rawData</span>: data,
            <span class="hljs-attr">sysID</span>: data.sys_id,
            <span class="hljs-attr">timestamp</span>: data.sys_created_on,
            <span class="hljs-attr">name</span>: data.file_name || <span class="hljs-string">"Image"</span>,
            <span class="hljs-attr">byteDisplay</span>: data.size,
            <span class="hljs-attr">canRead</span>: data.can_read,
            <span class="hljs-attr">fileName</span>: data.file_name,
            <span class="hljs-attr">sizeInBytes</span>: data.size_bytes,
            <span class="hljs-attr">compressSize</span>: data.size_compressed,
            <span class="hljs-attr">contentType</span>: data.content_type,
            <span class="hljs-attr">thumbSource</span>: data.thumb_src,
            <span class="hljs-attr">createdBy</span>: data.sys_created_by,
            <span class="hljs-attr">isImage</span>: data.image,
            <span class="hljs-attr">height</span>: data.image_height,
            <span class="hljs-attr">width</span>: data.image_width,
            <span class="hljs-attr">averageColor</span>: data.average_image_color,
            <span class="hljs-attr">newTabSource</span>: newTabSource,
            <span class="hljs-attr">downloadSource</span>: downloadSource,
            <span class="hljs-attr">open</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) </span>{
                <span class="hljs-keyword">if</span> (event.keyCode === <span class="hljs-number">9</span>)
                    <span class="hljs-keyword">return</span>;
                $<span class="hljs-built_in">window</span>.open(newTabSource, <span class="hljs-string">"_blank"</span>);
            },
            <span class="hljs-attr">download</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) </span>{
                <span class="hljs-keyword">if</span> (event.keyCode === <span class="hljs-number">9</span>)
                    <span class="hljs-keyword">return</span>;
                $<span class="hljs-built_in">window</span>.open(downloadSource, <span class="hljs-string">"_self"</span>);
            }
        }
    }
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">fromObject</span>: fromObject
    }
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/resource/service.resourcePersister.js */</span>
angular.module(<span class="hljs-string">'sn.connect.resource'</span>).service(<span class="hljs-string">'resourcePersister'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">
    $q, snHttp, liveLinkFactory, attachmentFactory, $timeout, isLoggedIn</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">var</span> CONVERSATION_PATH = isLoggedIn ? <span class="hljs-string">"/api/now/connect/conversations/"</span> : <span class="hljs-string">"/api/now/connect/support/anonymous/conversations/"</span>;
    <span class="hljs-keyword">var</span> conversations = {};

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addLink</span>(<span class="hljs-params">conversationID, link</span>) </span>{
        <span class="hljs-keyword">var</span> field = (link.isRecord) ? <span class="hljs-string">"records"</span> : <span class="hljs-string">"links"</span>;
        addToArray(conversationID, field, link, linkEquals);
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">linkEquals</span>(<span class="hljs-params">link1, link2</span>) </span>{
        <span class="hljs-keyword">return</span> link1.url === link2.url;
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addAttachment</span>(<span class="hljs-params">conversationID, attachment</span>) </span>{
        addToArray(conversationID, <span class="hljs-string">"attachments"</span>, attachment, attachmentEquals);
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">attachmentEquals</span>(<span class="hljs-params">attachment1, attachment2</span>) </span>{
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">cmp</span>(<span class="hljs-params">field</span>) </span>{
            <span class="hljs-keyword">var</span> field1 = attachment1[field];
            <span class="hljs-keyword">var</span> field2 = attachment2[field];
            <span class="hljs-keyword">return</span> !!field1 &amp;&amp; field1 === field2;
        }
        <span class="hljs-keyword">return</span> attachment1.isImage &amp;&amp;
            cmp(<span class="hljs-string">"sizeInBytes"</span>) &amp;&amp;
            cmp(<span class="hljs-string">"compressSize"</span>) &amp;&amp;
            cmp(<span class="hljs-string">"contentType"</span>) &amp;&amp;
            cmp(<span class="hljs-string">"height"</span>) &amp;&amp;
            cmp(<span class="hljs-string">"width"</span>) &amp;&amp;
            cmp(<span class="hljs-string">"averageColor"</span>);
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addToArray</span>(<span class="hljs-params">conversationID, field, element, equalsFn</span>) </span>{
        <span class="hljs-keyword">var</span> resources = conversations[conversationID];
        <span class="hljs-keyword">if</span> (!resources) {
            conversations[conversationID] = newResource();
            conversations[conversationID][field] = [element];
            <span class="hljs-keyword">return</span>;
        }
        <span class="hljs-keyword">var</span> array = resources[field];
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; array.length; i += <span class="hljs-number">1</span>) {
            <span class="hljs-keyword">var</span> item = array[i];
            <span class="hljs-keyword">if</span> (item.sysID === element.sysID) {
                array[i] = element;
                <span class="hljs-keyword">return</span>;
            }
            <span class="hljs-keyword">if</span> (equalsFn(item, element)) {
                <span class="hljs-keyword">if</span> (item.timestamp &gt; element.timestamp)
                    <span class="hljs-keyword">return</span>;
                array.splice(i, <span class="hljs-number">1</span>);
                <span class="hljs-keyword">break</span>;
            }
        }
        <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; array.length; ++i) {
            <span class="hljs-keyword">if</span> (array[i].timestamp &lt;= element.timestamp) {
                array.splice(i, <span class="hljs-number">0</span>, element);
                <span class="hljs-keyword">return</span>;
            }
        }
        array.push(element);
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">newResource</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> {
            <span class="hljs-attr">links</span>: [],
            <span class="hljs-attr">records</span>: [],
            <span class="hljs-attr">attachments</span>: []
        };
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">retrieve</span>(<span class="hljs-params">conversationID</span>) </span>{
        <span class="hljs-keyword">var</span> resources = conversations[conversationID];
        <span class="hljs-keyword">if</span> (resources &amp;&amp; (resources.loading || resources.retrieved))
            <span class="hljs-keyword">return</span>;
        <span class="hljs-keyword">if</span> (!resources)
            resources = conversations[conversationID] = newResource();
        resources.loading = <span class="hljs-literal">true</span>;
        $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
            snHttp.get(CONVERSATION_PATH + conversationID + <span class="hljs-string">"/resources"</span>).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>) </span>{
                <span class="hljs-keyword">delete</span> conversations[conversationID].loading;
                conversations[conversationID].retrieved = <span class="hljs-literal">true</span>;
                <span class="hljs-keyword">var</span> result = response.data.result;
                result.links.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">rawLink</span>) </span>{
                    addLink(conversationID, liveLinkFactory.fromObject(rawLink));
                });
                result.attachments.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">rawAttachment</span>) </span>{
                    addAttachment(conversationID, attachmentFactory.fromObject(rawAttachment));
                });
            });
        })
    }
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">get</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">conversationID</span>) </span>{
            retrieve(conversationID);
            <span class="hljs-keyword">return</span> conversations[conversationID];
        },
        <span class="hljs-attr">addLink</span>: addLink,
        <span class="hljs-attr">addAttachment</span>: addAttachment
    };
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/resource/service.supportTabHandler.js */</span>
angular.module(<span class="hljs-string">'sn.connect.resource'</span>).service(<span class="hljs-string">'supportTabHandler'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    <span class="hljs-keyword">var</span> tabs = {};
    <span class="hljs-keyword">var</span> watches = {};
    <span class="hljs-keyword">var</span> globalWatches = [];

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addTab</span>(<span class="hljs-params">channelID, tab</span>) </span>{
        <span class="hljs-keyword">if</span> (!channelID || !tab)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        tabs[channelID] = tabs[channelID] || [];
        <span class="hljs-keyword">if</span> (ngObjectIndexOf(tabs[channelID], tab) !== <span class="hljs-number">-1</span>)
            <span class="hljs-keyword">return</span> tab;
        tabs[channelID].push(tab);
        callWatches(channelID, tab);
        <span class="hljs-keyword">return</span> tab;
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">removeTab</span>(<span class="hljs-params">channelID, tab</span>) </span>{
        <span class="hljs-keyword">if</span> (!channelID || !tab || !tabs[channelID])
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">var</span> loc = ngObjectIndexOf(tabs[channelID], tab);
        <span class="hljs-keyword">if</span> (loc !== <span class="hljs-number">-1</span>) {
            <span class="hljs-keyword">var</span> removedTab = tabs[channelID].splice(loc, <span class="hljs-number">1</span>)[<span class="hljs-number">0</span>];
            callWatches(channelID, removedTab);
            <span class="hljs-keyword">return</span> removedTab;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">removeChannel</span>(<span class="hljs-params">channelID</span>) </span>{
        <span class="hljs-keyword">if</span> (!channelID || !tabs[channelID])
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        tabs[channelID] = [];
        callWatches(channelID, []);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getTabs</span>(<span class="hljs-params">channelID, sort</span>) </span>{
        <span class="hljs-keyword">if</span> (!tabs[channelID])
            <span class="hljs-keyword">return</span> [];
        <span class="hljs-keyword">return</span> sort ? tabs[channelID].sort(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">a, b</span>) </span>{
            <span class="hljs-keyword">return</span> a.$order - b.$order;
        }) : tabs[channelID];
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ngObjectIndexOf</span>(<span class="hljs-params">arr, obj</span>) </span>{
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, len = arr.length; i &lt; len; i++)
            <span class="hljs-keyword">if</span> (angular.equals(arr[i], obj))
                <span class="hljs-keyword">return</span> i;
        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">watch</span>(<span class="hljs-params">func, channelID</span>) </span>{
        <span class="hljs-keyword">if</span> (channelID) {
            watches[channelID] = watches[channelID] || [];
            watches[channelID].push(func)
        } <span class="hljs-keyword">else</span> {
            globalWatches.push(func);
        }
        <span class="hljs-keyword">return</span> func;
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">unwatch</span>(<span class="hljs-params">func, channelID</span>) </span>{
        <span class="hljs-keyword">var</span> i, len;
        <span class="hljs-keyword">if</span> (channelID &amp;&amp; watches[channelID]) {
            <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>, len = watches[channelID].length; i &lt; len; i++) {
                <span class="hljs-keyword">var</span> watchLoc = watches[channelID].indexOf(func);
                <span class="hljs-keyword">if</span> (watchLoc !== <span class="hljs-number">-1</span>)
                    watches[channelID].splice(watchLoc, <span class="hljs-number">1</span>);
            }
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>, len = globalWatches.length; i &lt; len; i++) {
                <span class="hljs-keyword">var</span> globalWatchLoc = globalWatches.indexOf(func);
                <span class="hljs-keyword">if</span> (globalWatchLoc !== <span class="hljs-number">-1</span>)
                    globalWatches.splice(globalWatchLoc, <span class="hljs-number">1</span>);
            }
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">callWatches</span>(<span class="hljs-params">channelID, response</span>) </span>{
        <span class="hljs-keyword">var</span> i, len;
        <span class="hljs-keyword">if</span> (channelID &amp;&amp; watches[channelID] &amp;&amp; watches[channelID].length) {
            <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>, len = watches[channelID].length; i &lt; len; i++)
                watches[channelID][i](response);
        }
        <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>, len = globalWatches.length; i &lt; len; i++)
            globalWatches[i](response);
    }
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">add</span>: addTab,
        <span class="hljs-attr">remove</span>: removeTab,
        <span class="hljs-attr">get</span>: getTabs,
        <span class="hljs-attr">removeChannel</span>: removeChannel,
        <span class="hljs-attr">watch</span>: watch,
        <span class="hljs-attr">unwatch</span>: unwatch
    };
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/resource/directive.snAsideMemberList.js */</span>
angular.module(<span class="hljs-string">'sn.connect.resource'</span>).directive(<span class="hljs-string">'snAsideMemberList'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">
    getTemplateUrl, $timeout, activeConversation</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
        <span class="hljs-attr">templateUrl</span>: getTemplateUrl(<span class="hljs-string">'snAsideMemberList.xml'</span>),
        <span class="hljs-attr">link</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">scope, element</span>) </span>{
            scope.$on(<span class="hljs-string">"sn.aside.open"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    <span class="hljs-keyword">if</span> (element.is(<span class="hljs-string">":visible"</span>))
                        scope.$emit(<span class="hljs-string">"sn.aside.controls.active"</span>, <span class="hljs-string">"members"</span>);
                }, <span class="hljs-number">0</span>, <span class="hljs-literal">false</span>);
            });
            scope.changeMode = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">evt, mode</span>) </span>{
                <span class="hljs-keyword">if</span> (!scope.conversation.amMember || evt.keyCode === <span class="hljs-number">9</span>)
                    <span class="hljs-keyword">return</span>;
                scope.mode = mode;
                <span class="hljs-keyword">if</span> (mode == <span class="hljs-string">'add'</span>) {
                    $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                        element.find(<span class="hljs-string">'.form-control-search.tt-input'</span>).focus();
                    }, <span class="hljs-number">200</span>);
                }
            };
        },
        <span class="hljs-attr">controller</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$scope, conversations, liveProfileID, supportAddMembers</span>) </span>{
            $scope.mode = <span class="hljs-string">'view'</span>;
            $scope.$emit(<span class="hljs-string">"sn.aside.controls.active"</span>, <span class="hljs-string">"members"</span>);
            $scope.viewProfile = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">evt, member</span>) </span>{
                <span class="hljs-keyword">if</span> (evt.keyCode === <span class="hljs-number">9</span>)
                    <span class="hljs-keyword">return</span>;
                $scope.$emit(<span class="hljs-string">"sn.aside.open"</span>, {
                    <span class="hljs-attr">templateUrl</span>: getTemplateUrl(<span class="hljs-string">"snAsideMemberList_profile.xml"</span>),
                    <span class="hljs-attr">isChild</span>: <span class="hljs-literal">true</span>,
                    <span class="hljs-attr">scope</span>: {
                        <span class="hljs-attr">profile</span>: member,
                        <span class="hljs-attr">showDirectMessage</span>: !$scope.conversation.isDirectMessage &amp;&amp; !$scope.conversation.isHelpDesk
                    }
                });
            };
            $scope.isAddUserButtonVisible = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">if</span> ($scope.mode !== <span class="hljs-string">'view'</span>)
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
                <span class="hljs-keyword">return</span> isButtonVisible(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
                });
            };
            $scope.isLeaveButtonVisible = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">var</span> queueEntryCheckFn = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">queueEntry</span>) </span>{
                    <span class="hljs-keyword">return</span> !queueEntry.isAssignedToMe;
                };
                <span class="hljs-keyword">return</span> isButtonVisible(queueEntryCheckFn);
            };
            $scope.isRemoveUserButtonVisible = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">userID</span>) </span>{
                <span class="hljs-keyword">var</span> queueEntryCheckFn = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">queueEntry</span>) </span>{
                    <span class="hljs-keyword">return</span> queueEntry.openedBy !== userID &amp;&amp;
                        queueEntry.assignedTo !== userID;
                };
                <span class="hljs-keyword">return</span> isButtonVisible(queueEntryCheckFn);
            };

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isButtonVisible</span>(<span class="hljs-params">queueEntryCheckFn</span>) </span>{
                <span class="hljs-keyword">var</span> conversation = $scope.conversation;
                <span class="hljs-keyword">if</span> (!conversation.isHelpDesk)
                    <span class="hljs-keyword">return</span> conversation.isGroup;
                <span class="hljs-keyword">var</span> queueEntry = conversation.queueEntry;
                <span class="hljs-keyword">return</span> supportAddMembers &amp;&amp;
                    queueEntryCheckFn(queueEntry) &amp;&amp;
                    queueEntry.isActive;
            }
            $scope.user = <span class="hljs-literal">false</span>;
            $scope.findUser = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; $scope.conversation.members.length; i++) {
                    <span class="hljs-keyword">if</span> ($scope.conversation.members[i].sysID === liveProfileID) {
                        $scope.user = $scope.conversation.members[i];
                        <span class="hljs-keyword">return</span>;
                    }
                }
                $scope.user = <span class="hljs-literal">false</span>;
            };
            $scope.findUser();
            $scope.$watch(<span class="hljs-string">'conversation.sysID'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                $scope.findUser();
            });
            $scope.addMember = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">memberID</span>) </span>{
                conversations.addUser($scope.conversation.sysID, memberID);
                $scope.mode = <span class="hljs-string">'view'</span>;
                <span class="hljs-keyword">if</span> (!$scope.user)
                    $scope.findUser();
            };
            $scope.showRemoveMember = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> $scope.conversation.amMember &amp;&amp; $scope.conversation.isGroup;
            };
            $scope.removeMember = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$event, memberID</span>) </span>{
                <span class="hljs-keyword">if</span> ($event &amp;&amp; $event.keyCode === <span class="hljs-number">9</span>)
                    <span class="hljs-keyword">return</span>;
                $event.stopPropagation();
                conversations.removeUser($scope.conversation.sysID, memberID);
                <span class="hljs-keyword">if</span> (memberID === liveProfileID) {
                    activeConversation.clear($scope.conversation);
                    $scope.user = <span class="hljs-literal">null</span>;
                }
            };
            $scope.showAddMembers = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> !$scope.conversation.isHelpDesk &amp;&amp; $scope.conversation.isGroup &amp;&amp; $scope.mode == <span class="hljs-string">'view'</span>
            };
            $scope.showUser = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> user &amp;&amp; $scope.memberFilterText &amp;&amp; user.name.indexOf($scope.memberFilterText) &gt; <span class="hljs-number">-1</span>;
            }
        }
    }
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/resource/directive.snAsideInfo.js */</span>
angular.module(<span class="hljs-string">'sn.connect.resource'</span>).directive(<span class="hljs-string">'snAsideInfo'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">getTemplateUrl, $timeout</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
        <span class="hljs-attr">templateUrl</span>: getTemplateUrl(<span class="hljs-string">'snAsideInfo.xml'</span>),
        <span class="hljs-attr">link</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">scope, element</span>) </span>{
            scope.$on(<span class="hljs-string">"sn.aside.open"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    <span class="hljs-keyword">if</span> (element.is(<span class="hljs-string">":visible"</span>))
                        scope.$emit(<span class="hljs-string">"sn.aside.controls.active"</span>, <span class="hljs-string">"info"</span>);
                }, <span class="hljs-number">0</span>, <span class="hljs-literal">false</span>);
            });
        },
        <span class="hljs-attr">controller</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$scope</span>) </span>{
            $scope.$emit(<span class="hljs-string">"sn.aside.controls.active"</span>, <span class="hljs-string">"info"</span>);
            $scope.isFieldVisible = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">field</span>) </span>{
                <span class="hljs-keyword">return</span> field.displayValue &amp;&amp; field.type !== <span class="hljs-string">'journal_input'</span> &amp;&amp; field.type !== <span class="hljs-string">'journal_list'</span>;
            };
            $scope.historyBack = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">evt</span>) </span>{
                <span class="hljs-keyword">if</span> (evt &amp;&amp; evt.keyCode === <span class="hljs-number">9</span>)
                    <span class="hljs-keyword">return</span>;
                $scope.$emit(<span class="hljs-string">"sn.aside.historyBack"</span>);
            };
        }
    }
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/resource/directive.snAsideInfoItem.js */</span>
angular.module(<span class="hljs-string">'sn.connect.resource'</span>).directive(<span class="hljs-string">'snAsideInfoItem'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">getTemplateUrl</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    <span class="hljs-keyword">var</span> iconMap = {
        <span class="hljs-attr">record</span>: <span class="hljs-string">"icon-article-document"</span>,
        <span class="hljs-attr">link</span>: <span class="hljs-string">"icon-link"</span>,
        <span class="hljs-attr">connect</span>: <span class="hljs-string">"icon-collaboration"</span>,
        <span class="hljs-attr">uipage</span>: <span class="hljs-string">"icon-document"</span>,
        <span class="hljs-attr">search</span>: <span class="hljs-string">"icon-search"</span>,
        <span class="hljs-attr">list</span>: <span class="hljs-string">"icon-list"</span>,
        <span class="hljs-attr">chart</span>: <span class="hljs-string">"icon-poll"</span>,
        <span class="hljs-attr">update</span>: <span class="hljs-string">"icon-form"</span>,
        <span class="hljs-attr">image</span>: <span class="hljs-string">"icon-image"</span>,
        <span class="hljs-attr">video</span>: <span class="hljs-string">"icon-video"</span>,
        <span class="hljs-attr">unauthorized</span>: <span class="hljs-string">"icon-locked sn-highlight_negative"</span>,
        <span class="hljs-attr">error</span>: <span class="hljs-string">"icon-alert-triangle"</span>,
        <span class="hljs-attr">pending</span>: <span class="hljs-string">"icon-loading"</span>
    };
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
        <span class="hljs-attr">templateUrl</span>: getTemplateUrl(<span class="hljs-string">'snAsideInfoItem.xml'</span>),
        <span class="hljs-attr">scope</span>: {
            <span class="hljs-attr">isLink</span>: <span class="hljs-string">"="</span>,
            <span class="hljs-attr">title</span>: <span class="hljs-string">"@"</span>,
            <span class="hljs-attr">description</span>: <span class="hljs-string">"@"</span>,
            <span class="hljs-attr">link</span>: <span class="hljs-string">"="</span>
        },
        <span class="hljs-attr">controller</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$scope</span>) </span>{
            $scope.isExternalIcon = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> !$scope.link.isPending &amp;&amp; $scope.link.external;
            };
            $scope.getExternalIcon = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> <span class="hljs-string">"https://www.google.com/s2/favicons?domain="</span> + $scope.link.url.toLowerCase();
            };
            $scope.getIcon = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">if</span> ($scope.link.isUnauthorized)
                    <span class="hljs-keyword">return</span> iconMap.unauthorized;
                <span class="hljs-keyword">if</span> ($scope.link.isError)
                    <span class="hljs-keyword">return</span> iconMap.error;
                <span class="hljs-keyword">if</span> ($scope.link.isPending)
                    <span class="hljs-keyword">return</span> iconMap.pending;
                <span class="hljs-keyword">return</span> iconMap[$scope.link.type] || iconMap.link;
            };
        }
    }
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/resource/directive.snAsideInfoViewAllItem.js */</span>
angular.module(<span class="hljs-string">'sn.connect.resource'</span>).directive(<span class="hljs-string">'snAsideInfoViewAllItem'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">getTemplateUrl</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
        <span class="hljs-attr">templateUrl</span>: getTemplateUrl(<span class="hljs-string">'snAsideInfoViewAllItem.xml'</span>),
        <span class="hljs-attr">scope</span>: {
            <span class="hljs-attr">title</span>: <span class="hljs-string">"@"</span>,
            <span class="hljs-attr">templateUrl</span>: <span class="hljs-string">"@"</span>,
            <span class="hljs-attr">minCount</span>: <span class="hljs-string">"@"</span>,
            <span class="hljs-attr">links</span>: <span class="hljs-string">"="</span>
        },
        <span class="hljs-attr">controller</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$scope</span>) </span>{
            $scope.isShowing = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> $scope.links.length &gt; $scope.minCount;
            };
            $scope.openView = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">evt</span>) </span>{
                <span class="hljs-keyword">if</span> (evt.keyCode === <span class="hljs-number">9</span>)
                    <span class="hljs-keyword">return</span>;
                $scope.$emit(<span class="hljs-string">"sn.aside.open"</span>, {
                    <span class="hljs-attr">templateUrl</span>: getTemplateUrl($scope.templateUrl),
                    <span class="hljs-attr">isChild</span>: <span class="hljs-literal">true</span>,
                    <span class="hljs-attr">scope</span>: $scope.$parent
                });
            };
        }
    }
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/resource/directive.snAsideAttachments.js */</span>
angular.module(<span class="hljs-string">'sn.connect.resource'</span>).directive(<span class="hljs-string">'snAsideAttachments'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">getTemplateUrl, $timeout</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
        <span class="hljs-attr">templateUrl</span>: getTemplateUrl(<span class="hljs-string">'snAsideAttachments.xml'</span>),
        <span class="hljs-attr">link</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">scope, element</span>) </span>{
            scope.$on(<span class="hljs-string">"sn.aside.open"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    <span class="hljs-keyword">if</span> (element.is(<span class="hljs-string">":visible"</span>))
                        scope.$emit(<span class="hljs-string">"sn.aside.controls.active"</span>, <span class="hljs-string">"attachments"</span>);
                }, <span class="hljs-number">0</span>, <span class="hljs-literal">false</span>);
            });
        },
        <span class="hljs-attr">controller</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$scope, $rootScope</span>) </span>{
            $scope.$emit(<span class="hljs-string">"sn.aside.controls.active"</span>, <span class="hljs-string">"attachments"</span>);
            $scope.$watch(<span class="hljs-string">"conversation.sysID"</span>, rawifyAttachments);
            $scope.$watchCollection(<span class="hljs-string">"conversation.resources.attachments"</span>, rawifyAttachments);

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">rawifyAttachments</span>(<span class="hljs-params"></span>) </span>{
                $scope.attachments = $scope.conversation.resources.attachments.map(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">attachment</span>) </span>{
                    <span class="hljs-keyword">return</span> attachment.rawData;
                });
            }
            rawifyAttachments();
            $scope.attachFiles = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">evt</span>) </span>{
                <span class="hljs-keyword">if</span> (evt.keyCode === <span class="hljs-number">9</span>)
                    <span class="hljs-keyword">return</span>;
                <span class="hljs-keyword">if</span> ($scope.conversation.amMember)
                    $rootScope.$broadcast(<span class="hljs-string">"connect.attachment_dialog.open"</span>, $scope.conversation.sysID);
            };
            $scope.isAddButtonShowing = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> !$scope.conversation.isHelpDesk || !$scope.conversation.queueEntry.isClosedByAgent;
            }
        }
    }
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/resource/directive.snAsideNotifications.js */</span>
angular.module(<span class="hljs-string">'sn.connect.resource'</span>).directive(<span class="hljs-string">'snAsideNotifications'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">getTemplateUrl, $timeout</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
        <span class="hljs-attr">templateUrl</span>: getTemplateUrl(<span class="hljs-string">'snAsideNotifications.xml'</span>),
        <span class="hljs-attr">link</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">scope, element</span>) </span>{
            scope.$on(<span class="hljs-string">"sn.aside.open"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    <span class="hljs-keyword">if</span> (element.is(<span class="hljs-string">":visible"</span>))
                        scope.$emit(<span class="hljs-string">"sn.aside.controls.active"</span>, <span class="hljs-string">"notifications"</span>);
                }, <span class="hljs-number">0</span>, <span class="hljs-literal">false</span>);
            });
        },
        <span class="hljs-attr">controller</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$scope, notificationPreferences</span>) </span>{
            $scope.$emit(<span class="hljs-string">"sn.aside.controls.active"</span>, <span class="hljs-string">"notifications"</span>);
            $scope.showSystemMessage = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> !$scope.conversation.isDirectMessage &amp;&amp;
                    notificationPreferences.globalPreferences.mobile &amp;&amp;
                    $scope.conversation.preferences.mobile === <span class="hljs-string">"all"</span>;
            };
        }
    }
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/resource/directive.snAsideNotificationItem.js */</span>
angular.module(<span class="hljs-string">'sn.connect.resource'</span>).directive(<span class="hljs-string">'snAsideNotificationItem'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">getTemplateUrl</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
        <span class="hljs-attr">templateUrl</span>: getTemplateUrl(<span class="hljs-string">'snAsideNotificationItem.xml'</span>),
        <span class="hljs-attr">scope</span>: {
            <span class="hljs-attr">conversation</span>: <span class="hljs-string">"="</span>,
            <span class="hljs-attr">section</span>: <span class="hljs-string">"@"</span>,
            <span class="hljs-attr">disableText</span>: <span class="hljs-string">"@"</span>,
            <span class="hljs-attr">disableLinkText</span>: <span class="hljs-string">"@"</span>,
            <span class="hljs-attr">description</span>: <span class="hljs-string">"@"</span>,
            <span class="hljs-attr">type</span>: <span class="hljs-string">'@'</span>
        },
        <span class="hljs-attr">controller</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$scope, notificationPreferences</span>) </span>{
            $scope.globalPreferences = notificationPreferences.globalPreferences;
            $scope.enable = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) </span>{
                <span class="hljs-keyword">if</span> (event.keyCode === <span class="hljs-number">9</span>)
                    <span class="hljs-keyword">return</span>;
                $scope.globalPreferences[$scope.type] = <span class="hljs-literal">true</span>;
            };
        }
    }
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/resource/directive.snAsideFrame.js */</span>
angular.module(<span class="hljs-string">'sn.connect.resource'</span>).directive(<span class="hljs-string">'snAsideFrame'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">getTemplateUrl, $timeout</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
        <span class="hljs-attr">templateUrl</span>: getTemplateUrl(<span class="hljs-string">'snAsideFrame.xml'</span>),
        <span class="hljs-attr">link</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">scope, element, attrs</span>) </span>{
            scope.title = attrs.title;
            scope.url = attrs.url + (attrs.url.indexOf(<span class="hljs-string">'?'</span>) &lt; <span class="hljs-number">0</span> ? <span class="hljs-string">'?'</span> : <span class="hljs-string">'&amp;'</span>) + <span class="hljs-string">"sysparm_clear_stack=true"</span>;
            scope.name = attrs.name;
            scope.$on(<span class="hljs-string">"sn.aside.open"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    <span class="hljs-keyword">if</span> (element.is(<span class="hljs-string">":visible"</span>))
                        scope.$emit(<span class="hljs-string">"sn.aside.controls.active"</span>, scope.name);
                }, <span class="hljs-number">0</span>, <span class="hljs-literal">false</span>);
            });
        },
        <span class="hljs-attr">controller</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$scope</span>) </span>{
            $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                $scope.$emit(<span class="hljs-string">'sn.aside.controls.active'</span>, $scope.name);
            }, <span class="hljs-number">0</span>, <span class="hljs-literal">false</span>);
            $scope.close = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">evt</span>) </span>{
                <span class="hljs-keyword">if</span> (evt.keyCode === <span class="hljs-number">9</span>)
                    <span class="hljs-keyword">return</span>;
                $scope.$emit(<span class="hljs-string">"sn.aside.close"</span>);
            }
        }
    }
});;;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/queue/js_includes_connect_queue.js */</span>
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/queue/_module.js */</span>
angular.module(<span class="hljs-string">"sn.connect.queue"</span>, [<span class="hljs-string">"sn.connect.profile"</span>, <span class="hljs-string">"sn.connect.conversation"</span>]);;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/queue/directive.snQueueList.js */</span>
angular.module(<span class="hljs-string">'sn.connect.queue'</span>).directive(<span class="hljs-string">'snQueueList'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">getTemplateUrl</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
        <span class="hljs-attr">templateUrl</span>: getTemplateUrl(<span class="hljs-string">'snQueueList.xml'</span>),
        <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">scope</span>: {},
        <span class="hljs-attr">controller</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$scope, $filter, queues, conversations, supportConversationLimit</span>) </span>{
            $scope.agents = queues.agents;
            $scope.hasQueues = queues.hasQueues;
            $scope.isLimitReached = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">if</span> (supportConversationLimit === <span class="hljs-number">-1</span>)
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
                <span class="hljs-keyword">var</span> supportConversations = $filter(<span class="hljs-string">'conversation'</span>)(conversations.all, <span class="hljs-literal">true</span>, <span class="hljs-literal">true</span>)
                    .filter(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">conversation</span>) </span>{
                        <span class="hljs-keyword">var</span> queueEntry = conversation.queueEntry;
                        <span class="hljs-keyword">return</span> queueEntry.isAssignedToMe &amp;&amp; !queueEntry.isPermanentlyClosed;
                    });
                <span class="hljs-keyword">return</span> supportConversationLimit &lt;= supportConversations.length;
            };
            $scope.$on(<span class="hljs-string">'dialog.queue-error.show'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">evt, data</span>) </span>{
                $scope.queueErrorData = data;
            });
        }
    };
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/queue/directive.snQueueItem.js */</span>
angular.module(<span class="hljs-string">'sn.connect.queue'</span>).directive(<span class="hljs-string">'snQueueItem'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">getTemplateUrl, $timeout, i18n</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    <span class="hljs-keyword">var</span> acceptButtonLabel = <span class="hljs-string">"Accept Ticket From {0}"</span>;
    i18n.getMessages([acceptButtonLabel], <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">translations</span>) </span>{
        acceptButtonLabel = translations[acceptButtonLabel];
    });
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
        <span class="hljs-attr">templateUrl</span>: getTemplateUrl(<span class="hljs-string">'snQueueItem.xml'</span>),
        <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">scope</span>: {
            <span class="hljs-attr">queue</span>: <span class="hljs-string">'='</span>,
            <span class="hljs-attr">canAnswer</span>: <span class="hljs-string">'='</span>
        },
        <span class="hljs-attr">link</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">scope, element</span>) </span>{
            <span class="hljs-keyword">var</span> flashCoolDown = <span class="hljs-number">1000</span>;
            <span class="hljs-keyword">var</span> onCoolDown = <span class="hljs-literal">false</span>;
            <span class="hljs-keyword">var</span> queueItem = element.find(<span class="hljs-string">'.queue-item'</span>);
            scope.flashQueue = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">if</span> (onCoolDown)
                    <span class="hljs-keyword">return</span>;
                onCoolDown = <span class="hljs-literal">true</span>;
                queueItem.addClass(<span class="hljs-string">"highlight-flash"</span>);
                $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    queueItem.removeClass(<span class="hljs-string">"highlight-flash"</span>);
                }, <span class="hljs-number">250</span>);
                $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    onCoolDown = <span class="hljs-literal">false</span>;
                }, flashCoolDown);
            }
        },
        <span class="hljs-attr">controller</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$scope, $rootScope, queueEntries, queueNotifier, conversations, activeConversation</span>) </span>{
            $scope.isEmpty = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> $scope.queue.waitingCount == <span class="hljs-number">0</span>;
            };
            $scope.getAcceptAriaLabel = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> i18n.format(acceptButtonLabel, $scope.queue.name);
            };
            $scope.answer = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">if</span> ($scope.isEmpty())
                    <span class="hljs-keyword">return</span>;
                <span class="hljs-keyword">if</span> (!$scope.canAnswer)
                    <span class="hljs-keyword">return</span>;
                queueEntries.requestNext($scope.queue.id).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">queueEntry</span>) </span>{
                    conversations.get(queueEntry.conversationID).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">conversation</span>) </span>{
                        activeConversation.conversation = conversation;
                    });
                }, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>) </span>{
                    <span class="hljs-keyword">if</span> (response.status !== <span class="hljs-number">404</span> || !response.data || !response.data.result || !response.data.result.error)
                        <span class="hljs-keyword">return</span>;
                    $rootScope.$broadcast(<span class="hljs-string">'dialog.queue-error.show'</span>, {
                        <span class="hljs-attr">queue</span>: $scope.queue,
                        <span class="hljs-attr">message</span>: response.data.result.error
                    });
                })
            };
            $scope.$watch(<span class="hljs-string">'queue.waitingCount'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                $scope.flashQueue();
                queueNotifier.notify($scope.queue);
            });
        }
    };
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/queue/directive.snNonAgentClose.js */</span>
angular.module(<span class="hljs-string">'sn.connect.queue'</span>).directive(<span class="hljs-string">'snNonAgentClose'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">
    getTemplateUrl, conversations, activeConversation</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
        <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">templateUrl</span>: getTemplateUrl(<span class="hljs-string">'snNonAgentClose.xml'</span>),
        <span class="hljs-attr">scope</span>: {},
        <span class="hljs-attr">controller</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$scope</span>) </span>{
            $scope.$on(<span class="hljs-string">'connect.non_agent_conversation.close_prompt'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event, conversation</span>) </span>{
                $scope.conversation = conversation;
                $scope.$broadcast(<span class="hljs-string">'dialog.queue-non-agent-modal.show'</span>);
            });
            $scope.close = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                conversations.closeSupport($scope.conversation.sysID, <span class="hljs-literal">true</span>);
                activeConversation.clear($scope.conversation);
            };
        }
    };
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/queue/directive.snQueueEntryClose.js */</span>
angular.module(<span class="hljs-string">'sn.connect.queue'</span>).directive(<span class="hljs-string">'snQueueEntryClose'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">
    getTemplateUrl, conversations, activeConversation</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
        <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">templateUrl</span>: getTemplateUrl(<span class="hljs-string">'snQueueEntryClose.xml'</span>),
        <span class="hljs-attr">scope</span>: {},
        <span class="hljs-attr">controller</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$scope</span>) </span>{
            <span class="hljs-keyword">var</span> hideConversation = <span class="hljs-literal">true</span>;
            $scope.$on(<span class="hljs-string">'connect.support_conversation.close_prompt'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event, conversation, shouldHide</span>) </span>{
                $scope.conversation = conversation;
                hideConversation = shouldHide;
                $scope.$broadcast(<span class="hljs-string">'dialog.queue-entry-close-modal.show'</span>);
            });
            $scope.close = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                conversations.closeSupport($scope.conversation.sysID, hideConversation);
                <span class="hljs-keyword">if</span> (hideConversation)
                    activeConversation.clear($scope.conversation);
            };
        }
    };
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/queue/directive.snQueueEntryTransfer.js */</span>
angular.module(<span class="hljs-string">'sn.connect.queue'</span>).directive(<span class="hljs-string">'snQueueEntryTransfer'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">getTemplateUrl</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
        <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">templateUrl</span>: getTemplateUrl(<span class="hljs-string">'snQueueEntryTransfer.xml'</span>),
        <span class="hljs-attr">scope</span>: {},
        <span class="hljs-attr">controller</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$scope, queues, queueEntries, userID, supportConversationLimit</span>) </span>{
            $scope.queues = [];

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">reset</span>(<span class="hljs-params"></span>) </span>{
                $scope.queue = {};
                $scope.agents = [];
            }
            $scope.$on(<span class="hljs-string">'connect.support.conversation.transfer'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event, conversation</span>) </span>{
                reset();
                $scope.conversation = conversation;
                $scope.queues.length = <span class="hljs-number">0</span>;
                queueEntries.requestByConversation(conversation.sysID).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">queueEntry</span>) </span>{
                    queues.getQueue(queueEntry.queueID).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">queue</span>) </span>{
                        $scope.queue = queue;
                    });
                    queues.getAgents(queueEntry.queueID).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">agents</span>) </span>{
                        $scope.agents = agents.filter(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">agent</span>) </span>{
                            <span class="hljs-keyword">return</span> (agent.userID !== queueEntry.openedBy) &amp;&amp;
                                (agent.userID !== userID);
                        }).sort(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">a, b</span>) </span>{
                            <span class="hljs-keyword">return</span> a.name.localeCompare(b.name);
                        });
                    });
                    queues.refresh().then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                        angular.forEach(queues.all, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">value, key</span>) </span>{
                            <span class="hljs-keyword">if</span> (key !== queueEntry.queueID)
                                $scope.queues.push(value)
                        });
                    });
                    $scope.$broadcast(<span class="hljs-string">'dialog.transfer-modal.show'</span>);
                });
            });
            $scope.close = reset;
            $scope.startsWith = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">actual, expected</span>) </span>{
                <span class="hljs-keyword">return</span> actual.toLowerCase().indexOf(expected.toLowerCase()) &gt; <span class="hljs-number">-1</span>;
            };
            $scope.canTransferToAgent = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">agent</span>) </span>{
                <span class="hljs-keyword">if</span> (supportConversationLimit === <span class="hljs-number">-1</span>)
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
                <span class="hljs-keyword">if</span> (!agent.supportConversationCount)
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
                <span class="hljs-keyword">return</span> agent.supportConversationCount &lt; supportConversationLimit;
            };
            $scope.transferToAgent = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">agent</span>) </span>{
                queueEntries.transfer($scope.conversation.sysID, agent.userID);
                $scope.$broadcast(<span class="hljs-string">'dialog.transfer-modal.close'</span>);
                reset();
            };
            $scope.transferToQueue = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">queue</span>) </span>{
                $scope.transferQueue = queue;
                $scope.$broadcast(<span class="hljs-string">'dialog.transfer-modal.close'</span>);
                reset();
                $scope.$broadcast(<span class="hljs-string">'dialog.queue-transfer-confirm.show'</span>);
            };
            $scope.transferQueueOk = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                queueEntries.escalate($scope.conversation, $scope.transferQueue.id);
            };
            $scope.cancelTransfer = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                queueEntries.cancel($scope.conversation.sysID);
            };
        }
    };
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/queue/directive.snQueueEntryTransferAccepted.js */</span>
angular.module(<span class="hljs-string">'sn.connect.queue'</span>).directive(<span class="hljs-string">'snQueueEntryTransferAccepted'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">getTemplateUrl</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
        <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">templateUrl</span>: getTemplateUrl(<span class="hljs-string">'snQueueEntryTransferAccepted.xml'</span>),
        <span class="hljs-attr">scope</span>: {},
        <span class="hljs-attr">controller</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$scope, $rootScope, $timeout, $filter, activeConversation, conversations, queueEntries,
            profiles</span>) </span>{
            <span class="hljs-keyword">var</span> transferOrder = [];
            $scope.$watchCollection(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> $filter(<span class="hljs-string">'transferAccepted'</span>)(conversations.all).map(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">conversation</span>) </span>{
                    <span class="hljs-keyword">return</span> conversation.sysID;
                });
            }, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">newCollection</span>) </span>{
                transferOrder = newCollection.sort(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">sysID1, sysID2</span>) </span>{
                    <span class="hljs-keyword">return</span> sortIndex(sysID1) - sortIndex(sysID2);
                });
                <span class="hljs-keyword">if</span> (transferOrder.length &gt; <span class="hljs-number">0</span>)
                    show();
                <span class="hljs-keyword">else</span>
                    hide();
            });

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sortIndex</span>(<span class="hljs-params">sysID</span>) </span>{
                <span class="hljs-keyword">var</span> index = transferOrder.indexOf(sysID);
                <span class="hljs-keyword">return</span> (index &lt; <span class="hljs-number">0</span>) ? <span class="hljs-number">1000</span> : index;
            }
            $scope.leave = closeModal(<span class="hljs-literal">true</span>);
            $scope.stay = closeModal(<span class="hljs-literal">false</span>);

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">closeModal</span>(<span class="hljs-params">removeConversation</span>) </span>{
                <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    <span class="hljs-keyword">var</span> conversation = conversations.indexed[currentSysID];
                    queueEntries.complete(currentSysID);
                    conversation.queueEntry.clearTransferState();
                    <span class="hljs-keyword">if</span> (removeConversation) {
                        conversations.closeSupport(conversation.sysID, <span class="hljs-literal">true</span>);
                        activeConversation.clear(conversation);
                    }
                    hide();
                }
            }
            <span class="hljs-keyword">var</span> currentSysID;

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">show</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">var</span> sysID = transferOrder[<span class="hljs-number">0</span>];
                <span class="hljs-keyword">if</span> (currentSysID === sysID)
                    <span class="hljs-keyword">return</span>;
                currentSysID = sysID;
                <span class="hljs-keyword">var</span> conversation = conversations.indexed[currentSysID];
                <span class="hljs-keyword">var</span> queueEntry = conversation.queueEntry;
                <span class="hljs-keyword">delete</span> $scope.profileForSession;
                <span class="hljs-keyword">delete</span> $scope.transferToProfile;
                profiles.getAsync(<span class="hljs-string">'sys_user.'</span> + queueEntry.openedBy).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">profile</span>) </span>{
                    $scope.profileForSession = profile;
                    profiles.getAsync(<span class="hljs-string">'sys_user.'</span> + queueEntry.transferTo).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">profile</span>) </span>{
                        $scope.transferToProfile = profile;
                        $scope.$broadcast(<span class="hljs-string">'dialog.transfer-accepted-modal.show'</span>);
                        activeConversation.conversation = conversation;
                    });
                });
            }

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">hide</span>(<span class="hljs-params"></span>) </span>{
                $scope.$broadcast(<span class="hljs-string">'dialog.transfer-accepted-modal.close'</span>);
                <span class="hljs-keyword">if</span> (currentSysID === transferOrder[<span class="hljs-number">0</span>])
                    transferOrder.shift();
                currentSysID = <span class="hljs-literal">undefined</span>;
                <span class="hljs-keyword">if</span> (transferOrder.length === <span class="hljs-number">0</span>)
                    <span class="hljs-keyword">return</span>;
                $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    show();
                }, <span class="hljs-number">400</span>);
            }
        }
    };
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/queue/factory.queue.js */</span>
angular.module(<span class="hljs-string">'sn.connect.queue'</span>).factory(<span class="hljs-string">'queueFactory'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">fromObject</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>) </span>{
            <span class="hljs-keyword">return</span> {
                get id() {
                    <span class="hljs-keyword">return</span> data.sys_id;
                },
                get name() {
                    <span class="hljs-keyword">return</span> data.name;
                },
                get question() {
                    <span class="hljs-keyword">return</span> data.question;
                },
                get waitTime() {
                    <span class="hljs-keyword">return</span> data.average_wait_time.replace(<span class="hljs-regexp">/ Minute(s?)/g</span>, <span class="hljs-string">"m"</span>).replace(<span class="hljs-regexp">/ Hour(s?)/g</span>, <span class="hljs-string">"h"</span>).replace(<span class="hljs-regexp">/ Second(s?)/g</span>, <span class="hljs-string">"s"</span>);
                },
                get waitTimeLong() {
                    <span class="hljs-keyword">return</span> data.average_wait_time;
                },
                get waitingCount() {
                    <span class="hljs-keyword">return</span> data.waiting_count;
                },
                get available() {
                    <span class="hljs-keyword">return</span> angular.isUndefined(data.not_available);
                },
                get unavailableMessage() {
                    <span class="hljs-keyword">return</span> data.not_available;
                },
                get escalateTo() {
                    <span class="hljs-keyword">return</span> data.escalate_to;
                },
                get isAgentsQueue() {
                    <span class="hljs-keyword">return</span> data.is_agent_for;
                }
            };
        }
    };
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/queue/factory.queueEntry.js */</span>
angular.module(<span class="hljs-string">'sn.connect.queue'</span>).factory(<span class="hljs-string">'queueEntryFactory'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">profiles, userID, queues</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    <span class="hljs-keyword">var</span> WAITING = <span class="hljs-number">1</span>;
    <span class="hljs-keyword">var</span> WORK_IN_PROGRESS = <span class="hljs-number">2</span>;
    <span class="hljs-keyword">var</span> CLOSED_COMPLETE = <span class="hljs-number">3</span>;
    <span class="hljs-keyword">var</span> CLOSED_ESCALATED = <span class="hljs-number">4</span>;
    <span class="hljs-keyword">var</span> CLOSED_BY_CLIENT = <span class="hljs-number">7</span>;
    <span class="hljs-keyword">var</span> CLOSED_ABANDONED = <span class="hljs-number">8</span>;
    <span class="hljs-keyword">var</span> TRANSFER_PENDING = <span class="hljs-string">'pending'</span>;
    <span class="hljs-keyword">var</span> TRANSFER_CANCELLED = <span class="hljs-string">'cancelled'</span>;
    <span class="hljs-keyword">var</span> TRANSFER_ACCEPTED = <span class="hljs-string">'accepted'</span>;
    <span class="hljs-keyword">var</span> TRANSFER_REJECTED = <span class="hljs-string">'rejected'</span>;
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">fromObject</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>) </span>{
            <span class="hljs-keyword">return</span> {
                <span class="hljs-attr">equals</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">rawQueueEntry</span>) </span>{
                    <span class="hljs-keyword">return</span> angular.equals(data, rawQueueEntry);
                },
                get averageWaitTime() {
                    <span class="hljs-keyword">return</span> data.average_wait_time;
                },
                get sysID() {
                    <span class="hljs-keyword">return</span> data.sys_id;
                },
                get queueID() {
                    <span class="hljs-keyword">return</span> data.queue;
                },
                get queue() {
                    <span class="hljs-keyword">return</span> queues.all[data.queue];
                },
                get conversationID() {
                    <span class="hljs-keyword">return</span> data.group;
                },
                get assignedTo() {
                    <span class="hljs-keyword">return</span> data.assigned_to;
                },
                get isAssignedToMe() {
                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.assignedTo === userID;
                },
                get number() {
                    <span class="hljs-keyword">return</span> data.number;
                },
                get position() {
                    <span class="hljs-keyword">return</span> data.position;
                },
                get profile() {
                    <span class="hljs-keyword">return</span> profiles.get(data.sys_id);
                },
                get shortDescription() {
                    <span class="hljs-keyword">return</span> data.short_description;
                },
                get state() {
                    <span class="hljs-keyword">return</span> data.state;
                },
                set state(value) {
                    data.state = value;
                },
                get waitTime() {
                    <span class="hljs-keyword">return</span> data.wait_time;
                },
                get workStart() {
                    <span class="hljs-keyword">return</span> data.work_start;
                },
                get workEnd() {
                    <span class="hljs-keyword">return</span> data.work_end;
                },
                get isTransferStateChanged() {
                    <span class="hljs-keyword">return</span> data.transfer_change;
                },
                <span class="hljs-attr">clearTransferState</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    data.transfer_state = <span class="hljs-literal">undefined</span>;
                },
                get hasTransfer() {
                    <span class="hljs-keyword">return</span> !!data.transfer_state;
                },
                get isTransferPending() {
                    <span class="hljs-keyword">return</span> data.transfer_state === TRANSFER_PENDING;
                },
                get isTransferCancelled() {
                    <span class="hljs-keyword">return</span> data.transfer_state === TRANSFER_CANCELLED;
                },
                get isTransferAccepted() {
                    <span class="hljs-keyword">return</span> data.transfer_state === TRANSFER_ACCEPTED;
                },
                get isTransferRejected() {
                    <span class="hljs-keyword">return</span> data.transfer_state === TRANSFER_REJECTED;
                },
                get openedBy() {
                    <span class="hljs-keyword">return</span> data.opened_by;
                },
                get isOpenedByMe() {
                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.openedBy === userID;
                },
                get transferTo() {
                    <span class="hljs-keyword">return</span> data.transfer_to;
                },
                get isTransferringToMe() {
                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.transferTo === userID;
                },
                get isTransferringFromMe() {
                    <span class="hljs-keyword">return</span> data.transfer_from === userID;
                },
                get transferShouldClose() {
                    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.isAssignedToMe)
                        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
                    <span class="hljs-keyword">return</span> data.transfer_should_close;
                },
                get transferUpdatedOn() {
                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(data.transfer_updated_on);
                },
                get updatedOn() {
                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(data.sys_updated_on);
                },
                get isActive() {
                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.isWaiting || <span class="hljs-keyword">this</span>.isAccepted || (!<span class="hljs-keyword">this</span>.isOpenedByMe &amp;&amp; <span class="hljs-keyword">this</span>.isClosedByClient);
                },
                get isPermanentlyClosed() {
                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.isClosedByAgent || <span class="hljs-keyword">this</span>.isEscalated;
                },
                get isWaiting() {
                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.state === WAITING;
                },
                get isAccepted() {
                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.state === WORK_IN_PROGRESS;
                },
                get isEscalated() {
                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.state === CLOSED_ESCALATED;
                },
                get isAbandoned() {
                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.state === CLOSED_ABANDONED;
                },
                get isClosedByAgent() {
                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.state === CLOSED_COMPLETE;
                },
                get isClosedByClient() {
                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.state === CLOSED_BY_CLIENT;
                },
                <span class="hljs-attr">escalate</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    <span class="hljs-keyword">this</span>.state = CLOSED_ESCALATED;
                }
            };
        }
    };
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/queue/service.queues.js */</span>
angular.module(<span class="hljs-string">'sn.connect.queue'</span>).service(<span class="hljs-string">'queues'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">
    $q, amb, snHttp, queueFactory, profiles, supportAddMembers, supportEnabled, inSupportClient, isLoggedIn, alertOnQueueEnter, audioNotifier</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    <span class="hljs-keyword">var</span> AMB_CHANNEL = <span class="hljs-string">'/connect/support/queue/'</span>;
    <span class="hljs-keyword">var</span> REST_API_PATH = isLoggedIn ? <span class="hljs-string">"/api/now/connect/support/queues"</span> : <span class="hljs-string">"/api/now/connect/support/anonymous/queues"</span>;
    <span class="hljs-keyword">var</span> queues = {};
    <span class="hljs-keyword">var</span> agentsQueues = {};

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">refresh</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> snHttp.get(REST_API_PATH).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>) </span>{
            angular.forEach(queues, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">queue</span>) </span>{
                <span class="hljs-keyword">if</span> (queue.ambChannel)
                    queue.ambChannel.unsubscribe();
            });
            queues = {};
            <span class="hljs-keyword">if</span> (response.data)
                addRawQueues(response.data.result);
            <span class="hljs-keyword">return</span> queues;
        });
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addRawQueues</span>(<span class="hljs-params">rawQueuesData</span>) </span>{
        angular.forEach(rawQueuesData, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">queueData</span>) </span>{
            addRawQueue(queueData);
        });
        angular.forEach(queues, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">queue</span>) </span>{
            addEscalationQueue(queue);
        });
        <span class="hljs-keyword">return</span> queues;
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addRawQueue</span>(<span class="hljs-params">rawQueueData</span>) </span>{
        <span class="hljs-keyword">if</span> (!rawQueueData)
            <span class="hljs-keyword">return</span>;
        <span class="hljs-keyword">var</span> queue = queueFactory.fromObject(rawQueueData);
        <span class="hljs-keyword">if</span> (!queues[queue.id] &amp;&amp; !inSupportClient) {
            queue.ambChannel = amb.getChannel(AMB_CHANNEL + queue.id).subscribe(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>) </span>{
                <span class="hljs-keyword">return</span> requestHttpQueue(response.data.sys_id);
            });
            amb.connect();
        }
        <span class="hljs-keyword">if</span> (queue.isAgentsQueue) {
            <span class="hljs-keyword">if</span> (alertOnQueueEnter &amp;&amp; agentsQueues[queue.id] &amp;&amp; rawQueueData.waiting_count &gt; agentsQueues[queue.id].waitingCount) {
                audioNotifier.notify({
                    <span class="hljs-attr">timestamp</span>: <span class="hljs-built_in">Date</span>.now()
                });
            }
            agentsQueues[queue.id] = queue;
        }
        <span class="hljs-keyword">return</span> queues[queue.id] = queue;
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addEscalationQueue</span>(<span class="hljs-params">queue</span>) </span>{
        <span class="hljs-keyword">if</span> (!queue.escalateTo)
            <span class="hljs-keyword">return</span>;
        requestQueue(queue.escalateTo).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">escalationQueue</span>) </span>{
            queue.escalationQueue = escalationQueue;
        });
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">requestHttpQueue</span>(<span class="hljs-params">queueID</span>) </span>{
        <span class="hljs-keyword">return</span> snHttp.get(REST_API_PATH + <span class="hljs-string">'/'</span> + queueID).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>) </span>{
            <span class="hljs-keyword">var</span> queue = addRawQueue(response.data.result);
            addEscalationQueue(queue);
            <span class="hljs-keyword">return</span> queue;
        });
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">requestQueue</span>(<span class="hljs-params">queueID</span>) </span>{
        <span class="hljs-keyword">if</span> (!queueID)
            <span class="hljs-keyword">return</span> $q.when();
        <span class="hljs-keyword">if</span> (queues[queueID])
            <span class="hljs-keyword">return</span> $q.when(queues[queueID]);
        <span class="hljs-keyword">return</span> requestHttpQueue(queueID);
    }
    <span class="hljs-keyword">if</span> ((supportAddMembers || supportEnabled) &amp;&amp; !inSupportClient)
        refresh();
    <span class="hljs-keyword">return</span> {
        get all() {
            <span class="hljs-keyword">return</span> queues;
        },
        get agents() {
            <span class="hljs-keyword">return</span> agentsQueues;
        },
        <span class="hljs-attr">hasQueues</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">Object</span>.keys(agentsQueues).length &gt; <span class="hljs-number">0</span>;
        },
        <span class="hljs-attr">refresh</span>: refresh,
        <span class="hljs-attr">getAgents</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">queueID</span>) </span>{
            <span class="hljs-keyword">return</span> snHttp.get(REST_API_PATH + <span class="hljs-string">'/'</span> + queueID + <span class="hljs-string">'/agents'</span>).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>) </span>{
                <span class="hljs-keyword">return</span> response.data.result.map(profiles.fromObject);
            });
        },
        <span class="hljs-attr">getQueue</span>: requestQueue,
        <span class="hljs-attr">getAllWaitingCount</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">var</span> waitingCount = <span class="hljs-number">0</span>;
            angular.forEach(agentsQueues, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">queue</span>) </span>{
                waitingCount = waitingCount + queue.waitingCount;
            });
            <span class="hljs-keyword">return</span> waitingCount;
        }
    };
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/queue/service.queueNotifier.js */</span>
angular.module(<span class="hljs-string">'sn.connect.queue'</span>).service(<span class="hljs-string">'queueNotifier'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$window, snNotifier, i18n, userPreferences, queues</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    <span class="hljs-keyword">var</span> LOCAL_STORAGE_KEY = <span class="hljs-string">'sn.connect.queueNotifier.lastUpdatedOn'</span>;
    <span class="hljs-keyword">var</span> queueWaitingCountUpdated;
    i18n.getMessages([
        <span class="hljs-string">'A new customer has joined your support queue'</span>
    ], <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">results</span>) </span>{
        queueWaitingCountUpdated = results[<span class="hljs-string">'A new customer has joined your support queue'</span>];
    });
    <span class="hljs-keyword">var</span> lastWaitingCounts = {};
    angular.forEach(queues.all, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">queue</span>) </span>{
        updateWaitingCounts(queue);
    });
    angular.element($<span class="hljs-built_in">window</span>).on(<span class="hljs-string">'storage'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
        <span class="hljs-keyword">if</span> (e.originalEvent.key !== LOCAL_STORAGE_KEY)
            <span class="hljs-keyword">return</span>;
        <span class="hljs-keyword">var</span> lastWaitingCountsJson = $<span class="hljs-built_in">window</span>.localStorage.getItem(LOCAL_STORAGE_KEY);
        <span class="hljs-keyword">if</span> (lastWaitingCountsJson) {
            lastWaitingCounts = angular.fromJson(lastWaitingCountsJson);
        }
    });

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">updateWaitingCounts</span>(<span class="hljs-params">queue</span>) </span>{
        lastWaitingCounts[queue.id] = queue.waitingCount;
        $<span class="hljs-built_in">window</span>.localStorage.setItem(LOCAL_STORAGE_KEY, angular.toJson(lastWaitingCounts));
    }
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">notify</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">queue</span>) </span>{
            userPreferences.getPreference(<span class="hljs-string">'connect.notifications.desktop'</span>).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">value</span>) </span>{
                <span class="hljs-keyword">if</span> (value === <span class="hljs-string">'false'</span>)
                    <span class="hljs-keyword">return</span>;
                <span class="hljs-keyword">if</span> (queue.waitingCount &lt;= lastWaitingCounts[queue.id]) {
                    updateWaitingCounts(queue);
                    <span class="hljs-keyword">return</span>;
                }
                updateWaitingCounts(queue);
                snNotifier().notify(queueWaitingCountUpdated);
            });
        }
    }
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/queue/service.queueEntries.js */</span>
angular.module(<span class="hljs-string">'sn.connect.queue'</span>).service(<span class="hljs-string">'queueEntries'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">
    $q, $rootScope, snHttp, amb, queueEntryFactory, queues, inSupportClient, isLoggedIn, snNotification</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    <span class="hljs-keyword">var</span> QUEUE_AMB = <span class="hljs-string">'/connect/support/queue/'</span>;
    <span class="hljs-keyword">var</span> GROUP_AMB = <span class="hljs-string">'/connect/support/group/'</span>;
    <span class="hljs-keyword">var</span> queueEntries = {};
    <span class="hljs-keyword">var</span> ambWatchers = {};

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">requestFiltered</span>(<span class="hljs-params">filter</span>) </span>{
        <span class="hljs-keyword">var</span> url = <span class="hljs-string">'/api/now/connect/support/sessions'</span>;
        <span class="hljs-keyword">if</span> (filter) {
            url += <span class="hljs-string">'?'</span>;
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> item <span class="hljs-keyword">in</span> filter)
                <span class="hljs-keyword">if</span> (filter.hasOwnProperty(item))
                    url += item + <span class="hljs-string">"="</span> + <span class="hljs-built_in">encodeURIComponent</span>(filter[item]) + <span class="hljs-string">"&amp;"</span>;
            url = url.slice(<span class="hljs-number">0</span>, <span class="hljs-number">-1</span>);
        }
        <span class="hljs-keyword">return</span> snHttp.get(url).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>) </span>{
            <span class="hljs-keyword">if</span> (!response.data.result)
                <span class="hljs-keyword">return</span>;
            angular.forEach(response.data.result, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">rawQueueEntry</span>) </span>{
                addRawQueueEntry(rawQueueEntry);
            });
        });
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addRawQueueEntry</span>(<span class="hljs-params">rawQueueEntry</span>) </span>{
        <span class="hljs-keyword">var</span> oldQueueEntry = queueEntries[rawQueueEntry.sys_id];
        <span class="hljs-keyword">if</span> (oldQueueEntry &amp;&amp; oldQueueEntry.equals(rawQueueEntry))
            <span class="hljs-keyword">return</span> oldQueueEntry;
        <span class="hljs-keyword">var</span> queueEntry = queueEntryFactory.fromObject(rawQueueEntry);
        <span class="hljs-keyword">if</span> (!ambWatchers[queueEntry.queueID]) {
            ambWatchers[queueEntry.queueID] = amb.getChannel(QUEUE_AMB + queueEntry.queueID)
                .subscribe(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>) </span>{
                    requestFiltered({
                        <span class="hljs-string">'closed'</span>: !inSupportClient,
                        <span class="hljs-string">'queue_id'</span>: response.data.sys_id
                    });
                });
        }
        queueEntries[queueEntry.conversationID] = queueEntries[queueEntry.sysID] = queueEntry;
        <span class="hljs-keyword">if</span> (ambWatchers[queueEntry.conversationID]) {
            <span class="hljs-keyword">if</span> (queueEntry.isPermanentlyClosed)
                removeAMBWatch(queueEntry.conversationID);
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!queueEntry.isPermanentlyClosed &amp;&amp; (queueEntry.isOpenedByMe === inSupportClient)) {
            ambWatchers[queueEntry.conversationID] = amb.getChannel(GROUP_AMB + queueEntry.conversationID)
                .subscribe(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>) </span>{
                    addRawQueueEntry(response.data);
                });
        }
        $rootScope.$broadcast(<span class="hljs-string">"connect.queueEntry.updated"</span>, queueEntry, oldQueueEntry);
        <span class="hljs-keyword">return</span> queueEntry;
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">removeAMBWatch</span>(<span class="hljs-params">conversationID</span>) </span>{
        <span class="hljs-keyword">if</span> (ambWatchers[conversationID]) {
            ambWatchers[conversationID].unsubscribe();
            <span class="hljs-keyword">delete</span> ambWatchers[conversationID];
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">remove</span>(<span class="hljs-params">id</span>) </span>{
        <span class="hljs-keyword">var</span> queueEntry = queueEntries[id];
        <span class="hljs-keyword">if</span> (!queueEntry)
            <span class="hljs-keyword">return</span>;
        <span class="hljs-keyword">delete</span> queueEntries[queueEntry.conversationID];
        <span class="hljs-keyword">delete</span> queueEntries[queueEntry.sysID];
        removeAMBWatch(queueEntry.conversationID);
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">postAction</span>(<span class="hljs-params">conversationID, action, data</span>) </span>{
        data = data || {};
        <span class="hljs-keyword">if</span> (!conversationID)
            <span class="hljs-keyword">throw</span> <span class="hljs-string">'conversationID cannot be undefined'</span>;
        <span class="hljs-keyword">var</span> sessionsApiUri = isLoggedIn ? <span class="hljs-string">'/api/now/connect/support/sessions/'</span> : <span class="hljs-string">'/api/now/connect/support/anonymous/sessions/'</span>;
        <span class="hljs-keyword">return</span> snHttp.post(sessionsApiUri + conversationID + action, data).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>) </span>{
            <span class="hljs-keyword">return</span> addRawQueueEntry(response.data.result);
        });
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">requestByConversation</span>(<span class="hljs-params">conversationID</span>) </span>{
        <span class="hljs-keyword">if</span> (!conversationID)
            <span class="hljs-keyword">throw</span> <span class="hljs-string">'conversationID cannot be undefined'</span>;
        <span class="hljs-keyword">var</span> queueEntry = queueEntries[conversationID];
        <span class="hljs-keyword">if</span> (queueEntry)
            <span class="hljs-keyword">return</span> $q.when(queueEntry);
        <span class="hljs-keyword">return</span> requestFiltered({
            <span class="hljs-string">'group_id'</span>: conversationID
        }).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">return</span> queueEntries[conversationID];
        });
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">requestNext</span>(<span class="hljs-params">queueID</span>) </span>{
        <span class="hljs-keyword">return</span> snHttp.post(<span class="hljs-string">'/api/now/connect/support/queues/'</span> + queueID + <span class="hljs-string">'/accept'</span>, {}).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>) </span>{
            <span class="hljs-keyword">return</span> addRawQueueEntry(response.data.result);
        });
    }
    amb.connect();
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">addRaw</span>: addRawQueueEntry,
        <span class="hljs-attr">get</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">id</span>) </span>{
            <span class="hljs-keyword">return</span> queueEntries[id];
        },
        <span class="hljs-attr">requestByConversation</span>: requestByConversation,
        <span class="hljs-attr">create</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">queueID, message, fromRecord</span>) </span>{
            <span class="hljs-keyword">if</span> (!queueID)
                <span class="hljs-keyword">throw</span> <span class="hljs-string">'queue ID cannot be undefined'</span>;
            <span class="hljs-keyword">if</span> (!message)
                <span class="hljs-keyword">throw</span> <span class="hljs-string">'message cannot be undefined'</span>;
            <span class="hljs-keyword">var</span> url = isLoggedIn ? <span class="hljs-string">'/api/now/connect/support/queues/'</span> + queueID + <span class="hljs-string">'/sessions'</span> :
                <span class="hljs-string">'/api/now/connect/support/anonymous/queues/'</span> + queueID + <span class="hljs-string">'/sessions'</span>;
            <span class="hljs-keyword">var</span> data = {
                <span class="hljs-attr">message</span>: message
            };
            <span class="hljs-keyword">if</span> (fromRecord &amp;&amp; fromRecord.table &amp;&amp; fromRecord.sysId) {
                data.from_table = fromRecord.table;
                data.from_sysid = fromRecord.sysId;
            }
            <span class="hljs-keyword">return</span> snHttp.post(url, data).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>) </span>{
                <span class="hljs-keyword">return</span> addRawQueueEntry(response.data.result);
            }, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>) </span>{
                <span class="hljs-keyword">if</span> (response.status === <span class="hljs-number">403</span>)
                    snNotification.show(<span class="hljs-string">"error"</span>, response.data.result);
                <span class="hljs-keyword">return</span> $q.reject(response)
            });
        },
        <span class="hljs-attr">remove</span>: remove,
        <span class="hljs-attr">close</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">conversationID, agentLeave</span>) </span>{
            <span class="hljs-keyword">return</span> postAction(conversationID, <span class="hljs-string">'/close'</span>, {
                <span class="hljs-attr">agent_leave</span>: !!agentLeave
            });
        },
        <span class="hljs-attr">leave</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">conversationID</span>) </span>{
            <span class="hljs-keyword">return</span> postAction(conversationID, <span class="hljs-string">'/leave'</span>);
        },
        <span class="hljs-attr">rejoin</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">conversationID</span>) </span>{
            <span class="hljs-keyword">return</span> postAction(conversationID, <span class="hljs-string">'/rejoin'</span>);
        },
        <span class="hljs-attr">escalate</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">conversation, queueID</span>) </span>{
            queueID = queueID || conversation.queueEntry.queue.escalateTo;
            <span class="hljs-keyword">if</span> (!queueID)
                <span class="hljs-keyword">throw</span> <span class="hljs-string">"queueID must be set"</span>;
            conversation.queueEntry.escalate();
            <span class="hljs-keyword">return</span> postAction(conversation.sysID, <span class="hljs-string">'/escalate/'</span> + queueID);
        },
        <span class="hljs-attr">transfer</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">conversationID, agentID</span>) </span>{
            <span class="hljs-keyword">if</span> (!agentID)
                <span class="hljs-keyword">throw</span> <span class="hljs-string">'agentID cannot be undefined'</span>;
            <span class="hljs-keyword">return</span> postAction(conversationID, <span class="hljs-string">'/transfer/'</span> + agentID);
        },
        <span class="hljs-attr">accept</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">conversationID</span>) </span>{
            <span class="hljs-keyword">return</span> postAction(conversationID, <span class="hljs-string">'/transfer/accept'</span>);
        },
        <span class="hljs-attr">reject</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">conversationID</span>) </span>{
            <span class="hljs-keyword">var</span> complete = <span class="hljs-keyword">this</span>.complete;
            <span class="hljs-keyword">return</span> postAction(conversationID, <span class="hljs-string">'/transfer/reject'</span>).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> complete(conversationID);
            });
        },
        <span class="hljs-attr">cancel</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">conversationID</span>) </span>{
            <span class="hljs-keyword">var</span> complete = <span class="hljs-keyword">this</span>.complete;
            <span class="hljs-keyword">return</span> postAction(conversationID, <span class="hljs-string">'/transfer/cancel'</span>).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> complete(conversationID);
            });
        },
        <span class="hljs-attr">complete</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">conversationID</span>) </span>{
            <span class="hljs-keyword">return</span> postAction(conversationID, <span class="hljs-string">'/transfer/complete'</span>);
        },
        <span class="hljs-attr">requestNext</span>: requestNext
    };
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/queue/service.queueEntryNotifier.js */</span>
angular.module(<span class="hljs-string">'sn.connect.queue'</span>).service(<span class="hljs-string">'queueEntryNotifier'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">
    $window, snNotifier, i18n, profiles, userPreferences, activeConversation, snNotification, inFrameSet</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    <span class="hljs-keyword">var</span> A_TAG = <span class="hljs-string">'&lt;a href="/$c.do#/support" target="_self"&gt;{0}&lt;/a&gt;'</span>;
    <span class="hljs-keyword">var</span> LOCAL_STORAGE_KEY = <span class="hljs-string">'sn.connect.queueEntryNotifier.lastUpdatedOn'</span>;
    <span class="hljs-keyword">var</span> NOTIFICATION_TEMPLATE = [<span class="hljs-string">'You have an incoming case transfer from {0}.'</span>,
        <span class="hljs-string">'To view the conversation, accept or decline the request,'</span>
    ].join(<span class="hljs-string">' '</span>);
    <span class="hljs-keyword">var</span> transferPendingText,
        transferAcceptedText,
        transferRejectedText,
        transferCancelledText,
        transferPendingNotificationText;
    i18n.getMessages([
        <span class="hljs-string">'Incoming chat transfer'</span>,
        <span class="hljs-string">'Accepted {0}'</span>,
        <span class="hljs-string">'Rejected {0}'</span>,
        <span class="hljs-string">'Cancelled transfer {0}'</span>,
        <span class="hljs-string">'click here'</span>,
        NOTIFICATION_TEMPLATE
    ], <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">results</span>) </span>{
        transferPendingText = results[<span class="hljs-string">'Incoming chat transfer'</span>];
        transferAcceptedText = results[<span class="hljs-string">'Accepted {0}'</span>];
        transferRejectedText = results[<span class="hljs-string">'Rejected {0}'</span>];
        transferCancelledText = results[<span class="hljs-string">'Cancelled transfer {0}'</span>];
        transferPendingNotificationText = results[NOTIFICATION_TEMPLATE] + <span class="hljs-string">" "</span> + A_TAG.replace(<span class="hljs-regexp">/(\{0})/g</span>, results[<span class="hljs-string">'click here'</span>]);
    });
    <span class="hljs-keyword">var</span> lastUpdatedOn;
    angular.element($<span class="hljs-built_in">window</span>).on(<span class="hljs-string">'storage'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
        <span class="hljs-keyword">if</span> (e.originalEvent.key !== LOCAL_STORAGE_KEY)
            <span class="hljs-keyword">return</span>;
        lastUpdatedOn = $<span class="hljs-built_in">window</span>.localStorage.getItem(LOCAL_STORAGE_KEY);
        <span class="hljs-keyword">if</span> (lastUpdatedOn) {
            lastUpdatedOn = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(lastUpdatedOn)
        }
    });
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">notify</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">conversation</span>) </span>{
            <span class="hljs-keyword">var</span> queueEntry = conversation.queueEntry;
            <span class="hljs-keyword">if</span> (!inFrameSet &amp;&amp; !activeConversation.isSupport &amp;&amp; queueEntry.isTransferringToMe) {
                profiles.getAsync(<span class="hljs-string">'sys_user.'</span> + queueEntry.assignedTo).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">profile</span>) </span>{
                    snNotification.show(<span class="hljs-string">'info'</span>, i18n.format(transferPendingNotificationText, profile.name))
                        .then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">element</span>) </span>{
                            element.on(<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                                snNotification.hide(element);
                                activeConversation.conversation = conversation;
                            });
                        });
                });
            }
            userPreferences.getPreference(<span class="hljs-string">'connect.notifications.desktop'</span>).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">value</span>) </span>{
                <span class="hljs-keyword">if</span> (value === <span class="hljs-string">'false'</span>)
                    <span class="hljs-keyword">return</span>;
                <span class="hljs-keyword">if</span> (!queueEntry.isTransferStateChanged)
                    <span class="hljs-keyword">return</span>;
                <span class="hljs-keyword">if</span> (queueEntry.transferUpdatedOn &lt;= lastUpdatedOn)
                    <span class="hljs-keyword">return</span>;
                <span class="hljs-keyword">var</span> body, userID;
                <span class="hljs-keyword">if</span> (queueEntry.isTransferringToMe) {
                    <span class="hljs-keyword">if</span> (queueEntry.isTransferPending) {
                        userID = queueEntry.assignedTo;
                        body = transferPendingText + <span class="hljs-string">"\n"</span> + queueEntry.number + <span class="hljs-string">" - "</span> + queueEntry.shortDescription;
                    }
                    <span class="hljs-keyword">if</span> (queueEntry.isTransferCancelled) {
                        userID = queueEntry.assignedTo;
                        body = transferCancelledText.replace(<span class="hljs-regexp">/\{0\}/</span>, queueEntry.number);
                    }
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (queueEntry.isTransferringFromMe) {
                    <span class="hljs-keyword">if</span> (queueEntry.isTransferAccepted) {
                        userID = queueEntry.assignedTo;
                        body = transferAcceptedText.replace(<span class="hljs-regexp">/\{0\}/</span>, queueEntry.number);
                    }
                    <span class="hljs-keyword">if</span> (queueEntry.isTransferRejected) {
                        userID = queueEntry.transferTo;
                        body = transferRejectedText.replace(<span class="hljs-regexp">/\{0\}/</span>, queueEntry.number);
                    }
                }
                <span class="hljs-keyword">if</span> (!body)
                    <span class="hljs-keyword">return</span>;
                $<span class="hljs-built_in">window</span>.localStorage.setItem(LOCAL_STORAGE_KEY, queueEntry.transferUpdatedOn);
                profiles.getAsync(<span class="hljs-string">'sys_user.'</span> + userID).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">profile</span>) </span>{
                    snNotifier().notify(profile.name, {
                        <span class="hljs-attr">body</span>: body,
                        <span class="hljs-attr">onClick</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                            activeConversation.conversation = conversation;
                        }
                    });
                });
            });
        }
    }
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/queue/filter.transferAccepted.js */</span>
angular.module(<span class="hljs-string">'sn.connect.queue'</span>).filter(<span class="hljs-string">'transferAccepted'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">input</span>) </span>{
        <span class="hljs-keyword">return</span> input.filter(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">conversation</span>) </span>{
            <span class="hljs-keyword">var</span> queueEntry = conversation.queueEntry;
            <span class="hljs-keyword">return</span> queueEntry &amp;&amp; queueEntry.isTransferringFromMe &amp;&amp; queueEntry.isTransferAccepted;
        });
    }
});;;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/search/directive.liveSearch.js */</span>
angular.module(<span class="hljs-string">'sn.connect'</span>).directive(<span class="hljs-string">'liveSearch'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">getTemplateUrl</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
        <span class="hljs-attr">templateUrl</span>: getTemplateUrl(<span class="hljs-string">'liveSearch.xml'</span>),
        <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">scope</span>: {
            <span class="hljs-attr">type</span>: <span class="hljs-string">'@'</span>,
            <span class="hljs-attr">limit</span>: <span class="hljs-string">'@'</span>,
            <span class="hljs-attr">placeholder</span>: <span class="hljs-string">'@'</span>,
            <span class="hljs-attr">expandDirection</span>: <span class="hljs-string">'@'</span>,
            <span class="hljs-attr">onSelect</span>: <span class="hljs-string">'&amp;'</span>
        },
        <span class="hljs-attr">link</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">scope</span>) </span>{
            scope.forwardOnSelect = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">id</span>) </span>{
                scope.onSelect({
                    <span class="hljs-attr">id</span>: id
                });
            };
        }
    }
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/search/directive.liveSearchControl.js */</span>
angular.module(<span class="hljs-string">'sn.connect'</span>).directive(<span class="hljs-string">'liveSearchControl'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">
    $compile, $timeout, getTemplateUrl, snHttp, userJID, $rootScope, i18n</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    <span class="hljs-keyword">var</span> MINIMUM_TYPING_WAIT = <span class="hljs-number">250</span>;
    <span class="hljs-keyword">var</span> CACHE_TIME_LIMIT = <span class="hljs-number">15</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>;
    <span class="hljs-keyword">var</span> liveSearchTranslatedStrings;
    i18n.getMessages([
        <span class="hljs-string">'People'</span>, <span class="hljs-string">'No matching people'</span>,
        <span class="hljs-string">'Groups'</span>, <span class="hljs-string">'No matching groups'</span>,
        <span class="hljs-string">'Messages'</span>, <span class="hljs-string">'No matching messages'</span>
    ], <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">result</span>) </span>{
        liveSearchTranslatedStrings = result;
    });
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
        <span class="hljs-attr">templateUrl</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">tElement, tAttrs</span>) </span>{
            <span class="hljs-keyword">if</span> (tAttrs.templateUrl)
                <span class="hljs-keyword">return</span> getTemplateUrl(tAttrs.templateUrl);
            <span class="hljs-keyword">else</span>
                <span class="hljs-keyword">return</span> getTemplateUrl(<span class="hljs-string">'liveSearchControl.xml'</span>);
        },
        <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">scope</span>: {
            <span class="hljs-attr">type</span>: <span class="hljs-string">'@'</span>,
            <span class="hljs-attr">limit</span>: <span class="hljs-string">'@'</span>,
            <span class="hljs-attr">placeholder</span>: <span class="hljs-string">'@'</span>,
            <span class="hljs-attr">expandDirection</span>: <span class="hljs-string">'@'</span>,
            <span class="hljs-attr">onSelect</span>: <span class="hljs-string">'&amp;'</span>,
            <span class="hljs-attr">templateOverride</span>: <span class="hljs-string">'=?'</span>,
            <span class="hljs-attr">ignoreBlur</span>: <span class="hljs-string">'@'</span>,
            <span class="hljs-attr">onBlur</span>: <span class="hljs-string">"&amp;?"</span>,
            <span class="hljs-attr">ignoreList</span>: <span class="hljs-string">"="</span>
        },
        <span class="hljs-attr">link</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">scope, element</span>) </span>{
            scope.triggerCreateConversation = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                $rootScope.$broadcast(<span class="hljs-string">"connect.show_create_conversation_screen"</span>);
                $rootScope.$broadcast(<span class="hljs-string">'connect.pane.close'</span>);
                $rootScope.$broadcast(<span class="hljs-string">"sn.aside.close"</span>, <span class="hljs-literal">true</span>);
            };
            <span class="hljs-keyword">var</span> suggestionScopes = [];
            <span class="hljs-keyword">var</span> limit = scope.limit || <span class="hljs-number">5</span>;
            <span class="hljs-keyword">var</span> searchURL = <span class="hljs-string">'/api/now/connect/search/'</span> + scope.type + <span class="hljs-string">'?keywords={query}&amp;limit='</span> + limit;
            <span class="hljs-keyword">if</span> (!scope.onBlur)
                scope.onBlur = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{};

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Search</span>(<span class="hljs-params">table</span>) </span>{
                Search.promises = Search.promises || {};
                <span class="hljs-keyword">var</span> that = <span class="hljs-keyword">this</span>;
                <span class="hljs-keyword">this</span>.table = table;
                <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">query, sync, async</span>) </span>{
                    that.debounce(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                        suggestionScopes.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">suggestionScope</span>) </span>{
                            suggestionScope.$destroy();
                        });
                        that.getPromise(query).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>) </span>{
                            <span class="hljs-keyword">if</span> (response.data.result) {
                                angular.forEach(response.data.result, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">result</span>) </span>{
                                    <span class="hljs-keyword">if</span> (that.table !== result.table)
                                        <span class="hljs-keyword">return</span>;
                                    <span class="hljs-keyword">async</span>(result.searchResults);
                                });
                            } <span class="hljs-keyword">else</span> {
                                <span class="hljs-keyword">async</span>();
                            }
                            <span class="hljs-keyword">return</span> response;
                        });
                    });
                };
            }
            Search.prototype.debounce = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">func</span>) </span>{
                $timeout.cancel(<span class="hljs-keyword">this</span>.timeout);
                <span class="hljs-keyword">this</span>.timeout = $timeout(func, MINIMUM_TYPING_WAIT);
            };
            Search.prototype.removeStaleEntries = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">var</span> now = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>();
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> key <span class="hljs-keyword">in</span> Search.promises) {
                    <span class="hljs-keyword">if</span> (!Search.promises.hasOwnProperty(key))
                        <span class="hljs-keyword">continue</span>;
                    <span class="hljs-keyword">var</span> elapsed = now - Search.promises[key].time;
                    <span class="hljs-keyword">if</span> (elapsed &gt; CACHE_TIME_LIMIT) {
                        <span class="hljs-keyword">delete</span> Search.promises[key];
                    }
                }
            };
            Search.prototype.getPromise = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">query</span>) </span>{
                <span class="hljs-keyword">this</span>.removeStaleEntries();
                <span class="hljs-keyword">var</span> url = searchURL.replace(<span class="hljs-string">"{query}"</span>, query);
                <span class="hljs-keyword">if</span> (scope.ignoreList)
                    url += <span class="hljs-string">"&amp;ignore="</span> + scope.ignoreList;
                <span class="hljs-keyword">var</span> data = Search.promises[url];
                <span class="hljs-keyword">if</span> (!data) {
                    data = Search.promises[url] = {
                        <span class="hljs-attr">promise</span>: snHttp.get(url),
                        <span class="hljs-attr">time</span>: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>()
                    };
                }
                <span class="hljs-keyword">return</span> data.promise;
            };
            <span class="hljs-keyword">var</span> templates = {
                <span class="hljs-attr">sys_user</span>: <span class="hljs-string">'&lt;div class="sn-widget-list_v2"&gt;&lt;div class="suggestion-user sn-widget-list-item"&gt;&lt;div class="sn-widget-list-content sn-widget-list-content_static"&gt;&lt;sn-avatar primary="::profile" class="avatar-small" nopopover="true"&gt;&lt;/sn-avatar&gt;&lt;/div&gt;&lt;div class="sn-widget-list-content"&gt;&lt;span class="name sn-widget-list-title"&gt;{{::profile.name}}&lt;/span&gt;&lt;span class="suggestion-detail sn-widget-list-subtitle"&gt;{{::profile.email}}&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;'</span>,
                <span class="hljs-attr">live_message</span>: <span class="hljs-string">'&lt;div class="sn-widget-list_v2"&gt;&lt;div class="suggestion-message sn-widget-list-item"&gt;&lt;div class="sn-widget-list-content sn-widget-list-content_static"&gt;&lt;sn-avatar primary="::profile" class="avatar-small" nopopover="true"&gt;&lt;/sn-avatar&gt;&lt;/div&gt;&lt;div class="details sn-widget-list-content"&gt;&lt;span class="body sn-widget-list-title"&gt;{{::suggestion.formattedBody}}&lt;/span&gt;&lt;span class="name sn-widget-list-subtitle"&gt;{{::profile.name}}&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;'</span>,
                <span class="hljs-attr">live_group_profile</span>: <span class="hljs-string">'&lt;div class="sn-widget-list_v2"&gt;&lt;div class="suggestion-group sn-widget-list-item"&gt;&lt;div class="sn-widget-list-content sn-widget-list-content_static"&gt;&lt;sn-avatar primary="::profile" members="::members" class="avatar-small" nopopover="true"&gt;&lt;/sn-avatar&gt;&lt;/div&gt;&lt;div class="sn-widget-list-content"&gt;&lt;span class="name sn-widget-list-title"&gt;{{::suggestion.name}}&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;'</span>
            };
            <span class="hljs-keyword">if</span> (scope.templateOverride)
                angular.extend(templates, scope.templateOverride);
            <span class="hljs-keyword">var</span> buildInitials = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">name</span>) </span>{
                <span class="hljs-keyword">if</span> (!name)
                    <span class="hljs-keyword">return</span> <span class="hljs-string">"--"</span>;
                <span class="hljs-keyword">var</span> initials = name.split(<span class="hljs-string">" "</span>).map(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">word</span>) </span>{
                    <span class="hljs-keyword">return</span> word.toUpperCase();
                }).filter(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">word</span>) </span>{
                    <span class="hljs-keyword">return</span> word.match(<span class="hljs-regexp">/^[A-Z]/</span>);
                }).map(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">word</span>) </span>{
                    <span class="hljs-keyword">return</span> word.substring(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>);
                }).join(<span class="hljs-string">""</span>);
                <span class="hljs-keyword">return</span> initials.substr(<span class="hljs-number">0</span>, <span class="hljs-number">3</span>);
            };
            <span class="hljs-keyword">var</span> isMember = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">member</span>) </span>{
                <span class="hljs-keyword">return</span> (member &amp;&amp; member.jid === userJID);
            };
            <span class="hljs-keyword">var</span> dataSet = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">table, displayKey, header, emptySuggestion</span>) </span>{
                <span class="hljs-keyword">return</span> {
                    <span class="hljs-attr">name</span>: table,
                    <span class="hljs-attr">limit</span>: scope.limit,
                    <span class="hljs-attr">displayKey</span>: displayKey,
                    <span class="hljs-attr">source</span>: <span class="hljs-keyword">new</span> Search(table),
                    <span class="hljs-attr">templates</span>: {
                        <span class="hljs-attr">header</span>: <span class="hljs-string">'&lt;div class="header sn-aside-group-title"&gt;'</span> + header + <span class="hljs-string">'&lt;/div&gt;'</span>,
                        <span class="hljs-attr">empty</span>: <span class="hljs-string">'&lt;div class="empty-suggestion sn-wiget sn-widget-textblock sn-widget-textblock_center"&gt;'</span> + emptySuggestion + <span class="hljs-string">'&lt;/div&gt;'</span>,
                        <span class="hljs-attr">suggestion</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">suggestion</span>) </span>{
                            <span class="hljs-keyword">var</span> suggestionScope = scope.$<span class="hljs-keyword">new</span>();
                            suggestionScopes.push(suggestionScope);
                            suggestionScope.suggestion = suggestion;
                            <span class="hljs-keyword">if</span> (!isMember(suggestion.from) &amp;&amp;
                                !isMember(suggestion.to) &amp;&amp;
                                suggestion.to &amp;&amp;
                                suggestion.from) {
                                suggestionScope.profile = {
                                    <span class="hljs-attr">avatar</span>: suggestion.from.avatarID,
                                    <span class="hljs-attr">initials</span>: buildInitials(suggestion.from.name),
                                    <span class="hljs-attr">name</span>: <span class="hljs-string">'From: '</span> + suggestion.from.name
                                };
                            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (isMember(suggestion.from) &amp;&amp;
                                suggestion.to &amp;&amp;
                                suggestion.to.name) {
                                suggestionScope.profile = {
                                    <span class="hljs-attr">avatar</span>: suggestion.from.avatarID,
                                    <span class="hljs-attr">initials</span>: buildInitials(suggestion.from.name),
                                    <span class="hljs-attr">name</span>: <span class="hljs-string">'To: '</span> + suggestion.to.name
                                };
                            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (isMember(suggestion.to) &amp;&amp;
                                suggestion.from &amp;&amp;
                                suggestion.from.name) {
                                suggestionScope.profile = {
                                    <span class="hljs-attr">avatar</span>: suggestion.from.avatarID,
                                    <span class="hljs-attr">initials</span>: buildInitials(suggestion.from.name),
                                    <span class="hljs-attr">name</span>: <span class="hljs-string">'From: '</span> + suggestion.from.name
                                };
                            } <span class="hljs-keyword">else</span> {
                                suggestionScope.profile = {
                                    <span class="hljs-attr">avatar</span>: suggestion.avatarID,
                                    <span class="hljs-attr">initials</span>: buildInitials(suggestion.name),
                                    <span class="hljs-attr">name</span>: suggestion.name,
                                    <span class="hljs-attr">email</span>: suggestion.email
                                };
                            }
                            <span class="hljs-keyword">if</span> (suggestion.members) {
                                suggestionScope.members = [];
                                angular.forEach(suggestion.members, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">member</span>) </span>{
                                    suggestionScope.members.push({
                                        <span class="hljs-attr">avatar</span>: member.avatarID,
                                        <span class="hljs-attr">initials</span>: buildInitials(suggestion.name),
                                        <span class="hljs-attr">name</span>: name
                                    });
                                });
                            }
                            <span class="hljs-keyword">if</span> (suggestion.body) {
                                suggestion.formattedBody = suggestion.body.replace(<span class="hljs-regexp">/@\[[a-z0-9]{32}:([^\]]+?)\]/gi</span>, <span class="hljs-string">"@$1"</span>);
                            }
                            <span class="hljs-keyword">return</span> $compile(templates[table])(suggestionScope);
                        }
                    }
                };
            };
            <span class="hljs-keyword">var</span> selected = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event, suggestion</span>) </span>{
                <span class="hljs-keyword">var</span> id = <span class="hljs-string">''</span>;
                <span class="hljs-keyword">if</span> (suggestion.jid.indexOf(<span class="hljs-string">'live_message'</span>) === <span class="hljs-number">0</span>) {
                    <span class="hljs-keyword">if</span> (!isMember(suggestion.from) &amp;&amp;
                        !isMember(suggestion.to) &amp;&amp;
                        suggestion.to &amp;&amp;
                        suggestion.from) {
                        id = suggestion.to.jid;
                    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (isMember(suggestion.from) &amp;&amp; suggestion.to) {
                        id = suggestion.to.jid;
                    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (isMember(suggestion.to) &amp;&amp; suggestion.from) {
                        id = suggestion.from.jid;
                    }
                } <span class="hljs-keyword">else</span> {
                    id = suggestion.jid;
                }
                scope.onSelect({
                    <span class="hljs-attr">id</span>: id,
                    <span class="hljs-attr">suggestion</span>: suggestion
                });
                scope.$apply();
                <span class="hljs-keyword">var</span> target = angular.element(event.target);
                target.typeahead(<span class="hljs-string">'close'</span>);
                target.typeahead(<span class="hljs-string">'val'</span>, <span class="hljs-string">''</span>);
            };
            <span class="hljs-keyword">var</span> options = [{
                    <span class="hljs-attr">autoselect</span>: <span class="hljs-string">'first'</span>,
                    <span class="hljs-attr">hint</span>: <span class="hljs-literal">true</span>,
                    <span class="hljs-attr">highlight</span>: <span class="hljs-literal">false</span>,
                    <span class="hljs-attr">minLength</span>: <span class="hljs-number">2</span>
                },
                dataSet(<span class="hljs-string">'sys_user'</span>, <span class="hljs-string">'name'</span>, liveSearchTranslatedStrings[<span class="hljs-string">'People'</span>], liveSearchTranslatedStrings[<span class="hljs-string">'No matching people'</span>])
            ];
            <span class="hljs-keyword">if</span> (scope.type !== <span class="hljs-string">'user'</span>) {
                options.push(dataSet(<span class="hljs-string">'live_message'</span>, <span class="hljs-string">'body'</span>, liveSearchTranslatedStrings[<span class="hljs-string">'Messages'</span>], liveSearchTranslatedStrings[<span class="hljs-string">'No matching messages'</span>]));
                options.push(dataSet(<span class="hljs-string">'live_group_profile'</span>, <span class="hljs-string">'body'</span>, liveSearchTranslatedStrings[<span class="hljs-string">'Groups'</span>], liveSearchTranslatedStrings[<span class="hljs-string">'No matching groups'</span>]));
            }
            $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">var</span> input = element.find(<span class="hljs-string">"input"</span>);
                input.on(<span class="hljs-string">"keydown"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
                    <span class="hljs-keyword">if</span> (input.val() !== <span class="hljs-string">""</span>)
                        <span class="hljs-keyword">return</span>;
                    <span class="hljs-keyword">if</span> (e.keyCode === <span class="hljs-number">8</span>)
                        scope.$emit(<span class="hljs-string">"connect.search_control_key"</span>, <span class="hljs-string">"backspace"</span>);
                    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (e.keyCode === <span class="hljs-number">13</span>)
                        scope.$emit(<span class="hljs-string">"connect.search_control_key"</span>, <span class="hljs-string">"enter"</span>);
                    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (e.keyCode === <span class="hljs-number">27</span>)
                        scope.$emit(<span class="hljs-string">"connect.search_control_key"</span>, <span class="hljs-string">"escape"</span>);
                });
                input.typeahead.apply(input, options);
                input.on(<span class="hljs-string">'typeahead:selected'</span>, selected);
                input.on(<span class="hljs-string">'typeahead:autocomplete'</span>, selected);
                input.on(<span class="hljs-string">'keydown'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
                    <span class="hljs-keyword">if</span> (e.keyCode === <span class="hljs-number">13</span>) {
                        <span class="hljs-keyword">var</span> newEvent = angular.element.Event(<span class="hljs-string">"keydown"</span>);
                        newEvent.keyCode = <span class="hljs-number">9</span>;
                        input.trigger(newEvent);
                    }
                });
                scope.$emit(<span class="hljs-string">"live.search.control.ready"</span>, input);
                <span class="hljs-keyword">if</span> (scope.ignoreBlur) {
                    <span class="hljs-keyword">var</span> api = input.data(<span class="hljs-string">'ttTypeahead'</span>);
                    api.input.off(<span class="hljs-string">"blurred"</span>);
                    api._onBlurred = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                        <span class="hljs-keyword">this</span>.isActivated = <span class="hljs-literal">false</span>;
                    };
                    api.input.onSync(<span class="hljs-string">"blurred"</span>, api._onBlurred, api);
                }
            });
        }
    };
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/search/directive.liveSearchPopover.js */</span>
angular.module(<span class="hljs-string">'sn.connect'</span>).directive(<span class="hljs-string">'liveSearchPopover'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$timeout, $document, getTemplateUrl</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    <span class="hljs-keyword">var</span> VK_ESC = <span class="hljs-number">27</span>;
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
        <span class="hljs-attr">templateUrl</span>: getTemplateUrl(<span class="hljs-string">'liveSearchPopover.xml'</span>),
        <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">scope</span>: {
            <span class="hljs-attr">type</span>: <span class="hljs-string">'@'</span>,
            <span class="hljs-attr">limit</span>: <span class="hljs-string">'@'</span>,
            <span class="hljs-attr">buttonId</span>: <span class="hljs-string">'@'</span>,
            <span class="hljs-attr">placeholder</span>: <span class="hljs-string">'@'</span>,
            <span class="hljs-attr">expandDirection</span>: <span class="hljs-string">'@'</span>,
            <span class="hljs-attr">onSelect</span>: <span class="hljs-string">'&amp;'</span>
        },
        <span class="hljs-attr">link</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">scope, element</span>) </span>{
            element.detach();
            <span class="hljs-keyword">var</span> popoverButton;
            <span class="hljs-keyword">var</span> getPopoverButton = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">if</span> (!popoverButton) {
                    popoverButton = $<span class="hljs-built_in">document</span>.find(<span class="hljs-string">"#"</span> + scope.buttonId);
                    <span class="hljs-keyword">var</span> toggleIgnore = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) </span>{
                        popoverButton.ignoreBlurHide = (event.type === <span class="hljs-string">'mousedown'</span>);
                    };
                    popoverButton.mousedown(toggleIgnore);
                    popoverButton.mouseup(toggleIgnore);
                }
                <span class="hljs-keyword">return</span> popoverButton;
            };
            scope.onSelectHidePopover = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">id</span>) </span>{
                scope.onSelect({
                    <span class="hljs-attr">id</span>: id
                });
                getPopoverButton().popover(<span class="hljs-string">'hide'</span>);
            };
            scope.$on(<span class="hljs-string">'live.search.control.ready'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event, popoverInput</span>) </span>{
                popoverInput.data(<span class="hljs-string">'ttTypeahead'</span>).input.off(<span class="hljs-string">'blurred'</span>);
                <span class="hljs-keyword">var</span> hidePopover = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    <span class="hljs-keyword">var</span> popoverButton = getPopoverButton();
                    <span class="hljs-keyword">if</span> (popoverButton.ignoreBlurHide) {
                        <span class="hljs-keyword">return</span>;
                    }
                    popoverButton.popover(<span class="hljs-string">'hide'</span>);
                };
                popoverInput.on(<span class="hljs-string">'blur'</span>, hidePopover);
                popoverInput.keyup(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) </span>{
                    <span class="hljs-keyword">var</span> code = event.keyCode || event.which;
                    <span class="hljs-keyword">if</span> (code !== VK_ESC) {
                        <span class="hljs-keyword">return</span>;
                    }
                    hidePopover();
                });
                getPopoverButton().on(<span class="hljs-string">'shown.bs.popover'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    popoverInput.focus();
                });
                getPopoverButton().on(<span class="hljs-string">'hidden.bs.popover'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    popoverInput.typeahead(<span class="hljs-string">'val'</span>, <span class="hljs-string">''</span>);
                });
            });
            $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                getPopoverButton().popover({
                    <span class="hljs-attr">container</span>: <span class="hljs-string">'body'</span>,
                    <span class="hljs-attr">placement</span>: scope.expandDirection || <span class="hljs-string">'right'</span>,
                    <span class="hljs-attr">html</span>: <span class="hljs-literal">true</span>,
                    <span class="hljs-attr">content</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                        <span class="hljs-keyword">return</span> angular.element(<span class="hljs-string">'&lt;div /&gt;'</span>).append(element);
                    },
                    <span class="hljs-attr">template</span>: <span class="hljs-string">'&lt;div class="sn-live-search-popover popover" role="tooltip"&gt;'</span> +
                        <span class="hljs-string">'&lt;div class="arrow"&gt;&lt;/div&gt;'</span> +
                        <span class="hljs-string">'&lt;h3 class="popover-title"&gt;&lt;/h3&gt;'</span> +
                        <span class="hljs-string">'&lt;div class="popover-content"&gt;&lt;/div&gt;'</span> +
                        <span class="hljs-string">'&lt;/div&gt;'</span>
                });
            });
        }
    };
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.ng_chat/search/directive.snSearchButton.js */</span>
angular.module(<span class="hljs-string">'sn.connect'</span>).directive(<span class="hljs-string">'snSearchButton'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">getTemplateUrl</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
        <span class="hljs-attr">templateUrl</span>: getTemplateUrl(<span class="hljs-string">'snSearchButton.xml'</span>),
        <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">scope</span>: {
            <span class="hljs-attr">blockAside</span>: <span class="hljs-string">'='</span>,
            <span class="hljs-attr">conversation</span>: <span class="hljs-string">'='</span>
        },
        <span class="hljs-attr">controller</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$scope</span>) </span>{
            $scope.isActive = <span class="hljs-literal">false</span>;
            <span class="hljs-keyword">var</span> asideView = {
                <span class="hljs-attr">template</span>: <span class="hljs-string">"&lt;sn-aside-search&gt;&lt;/sn-aside-search&gt;"</span>
            };
            $scope.openAside = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">if</span> (!$scope.buttons)
                    $scope.buttons = angular.element(<span class="hljs-string">'#conversationAsideButtons'</span>);
                <span class="hljs-keyword">if</span> ($scope.blockAside || !$scope.conversation.sysID || $scope.conversation.isPending)
                    <span class="hljs-keyword">return</span>;
                <span class="hljs-keyword">if</span> ($scope.isActive)
                    $scope.$emit(<span class="hljs-string">"sn.aside.close"</span>);
                <span class="hljs-keyword">else</span>
                    $scope.$emit(<span class="hljs-string">"sn.aside.open"</span>, asideView, <span class="hljs-literal">false</span>, $scope.buttons.width());
            };
            $scope.$on(<span class="hljs-string">"sn.aside.controls.active"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e, data</span>) </span>{
                $scope.isActive = (data === <span class="hljs-string">"search"</span>);
            });
            $scope.$on(<span class="hljs-string">"sn.aside.close"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                $scope.isActive = <span class="hljs-literal">false</span>;
            });
        }
    };
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/doctype/CustomEventManager.js */</span>
<span class="hljs-keyword">var</span> NOW = NOW || {};
<span class="hljs-keyword">var</span> CustomEventManager = (<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">existingCustomEvent</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">var</span> events = (existingCustomEvent &amp;&amp; existingCustomEvent.events) || {};
    <span class="hljs-keyword">var</span> isFiringFlag = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">var</span> trace = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">var</span> suppressEvents = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">var</span> NOW_MSG = <span class="hljs-string">'NOW.PostMessage'</span>;

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">observe</span>(<span class="hljs-params">eventName, fn</span>) </span>{
        <span class="hljs-keyword">if</span> (trace)
            jslog(<span class="hljs-string">"$CustomEventManager observing: "</span> + eventName);
        on(eventName, fn);
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">on</span>(<span class="hljs-params">name, func</span>) </span>{
        <span class="hljs-keyword">if</span> (!func || <span class="hljs-keyword">typeof</span> func !== <span class="hljs-string">'function'</span>)
            <span class="hljs-keyword">return</span>;
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> name === <span class="hljs-string">'undefined'</span>)
            <span class="hljs-keyword">return</span>;
        <span class="hljs-keyword">if</span> (!events[name])
            events[name] = [];
        events[name].push(func);
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">un</span>(<span class="hljs-params">name, func</span>) </span>{
        <span class="hljs-keyword">if</span> (!events[name])
            <span class="hljs-keyword">return</span>;
        <span class="hljs-keyword">var</span> idx = <span class="hljs-number">-1</span>;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; events[name].length; i++) {
            <span class="hljs-keyword">if</span> (events[name][i] === func) {
                idx = i;
                <span class="hljs-keyword">break</span>;
            }
        }
        <span class="hljs-keyword">if</span> (idx &gt;= <span class="hljs-number">0</span>)
            events[name].splice(idx, <span class="hljs-number">1</span>)
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">unAll</span>(<span class="hljs-params">name</span>) </span>{
        <span class="hljs-keyword">if</span> (events[name])
            <span class="hljs-keyword">delete</span> events[name];
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fire</span>(<span class="hljs-params">eventName, args</span>) </span>{
        <span class="hljs-keyword">if</span> (trace)
            jslog(<span class="hljs-string">"$CustomEventManager firing: "</span> + eventName + <span class="hljs-string">" args: "</span> + <span class="hljs-built_in">arguments</span>.length);
        <span class="hljs-keyword">return</span> fireEvent.apply(<span class="hljs-literal">null</span>, <span class="hljs-built_in">arguments</span>);
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fireUp</span>(<span class="hljs-params">eventName, args</span>) </span>{
        <span class="hljs-keyword">var</span> win = <span class="hljs-built_in">window</span>;
        <span class="hljs-keyword">while</span> (win) {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">if</span> (win.CustomEvent.fireEvent.apply(<span class="hljs-literal">null</span>, <span class="hljs-built_in">arguments</span>) === <span class="hljs-literal">false</span>)
                    <span class="hljs-keyword">return</span>;
                win = win.parent === win ? <span class="hljs-literal">null</span> : win.parent;
            } <span class="hljs-keyword">catch</span> (e) {
                <span class="hljs-keyword">return</span>;
            }
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fireEvent</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">if</span> (suppressEvents)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">var</span> args = <span class="hljs-built_in">Array</span>.prototype.slice.apply(<span class="hljs-built_in">arguments</span>);
        <span class="hljs-keyword">var</span> name = args.shift();
        <span class="hljs-keyword">var</span> eventList = events[name];
        <span class="hljs-keyword">if</span> (!eventList)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">var</span> event = eventList.slice();
        isFiringFlag = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, l = event.length; i &lt; l; i++) {
            <span class="hljs-keyword">var</span> ev = event[i];
            <span class="hljs-keyword">if</span> (!ev)
                <span class="hljs-keyword">continue</span>;
            <span class="hljs-keyword">if</span> (ev.apply(<span class="hljs-literal">null</span>, args) === <span class="hljs-literal">false</span>) {
                isFiringFlag = <span class="hljs-literal">false</span>;
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            }
        }
        isFiringFlag = <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isFiring</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> isFiringFlag;
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">forward</span>(<span class="hljs-params">name, element, func</span>) </span>{
        on(name, func);
        element.addEventListener(name, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
            fireEvent(e.type, <span class="hljs-keyword">this</span>, e);
        }.bind(api));
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">registerPostMessageEvent</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">if</span> (NOW.registeredPostMessageEvent) {
            <span class="hljs-keyword">return</span>;
        }
        <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">window</span>.postMessage) {
            <span class="hljs-keyword">return</span>;
        }
        <span class="hljs-built_in">window</span>.addEventListener(<span class="hljs-string">'message'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) </span>{
            <span class="hljs-keyword">var</span> nowMessageJSON = event.data;
            <span class="hljs-keyword">var</span> nowMessage;
            <span class="hljs-keyword">try</span> {
                nowMessage = <span class="hljs-built_in">JSON</span>.parse(nowMessageJSON.toString());
            } <span class="hljs-keyword">catch</span> (e) {
                <span class="hljs-keyword">return</span>;
            }
            <span class="hljs-keyword">if</span> (!nowMessage.type == NOW_MSG) {
                <span class="hljs-keyword">return</span>;
            }
            fire(nowMessage.eventName, nowMessage.args);
        }, <span class="hljs-literal">false</span>);
        NOW.registeredPostMessageEvent = <span class="hljs-literal">true</span>;
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">doPostMessage</span>(<span class="hljs-params">win, event, msg, targetOrigin</span>) </span>{
        <span class="hljs-keyword">var</span> nowMessage = {
            <span class="hljs-attr">type</span>: NOW_MSG,
            <span class="hljs-attr">eventName</span>: event,
            <span class="hljs-attr">args</span>: msg
        };
        <span class="hljs-keyword">var</span> nowMessageJSON;
        <span class="hljs-keyword">if</span> (!win || !win.postMessage) {
            <span class="hljs-keyword">return</span>
        }
        nowMessageJSON = <span class="hljs-built_in">JSON</span>.stringify(nowMessage);
        win.postMessage(nowMessageJSON, targetOrigin);
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fireTop</span>(<span class="hljs-params">eventName, args</span>) </span>{
        <span class="hljs-keyword">if</span> (trace)
            jslog(<span class="hljs-string">"$CustomEventManager firing: "</span> + eventName + <span class="hljs-string">" args: "</span> + <span class="hljs-built_in">arguments</span>.length);
        fireEvent.apply(<span class="hljs-literal">null</span>, <span class="hljs-built_in">arguments</span>);
        <span class="hljs-keyword">var</span> t = getTopWindow();
        <span class="hljs-keyword">if</span> (t !== <span class="hljs-literal">null</span> &amp;&amp; <span class="hljs-built_in">window</span> !== t)
            t.CustomEvent.fire(eventName, args);
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fireAll</span>(<span class="hljs-params">eventName, args</span>) </span>{
        <span class="hljs-keyword">if</span> (trace)
            jslog(<span class="hljs-string">"$CustomEventManager firing: "</span> + eventName + <span class="hljs-string">" args: "</span> + <span class="hljs-built_in">arguments</span>.length);
        <span class="hljs-keyword">var</span> topWindow = getTopWindow();
        notifyAllFrom(topWindow);

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">notifyAllFrom</span>(<span class="hljs-params">rootFrame</span>) </span>{
            <span class="hljs-keyword">var</span> childFrame;
            rootFrame.CustomEvent.fireEvent(eventName, args);
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; rootFrame.length; i++) {
                <span class="hljs-keyword">try</span> {
                    childFrame = rootFrame[i];
                    <span class="hljs-keyword">if</span> (!childFrame)
                        <span class="hljs-keyword">continue</span>;
                    <span class="hljs-keyword">if</span> (childFrame.CustomEvent &amp;&amp; <span class="hljs-keyword">typeof</span> childFrame.CustomEvent.fireEvent === <span class="hljs-string">"function"</span>) {
                        notifyAllFrom(childFrame);
                    }
                } <span class="hljs-keyword">catch</span> (e) {}
            }
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fireToWindow</span>(<span class="hljs-params">targetWindow, eventName, args, usePostMessage, targetOrigin</span>) </span>{
        <span class="hljs-keyword">if</span> (trace)
            jslog(<span class="hljs-string">"$CustomEventManager firing: "</span> + eventName + <span class="hljs-string">" args: "</span> + args.length);
        <span class="hljs-keyword">if</span> (usePostMessage) {
            doPostMessage(targetWindow, eventName, args, targetOrigin);
        } <span class="hljs-keyword">else</span> {
            targetWindow.CustomEvent.fireEvent(eventName, args);
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getTopWindow</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> topWindow = <span class="hljs-built_in">window</span>.self;
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">while</span> (topWindow.CustomEvent.fireEvent &amp;&amp; topWindow !== topWindow.parent &amp;&amp; topWindow.parent.CustomEvent.fireEvent) {
                topWindow = topWindow.parent;
            }
        } <span class="hljs-keyword">catch</span> (e) {}
        <span class="hljs-keyword">return</span> topWindow;
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isTopWindow</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> getTopWindow() == <span class="hljs-built_in">window</span>.self;
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">jslog</span>(<span class="hljs-params">msg, src, dateTime</span>) </span>{
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">if</span> (!src) {
                <span class="hljs-keyword">var</span> path = <span class="hljs-built_in">window</span>.self.location.pathname;
                src = path.substring(path.lastIndexOf(<span class="hljs-string">'/'</span>) + <span class="hljs-number">1</span>);
            }
            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">window</span>.self.opener &amp;&amp; <span class="hljs-built_in">window</span> != <span class="hljs-built_in">window</span>.self.opener) {
                <span class="hljs-keyword">if</span> (<span class="hljs-built_in">window</span>.self.opener.jslog) {
                    <span class="hljs-built_in">window</span>.self.opener.jslog(msg, src, dateTime);
                }
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (parent &amp;&amp; parent.jslog &amp;&amp; jslog != parent.jslog) {
                parent.jslog(msg, src, dateTime);
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">if</span> (<span class="hljs-built_in">window</span>.console &amp;&amp; <span class="hljs-built_in">window</span>.console.log)
                    <span class="hljs-built_in">console</span>.log(msg);
            }
        } <span class="hljs-keyword">catch</span> (e) {}
    }
    <span class="hljs-keyword">var</span> api = {
        set trace(value) {
            trace = !!value;
        },
        get trace() {
            <span class="hljs-keyword">return</span> trace;
        },
        set suppressEvents(value) {
            suppressEvents = !!value;
        },
        get suppressEvents() {
            <span class="hljs-keyword">return</span> suppressEvents;
        },
        get events() {
            <span class="hljs-keyword">return</span> events;
        },
        <span class="hljs-attr">on</span>: on,
        <span class="hljs-attr">un</span>: un,
        <span class="hljs-attr">unAll</span>: unAll,
        <span class="hljs-attr">forward</span>: forward,
        <span class="hljs-attr">isFiring</span>: isFiring,
        <span class="hljs-attr">fireEvent</span>: fireEvent,
        <span class="hljs-attr">observe</span>: observe,
        <span class="hljs-attr">fire</span>: fire,
        <span class="hljs-attr">fireTop</span>: fireTop,
        <span class="hljs-attr">fireAll</span>: fireAll,
        <span class="hljs-attr">fireToWindow</span>: fireToWindow,
        <span class="hljs-attr">isTopWindow</span>: isTopWindow,
        <span class="hljs-attr">fireUp</span>: fireUp,
        <span class="hljs-attr">toString</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">return</span> <span class="hljs-string">'CustomEventManager'</span>;
        }
    };
    registerPostMessageEvent();
    <span class="hljs-keyword">return</span> api;
})(NOW.CustomEvent);
NOW.CustomEvent = CustomEventManager;
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> CustomEvent !== <span class="hljs-string">"undefined"</span>) {
    CustomEvent.observe = NOW.CustomEvent.observe.bind(NOW.CustomEvent);
    CustomEvent.fire = NOW.CustomEvent.fire.bind(NOW.CustomEvent);
    CustomEvent.fireUp = NOW.CustomEvent.fireUp.bind(NOW.CustomEvent);
    CustomEvent.fireTop = NOW.CustomEvent.fireTop.bind(NOW.CustomEvent);
    CustomEvent.fireAll = NOW.CustomEvent.fireAll.bind(NOW.CustomEvent);
    CustomEvent.fireToWindow = NOW.CustomEvent.fireToWindow.bind(NOW.CustomEvent);
    CustomEvent.on = NOW.CustomEvent.on.bind(NOW.CustomEvent);
    CustomEvent.un = NOW.CustomEvent.un.bind(NOW.CustomEvent);
    CustomEvent.unAll = NOW.CustomEvent.unAll.bind(NOW.CustomEvent);
    CustomEvent.forward = NOW.CustomEvent.forward.bind(NOW.CustomEvent);
    CustomEvent.isFiring = NOW.CustomEvent.isFiring.bind(NOW.CustomEvent);
    CustomEvent.fireEvent = NOW.CustomEvent.fireEvent.bind(NOW.CustomEvent);
    CustomEvent.events = NOW.CustomEvent.events;
    CustomEvent.isTopWindow = NOW.CustomEvent.isTopWindow.bind(NOW.CustomEvent);
} <span class="hljs-keyword">else</span> {
    <span class="hljs-built_in">window</span>.CustomEvent = NOW.CustomEvent;
};;</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>

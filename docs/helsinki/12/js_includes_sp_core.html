<!DOCTYPE html>

<html>
<head>
  <title>js_includes_sp_core.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="AJAXCompleter.html">
                  AJAXCompleter.js
                </a>
              
                
                <a class="source" href="AJAXEmailClientCompleter.html">
                  AJAXEmailClientCompleter.js
                </a>
              
                
                <a class="source" href="AJAXOtherCompleter.html">
                  AJAXOtherCompleter.js
                </a>
              
                
                <a class="source" href="AJAXReferenceChoice.html">
                  AJAXReferenceChoice.js
                </a>
              
                
                <a class="source" href="AJAXReferenceCompleter.html">
                  AJAXReferenceCompleter.js
                </a>
              
                
                <a class="source" href="AJAXReferenceCompleterMulti.html">
                  AJAXReferenceCompleterMulti.js
                </a>
              
                
                <a class="source" href="AJAXReferenceControls.html">
                  AJAXReferenceControls.js
                </a>
              
                
                <a class="source" href="AJAXTableCompleter.html">
                  AJAXTableCompleter.js
                </a>
              
                
                <a class="source" href="AttachmentUploader.html">
                  AttachmentUploader.js
                </a>
              
                
                <a class="source" href="AutoComplete.html">
                  AutoComplete.js
                </a>
              
                
                <a class="source" href="BoundsUtil2.html">
                  BoundsUtil2.js
                </a>
              
                
                <a class="source" href="CookieJar.html">
                  CookieJar.js
                </a>
              
                
                <a class="source" href="CustomEventManager.html">
                  CustomEventManager.js
                </a>
              
                
                <a class="source" href="DaysOfWeekElement.html">
                  DaysOfWeekElement.js
                </a>
              
                
                <a class="source" href="DerivedFields.html">
                  DerivedFields.js
                </a>
              
                
                <a class="source" href="Draggable2.html">
                  Draggable2.js
                </a>
              
                
                <a class="source" href="DropTarget2.html">
                  DropTarget2.js
                </a>
              
                
                <a class="source" href="FieldListElement.html">
                  FieldListElement.js
                </a>
              
                
                <a class="source" href="GlideAPI1.html">
                  GlideAPI1.js
                </a>
              
                
                <a class="source" href="GlideAjax.html">
                  GlideAjax.js
                </a>
              
                
                <a class="source" href="GlideAjaxForm.html">
                  GlideAjaxForm.js
                </a>
              
                
                <a class="source" href="GlideBox.html">
                  GlideBox.js
                </a>
              
                
                <a class="source" href="GlideClientCache.html">
                  GlideClientCache.js
                </a>
              
                
                <a class="source" href="GlideDecoration.html">
                  GlideDecoration.js
                </a>
              
                
                <a class="source" href="GlideDialogForm.html">
                  GlideDialogForm.js
                </a>
              
                
                <a class="source" href="GlideDialogWindow.html">
                  GlideDialogWindow.js
                </a>
              
                
                <a class="source" href="GlideDraggable.html">
                  GlideDraggable.js
                </a>
              
                
                <a class="source" href="GlideDuration.html">
                  GlideDuration.js
                </a>
              
                
                <a class="source" href="GlideEvent.html">
                  GlideEvent.js
                </a>
              
                
                <a class="source" href="GlideEventHandler.html">
                  GlideEventHandler.js
                </a>
              
                
                <a class="source" href="GlideFilter14.html">
                  GlideFilter14.js
                </a>
              
                
                <a class="source" href="GlideFilterDate.html">
                  GlideFilterDate.js
                </a>
              
                
                <a class="source" href="GlideFilterDescription.html">
                  GlideFilterDescription.js
                </a>
              
                
                <a class="source" href="GlideFilterHandlers.html">
                  GlideFilterHandlers.js
                </a>
              
                
                <a class="source" href="GlideFilterItemVariables.html">
                  GlideFilterItemVariables.js
                </a>
              
                
                <a class="source" href="GlideFilterLabels.html">
                  GlideFilterLabels.js
                </a>
              
                
                <a class="source" href="GlideFilterQuestions.html">
                  GlideFilterQuestions.js
                </a>
              
                
                <a class="source" href="GlideFilterReference.html">
                  GlideFilterReference.js
                </a>
              
                
                <a class="source" href="GlideFilterReferenceMulti.html">
                  GlideFilterReferenceMulti.js
                </a>
              
                
                <a class="source" href="GlideFilterVariables.html">
                  GlideFilterVariables.js
                </a>
              
                
                <a class="source" href="GlideForm14.html">
                  GlideForm14.js
                </a>
              
                
                <a class="source" href="GlideHeaderSearch.html">
                  GlideHeaderSearch.js
                </a>
              
                
                <a class="source" href="GlideList2.html">
                  GlideList2.js
                </a>
              
                
                <a class="source" href="GlideList2FilterUtil.html">
                  GlideList2FilterUtil.js
                </a>
              
                
                <a class="source" href="GlideList2Handlers.html">
                  GlideList2Handlers.js
                </a>
              
                
                <a class="source" href="GlideList2InitEvents.html">
                  GlideList2InitEvents.js
                </a>
              
                
                <a class="source" href="GlideList2Statics.html">
                  GlideList2Statics.js
                </a>
              
                
                <a class="source" href="GlideListAggregates.html">
                  GlideListAggregates.js
                </a>
              
                
                <a class="source" href="GlideListEditor.html">
                  GlideListEditor.js
                </a>
              
                
                <a class="source" href="GlideListEditorMessaging.html">
                  GlideListEditorMessaging.js
                </a>
              
                
                <a class="source" href="GlideListElement.html">
                  GlideListElement.js
                </a>
              
                
                <a class="source" href="GlideListWidget.html">
                  GlideListWidget.js
                </a>
              
                
                <a class="source" href="GlideListv3Compatibility.html">
                  GlideListv3Compatibility.js
                </a>
              
                
                <a class="source" href="GlideModalForm.html">
                  GlideModalForm.js
                </a>
              
                
                <a class="source" href="GlideOverlay.html">
                  GlideOverlay.js
                </a>
              
                
                <a class="source" href="GlidePane.html">
                  GlidePane.js
                </a>
              
                
                <a class="source" href="GlidePaneForm.html">
                  GlidePaneForm.js
                </a>
              
                
                <a class="source" href="GlideRecord.html">
                  GlideRecord.js
                </a>
              
                
                <a class="source" href="GlideTabs2.html">
                  GlideTabs2.js
                </a>
              
                
                <a class="source" href="GlideTabs2State.html">
                  GlideTabs2State.js
                </a>
              
                
                <a class="source" href="GlideTabs2Tab.html">
                  GlideTabs2Tab.js
                </a>
              
                
                <a class="source" href="GlideTimeElement.html">
                  GlideTimeElement.js
                </a>
              
                
                <a class="source" href="GlideTimerElement.html">
                  GlideTimerElement.js
                </a>
              
                
                <a class="source" href="GlideTransactionScope.html">
                  GlideTransactionScope.js
                </a>
              
                
                <a class="source" href="GlideUI.html">
                  GlideUI.js
                </a>
              
                
                <a class="source" href="GlideUIDefault.html">
                  GlideUIDefault.js
                </a>
              
                
                <a class="source" href="GlideUIElement.html">
                  GlideUIElement.js
                </a>
              
                
                <a class="source" href="GlideUINotification.html">
                  GlideUINotification.js
                </a>
              
                
                <a class="source" href="GlideURL.html">
                  GlideURL.js
                </a>
              
                
                <a class="source" href="GlideURLElement.html">
                  GlideURLElement.js
                </a>
              
                
                <a class="source" href="GlideUserImageElement.html">
                  GlideUserImageElement.js
                </a>
              
                
                <a class="source" href="GlideWidgetActions.html">
                  GlideWidgetActions.js
                </a>
              
                
                <a class="source" href="GlideWidgetFilter.html">
                  GlideWidgetFilter.js
                </a>
              
                
                <a class="source" href="GlideWidgetHideOnEmpty.html">
                  GlideWidgetHideOnEmpty.js
                </a>
              
                
                <a class="source" href="GlideWidgetSearch.html">
                  GlideWidgetSearch.js
                </a>
              
                
                <a class="source" href="GlideWidgetVCR.html">
                  GlideWidgetVCR.js
                </a>
              
                
                <a class="source" href="GlideWindow.html">
                  GlideWindow.js
                </a>
              
                
                <a class="source" href="GuidedTourElementTranslator.html">
                  GuidedTourElementTranslator.js
                </a>
              
                
                <a class="source" href="GwtCellEditor.html">
                  GwtCellEditor.js
                </a>
              
                
                <a class="source" href="GwtCellSelector.html">
                  GwtCellSelector.js
                </a>
              
                
                <a class="source" href="GwtContextMenu.html">
                  GwtContextMenu.js
                </a>
              
                
                <a class="source" href="GwtCursor.html">
                  GwtCursor.js
                </a>
              
                
                <a class="source" href="GwtDate.html">
                  GwtDate.js
                </a>
              
                
                <a class="source" href="GwtDraggable.html">
                  GwtDraggable.js
                </a>
              
                
                <a class="source" href="GwtDraggableSnap.html">
                  GwtDraggableSnap.js
                </a>
              
                
                <a class="source" href="GwtExportScheduleDialog.html">
                  GwtExportScheduleDialog.js
                </a>
              
                
                <a class="source" href="GwtGridEdit.html">
                  GwtGridEdit.js
                </a>
              
                
                <a class="source" href="GwtListEditAjaxChangeSaver.html">
                  GwtListEditAjaxChangeSaver.js
                </a>
              
                
                <a class="source" href="GwtListEditAjaxValueLoader.html">
                  GwtListEditAjaxValueLoader.js
                </a>
              
                
                <a class="source" href="GwtListEditBoolean.html">
                  GwtListEditBoolean.js
                </a>
              
                
                <a class="source" href="GwtListEditCalendar.html">
                  GwtListEditCalendar.js
                </a>
              
                
                <a class="source" href="GwtListEditDuration.html">
                  GwtListEditDuration.js
                </a>
              
                
                <a class="source" href="GwtListEditEncryptedText.html">
                  GwtListEditEncryptedText.js
                </a>
              
                
                <a class="source" href="GwtListEditError.html">
                  GwtListEditError.js
                </a>
              
                
                <a class="source" href="GwtListEditGList.html">
                  GwtListEditGList.js
                </a>
              
                
                <a class="source" href="GwtListEditGlideRecord.html">
                  GwtListEditGlideRecord.js
                </a>
              
                
                <a class="source" href="GwtListEditGridSelector.html">
                  GwtListEditGridSelector.js
                </a>
              
                
                <a class="source" href="GwtListEditInternalType.html">
                  GwtListEditInternalType.js
                </a>
              
                
                <a class="source" href="GwtListEditJournal.html">
                  GwtListEditJournal.js
                </a>
              
                
                <a class="source" href="GwtListEditMultiText.html">
                  GwtListEditMultiText.js
                </a>
              
                
                <a class="source" href="GwtListEditPassword.html">
                  GwtListEditPassword.js
                </a>
              
                
                <a class="source" href="GwtListEditRecord.html">
                  GwtListEditRecord.js
                </a>
              
                
                <a class="source" href="GwtListEditRecordDecorations.html">
                  GwtListEditRecordDecorations.js
                </a>
              
                
                <a class="source" href="GwtListEditReference.html">
                  GwtListEditReference.js
                </a>
              
                
                <a class="source" href="GwtListEditRelatedTags.html">
                  GwtListEditRelatedTags.js
                </a>
              
                
                <a class="source" href="GwtListEditSavePolicy.html">
                  GwtListEditSavePolicy.js
                </a>
              
                
                <a class="source" href="GwtListEditSelect.html">
                  GwtListEditSelect.js
                </a>
              
                
                <a class="source" href="GwtListEditTableController.html">
                  GwtListEditTableController.js
                </a>
              
                
                <a class="source" href="GwtListEditTablename.html">
                  GwtListEditTablename.js
                </a>
              
                
                <a class="source" href="GwtListEditText.html">
                  GwtListEditText.js
                </a>
              
                
                <a class="source" href="GwtListEditTranslatedField.html">
                  GwtListEditTranslatedField.js
                </a>
              
                
                <a class="source" href="GwtListEditUpdateTablename.html">
                  GwtListEditUpdateTablename.js
                </a>
              
                
                <a class="source" href="GwtListEditValueRenderer.html">
                  GwtListEditValueRenderer.js
                </a>
              
                
                <a class="source" href="GwtListEditWindow.html">
                  GwtListEditWindow.js
                </a>
              
                
                <a class="source" href="GwtListEditor.html">
                  GwtListEditor.js
                </a>
              
                
                <a class="source" href="GwtListEditorPendingChanges.html">
                  GwtListEditorPendingChanges.js
                </a>
              
                
                <a class="source" href="GwtMessage14.html">
                  GwtMessage14.js
                </a>
              
                
                <a class="source" href="GwtObservable.html">
                  GwtObservable.js
                </a>
              
                
                <a class="source" href="GwtPollDialog.html">
                  GwtPollDialog.js
                </a>
              
                
                <a class="source" href="InPlaceEdit.html">
                  InPlaceEdit.js
                </a>
              
                
                <a class="source" href="ListDraggableRow2.html">
                  ListDraggableRow2.js
                </a>
              
                
                <a class="source" href="ListSelectManager2.html">
                  ListSelectManager2.js
                </a>
              
                
                <a class="source" href="ListSortDual2.html">
                  ListSortDual2.js
                </a>
              
                
                <a class="source" href="ListSortWindow2.html">
                  ListSortWindow2.js
                </a>
              
                
                <a class="source" href="NOW.messaging.html">
                  NOW.messaging.js
                </a>
              
                
                <a class="source" href="NOW.messaging.record.html">
                  NOW.messaging.record.js
                </a>
              
                
                <a class="source" href="NameMapEntry.html">
                  NameMapEntry.js
                </a>
              
                
                <a class="source" href="NotificationMessage.html">
                  NotificationMessage.js
                </a>
              
                
                <a class="source" href="PageTiming14.html">
                  PageTiming14.js
                </a>
              
                
                <a class="source" href="PersonalizeForm.html">
                  PersonalizeForm.js
                </a>
              
                
                <a class="source" href="Point.html">
                  Point.js
                </a>
              
                
                <a class="source" href="SLARepairClient.html">
                  SLARepairClient.js
                </a>
              
                
                <a class="source" href="ScriptLoader.html">
                  ScriptLoader.js
                </a>
              
                
                <a class="source" href="Select.html">
                  Select.js
                </a>
              
                
                <a class="source" href="SlushBucket.html">
                  SlushBucket.js
                </a>
              
                
                <a class="source" href="SortDraggable2.html">
                  SortDraggable2.js
                </a>
              
                
                <a class="source" href="SortDropTarget2.html">
                  SortDropTarget2.js
                </a>
              
                
                <a class="source" href="SortListManager2.html">
                  SortListManager2.js
                </a>
              
                
                <a class="source" href="SortUtil2.html">
                  SortUtil2.js
                </a>
              
                
                <a class="source" href="StopWatch.html">
                  StopWatch.js
                </a>
              
                
                <a class="source" href="Table.html">
                  Table.js
                </a>
              
                
                <a class="source" href="TableElement.html">
                  TableElement.js
                </a>
              
                
                <a class="source" href="TableExtension.html">
                  TableExtension.js
                </a>
              
                
                <a class="source" href="TemplateRecord.html">
                  TemplateRecord.js
                </a>
              
                
                <a class="source" href="TextAreaElement.html">
                  TextAreaElement.js
                </a>
              
                
                <a class="source" href="UserRolesElement.html">
                  UserRolesElement.js
                </a>
              
                
                <a class="source" href="UtilityAndOverrides2.html">
                  UtilityAndOverrides2.js
                </a>
              
                
                <a class="source" href="_module.html">
                  _module.js
                </a>
              
                
                <a class="source" href="ac.html">
                  ac.js
                </a>
              
                
                <a class="source" href="ac_derived_field_support.html">
                  ac_derived_field_support.js
                </a>
              
                
                <a class="source" href="accessibility_tabindex.html">
                  accessibility_tabindex.js
                </a>
              
                
                <a class="source" href="affix.html">
                  affix.js
                </a>
              
                
                <a class="source" href="alert.html">
                  alert.js
                </a>
              
                
                <a class="source" href="amb.Channel.html">
                  amb.Channel.js
                </a>
              
                
                <a class="source" href="amb.ChannelListener.html">
                  amb.ChannelListener.js
                </a>
              
                
                <a class="source" href="amb.ChannelRedirect.html">
                  amb.ChannelRedirect.js
                </a>
              
                
                <a class="source" href="amb.EventManager.html">
                  amb.EventManager.js
                </a>
              
                
                <a class="source" href="amb.Logger.html">
                  amb.Logger.js
                </a>
              
                
                <a class="source" href="amb.MessageClient.html">
                  amb.MessageClient.js
                </a>
              
                
                <a class="source" href="amb.MessageClientBuilder.html">
                  amb.MessageClientBuilder.js
                </a>
              
                
                <a class="source" href="amb.ServerConnection.html">
                  amb.ServerConnection.js
                </a>
              
                
                <a class="source" href="amb_initialize.html">
                  amb_initialize.js
                </a>
              
                
                <a class="source" href="amb_properties.html">
                  amb_properties.js
                </a>
              
                
                <a class="source" href="angular-animate.html">
                  angular-animate.js
                </a>
              
                
                <a class="source" href="angular-aria.html">
                  angular-aria.js
                </a>
              
                
                <a class="source" href="angular-cookies.html">
                  angular-cookies.js
                </a>
              
                
                <a class="source" href="angular-file-upload-all.html">
                  angular-file-upload-all.js
                </a>
              
                
                <a class="source" href="angular-resource.html">
                  angular-resource.js
                </a>
              
                
                <a class="source" href="angular-route.html">
                  angular-route.js
                </a>
              
                
                <a class="source" href="angular-sanitize.html">
                  angular-sanitize.js
                </a>
              
                
                <a class="source" href="angular-touch.html">
                  angular-touch.js
                </a>
              
                
                <a class="source" href="angular-ui-tinymce.html">
                  angular-ui-tinymce.js
                </a>
              
                
                <a class="source" href="angular.html">
                  angular.js
                </a>
              
                
                <a class="source" href="annotations_toggle.html">
                  annotations_toggle.js
                </a>
              
                
                <a class="source" href="app.$sp.html">
                  app.$sp.js
                </a>
              
                
                <a class="source" href="app.config.html">
                  app.config.js
                </a>
              
                
                <a class="source" href="app.ng.amb.html">
                  app.ng.amb.js
                </a>
              
                
                <a class="source" href="app_guided_tours.html">
                  app_guided_tours.js
                </a>
              
                
                <a class="source" href="attachments.html">
                  attachments.js
                </a>
              
                
                <a class="source" href="bootstrap-datetimepicker.html">
                  bootstrap-datetimepicker.js
                </a>
              
                
                <a class="source" href="bootstrap-iconpicker.html">
                  bootstrap-iconpicker.js
                </a>
              
                
                <a class="source" href="bootstrap_336.html">
                  bootstrap_336.js
                </a>
              
                
                <a class="source" href="button.html">
                  button.js
                </a>
              
                
                <a class="source" href="cabrillo.factory.html">
                  cabrillo.factory.js
                </a>
              
                
                <a class="source" href="calendar.html">
                  calendar.js
                </a>
              
                
                <a class="source" href="camera.html">
                  camera.js
                </a>
              
                
                <a class="source" href="carousel.html">
                  carousel.js
                </a>
              
                
                <a class="source" href="catalogDataLookup.html">
                  catalogDataLookup.js
                </a>
              
                
                <a class="source" href="catalogGlideFormFactory.html">
                  catalogGlideFormFactory.js
                </a>
              
                
                <a class="source" href="catalogItemFactory.html">
                  catalogItemFactory.js
                </a>
              
                
                <a class="source" href="clientScript_components.html">
                  clientScript_components.js
                </a>
              
                
                <a class="source" href="collapse.html">
                  collapse.js
                </a>
              
                
                <a class="source" href="cometd.html">
                  cometd.js
                </a>
              
                
                <a class="source" href="condition14_new.html">
                  condition14_new.js
                </a>
              
                
                <a class="source" href="condition14_reporting.html">
                  condition14_reporting.js
                </a>
              
                
                <a class="source" href="condition14_templates.html">
                  condition14_templates.js
                </a>
              
                
                <a class="source" href="condition_global_variables14.html">
                  condition_global_variables14.js
                </a>
              
                
                <a class="source" href="constants_embedded_help.html">
                  constants_embedded_help.js
                </a>
              
                
                <a class="source" href="context_actions.html">
                  context_actions.js
                </a>
              
                
                <a class="source" href="controller.AMBRecordWatcher.html">
                  controller.AMBRecordWatcher.js
                </a>
              
                
                <a class="source" href="controller.Stream.html">
                  controller.Stream.js
                </a>
              
                
                <a class="source" href="controller.guidedTours.html">
                  controller.guidedTours.js
                </a>
              
                
                <a class="source" href="core.html">
                  core.js
                </a>
              
                
                <a class="source" href="debug.html">
                  debug.js
                </a>
              
                
                <a class="source" href="decorator.uiTinymce.html">
                  decorator.uiTinymce.js
                </a>
              
                
                <a class="source" href="deferred_related_lists.html">
                  deferred_related_lists.js
                </a>
              
                
                <a class="source" href="depends.html">
                  depends.js
                </a>
              
                
                <a class="source" href="directive.contenteditable.html">
                  directive.contenteditable.js
                </a>
              
                
                <a class="source" href="directive.glideFormField.html">
                  directive.glideFormField.js
                </a>
              
                
                <a class="source" href="directive.glyph.html">
                  directive.glyph.js
                </a>
              
                
                <a class="source" href="directive.message.html">
                  directive.message.js
                </a>
              
                
                <a class="source" href="directive.nowAttachmentsList.html">
                  directive.nowAttachmentsList.js
                </a>
              
                
                <a class="source" href="directive.recursiveHelper.html">
                  directive.recursiveHelper.js
                </a>
              
                
                <a class="source" href="directive.snAttachmentList.html">
                  directive.snAttachmentList.js
                </a>
              
                
                <a class="source" href="directive.snAttachmentPreview.html">
                  directive.snAttachmentPreview.js
                </a>
              
                
                <a class="source" href="directive.snAvatar.html">
                  directive.snAvatar.js
                </a>
              
                
                <a class="source" href="directive.snAvatarPopover.html">
                  directive.snAvatarPopover.js
                </a>
              
                
                <a class="source" href="directive.snBindI18n.html">
                  directive.snBindI18n.js
                </a>
              
                
                <a class="source" href="directive.snBindOnce.html">
                  directive.snBindOnce.js
                </a>
              
                
                <a class="source" href="directive.snBindPopoverSelection.html">
                  directive.snBindPopoverSelection.js
                </a>
              
                
                <a class="source" href="directive.snBlurOnEnter.html">
                  directive.snBlurOnEnter.js
                </a>
              
                
                <a class="source" href="directive.snChoiceList.html">
                  directive.snChoiceList.js
                </a>
              
                
                <a class="source" href="directive.snCloak.html">
                  directive.snCloak.js
                </a>
              
                
                <a class="source" href="directive.snComplexPopover.html">
                  directive.snComplexPopover.js
                </a>
              
                
                <a class="source" href="directive.snConfirmModal.html">
                  directive.snConfirmModal.js
                </a>
              
                
                <a class="source" href="directive.snContextMenu.html">
                  directive.snContextMenu.js
                </a>
              
                
                <a class="source" href="directive.snDayAgo.html">
                  directive.snDayAgo.js
                </a>
              
                
                <a class="source" href="directive.snDialog.html">
                  directive.snDialog.js
                </a>
              
                
                <a class="source" href="directive.snExpandedEmail.html">
                  directive.snExpandedEmail.js
                </a>
              
                
                <a class="source" href="directive.snFieldReference.html">
                  directive.snFieldReference.js
                </a>
              
                
                <a class="source" href="directive.snFileUploadInput.html">
                  directive.snFileUploadInput.js
                </a>
              
                
                <a class="source" href="directive.snFlyout.html">
                  directive.snFlyout.js
                </a>
              
                
                <a class="source" href="directive.snFocus.html">
                  directive.snFocus.js
                </a>
              
                
                <a class="source" href="directive.snGlyph.html">
                  directive.snGlyph.js
                </a>
              
                
                <a class="source" href="directive.snImageUploader.html">
                  directive.snImageUploader.js
                </a>
              
                
                <a class="source" href="directive.snLinkContent.html">
                  directive.snLinkContent.js
                </a>
              
                
                <a class="source" href="directive.snLinkContentArticle.html">
                  directive.snLinkContentArticle.js
                </a>
              
                
                <a class="source" href="directive.snLinkContentAttachment.html">
                  directive.snLinkContentAttachment.js
                </a>
              
                
                <a class="source" href="directive.snLinkContentError.html">
                  directive.snLinkContentError.js
                </a>
              
                
                <a class="source" href="directive.snLinkContentImage.html">
                  directive.snLinkContentImage.js
                </a>
              
                
                <a class="source" href="directive.snLinkContentRecord.html">
                  directive.snLinkContentRecord.js
                </a>
              
                
                <a class="source" href="directive.snLinkContentSoundcloud.html">
                  directive.snLinkContentSoundcloud.js
                </a>
              
                
                <a class="source" href="directive.snLinkContentYoutube.html">
                  directive.snLinkContentYoutube.js
                </a>
              
                
                <a class="source" href="directive.snMentionPopover.html">
                  directive.snMentionPopover.js
                </a>
              
                
                <a class="source" href="directive.snModal.html">
                  directive.snModal.js
                </a>
              
                
                <a class="source" href="directive.snModalShow.html">
                  directive.snModalShow.js
                </a>
              
                
                <a class="source" href="directive.snNotification.html">
                  directive.snNotification.js
                </a>
              
                
                <a class="source" href="directive.snPasteImageHandler.html">
                  directive.snPasteImageHandler.js
                </a>
              
                
                <a class="source" href="directive.snPresence.html">
                  directive.snPresence.js
                </a>
              
                
                <a class="source" href="directive.snRecordPicker.html">
                  directive.snRecordPicker.js
                </a>
              
                
                <a class="source" href="directive.snReferencePicker.html">
                  directive.snReferencePicker.js
                </a>
              
                
                <a class="source" href="directive.snResizeHeight.html">
                  directive.snResizeHeight.js
                </a>
              
                
                <a class="source" href="directive.snSelectBasic.html">
                  directive.snSelectBasic.js
                </a>
              
                
                <a class="source" href="directive.snStickyHeaders.html">
                  directive.snStickyHeaders.js
                </a>
              
                
                <a class="source" href="directive.snStream.html">
                  directive.snStream.js
                </a>
              
                
                <a class="source" href="directive.snSyncWith.html">
                  directive.snSyncWith.js
                </a>
              
                
                <a class="source" href="directive.snTableReference.html">
                  directive.snTableReference.js
                </a>
              
                
                <a class="source" href="directive.snTabs.html">
                  directive.snTabs.js
                </a>
              
                
                <a class="source" href="directive.snTextExpander.html">
                  directive.snTextExpander.js
                </a>
              
                
                <a class="source" href="directive.snTimeAgo.html">
                  directive.snTimeAgo.js
                </a>
              
                
                <a class="source" href="directive.snUserAvatar.html">
                  directive.snUserAvatar.js
                </a>
              
                
                <a class="source" href="directive.snUserProfile.html">
                  directive.snUserProfile.js
                </a>
              
                
                <a class="source" href="directive.spCLink.html">
                  directive.spCLink.js
                </a>
              
                
                <a class="source" href="directive.spCatItem.html">
                  directive.spCatItem.js
                </a>
              
                
                <a class="source" href="directive.spChoiceList.html">
                  directive.spChoiceList.js
                </a>
              
                
                <a class="source" href="directive.spCodeMirror.html">
                  directive.spCodeMirror.js
                </a>
              
                
                <a class="source" href="directive.spColorPicker.html">
                  directive.spColorPicker.js
                </a>
              
                
                <a class="source" href="directive.spContextMenu.html">
                  directive.spContextMenu.js
                </a>
              
                
                <a class="source" href="directive.spCssEditor.html">
                  directive.spCssEditor.js
                </a>
              
                
                <a class="source" href="directive.spDatePicker.html">
                  directive.spDatePicker.js
                </a>
              
                
                <a class="source" href="directive.spDropdownTree.html">
                  directive.spDropdownTree.js
                </a>
              
                
                <a class="source" href="directive.spEditableField.html">
                  directive.spEditableField.js
                </a>
              
                
                <a class="source" href="directive.spFieldListElement.html">
                  directive.spFieldListElement.js
                </a>
              
                
                <a class="source" href="directive.spFormField.html">
                  directive.spFormField.js
                </a>
              
                
                <a class="source" href="directive.spGlyph.html">
                  directive.spGlyph.js
                </a>
              
                
                <a class="source" href="directive.spGlyphPicker.html">
                  directive.spGlyphPicker.js
                </a>
              
                
                <a class="source" href="directive.spHTMLEditor.html">
                  directive.spHTMLEditor.js
                </a>
              
                
                <a class="source" href="directive.spHtmlContent.html">
                  directive.spHtmlContent.js
                </a>
              
                
                <a class="source" href="directive.spPanel.html">
                  directive.spPanel.js
                </a>
              
                
                <a class="source" href="directive.spReferenceElement.html">
                  directive.spReferenceElement.js
                </a>
              
                
                <a class="source" href="directive.spReferenceField.html">
                  directive.spReferenceField.js
                </a>
              
                
                <a class="source" href="directive.spScriptEditor.html">
                  directive.spScriptEditor.js
                </a>
              
                
                <a class="source" href="directive.spTinymceEditor.html">
                  directive.spTinymceEditor.js
                </a>
              
                
                <a class="source" href="dropdown.html">
                  dropdown.js
                </a>
              
                
                <a class="source" href="dropdowns.html">
                  dropdowns.js
                </a>
              
                
                <a class="source" href="email_activity.html">
                  email_activity.js
                </a>
              
                
                <a class="source" href="event_initialize.html">
                  event_initialize.js
                </a>
              
                
                <a class="source" href="factory.AMBOverlay.html">
                  factory.AMBOverlay.js
                </a>
              
                
                <a class="source" href="factory.ArraySynchronizer.html">
                  factory.ArraySynchronizer.js
                </a>
              
                
                <a class="source" href="factory.glideUrlBuilder.html">
                  factory.glideUrlBuilder.js
                </a>
              
                
                <a class="source" href="factory.notificationWrapper.html">
                  factory.notificationWrapper.js
                </a>
              
                
                <a class="source" href="factory.nowAttachmentHandler.html">
                  factory.nowAttachmentHandler.js
                </a>
              
                
                <a class="source" href="factory.paneManager.html">
                  factory.paneManager.js
                </a>
              
                
                <a class="source" href="factory.snAttachmentHandler.html">
                  factory.snAttachmentHandler.js
                </a>
              
                
                <a class="source" href="factory.snPresence.html">
                  factory.snPresence.js
                </a>
              
                
                <a class="source" href="factory.snRecordPresence.html">
                  factory.snRecordPresence.js
                </a>
              
                
                <a class="source" href="factory.snRecordWatcher.html">
                  factory.snRecordWatcher.js
                </a>
              
                
                <a class="source" href="factory.spMacro.html">
                  factory.spMacro.js
                </a>
              
                
                <a class="source" href="factory.spUIActionFactory.html">
                  factory.spUIActionFactory.js
                </a>
              
                
                <a class="source" href="factory.unwrappedHTTPPromise.html">
                  factory.unwrappedHTTPPromise.js
                </a>
              
                
                <a class="source" href="fixedHeaders.html">
                  fixedHeaders.js
                </a>
              
                
                <a class="source" href="form.html">
                  form.js
                </a>
              
                
                <a class="source" href="form_submitted_mask.html">
                  form_submitted_mask.js
                </a>
              
                
                <a class="source" href="form_tags.html">
                  form_tags.js
                </a>
              
                
                <a class="source" href="formatting.html">
                  formatting.js
                </a>
              
                
                <a class="source" href="functions.html">
                  functions.js
                </a>
              
                
                <a class="source" href="functions_attachments.html">
                  functions_attachments.js
                </a>
              
                
                <a class="source" href="functions_bootstrap14.html">
                  functions_bootstrap14.js
                </a>
              
                
                <a class="source" href="functions_calendar.html">
                  functions_calendar.js
                </a>
              
                
                <a class="source" href="functions_clipboard.html">
                  functions_clipboard.js
                </a>
              
                
                <a class="source" href="functions_email.html">
                  functions_email.js
                </a>
              
                
                <a class="source" href="functions_fontsizer.html">
                  functions_fontsizer.js
                </a>
              
                
                <a class="source" href="functions_onchange.html">
                  functions_onchange.js
                </a>
              
                
                <a class="source" href="functions_reference.html">
                  functions_reference.js
                </a>
              
                
                <a class="source" href="functions_showloading.html">
                  functions_showloading.js
                </a>
              
                
                <a class="source" href="functions_user_image.html">
                  functions_user_image.js
                </a>
              
                
                <a class="source" href="geolocation.html">
                  geolocation.js
                </a>
              
                
                <a class="source" href="glide-highcharts-v5.html">
                  glide-highcharts-v5.js
                </a>
              
                
                <a class="source" href="glideAjaxFactory.html">
                  glideAjaxFactory.js
                </a>
              
                
                <a class="source" href="glideFormEnvironmentFactory.html">
                  glideFormEnvironmentFactory.js
                </a>
              
                
                <a class="source" href="glideFormFactory.html">
                  glideFormFactory.js
                </a>
              
                
                <a class="source" href="glideFormFieldFactory.html">
                  glideFormFieldFactory.js
                </a>
              
                
                <a class="source" href="glideFormMessageHandler.html">
                  glideFormMessageHandler.js
                </a>
              
                
                <a class="source" href="glideListFactory.html">
                  glideListFactory.js
                </a>
              
                
                <a class="source" href="glideModalFactory.html">
                  glideModalFactory.js
                </a>
              
                
                <a class="source" href="glideRecordData.html">
                  glideRecordData.js
                </a>
              
                
                <a class="source" href="glideRecordFactory.html">
                  glideRecordFactory.js
                </a>
              
                
                <a class="source" href="glideRequest.html">
                  glideRequest.js
                </a>
              
                
                <a class="source" href="glideUIActionsFactory.html">
                  glideUIActionsFactory.js
                </a>
              
                
                <a class="source" href="glideUser.html">
                  glideUser.js
                </a>
              
                
                <a class="source" href="glideUserFactory.html">
                  glideUserFactory.js
                </a>
              
                
                <a class="source" href="glideUserSession.html">
                  glideUserSession.js
                </a>
              
                
                <a class="source" href="guided_tours_template.html">
                  guided_tours_template.js
                </a>
              
                
                <a class="source" href="heisenberg_all.html">
                  heisenberg_all.js
                </a>
              
                
                <a class="source" href="html_class_setter.html">
                  html_class_setter.js
                </a>
              
                
                <a class="source" href="iconset-fontawesome-4.2.0.html">
                  iconset-fontawesome-4.2.0.js
                </a>
              
                
                <a class="source" href="jQueryRequestShim.html">
                  jQueryRequestShim.js
                </a>
              
                
                <a class="source" href="jquery-1.11.0_no_conflict.html">
                  jquery-1.11.0_no_conflict.js
                </a>
              
                
                <a class="source" href="jquery-2.1.html">
                  jquery-2.1.js
                </a>
              
                
                <a class="source" href="jquery-ui-1.9.2.custom.html">
                  jquery-ui-1.9.2.custom.js
                </a>
              
                
                <a class="source" href="jquery.cometd.html">
                  jquery.cometd.js
                </a>
              
                
                <a class="source" href="jquery_clean.html">
                  jquery_clean.js
                </a>
              
                
                <a class="source" href="jquery_includes.html">
                  jquery_includes.js
                </a>
              
                
                <a class="source" href="jquery_no_conflict.html">
                  jquery_no_conflict.js
                </a>
              
                
                <a class="source" href="js_guided_tours_includes.html">
                  js_guided_tours_includes.js
                </a>
              
                
                <a class="source" href="js_includes_amb.html">
                  js_includes_amb.js
                </a>
              
                
                <a class="source" href="js_includes_angular.html">
                  js_includes_angular.js
                </a>
              
                
                <a class="source" href="js_includes_attachments.html">
                  js_includes_attachments.js
                </a>
              
                
                <a class="source" href="js_includes_avatar.html">
                  js_includes_avatar.js
                </a>
              
                
                <a class="source" href="js_includes_cabrillo.html">
                  js_includes_cabrillo.js
                </a>
              
                
                <a class="source" href="js_includes_clientScript.html">
                  js_includes_clientScript.js
                </a>
              
                
                <a class="source" href="js_includes_common.html">
                  js_includes_common.js
                </a>
              
                
                <a class="source" href="js_includes_controls.html">
                  js_includes_controls.js
                </a>
              
                
                <a class="source" href="js_includes_customer.html">
                  js_includes_customer.js
                </a>
              
                
                <a class="source" href="js_includes_data.html">
                  js_includes_data.js
                </a>
              
                
                <a class="source" href="js_includes_datetime.html">
                  js_includes_datetime.js
                </a>
              
                
                <a class="source" href="js_includes_doctype.html">
                  js_includes_doctype.js
                </a>
              
                
                <a class="source" href="js_includes_form.html">
                  js_includes_form.js
                </a>
              
                
                <a class="source" href="js_includes_glide.html">
                  js_includes_glide.js
                </a>
              
                
                <a class="source" href="js_includes_i18n.html">
                  js_includes_i18n.js
                </a>
              
                
                <a class="source" href="js_includes_last_doctype.html">
                  js_includes_last_doctype.js
                </a>
              
                
                <a class="source" href="js_includes_link.html">
                  js_includes_link.js
                </a>
              
                
                <a class="source" href="js_includes_list_edit_doctype.html">
                  js_includes_list_edit_doctype.js
                </a>
              
                
                <a class="source" href="js_includes_listv2_doctype.html">
                  js_includes_listv2_doctype.js
                </a>
              
                
                <a class="source" href="js_includes_mention.html">
                  js_includes_mention.js
                </a>
              
                
                <a class="source" href="js_includes_messaging.html">
                  js_includes_messaging.js
                </a>
              
                
                <a class="source" href="js_includes_ng_amb.html">
                  js_includes_ng_amb.js
                </a>
              
                
                <a class="source" href="js_includes_notification.html">
                  js_includes_notification.js
                </a>
              
                
                <a class="source" href="js_includes_presence.html">
                  js_includes_presence.js
                </a>
              
                
                <a class="source" href="js_includes_sorting_new.html">
                  js_includes_sorting_new.js
                </a>
              
                
                <a class="source" href="js_includes_sp.html">
                  js_includes_sp.js
                </a>
              
                
                <a class="source" href="js_includes_sp_core.html">
                  js_includes_sp_core.js
                </a>
              
                
                <a class="source" href="js_includes_sp_deps.html">
                  js_includes_sp_deps.js
                </a>
              
                
                <a class="source" href="js_includes_sp_tinymce.html">
                  js_includes_sp_tinymce.js
                </a>
              
                
                <a class="source" href="js_includes_stream.html">
                  js_includes_stream.js
                </a>
              
                
                <a class="source" href="js_includes_ui.html">
                  js_includes_ui.js
                </a>
              
                
                <a class="source" href="js_includes_ui_popover.html">
                  js_includes_ui_popover.js
                </a>
              
                
                <a class="source" href="js_includes_user_profile.html">
                  js_includes_user_profile.js
                </a>
              
                
                <a class="source" href="js_includes_util.html">
                  js_includes_util.js
                </a>
              
                
                <a class="source" href="list.html">
                  list.js
                </a>
              
                
                <a class="source" href="list_filter.html">
                  list_filter.js
                </a>
              
                
                <a class="source" href="mentio.html">
                  mentio.js
                </a>
              
                
                <a class="source" href="modal.html">
                  modal.js
                </a>
              
                
                <a class="source" href="modals.html">
                  modals.js
                </a>
              
                
                <a class="source" href="moment-2.8.3.html">
                  moment-2.8.3.js
                </a>
              
                
                <a class="source" href="navigation.html">
                  navigation.js
                </a>
              
                
                <a class="source" href="newtag-it.html">
                  newtag-it.js
                </a>
              
                
                <a class="source" href="ng-sortable.html">
                  ng-sortable.js
                </a>
              
                
                <a class="source" href="page_title.html">
                  page_title.js
                </a>
              
                
                <a class="source" href="popover.html">
                  popover.js
                </a>
              
                
                <a class="source" href="popovers.html">
                  popovers.js
                </a>
              
                
                <a class="source" href="popupdivs14.html">
                  popupdivs14.js
                </a>
              
                
                <a class="source" href="popups.html">
                  popups.js
                </a>
              
                
                <a class="source" href="prism.html">
                  prism.js
                </a>
              
                
                <a class="source" href="prototype.effects.html">
                  prototype.effects.js
                </a>
              
                
                <a class="source" href="prototype.hidefix.html">
                  prototype.hidefix.js
                </a>
              
                
                <a class="source" href="prototype.html">
                  prototype.js
                </a>
              
                
                <a class="source" href="prototype.plugin.html">
                  prototype.plugin.js
                </a>
              
                
                <a class="source" href="prototype.template.html">
                  prototype.template.js
                </a>
              
                
                <a class="source" href="provider.lazyloader.html">
                  provider.lazyloader.js
                </a>
              
                
                <a class="source" href="provider.linkContentTypes.html">
                  provider.linkContentTypes.js
                </a>
              
                
                <a class="source" href="scoped_object_generators.html">
                  scoped_object_generators.js
                </a>
              
                
                <a class="source" href="scrollable.html">
                  scrollable.js
                </a>
              
                
                <a class="source" href="scrollspy.html">
                  scrollspy.js
                </a>
              
                
                <a class="source" href="section.html">
                  section.js
                </a>
              
                
                <a class="source" href="select2.html">
                  select2.js
                </a>
              
                
                <a class="source" href="selects.html">
                  selects.js
                </a>
              
                
                <a class="source" href="service.AMB.html">
                  service.AMB.js
                </a>
              
                
                <a class="source" href="service.authInterceptor.html">
                  service.authInterceptor.js
                </a>
              
                
                <a class="source" href="service.avatarProfilePersister.html">
                  service.avatarProfilePersister.js
                </a>
              
                
                <a class="source" href="service.dateUtils.html">
                  service.dateUtils.js
                </a>
              
                
                <a class="source" href="service.debounceFn.html">
                  service.debounceFn.js
                </a>
              
                
                <a class="source" href="service.filterExpressionParser.html">
                  service.filterExpressionParser.js
                </a>
              
                
                <a class="source" href="service.getTemplateUrl.html">
                  service.getTemplateUrl.js
                </a>
              
                
                <a class="source" href="service.guidedToursService.html">
                  service.guidedToursService.js
                </a>
              
                
                <a class="source" href="service.i18n.html">
                  service.i18n.js
                </a>
              
                
                <a class="source" href="service.md5.html">
                  service.md5.js
                </a>
              
                
                <a class="source" href="service.nowServer.html">
                  service.nowServer.js
                </a>
              
                
                <a class="source" href="service.nowStream.html">
                  service.nowStream.js
                </a>
              
                
                <a class="source" href="service.priorityQueue.html">
                  service.priorityQueue.js
                </a>
              
                
                <a class="source" href="service.progressDialog.html">
                  service.progressDialog.js
                </a>
              
                
                <a class="source" href="service.queryFilter.html">
                  service.queryFilter.js
                </a>
              
                
                <a class="source" href="service.snComplexPopoverService.html">
                  service.snComplexPopoverService.js
                </a>
              
                
                <a class="source" href="service.snConnect.html">
                  service.snConnect.js
                </a>
              
                
                <a class="source" href="service.snCustomEvent.html">
                  service.snCustomEvent.js
                </a>
              
                
                <a class="source" href="service.snMention.html">
                  service.snMention.js
                </a>
              
                
                <a class="source" href="service.snNotification.html">
                  service.snNotification.js
                </a>
              
                
                <a class="source" href="service.snNotifier.html">
                  service.snNotifier.js
                </a>
              
                
                <a class="source" href="service.snResource.html">
                  service.snResource.js
                </a>
              
                
                <a class="source" href="service.snTabActivity.html">
                  service.snTabActivity.js
                </a>
              
                
                <a class="source" href="service.spCommunicator.html">
                  service.spCommunicator.js
                </a>
              
                
                <a class="source" href="service.spFileSelect.html">
                  service.spFileSelect.js
                </a>
              
                
                <a class="source" href="service.spModal.html">
                  service.spModal.js
                </a>
              
                
                <a class="source" href="service.spUtil.html">
                  service.spUtil.js
                </a>
              
                
                <a class="source" href="service.urlTools.html">
                  service.urlTools.js
                </a>
              
                
                <a class="source" href="service.userPreferences.html">
                  service.userPreferences.js
                </a>
              
                
                <a class="source" href="simpleStorage.html">
                  simpleStorage.js
                </a>
              
                
                <a class="source" href="snPolyfill.html">
                  snPolyfill.js
                </a>
              
                
                <a class="source" href="snPopover.html">
                  snPopover.js
                </a>
              
                
                <a class="source" href="snTimeAgoSettings.html">
                  snTimeAgoSettings.js
                </a>
              
                
                <a class="source" href="snm.auth.data.module.html">
                  snm.auth.data.module.js
                </a>
              
                
                <a class="source" href="snm.serviceCatalog.data.shim.html">
                  snm.serviceCatalog.data.shim.js
                </a>
              
                
                <a class="source" href="snm.serviceCatalog.form.module.html">
                  snm.serviceCatalog.form.module.js
                </a>
              
                
                <a class="source" href="sp.geo.html">
                  sp.geo.js
                </a>
              
                
                <a class="source" href="streamButton.html">
                  streamButton.js
                </a>
              
                
                <a class="source" href="tables.html">
                  tables.js
                </a>
              
                
                <a class="source" href="tabs.html">
                  tabs.js
                </a>
              
                
                <a class="source" href="tabs2_14.html">
                  tabs2_14.js
                </a>
              
                
                <a class="source" href="templates.html">
                  templates.js
                </a>
              
                
                <a class="source" href="textutil.html">
                  textutil.js
                </a>
              
                
                <a class="source" href="timeAgo.html">
                  timeAgo.js
                </a>
              
                
                <a class="source" href="tooltip.html">
                  tooltip.js
                </a>
              
                
                <a class="source" href="tooltips.html">
                  tooltips.js
                </a>
              
                
                <a class="source" href="transaction_scope_includes.html">
                  transaction_scope_includes.js
                </a>
              
                
                <a class="source" href="transition.html">
                  transition.js
                </a>
              
                
                <a class="source" href="ui-bootstrap-tpls-1.1.2.html">
                  ui-bootstrap-tpls-1.1.2.js
                </a>
              
                
                <a class="source" href="uiPolicyFactory.html">
                  uiPolicyFactory.js
                </a>
              
                
                <a class="source" href="uiPolicyTypes.html">
                  uiPolicyTypes.js
                </a>
              
                
                <a class="source" href="ui_policy.html">
                  ui_policy.js
                </a>
              
                
                <a class="source" href="utils14.html">
                  utils14.js
                </a>
              
                
                <a class="source" href="viewLayout.html">
                  viewLayout.js
                </a>
              
                
                <a class="source" href="xmlUtil.html">
                  xmlUtil.js
                </a>
              
                
                <a class="source" href="xmlhttp.html">
                  xmlhttp.js
                </a>
              
                
                <a class="source" href="z_last_include.html">
                  z_last_include.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>js_includes_sp_core.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/*! RESOURCE: /scripts/js_includes_sp_core.js */</span>
<span class="hljs-comment">/*! RESOURCE: /scripts/app.$sp/app.$sp.js */</span>
angular.module(<span class="hljs-string">"sn.$sp"</span>, [
  <span class="hljs-string">'oc.lazyLoad'</span>,
  <span class="hljs-string">'ngAnimate'</span>,
  <span class="hljs-string">'sn.common'</span>,
  <span class="hljs-string">'ngResource'</span>,
  <span class="hljs-string">'ngCookies'</span>,
  <span class="hljs-string">'sn.base'</span>,
  <span class="hljs-string">'ui.bootstrap'</span>,
  <span class="hljs-string">'sn.common.attachments'</span>,
  <span class="hljs-string">'sn.common.util'</span>,
  <span class="hljs-string">'sn.common.presence'</span>,
  <span class="hljs-string">'snm.auth.data'</span>,
  <span class="hljs-string">'snm.cabrillo'</span>,
  <span class="hljs-string">'snm.serviceCatalog.form'</span>,
  <span class="hljs-string">'snm.serviceCatalog.data'</span>,
  <span class="hljs-string">'sn.common.form'</span>,
  <span class="hljs-string">'sn.common.controls'</span>,
  <span class="hljs-string">'ui.tinymce'</span>,
  <span class="hljs-string">'ngSanitize'</span>,
  <span class="hljs-string">'as.sortable'</span>,
  <span class="hljs-string">'sp.dependencies'</span>,
  <span class="hljs-string">'720kb.tooltips'</span>
]);
angular.module(<span class="hljs-string">'snm.auth.data'</span>).provider(<span class="hljs-string">'glideSystemProperties'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">glideSystemPropertiesProvider</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-meta">  'use strict'</span>;
  <span class="hljs-keyword">var</span> systemPropertyCache = {};
  <span class="hljs-keyword">this</span>.$get = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">glideSystemProperties</span>(<span class="hljs-params">$window</span>) </span>{
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">set</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">key, value</span>) </span>{
        systemPropertyCache[key] = value;
      },
      <span class="hljs-attr">get</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">key</span>) </span>{
        <span class="hljs-keyword">return</span> systemPropertyCache[key];
      }
    };
  };
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.$sp/directive.spFormField.js */</span>
angular.module(<span class="hljs-string">'sn.$sp'</span>).directive(<span class="hljs-string">'spFormField'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$location, glideFormFieldFactory, $timeout</span>) </span>{
<span class="hljs-meta">  'use strict'</span>;
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
    <span class="hljs-attr">templateUrl</span>: <span class="hljs-string">'sp_form_field.xml'</span>,
    <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">scope</span>: {
      <span class="hljs-attr">field</span>: <span class="hljs-string">'='</span>,
      <span class="hljs-attr">formModel</span>: <span class="hljs-string">'='</span>,
      <span class="hljs-attr">getGlideForm</span>: <span class="hljs-string">'&amp;glideForm'</span>
    },
    <span class="hljs-attr">controller</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$element, $scope</span>) </span>{
      <span class="hljs-keyword">var</span> field = $scope.field;
      <span class="hljs-keyword">if</span> (!field)
        <span class="hljs-keyword">throw</span> <span class="hljs-string">"spFormField used without providing a field."</span>;
      extendField($scope.field);

      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">extendField</span>(<span class="hljs-params">field</span>) </span>{
        <span class="hljs-keyword">var</span> glideField = glideFormFieldFactory.create(field);
        field.isReadonly = glideField.isReadonly;
        field.isMandatory = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
          <span class="hljs-keyword">return</span> !glideField.isReadonly() &amp;&amp; glideField.isMandatory();
        };
        field.mandatory_filled = hasValue;
        field.stagedValue = field.value;
        $scope.getGlideForm().$private.events.on(<span class="hljs-string">"change"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">fieldName, oldValue, newValue</span>) </span>{
          <span class="hljs-keyword">if</span> (fieldName == field.name)
            field.stagedValue = newValue;
        });
      }

      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">hasValue</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">if</span> (field.type === <span class="hljs-string">"boolean"</span>)
          <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">if</span> (field.stagedValue == <span class="hljs-literal">null</span> || <span class="hljs-keyword">typeof</span> field.stagedValue === <span class="hljs-string">'undefined'</span>)
          <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">var</span> trimmed = <span class="hljs-built_in">String</span>(field.stagedValue).trim();
        <span class="hljs-keyword">return</span> trimmed.length &gt; <span class="hljs-number">0</span>;
      }
      $scope.stagedValueChange = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        $scope.$emit(<span class="hljs-string">'sp.spFormField.stagedValueChange'</span>, <span class="hljs-literal">null</span>);
      }
      $scope.fieldValue = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">newValue, displayValue</span>) </span>{
        <span class="hljs-keyword">if</span> (angular.isDefined(newValue)) {
          $scope.getGlideForm().setValue(field.name, newValue, displayValue);
        }
        <span class="hljs-keyword">return</span> field.value;
      };
      $scope.getEncodedRecordValues = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> result = {};
        angular.forEach($scope.formModel._fields, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">f</span>) </span>{
          <span class="hljs-keyword">if</span> (f.type != <span class="hljs-string">'user_image'</span>)
            result[f.name] = f.value;
          <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (f.value)
            result[f.name] = <span class="hljs-string">'data:image/jpeg;base64,A=='</span>;
        });
        <span class="hljs-keyword">return</span> result;
      };
      $scope.onImageUpload = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">thumbnail</span>) </span>{
        $scope.getGlideForm().setValue(field.name, thumbnail, thumbnail);
      };
      $scope.onImageDelete = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        $scope.getGlideForm().setValue(field.name, <span class="hljs-string">''</span>);
      };
      $scope.hasValueOrFocus = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> val = $scope.hasFocus || glideFormFieldFactory.hasValue(field);
        <span class="hljs-keyword">if</span> (field.type == <span class="hljs-string">"user_image"</span>)
          val = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">return</span> val;
      };
    },
    <span class="hljs-attr">link</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">scope, element, attr</span>) </span>{
      $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> inputField;
        <span class="hljs-keyword">switch</span> (scope.field.type) {
          <span class="hljs-keyword">case</span> <span class="hljs-string">"masked"</span>:
          <span class="hljs-keyword">case</span> <span class="hljs-string">"email"</span>:
          <span class="hljs-keyword">case</span> <span class="hljs-string">"password"</span>:
            inputField = element.find(<span class="hljs-string">"input[name='"</span> + scope.field.name + <span class="hljs-string">"']"</span>);
            <span class="hljs-keyword">break</span>;
          <span class="hljs-keyword">case</span> <span class="hljs-string">"field_list"</span>:
          <span class="hljs-keyword">case</span> <span class="hljs-string">"glide_list"</span>:
          <span class="hljs-keyword">case</span> <span class="hljs-string">"reference"</span>:
          <span class="hljs-keyword">case</span> <span class="hljs-string">"field_name"</span>:
          <span class="hljs-keyword">case</span> <span class="hljs-string">"table_name"</span>:
            <span class="hljs-keyword">return</span>;
            <span class="hljs-keyword">break</span>;
          <span class="hljs-keyword">default</span>:
            inputField = element.find(<span class="hljs-string">"[name='"</span> + scope.field.name + <span class="hljs-string">"']"</span>);
            <span class="hljs-keyword">break</span>;
        }
        <span class="hljs-keyword">var</span> focusHandler = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
          scope.hasFocus = <span class="hljs-literal">true</span>;
          scope.$emit(<span class="hljs-string">"sp.spFormField.focus"</span>, element, inputField);
          <span class="hljs-keyword">if</span> (!scope.$root.$$phase)
            scope.$apply();
        };
        <span class="hljs-keyword">var</span> blurHandler = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
          scope.fieldValue(scope.field.stagedValue);
          scope.hasFocus = <span class="hljs-literal">false</span>;
          scope.$emit(<span class="hljs-string">"sp.spFormField.blur"</span>, element, inputField);
          <span class="hljs-keyword">if</span> (!scope.$root.$$phase)
            scope.$apply();
        };
        inputField.on(<span class="hljs-string">'focus'</span>, focusHandler).on(<span class="hljs-string">'blur'</span>, blurHandler);
        scope.$on(<span class="hljs-string">'$destroy'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
          inputField.off(<span class="hljs-string">'focus'</span>, focusHandler).off(<span class="hljs-string">'blur'</span>, blurHandler);
        });
        scope.$emit(<span class="hljs-string">"sp.spFormField.rendered"</span>, element, inputField);
      });
      scope.$on(<span class="hljs-string">'select2.ready'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e, $el</span>) </span>{
        e.stopPropagation();
        <span class="hljs-keyword">var</span> focusHandler = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
          $el.select2(<span class="hljs-string">'open'</span>);
        };
        $el.on(<span class="hljs-string">'focus'</span>, focusHandler);
        scope.$on(<span class="hljs-string">'$destroy'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
          $el.off(<span class="hljs-string">'focus'</span>, focusHandler);
        });
        scope.$emit(<span class="hljs-string">"sp.spFormField.rendered"</span>, element, $el);
      });
    }
  }
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.$sp/service.spUtil.js */</span>
angular.module(<span class="hljs-string">'sn.$sp'</span>).factory(<span class="hljs-string">'spUtil'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">nowServer, $rootScope, $http, $location, snRecordWatcher, $q</span>) </span>{
<span class="hljs-meta">  "use strict"</span>;
  <span class="hljs-keyword">var</span> spUtil = {
    <span class="hljs-attr">format</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">tpl, data</span>) </span>{
      <span class="hljs-keyword">var</span> re = <span class="hljs-regexp">/{([^}]+)?}/g</span>,
        match;
      <span class="hljs-keyword">while</span> (match = <span class="hljs-keyword">new</span> <span class="hljs-built_in">RegExp</span>(re).exec(tpl)) {
        tpl = tpl.replace(match[<span class="hljs-number">0</span>], data[match[<span class="hljs-number">1</span>]]);
      }
      <span class="hljs-keyword">return</span> tpl;
    },
    <span class="hljs-attr">update</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$scope</span>) </span>{
      <span class="hljs-keyword">var</span> s = $scope;
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.get(s, s.data).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>) </span>{
        <span class="hljs-keyword">if</span> (!response)
          <span class="hljs-keyword">return</span> {};
        angular.extend(s.data, response.data);
        <span class="hljs-keyword">return</span> response.data;
      })
    },
    <span class="hljs-attr">refresh</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$scope</span>) </span>{
      <span class="hljs-keyword">var</span> s = $scope;
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.get(s, <span class="hljs-literal">null</span>).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>) </span>{
        angular.extend(s.options, response.options);
        angular.extend(s.data, response.data);
        <span class="hljs-keyword">return</span> response;
      })
    },
    <span class="hljs-attr">triggerTableUIAction</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">action, table, recordID</span>) </span>{
      <span class="hljs-keyword">var</span> req = {
        <span class="hljs-attr">method</span>: <span class="hljs-string">"POST"</span>,
        <span class="hljs-attr">url</span>: <span class="hljs-string">"/api/now/sp/uiaction/"</span> + action.id,
        <span class="hljs-attr">headers</span>: <span class="hljs-keyword">this</span>.getHeaders(),
        <span class="hljs-attr">data</span>: {
          <span class="hljs-attr">table</span>: table,
          <span class="hljs-attr">recordID</span>: recordID
        }
      };
      <span class="hljs-keyword">return</span> $http(req).then(qs, qe);

      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">qs</span>(<span class="hljs-params">response</span>) </span>{
        <span class="hljs-keyword">var</span> r = response.data.result;
        <span class="hljs-keyword">if</span> (r &amp;&amp; r.$$uiNotification)
          $rootScope.$broadcast(<span class="hljs-string">"$$uiNotification"</span>, r.$$uiNotification);
        <span class="hljs-keyword">return</span> r;
      }

      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">qe</span>(<span class="hljs-params">error</span>) </span>{
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Error "</span> + error.status + <span class="hljs-string">" "</span> + error.statusText);
      }
    },
    <span class="hljs-attr">get</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$scope, data</span>) </span>{
      <span class="hljs-keyword">var</span> defer = $q.defer();
      <span class="hljs-keyword">var</span> t = <span class="hljs-keyword">this</span>.getWidgetURL($scope);
      <span class="hljs-keyword">var</span> req = {
        <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>,
        <span class="hljs-attr">url</span>: t,
        <span class="hljs-attr">headers</span>: <span class="hljs-keyword">this</span>.getHeaders(),
        <span class="hljs-attr">data</span>: data
      };
      $http(req).then(qs, qe);

      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">qs</span>(<span class="hljs-params">response</span>) </span>{
        <span class="hljs-keyword">var</span> r = response.data.result;
        <span class="hljs-keyword">if</span> (r &amp;&amp; r._server_time) {
          <span class="hljs-keyword">var</span> w = $scope.widget;
          <span class="hljs-keyword">if</span> (w)
            w._server_time = r._server_time;
        }
        <span class="hljs-keyword">if</span> (r &amp;&amp; r.$$uiNotification) {
          <span class="hljs-keyword">if</span> ($scope.$emit)
            $scope.$emit(<span class="hljs-string">"$$uiNotification"</span>, r.$$uiNotification);
          <span class="hljs-keyword">else</span>
            $rootScope.$broadcast(<span class="hljs-string">"$$uiNotification"</span>, r.$$uiNotification);
        }
        defer.resolve(r);
      }

      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">qe</span>(<span class="hljs-params">error</span>) </span>{
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Error "</span> + error.status + <span class="hljs-string">" "</span> + error.statusText);
        defer.reject(error);
      }
      <span class="hljs-keyword">return</span> defer.promise;
    },
    <span class="hljs-attr">getHeaders</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">return</span> {
        <span class="hljs-string">'Accept'</span>: <span class="hljs-string">'application/json'</span>,
        <span class="hljs-string">'x-portal'</span>: $rootScope.portal_id
      };
    },
    <span class="hljs-attr">getWidgetURL</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">arg</span>) </span>{
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> arg == <span class="hljs-string">'string'</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-string">"/api/now/sp/widget/"</span> + arg;
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (arg.widget &amp;&amp; arg.widget.rectangle_id)
        <span class="hljs-keyword">return</span> <span class="hljs-string">"/api/now/sp/rectangle/"</span> + arg.widget.rectangle_id;
      <span class="hljs-keyword">else</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">"/api/now/sp/widget/"</span> + arg.widget.sys_id;
    },
    <span class="hljs-attr">setBreadCrumb</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$scope, list</span>) </span>{
      $scope.$emit(<span class="hljs-string">'sp.update.breadcrumbs'</span>, list);
    },
    <span class="hljs-attr">setSearchPage</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">searchPage</span>) </span>{
      $rootScope.$emit(<span class="hljs-string">"update.searchpage"</span>, searchPage);
    },
    <span class="hljs-attr">addTrivialMessage</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">message</span>) </span>{
      $rootScope.$broadcast(<span class="hljs-string">"$$uiNotification"</span>, {
        <span class="hljs-attr">type</span>: <span class="hljs-string">"trivial"</span>,
        <span class="hljs-attr">message</span>: message
      });
    },
    <span class="hljs-attr">addInfoMessage</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">message</span>) </span>{
      $rootScope.$broadcast(<span class="hljs-string">"$$uiNotification"</span>, {
        <span class="hljs-attr">type</span>: <span class="hljs-string">"info"</span>,
        <span class="hljs-attr">message</span>: message
      });
    },
    <span class="hljs-attr">addErrorMessage</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">message</span>) </span>{
      $rootScope.$broadcast(<span class="hljs-string">"$$uiNotification"</span>, {
        <span class="hljs-attr">type</span>: <span class="hljs-string">"error"</span>,
        <span class="hljs-attr">message</span>: message
      });
    },
    <span class="hljs-attr">getURL</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">type</span>) </span>{
      <span class="hljs-keyword">var</span> dataURL = nowServer.getURL(<span class="hljs-string">"$sp"</span>);
      <span class="hljs-keyword">var</span> n = {
        <span class="hljs-attr">sysparm_ck</span>: g_ck,
        <span class="hljs-attr">type</span>: type
      };
      <span class="hljs-built_in">Object</span>.keys(n).forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">t</span>) </span>{
        dataURL += <span class="hljs-string">"&amp;"</span> + t + <span class="hljs-string">"="</span> + n[t]
      });
      <span class="hljs-keyword">return</span> dataURL;
    },
    <span class="hljs-attr">getHost</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">var</span> host = $location.protocol() + <span class="hljs-string">'://'</span> + $location.host();
      <span class="hljs-keyword">if</span> ($location.port()) {
        host += <span class="hljs-string">':'</span> + $location.port();
      }
      <span class="hljs-keyword">return</span> host;
    },
    <span class="hljs-attr">scrollTo</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">id, time</span>) </span>{
      <span class="hljs-keyword">var</span> t = time || <span class="hljs-number">1000</span>;
      <span class="hljs-keyword">var</span> offset = $(<span class="hljs-string">'.navbar'</span>).height() || <span class="hljs-number">0</span>;
      $(<span class="hljs-string">'section'</span>).animate({
        <span class="hljs-attr">scrollTop</span>: $(id).offset().top - offset - <span class="hljs-number">10</span>
      }, t);
    },
    <span class="hljs-attr">getAccelerator</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">char</span>) </span>{
      <span class="hljs-keyword">var</span> t = <span class="hljs-string">""</span>;
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-built_in">window</span>.ontouchstart == <span class="hljs-string">"undefined"</span>) {
        <span class="hljs-keyword">if</span> (navigator.userAgent.indexOf(<span class="hljs-string">"Mac OS X"</span>) &gt; <span class="hljs-number">-1</span>)
          t = <span class="hljs-string">" + "</span> + char;
        <span class="hljs-keyword">else</span>
          t = <span class="hljs-string">"Ctrl + "</span> + char;
      }
      <span class="hljs-keyword">return</span> t;
    },
    <span class="hljs-attr">recordWatch</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$scope, table, filter, callback</span>) </span>{
      filter = filter || <span class="hljs-string">'sys_id!=-1'</span>;
      <span class="hljs-keyword">var</span> watcherChannel = snRecordWatcher.initChannel(table, filter);
      <span class="hljs-keyword">var</span> deregister = $scope.$on(<span class="hljs-string">'record.updated'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">name, data</span>) </span>{
        <span class="hljs-keyword">if</span> (data.table_name != table)
          <span class="hljs-keyword">return</span>;
        <span class="hljs-keyword">if</span> (callback)
          callback(name, data);
        <span class="hljs-keyword">else</span>
          $scope.server.update();
      })
      $scope.$on(<span class="hljs-string">'$destroy'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        deregister();
        watcherChannel.unsubscribe();
      })
    },
    <span class="hljs-attr">createUid</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">str</span>) </span>{
      <span class="hljs-keyword">return</span> str.replace(<span class="hljs-regexp">/[xy]/g</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">c</span>) </span>{
        <span class="hljs-keyword">var</span> r, v;
        r = <span class="hljs-built_in">Math</span>.random() * <span class="hljs-number">16</span> | <span class="hljs-number">0</span>;
        v = c === <span class="hljs-string">'x'</span> ? r : r &amp; <span class="hljs-number">0x3</span> | <span class="hljs-number">0x8</span>;
        <span class="hljs-keyword">return</span> v.toString(<span class="hljs-number">16</span>);
      });
    }
  }
  <span class="hljs-keyword">return</span> spUtil;
});
<span class="hljs-comment">/*! RESOURCE: /scripts/app.$sp/directive.spCatItem.js */</span>
angular.module(<span class="hljs-string">"sn.$sp"</span>).directive(<span class="hljs-string">'spCatItem'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$http, spUtil, $rootScope</span>) </span>{
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
    <span class="hljs-attr">link</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">scope, element, attrs</span>) </span>{
      scope.item = scope.$<span class="hljs-built_in">eval</span>(attrs.item);
    },
    <span class="hljs-attr">controller</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$scope</span>) </span>{
      $scope.$on(<span class="hljs-string">'variable.price.change'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">evt, parms</span>) </span>{
        <span class="hljs-keyword">var</span> p = $scope.item._pricing;
        <span class="hljs-keyword">var</span> changed = <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">var</span> t = parms.recurring_price + p.recurring_price;
        <span class="hljs-keyword">if</span> (t != p.recurring_total) {
          changed = <span class="hljs-literal">true</span>;
          p.recurring_total = t;
        }
        t = parms.price + p.price
        <span class="hljs-keyword">if</span> (t != p.price_total) {
          changed = <span class="hljs-literal">true</span>;
          p.price_total = parms.price + p.price;
        }
        <span class="hljs-keyword">if</span> (!changed)
          <span class="hljs-keyword">return</span>;
        <span class="hljs-keyword">var</span> o = {
          <span class="hljs-attr">price</span>: p.price_total,
          <span class="hljs-attr">recurring_price</span>: p.recurring_total
        };
        $rootScope.$broadcast(<span class="hljs-string">"guide.item.price.change"</span>, o);
        $http.post(spUtil.getURL(<span class="hljs-string">'format_prices'</span>), o).success(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>) </span>{
          <span class="hljs-keyword">var</span> t = $scope.data.sc_cat_item;
          t = $scope.item;
          t.price = t.recurring_price = <span class="hljs-string">""</span>;
          <span class="hljs-keyword">if</span> (p.price_total)
            t.price = response.price;
          <span class="hljs-keyword">if</span> (p.recurring_total)
            t.recurring_price = response.recurring_price + <span class="hljs-string">" "</span> + p.rfd;
        })
      })
    }
  }
});
<span class="hljs-comment">/*! RESOURCE: /scripts/app.$sp/directive.spChoiceList.js */</span>
angular.module(<span class="hljs-string">'sn.$sp'</span>).directive(<span class="hljs-string">'spChoiceList'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$timeout, urlTools, $http</span>) </span>{
  <span class="hljs-keyword">var</span> ChoiceType = {
    <span class="hljs-attr">DropdownWithNone</span>: <span class="hljs-number">1</span>,
    <span class="hljs-attr">DropdownWithoutNone</span>: <span class="hljs-number">3</span>
  };
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">template</span>: <span class="hljs-string">'&lt;select name="{{field.name}}" ng-model="fieldValue" ng-model-options="{getterSetter: true}" sn-select-width="auto" ng-disabled="field.isReadonly()" ng-options="c.value as c.label for c in field.choices track by getVal(c.value)"&gt;&lt;/select&gt;'</span>,
    <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
    <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">require</span>: <span class="hljs-string">'ngModel'</span>,
    <span class="hljs-attr">scope</span>: {
      <span class="hljs-string">'field'</span>: <span class="hljs-string">'='</span>,
      <span class="hljs-string">'options'</span>: <span class="hljs-string">'=?'</span>,
      <span class="hljs-string">'getGlideForm'</span>: <span class="hljs-string">'&amp;glideForm'</span>
    },
    <span class="hljs-attr">link</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">scope, element, attrs, ngModel</span>) </span>{
      scope.getVal = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">v</span>) </span>{
        <span class="hljs-keyword">return</span> v;
      };
      <span class="hljs-keyword">var</span> g_form = scope.getGlideForm();
      <span class="hljs-keyword">var</span> field = scope.field;
      <span class="hljs-keyword">var</span> fieldOptions;
      scope.fieldValue = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> field.value;
      };
      g_form.$private.events.on(<span class="hljs-string">'change'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">fieldName, oldValue, newValue</span>) </span>{
        <span class="hljs-keyword">if</span> (fieldName == field.name) {} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (fieldName == field.dependentField) {
          field.dependentValue = newValue;
          refreshChoiceList();
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-string">'variable_name'</span> <span class="hljs-keyword">in</span> field &amp;&amp; field.reference_qual &amp;&amp; field.reference_qual.indexOf(fieldName) != <span class="hljs-number">-1</span>) {
          refreshReferenceChoices();
        }
      });

      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">refreshChoiceList</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> params = {};
        params.table = g_form.getTableName();
        params.field = field.name;
        params.sysparm_dependent_value = field.dependentValue;
        <span class="hljs-keyword">var</span> url = urlTools.getURL(<span class="hljs-string">'choice_list_data'</span>, params);
        <span class="hljs-keyword">return</span> $http.get(url).success(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>) </span>{
          field.choices = [];
          angular.forEach(data.items, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">item</span>) </span>{
            field.choices.push(item);
          });
          selectValueOrNone();
        });
      }

      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">selectValueOrNone</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> hasSelectedValue = <span class="hljs-literal">false</span>;
        angular.forEach(field.choices, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">c</span>) </span>{
          <span class="hljs-keyword">if</span> (field.value == c.value)
            hasSelectedValue = <span class="hljs-literal">true</span>;
        });
        <span class="hljs-keyword">if</span> (!hasSelectedValue &amp;&amp; field.choices.length &gt; <span class="hljs-number">0</span> &amp;&amp; (field.choice == ChoiceType.DropdownWithNone || field.choice == ChoiceType.DropdownWithoutNone))
          g_form.setValue(field.name, field.choices[<span class="hljs-number">0</span>].value, field.choices[<span class="hljs-number">0</span>].label);
      }

      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">refreshReferenceChoices</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> params = [];
        params[<span class="hljs-string">'qualifier'</span>] = field.reference_qual;
        params[<span class="hljs-string">'table'</span>] = field.lookup_table;
        params[<span class="hljs-string">'sysparm_include_variables'</span>] = <span class="hljs-literal">true</span>;
        params[<span class="hljs-string">'variable_ids'</span>] = field.sys_id;
        <span class="hljs-keyword">var</span> getFieldSequence = g_form.$private.options(<span class="hljs-string">'getFieldSequence'</span>);
        <span class="hljs-keyword">if</span> (getFieldSequence) {
          params[<span class="hljs-string">'variable_sequence1'</span>] = getFieldSequence();
        }
        <span class="hljs-keyword">var</span> itemSysId = g_form.$private.options(<span class="hljs-string">'itemSysId'</span>);
        params[<span class="hljs-string">'sysparm_id'</span>] = itemSysId;
        <span class="hljs-keyword">var</span> getFieldParams = g_form.$private.options(<span class="hljs-string">'getFieldParams'</span>);
        <span class="hljs-keyword">if</span> (getFieldParams) {
          angular.extend(params, getFieldParams());
        }
        <span class="hljs-keyword">var</span> url = urlTools.getURL(<span class="hljs-string">'sp_ref_list_data'</span>, params);
        <span class="hljs-keyword">return</span> $http.get(url).success(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>) </span>{
          <span class="hljs-keyword">var</span> hasSelectedValue = <span class="hljs-literal">false</span>;
          field.choices = [];
          angular.forEach(data.items, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">item</span>) </span>{
            item.label = item.$$displayValue;
            item.value = item.sys_id;
            <span class="hljs-keyword">if</span> (field.value == item.value)
              hasSelectedValue = <span class="hljs-literal">true</span>;
            field.choices.push(item);
          });
          <span class="hljs-keyword">if</span> (!hasSelectedValue &amp;&amp; field.choices.length &gt; <span class="hljs-number">0</span>)
            g_form.setValue(field.name, field.choices[<span class="hljs-number">0</span>].value, field.choices[<span class="hljs-number">0</span>].label);
        });
      }
      <span class="hljs-keyword">var</span> pcTimeout;
      g_form.$private.events.on(<span class="hljs-string">'propertyChange'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">type, fieldName, propertyName</span>) </span>{
        <span class="hljs-keyword">if</span> (fieldName != field.name)
          <span class="hljs-keyword">return</span>;
        <span class="hljs-keyword">if</span> (propertyName == <span class="hljs-string">"optionStack"</span>) {
          $timeout.cancel(pcTimeout);
          pcTimeout = $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
            field.choices = applyOptionStack(fieldOptions, field.optionStack);
            selectValueOrNone();
          }, <span class="hljs-number">35</span>);
        }
      });
      setDefaultOptions();
      <span class="hljs-keyword">if</span> (field.choices) {
        setChoiceOptions(field.choices);
      }
      selectValueOrNone();

      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setDefaultOptions</span>(<span class="hljs-params"></span>) </span>{
        setChoiceOptions([{
          <span class="hljs-attr">value</span>: scope.field.value,
          <span class="hljs-attr">label</span>: scope.field.displayValue || scope.field.placeholder
        }]);
      }

      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setChoiceOptions</span>(<span class="hljs-params">options</span>) </span>{
        <span class="hljs-keyword">if</span> (options) {
          options.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">option</span>) </span>{
            option.value = <span class="hljs-built_in">String</span>(option.value);
          });
        }
        fieldOptions = options;
        scope.options = applyOptionStack(options, scope.field.optionStack);
      }

      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">removeDuplicateNone</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> childrenOpt = element[<span class="hljs-number">0</span>].children;
        <span class="hljs-keyword">if</span> (childrenOpt.length == <span class="hljs-number">0</span>)
          <span class="hljs-keyword">return</span>;
        <span class="hljs-keyword">var</span> firstElement = angular.element(childrenOpt[<span class="hljs-number">0</span>]);
        <span class="hljs-keyword">if</span> (firstElement &amp;&amp; firstElement.val().trim() == <span class="hljs-string">""</span>)
          firstElement.remove();
      }

      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">applyOptionStack</span>(<span class="hljs-params">options, optionStack</span>) </span>{
        <span class="hljs-keyword">if</span> (!optionStack || optionStack.length == <span class="hljs-number">0</span>) {
          <span class="hljs-keyword">return</span> options;
        }
        <span class="hljs-keyword">var</span> newOptions = angular.copy(options);
        <span class="hljs-keyword">if</span> (!newOptions) {
          newOptions = [];
        }
        optionStack.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">item</span>) </span>{
          <span class="hljs-keyword">switch</span> (item.operation) {
            <span class="hljs-keyword">case</span> <span class="hljs-string">'add'</span>:
              <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> o <span class="hljs-keyword">in</span> newOptions) {
                <span class="hljs-keyword">if</span> (newOptions[o].label == item.label)
                  <span class="hljs-keyword">return</span>;
              }
              <span class="hljs-keyword">var</span> newOption = {
                <span class="hljs-attr">label</span>: item.label,
                <span class="hljs-attr">value</span>: item.value
              };
              <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> item.index === <span class="hljs-string">'undefined'</span>) {
                newOptions.push(newOption);
              } <span class="hljs-keyword">else</span> {
                newOptions.splice(item.index, <span class="hljs-number">0</span>, newOption);
              }
              removeDuplicateNone();
              <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">'remove'</span>:
              <span class="hljs-keyword">var</span> itemValue = <span class="hljs-built_in">String</span>(item.value);
              <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, iM = newOptions.length; i &lt; iM; i++) {
                <span class="hljs-keyword">var</span> optionValue = <span class="hljs-built_in">String</span>(newOptions[i].value);
                <span class="hljs-keyword">if</span> (optionValue !== itemValue) {
                  <span class="hljs-keyword">continue</span>;
                }
                newOptions.splice(i, <span class="hljs-number">1</span>);
                <span class="hljs-keyword">if</span> (i == <span class="hljs-number">0</span>)
                  removeDuplicateNone();
                <span class="hljs-keyword">break</span>;
              }
              <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">'clear'</span>:
              newOptions = [];
              removeDuplicateNone();
              <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">default</span>:
          }
        });
        <span class="hljs-keyword">return</span> newOptions;
      }
      <span class="hljs-keyword">if</span> (angular.isFunction(element.select2)) {
        element.select2({
          <span class="hljs-attr">allowClear</span>: <span class="hljs-literal">false</span>,
          <span class="hljs-attr">width</span>: <span class="hljs-string">'100%'</span>
        });
        element.bind(<span class="hljs-string">"change select2-removed"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
          e.stopImmediatePropagation();
          <span class="hljs-keyword">if</span> (e.added) {
            <span class="hljs-keyword">var</span> selectedItem = e.added;
            g_form.setValue(field.name, selectedItem.id, selectedItem.text);
          } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (e.removed) {
            g_form.clearValue(scope.field.name);
          }
        });
        ngModel.$render = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
          <span class="hljs-keyword">if</span> (ngModel.$viewValue === <span class="hljs-string">""</span> || ngModel.$viewValue === <span class="hljs-literal">null</span>)
            selectValueOrNone();
          element.select2(<span class="hljs-string">'val'</span>, ngModel.$viewValue);
        };
      }
    }
  };
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.$sp/directive.spCLink.js */</span>
angular.module(<span class="hljs-string">'sn.$sp'</span>).directive(<span class="hljs-string">'spCLink'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">i18n</span>) </span>{
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
    <span class="hljs-attr">scope</span>: {
      <span class="hljs-attr">rectangle</span>: <span class="hljs-string">'='</span>,
      <span class="hljs-attr">target</span>: <span class="hljs-string">'@'</span>,
      <span class="hljs-attr">table</span>: <span class="hljs-string">'='</span>,
      <span class="hljs-attr">id</span>: <span class="hljs-string">'='</span>,
      <span class="hljs-attr">query</span>: <span class="hljs-string">'='</span>
    },
    <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">template</span>: <span class="hljs-string">'&lt;span class="sp-convenience-link-wrapper" ng-if="display()"&gt;&lt;a href="{{href}}" target="_blank" class="sp-convenience-link"&gt;{{getText()}}&lt;/a&gt;&lt;/span&gt;'</span>,
    <span class="hljs-attr">link</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">scope, element, attrs, controller</span>) </span>{
      scope.display = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> scope.href &amp;&amp; <span class="hljs-built_in">window</span>.NOW.sp_debug;
      }
      <span class="hljs-keyword">var</span> href = <span class="hljs-string">''</span>;
      <span class="hljs-keyword">if</span> (scope.target) {
        <span class="hljs-keyword">var</span> target = scope.target;
        <span class="hljs-keyword">if</span> (target == <span class="hljs-string">'form'</span>)
          href = scope.table + <span class="hljs-string">'.do?sys_id='</span> + scope.id;
        <span class="hljs-keyword">if</span> (target == <span class="hljs-string">'kb_article'</span>)
          href = <span class="hljs-string">'kb_view.do?sysparm_article='</span> + scope.id;
        <span class="hljs-keyword">if</span> (target == <span class="hljs-string">'sc_cat_item'</span>)
          href = <span class="hljs-string">'com.glideapp.servicecatalog_cat_item_view.do?sysparm_id='</span> + scope.id + <span class="hljs-string">'&amp;sysparm_catalog_view=catalog_default'</span>;
        <span class="hljs-keyword">if</span> (target == <span class="hljs-string">'list'</span>) {
          scope.$watch(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">return</span> scope.table + <span class="hljs-string">" | "</span> + scope.query;
          }, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">newValue, oldValue</span>) </span>{
            <span class="hljs-keyword">if</span> (newValue != oldValue)
              scope.href = scope.table + <span class="hljs-string">'_list.do?sysparm_query='</span> + scope.query;
          })
          href = scope.table + <span class="hljs-string">'_list.do?sysparm_query='</span> + scope.query;
        }
      }
      scope.href = href;
      scope.getText = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> i18n.getMessage(<span class="hljs-string">'Open'</span>);
      }
    }
  }
});
<span class="hljs-comment">/*! RESOURCE: /scripts/app.$sp/service.spCommunicator.js */</span>
angular.module(<span class="hljs-string">'sn.$sp'</span>).factory(<span class="hljs-string">'spCommunicator'</span>, [<span class="hljs-string">'$rootScope'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$rootScope</span>) </span>{
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">deregFuncMap</span>: {},
    <span class="hljs-attr">_getEventMap</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$scope</span>) </span>{
      <span class="hljs-keyword">var</span> eventMap = <span class="hljs-keyword">this</span>.deregFuncMap[$scope.$id];
      <span class="hljs-keyword">if</span> (!eventMap)
        eventMap = <span class="hljs-keyword">this</span>.deregFuncMap[$scope.$id] = {};
      <span class="hljs-keyword">return</span> eventMap;
    },
    <span class="hljs-attr">start</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event, handler, $scope</span>) </span>{
      <span class="hljs-keyword">this</span>.stop(event, $scope);
      <span class="hljs-keyword">var</span> eventMap = <span class="hljs-keyword">this</span>._getEventMap($scope);
      eventMap[event] = $rootScope.$on(event, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event, data</span>) </span>{
        handler(data);
      });
    },
    <span class="hljs-attr">stop</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event, $scope</span>) </span>{
      <span class="hljs-keyword">var</span> eventMap = <span class="hljs-keyword">this</span>._getEventMap($scope);
      <span class="hljs-keyword">var</span> deregFunc = eventMap[event];
      <span class="hljs-keyword">if</span> (deregFunc)
        deregFunc();
    },
    <span class="hljs-attr">fire</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event, data</span>) </span>{
      <span class="hljs-keyword">if</span> (event)
        $rootScope.$broadcast(event, data);
    }
  }
}]);
<span class="hljs-comment">/*! RESOURCE: /scripts/app.$sp/directive.spDatePicker.js */</span>
angular.module(<span class="hljs-string">'sn.$sp'</span>).directive(<span class="hljs-string">'spDatePicker'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">dateUtils, $rootScope</span>) </span>{
  <span class="hljs-keyword">var</span> dateFormat = g_user_date_format || dateUtils.SYS_DATE_FORMAT;
  <span class="hljs-keyword">if</span> ($rootScope.user &amp;&amp; $rootScope.user.date_format)
    dateFormat = $rootScope.user.date_format;

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isValidDate</span>(<span class="hljs-params">value, format</span>) </span>{
    <span class="hljs-keyword">if</span> (value === <span class="hljs-string">''</span>)
      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">return</span> dateUtils.getDateFromFormat(value, format) != <span class="hljs-number">0</span>;
  }
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">template</span>: <span class="hljs-string">'&lt;div ng-class="{\'input-group\': !snDisabled, \'has-error\': isInvalid}" style="width: 100%;"&gt;'</span> +
      <span class="hljs-string">'&lt;input type="text" name="{{field.name}}" class="form-control" placeholder="{{field.placeholder}}" ng-model="formattedDate" ng-model-options="{updateOn: \'blur\', getterSetter: true}" ng-disabled="snDisabled" /&gt;'</span> +
      <span class="hljs-string">'&lt;span class="input-group-btn" ng-hide="snDisabled"&gt;'</span> +
      <span class="hljs-string">'&lt;input type="hidden" class="datepickerinput" ng-model="formattedDate" ng-readonly="true" /&gt;'</span> +
      <span class="hljs-string">'&lt;button class="btn btn-default" type="button"&gt;'</span> +
      <span class="hljs-string">'&lt;glyph sn-char="calendar" /&gt;'</span> +
      <span class="hljs-string">'&lt;/button&gt;'</span> +
      <span class="hljs-string">'&lt;/span&gt;'</span> +
      <span class="hljs-string">'&lt;/div&gt;'</span>,
    <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
    <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">require</span>: <span class="hljs-string">'?ngModel'</span>,
    <span class="hljs-attr">scope</span>: {
      <span class="hljs-attr">field</span>: <span class="hljs-string">'='</span>,
      <span class="hljs-attr">snDisabled</span>: <span class="hljs-string">'='</span>,
      <span class="hljs-attr">snIncludeTime</span>: <span class="hljs-string">'='</span>,
      <span class="hljs-attr">snChange</span>: <span class="hljs-string">'&amp;'</span>
    },
    <span class="hljs-attr">link</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">scope, element, attrs, ngModel</span>) </span>{
      <span class="hljs-keyword">var</span> includeTime = scope.snIncludeTime;
      <span class="hljs-keyword">var</span> format = includeTime ? dateFormat.trim() + <span class="hljs-string">' '</span> + dateUtils.SYS_TIME_FORMAT : dateFormat;
      <span class="hljs-keyword">var</span> dp = element.find(<span class="hljs-string">'.input-group-btn'</span>).datetimepicker({
        <span class="hljs-attr">keepInvalid</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">pickTime</span>: scope.snIncludeTime === <span class="hljs-literal">true</span>,
        <span class="hljs-attr">format</span>: <span class="hljs-string">"X"</span>
      }).on(<span class="hljs-string">'dp.change'</span>, onDpChange);

      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onDpChange</span>(<span class="hljs-params">e</span>) </span>{
        <span class="hljs-keyword">var</span> value = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(e.date._d);
        scope.formattedDate(dateUtils.formatDate(value, format));
        <span class="hljs-keyword">if</span> (!scope.$root.$$phase)
          scope.$apply();
      }

      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">validate</span>(<span class="hljs-params">formattedDate</span>) </span>{
        scope.isInvalid = <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">if</span> (formattedDate == <span class="hljs-literal">null</span> || formattedDate == <span class="hljs-string">''</span>) {
          dp.data(<span class="hljs-string">'DateTimePicker'</span>).setValue(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>());
          <span class="hljs-keyword">return</span> <span class="hljs-string">''</span>;
        }
        <span class="hljs-keyword">if</span> (isValidDate(formattedDate, format)) {
          <span class="hljs-keyword">var</span> d = dateUtils.getDateFromFormat(formattedDate, format);
          dp.data(<span class="hljs-string">'DateTimePicker'</span>).setValue(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(d));
        } <span class="hljs-keyword">else</span> {
          scope.isInvalid = <span class="hljs-literal">true</span>;
        }
        <span class="hljs-keyword">return</span> formattedDate;
      }
      <span class="hljs-keyword">if</span> (ngModel) {
        ngModel.$parsers.push(validate);
        ngModel.$render = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
          validate(ngModel.$viewValue);
        };
        scope.formattedDate = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">formattedValue</span>) </span>{
          <span class="hljs-keyword">if</span> (angular.isDefined(formattedValue)) {
            ngModel.$setViewValue(formattedValue);
            <span class="hljs-keyword">if</span> (scope.snChange) scope.snChange({
              <span class="hljs-attr">newValue</span>: formattedValue
            });
          }
          <span class="hljs-keyword">return</span> ngModel.$viewValue;
        };
      } <span class="hljs-keyword">else</span> {
        scope.formattedDate = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">formattedValue</span>) </span>{
          <span class="hljs-keyword">if</span> (angular.isDefined(formattedValue)) {
            scope.field.value = validate(formattedValue);
            <span class="hljs-keyword">if</span> (scope.snChange) scope.snChange({
              <span class="hljs-attr">newValue</span>: formattedValue
            });
          }
          <span class="hljs-keyword">return</span> scope.field.value;
        };
        scope.$watch(<span class="hljs-string">'field.value'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">newValue, oldValue</span>) </span>{
          <span class="hljs-keyword">if</span> (newValue != oldValue)
            validate(newValue);
        });
      }
      scope.$on(<span class="hljs-string">'$destroy'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        dp.off(<span class="hljs-string">'dp.change'</span>, onDpChange);
      });
    }
  }
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.$sp/directive.spDropdownTree.js */</span>
angular.module(<span class="hljs-string">'sn.$sp'</span>).directive(<span class="hljs-string">'spDropdownTree'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
    <span class="hljs-attr">scope</span>: {
      <span class="hljs-attr">items</span>: <span class="hljs-string">'='</span>
    },
    <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">template</span>: <span class="hljs-string">'&lt;ul class="dropdown-menu"&gt;'</span> +
      <span class="hljs-string">'&lt;li ng-repeat="mi in items" style="min-width: 20em;" ng-class="{\'dropdown-submenu\': mi.type == \'menu\', \'dropdown-menu-line\':$index &lt; items.length - 1}" ng-include="getURL()"&gt;'</span> +
      <span class="hljs-string">'&lt;/ul&gt;'</span>,
    <span class="hljs-attr">link</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">scope, element, attrs, controller</span>) </span>{
      scope.getURL = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">'spDropdownTreeTemplate'</span>;
      }
    }
  }
});
(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$</span>) </span>{
  $(<span class="hljs-string">"body"</span>).on(<span class="hljs-string">"click"</span>, <span class="hljs-string">"a.menu_trigger"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
    <span class="hljs-keyword">var</span> current = $(<span class="hljs-keyword">this</span>).next();
    <span class="hljs-keyword">var</span> grandparent = $(<span class="hljs-keyword">this</span>).parent().parent();
    <span class="hljs-keyword">if</span> ($(<span class="hljs-keyword">this</span>).hasClass(<span class="hljs-string">'left-caret'</span>) || $(<span class="hljs-keyword">this</span>).hasClass(<span class="hljs-string">'right-caret'</span>))
      $(<span class="hljs-keyword">this</span>).toggleClass(<span class="hljs-string">'right-caret left-caret'</span>);
    grandparent.find(<span class="hljs-string">'.left-caret'</span>).not(<span class="hljs-keyword">this</span>).toggleClass(<span class="hljs-string">'right-caret left-caret'</span>);
    current.toggle();
    $(<span class="hljs-string">".dropdown-menu"</span>).each(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">i, elem</span>) </span>{
      <span class="hljs-keyword">var</span> elemClosest = $(elem).closest(<span class="hljs-string">'.dropdown'</span>);
      <span class="hljs-keyword">var</span> currentClosest = current.closest(<span class="hljs-string">'.dropdown'</span>);
      <span class="hljs-keyword">if</span> (!elem.contains(current[<span class="hljs-number">0</span>]) &amp;&amp; elem != current[<span class="hljs-number">0</span>] &amp;&amp; (!currentClosest.length || !elemClosest.length || elemClosest[<span class="hljs-number">0</span>] == currentClosest[<span class="hljs-number">0</span>]))
        $(elem).hide();
    })
    e.stopPropagation();
  });
  $(<span class="hljs-string">"body"</span>).on(<span class="hljs-string">"click"</span>, <span class="hljs-string">"a:not(.menu_trigger)"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> root = $(<span class="hljs-keyword">this</span>).closest(<span class="hljs-string">'.dropdown'</span>);
    root.find(<span class="hljs-string">'.left-caret'</span>).toggleClass(<span class="hljs-string">'right-caret left-caret'</span>);
  });
})(jQuery);;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.$sp/factory.spMacro.js */</span>
angular.module(<span class="hljs-string">'sn.$sp'</span>).factory(<span class="hljs-string">"spMacro"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-meta">  "use strict"</span>;
  <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$scope, dataPrototype, inputMap, keepFields</span>) </span>{
    <span class="hljs-keyword">var</span> gf = $scope.page.g_form;
    <span class="hljs-keyword">if</span> (!gf) {
      <span class="hljs-built_in">console</span>.warn(<span class="hljs-string">'GlideForm not set for widget: '</span> + $scope.widget.name);
      <span class="hljs-keyword">return</span>;
    }
    <span class="hljs-keyword">var</span> map = createMap();

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createMap</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">var</span> names = gf.getFieldNames();
      <span class="hljs-keyword">var</span> fields = [];
      names.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">name</span>) </span>{
        fields.push(gf.getField(name));
      })
      <span class="hljs-keyword">var</span> map = {};
      angular.forEach(inputMap, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">value, key</span>) </span>{
        fields.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">field</span>) </span>{
          <span class="hljs-keyword">if</span> (field.variable_name == value) {
            map[key] = field.name;
            <span class="hljs-keyword">if</span> (!keepFields)
              gf.setDisplay(field.name, <span class="hljs-literal">false</span>);
          }
        })
      })
      angular.forEach(dataPrototype, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">value, key</span>) </span>{
        <span class="hljs-keyword">if</span> (map[key])
          <span class="hljs-keyword">return</span>;
        fields.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">field</span>) </span>{
          <span class="hljs-keyword">if</span> (field.variable_name == key) {
            map[key] = field.name;
            <span class="hljs-keyword">if</span> (!keepFields)
              gf.setDisplay(field.name, <span class="hljs-literal">false</span>);
          }
        })
      })
      <span class="hljs-keyword">return</span> map;
    }
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">getMap</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> map;
      },
      <span class="hljs-attr">onChange</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">newV, oldV</span>) </span>{
        <span class="hljs-keyword">if</span> (!angular.isDefined(newV))
          <span class="hljs-keyword">return</span>;
        angular.forEach(newV, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">value, key</span>) </span>{
          <span class="hljs-keyword">if</span> (newV[key] == oldV[key])
            <span class="hljs-keyword">return</span>;
          <span class="hljs-keyword">var</span> n = map[key];
          gf.setValue(n, newV[key]);
        })
      }
    }
  }
});
<span class="hljs-comment">/*! RESOURCE: /scripts/app.$sp/factory.spUIActionFactory.js */</span>
angular.module(<span class="hljs-string">'sn.$sp'</span>).factory(<span class="hljs-string">'spUIActionFactory'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$http, $rootScope</span>) </span>{
<span class="hljs-meta">  'use strict'</span>;
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">create</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">uiActions, options</span>) </span>{
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> GlideUIActions(uiActions, options);
    },
    <span class="hljs-attr">executeUIAction</span>: executeDesktopUIAction
  };

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">GlideUIActions</span>(<span class="hljs-params">uiActions, options</span>) </span>{
    <span class="hljs-keyword">if</span> (!uiActions) {
      <span class="hljs-keyword">throw</span> <span class="hljs-string">'uiActions must be provided'</span>;
    }
    <span class="hljs-keyword">var</span> _uiActionsById = {};
    <span class="hljs-keyword">var</span> _uiActions = [];
    options = options || {};
    uiActions.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">uiAction</span>) </span>{
      <span class="hljs-keyword">var</span> action = <span class="hljs-keyword">new</span> GlideUIAction(
        uiAction.action_name,
        uiAction.sys_id,
        uiAction.name,
        options.uiActionNotifier,
        options.attachmentGUID
      );
      _uiActionsById[action.getSysId()] = action;
      _uiActions.push(action);
    });
    <span class="hljs-keyword">this</span>.getActions = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">return</span> _uiActions;
    };
    <span class="hljs-keyword">this</span>.getAction = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">sysId</span>) </span>{
      <span class="hljs-keyword">return</span> _uiActionsById[sysId];
    };
    <span class="hljs-keyword">this</span>.getActionByName = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">name</span>) </span>{
      <span class="hljs-keyword">var</span> foundAction;
      _uiActions.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">action</span>) </span>{
        <span class="hljs-keyword">if</span> (foundAction) {
          <span class="hljs-keyword">return</span>;
        }
        <span class="hljs-keyword">if</span> (name === action.getName()) {
          foundAction = action;
        }
      });
      <span class="hljs-keyword">if</span> (!foundAction)
        foundAction = <span class="hljs-keyword">this</span>.getAction(name);
      <span class="hljs-keyword">return</span> foundAction;
    };
  }

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">GlideUIAction</span>(<span class="hljs-params">name, sysId, displayName, uiActionNotifier, attachmentGUID</span>) </span>{
    <span class="hljs-keyword">var</span> _inProgress = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">var</span> _name = name;
    <span class="hljs-keyword">var</span> _displayName = displayName;
    <span class="hljs-keyword">var</span> _sysId = sysId;
    <span class="hljs-keyword">var</span> _notifier = uiActionNotifier;
    <span class="hljs-keyword">this</span>.getSysId = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">return</span> _sysId;
    };
    <span class="hljs-keyword">this</span>.getName = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">return</span> _name;
    };
    <span class="hljs-keyword">this</span>.getDisplayName = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">return</span> _displayName;
    };
    <span class="hljs-keyword">this</span>.execute = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">g_form</span>) </span>{
      _inProgress = <span class="hljs-literal">true</span>;
      <span class="hljs-keyword">var</span> formData = {};
      <span class="hljs-keyword">var</span> fieldNames = g_form.getFieldNames();
      fieldNames.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">name</span>) </span>{
        formData[name] = g_form.getField(name);
      });
      <span class="hljs-keyword">if</span> (attachmentGUID)
        formData._attachmentGUID = attachmentGUID;
      <span class="hljs-keyword">var</span> $execute = executeDesktopUIAction(
        <span class="hljs-keyword">this</span>.getSysId(),
        g_form.getTableName(),
        g_form.getSysId(),
        formData
      ).finally(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        _inProgress = <span class="hljs-literal">false</span>;
      });
      _notifier(<span class="hljs-keyword">this</span>.getName(), $execute);
      <span class="hljs-keyword">return</span> $execute;
    };
  }

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">executeDesktopUIAction</span>(<span class="hljs-params">actionSysId, tableName, recordSysId, formData</span>) </span>{
    <span class="hljs-keyword">var</span> req = {
      <span class="hljs-attr">method</span>: <span class="hljs-string">"POST"</span>,
      <span class="hljs-attr">url</span>: <span class="hljs-string">"/api/now/sp/uiaction/"</span> + actionSysId,
      <span class="hljs-attr">headers</span>: {
        <span class="hljs-string">'Accept'</span>: <span class="hljs-string">'application/json'</span>,
        <span class="hljs-string">'x-portal'</span>: $rootScope.portal_id
      },
      <span class="hljs-attr">data</span>: {
        <span class="hljs-attr">table</span>: tableName,
        <span class="hljs-attr">recordID</span>: recordSysId,
        <span class="hljs-attr">data</span>: formData
      }
    };
    <span class="hljs-keyword">return</span> $http(req).then(qs, qe);

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">qs</span>(<span class="hljs-params">response</span>) </span>{
      <span class="hljs-keyword">var</span> r = response.data.result;
      <span class="hljs-keyword">if</span> (r &amp;&amp; r.$$uiNotification)
        $rootScope.$broadcast(<span class="hljs-string">"$$uiNotification"</span>, r.$$uiNotification);
      <span class="hljs-keyword">return</span> r;
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">qe</span>(<span class="hljs-params">error</span>) </span>{
      <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Error "</span> + error.status + <span class="hljs-string">" "</span> + error.statusText);
    }
  }
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.$sp/service.spFileSelect.js */</span>
angular.module(<span class="hljs-string">'sn.$sp'</span>).factory(<span class="hljs-string">'spFileSelect'</span>, [<span class="hljs-string">'$rootScope'</span>, <span class="hljs-string">'$upload'</span>, <span class="hljs-string">'$timeout'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$rootScope, $upload, $timeout</span>) </span>{
<span class="hljs-meta">  'use strict'</span>;
  <span class="hljs-keyword">var</span> imageFile = {};
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">onFileSelect</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$files, field</span>) </span>{
      imageFile[field.name] = <span class="hljs-literal">null</span>;
      <span class="hljs-keyword">if</span> ($files.length == <span class="hljs-number">1</span> &amp;&amp; <span class="hljs-built_in">window</span>.FileReader &amp;&amp; $files[<span class="hljs-number">0</span>].type.indexOf(<span class="hljs-string">'image'</span>) &gt; <span class="hljs-number">-1</span>) {
        field.image = <span class="hljs-literal">null</span>;
        imageFile[field.name] = $files[<span class="hljs-number">0</span>];
        <span class="hljs-keyword">var</span> fileReader = <span class="hljs-keyword">new</span> FileReader();
        fileReader.readAsDataURL(imageFile[field.name]);
        fileReader.onload = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
          field.value = e.target.result;
        }
        $upload.upload({
          <span class="hljs-attr">url</span>: <span class="hljs-string">'upload'</span>,
          <span class="hljs-attr">data</span>: {},
          <span class="hljs-attr">formDataAppender</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">formData, key, val</span>) </span>{
            <span class="hljs-keyword">if</span> (angular.isArray(val))
              angular.forEach(val, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">v</span>) </span>{
                formData.append(key, v);
              });
            <span class="hljs-keyword">else</span>
              formData.append(key, val);
          },
          <span class="hljs-attr">file</span>: imageFile[field.name],
          <span class="hljs-attr">fileFormDataName</span>: <span class="hljs-string">'myFile'</span>
        })
      }
    }
  }
}]);
<span class="hljs-comment">/*! RESOURCE: /scripts/app.$sp/directive.spGlyph.js */</span>
angular.module(<span class="hljs-string">'sn.$sp'</span>).directive(<span class="hljs-string">"spGlyph"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-meta">  "use strict"</span>;
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
    <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">scope</span>: {
      <span class="hljs-attr">char</span>: <span class="hljs-string">"@"</span>,
    },
    <span class="hljs-attr">template</span>: <span class="hljs-string">'&lt;span class="glyphicon glyphicon-{{char}}" /&gt;'</span>,
    <span class="hljs-attr">link</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">scope</span>) </span>{}
  }
});
<span class="hljs-comment">/*! RESOURCE: /scripts/app.$sp/directive.spGlyphPicker.js */</span>
angular.module(<span class="hljs-string">'sn.$sp'</span>).directive(<span class="hljs-string">'spGlyphPicker'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$rootScope</span>) </span>{
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">template</span>: <span class="hljs-string">'&lt;span class="glyph-picker-container"&gt;'</span> +
      <span class="hljs-string">'&lt;button ng-show="!disabled()" class="btn btn-default" data-iconset="fontawesome" data-icon="fa-{{field.value}}" role="iconpicker" /&gt;'</span> +
      <span class="hljs-string">'&lt;div ng-show="disabled()" class="fa fa-{{field.value}} glyph-picker-disabled"/&gt;'</span> +
      <span class="hljs-string">'&lt;/span&gt;'</span>,
    <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
    <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">scope</span>: {
      <span class="hljs-attr">field</span>: <span class="hljs-string">'='</span>,
      <span class="hljs-attr">snOnChange</span>: <span class="hljs-string">'&amp;'</span>,
      <span class="hljs-attr">snOnBlur</span>: <span class="hljs-string">'&amp;'</span>,
      <span class="hljs-attr">snDisabled</span>: <span class="hljs-string">'&amp;'</span>
    },
    <span class="hljs-attr">link</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">scope, element, attrs, controller</span>) </span>{
      scope.disabled = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> scope.snDisabled() == <span class="hljs-string">"undefined"</span>)
          <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">return</span> scope.snDisabled();
      }
      <span class="hljs-keyword">var</span> button = element.find(<span class="hljs-string">'button'</span>);
      button.on(<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
        <span class="hljs-keyword">var</span> describedByAttr = <span class="hljs-keyword">this</span>.attributes[<span class="hljs-string">'aria-describedby'</span>];
        <span class="hljs-keyword">if</span> (describedByAttr &amp;&amp; describedByAttr.value.startsWith(<span class="hljs-string">"popover"</span>)) {
          e.stopImmediatePropagation();
        }
      });
      button.iconpicker({
        <span class="hljs-attr">cols</span>: <span class="hljs-number">6</span>,
        <span class="hljs-attr">rows</span>: <span class="hljs-number">6</span>,
        <span class="hljs-attr">placement</span>: <span class="hljs-string">'right'</span>,
        <span class="hljs-attr">iconset</span>: <span class="hljs-string">'fontawesome'</span>
      });
      scope.transferIcon = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        button.iconpicker(<span class="hljs-string">'setIcon'</span>, <span class="hljs-string">'fa-'</span> + scope.field.value);
      }
      scope.$watch(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> scope.field.value;
      }, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">newValue, oldValue</span>) </span>{
        <span class="hljs-keyword">if</span> (newValue != oldValue)
          scope.transferIcon();
      })
      scope.transferIcon();
      button.on(<span class="hljs-string">'change'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
        scope.field.value = e.icon.replace(<span class="hljs-regexp">/^fa-/</span>, <span class="hljs-string">''</span>);
        <span class="hljs-keyword">if</span> (!$rootScope.$$phase)
          $rootScope.$digest();
        scope.snOnChange();
      })
      button.on(<span class="hljs-string">'change'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
        scope.snOnBlur();
      })
    }
  }
});
<span class="hljs-comment">/*! RESOURCE: /scripts/app.$sp/directive.spColorPicker.js */</span>
angular.module(<span class="hljs-string">'sn.$sp'</span>).directive(<span class="hljs-string">'spColorPicker'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$timeout</span>) </span>{
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">template</span>: <span class="hljs-string">'&lt;div class="input-group"&gt;'</span> +
      <span class="hljs-string">'&lt;input class="form-control" name="{{field.name}}" value="{{field.value}}" placeholder="{{field.placeholder}}" autocomplete="off" ng-disabled="snDisabled" /&gt;'</span> +
      <span class="hljs-string">'&lt;input type="text" class="btn input-group-btn" name="color_picker_{{field.name}}" ng-disabled="snDisabled" /&gt;'</span> +
      <span class="hljs-string">'&lt;/div&gt;'</span>,
    <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
    <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">scope</span>: {
      <span class="hljs-attr">field</span>: <span class="hljs-string">'='</span>,
      <span class="hljs-attr">getGlideForm</span>: <span class="hljs-string">'&amp;glideForm'</span>,
      <span class="hljs-attr">snChange</span>: <span class="hljs-string">"&amp;"</span>,
      <span class="hljs-attr">snDisabled</span>: <span class="hljs-string">"="</span>
    },
    <span class="hljs-attr">link</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">scope, element, attrs, controller</span>) </span>{
      <span class="hljs-keyword">var</span> field = scope.field;
      <span class="hljs-keyword">var</span> initialColor;

      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setValue</span>(<span class="hljs-params">newVal</span>) </span>{
        <span class="hljs-keyword">if</span> (!scope.snDisabled)
          scope.snChange({
            <span class="hljs-attr">newValue</span>: newVal
          });
      }
      $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        init();
      });

      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">init</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> $input = element.find(<span class="hljs-string">'input[name="'</span> + field.name + <span class="hljs-string">'"]'</span>);
        <span class="hljs-keyword">var</span> $picker = element.find(<span class="hljs-string">'input[name="color_picker_'</span> + field.name + <span class="hljs-string">'"]'</span>);
        $picker.spectrum({
          <span class="hljs-attr">color</span>: field.value,
          <span class="hljs-attr">showInitial</span>: <span class="hljs-literal">true</span>,
          <span class="hljs-attr">showButtons</span>: <span class="hljs-literal">false</span>,
          <span class="hljs-attr">showInput</span>: <span class="hljs-literal">true</span>,
          <span class="hljs-attr">showSelectionPalette</span>: <span class="hljs-literal">false</span>,
          <span class="hljs-attr">preferredFormat</span>: <span class="hljs-string">"hex"</span>,
          <span class="hljs-attr">showPalette</span>: <span class="hljs-literal">true</span>,
          <span class="hljs-attr">hideAfterPaletteSelect</span>: <span class="hljs-literal">true</span>,
          <span class="hljs-attr">replacerClassName</span>: <span class="hljs-string">"input-group-btn"</span>,
          <span class="hljs-attr">palette</span>: [
            [<span class="hljs-string">"#000000"</span>, <span class="hljs-string">"#ffffff"</span>, <span class="hljs-string">"#343d47"</span>, <span class="hljs-string">"#485563"</span>, <span class="hljs-string">"#81878e"</span>, <span class="hljs-string">"#bdc0c4"</span>, <span class="hljs-string">"#e6e8ea"</span>],
            [<span class="hljs-string">"#e7e9eb"</span>, <span class="hljs-string">"#6d79eb"</span>, <span class="hljs-string">"#8784db"</span>, <span class="hljs-string">"#b1afdb"</span>, <span class="hljs-string">"#278efc"</span>, <span class="hljs-string">"#83bfff"</span>, <span class="hljs-string">"#c0dcfa"</span>],
            [<span class="hljs-string">"#289fdb"</span>, <span class="hljs-string">"#97e0fc"</span>, <span class="hljs-string">"#caeefc"</span>, <span class="hljs-string">"#71e279"</span>, <span class="hljs-string">"#6edb8f"</span>, <span class="hljs-string">"#9adbad"</span>, <span class="hljs-string">"#fcc742"</span>],
            [<span class="hljs-string">"#ffe366"</span>, <span class="hljs-string">"#fff1b2"</span>, <span class="hljs-string">"#fc8a3d"</span>, <span class="hljs-string">"#ffc266"</span>, <span class="hljs-string">"#ffe0b2"</span>, <span class="hljs-string">"#f95050"</span>, <span class="hljs-string">"#ff7b65"</span>],
            [<span class="hljs-string">"#ffbeb2"</span>, <span class="hljs-string">"#f95070"</span>, <span class="hljs-string">"#ff93a2"</span>, <span class="hljs-string">"#ffc1ca"</span>, <span class="hljs-string">"#cddc39"</span>, <span class="hljs-string">"#e6ee9c"</span>, <span class="hljs-string">"#f9fbe7"</span>]
          ],
          <span class="hljs-attr">show</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">color</span>) </span>{
            initialColor = color.toHexString();
          },
          <span class="hljs-attr">hide</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">color</span>) </span>{
            <span class="hljs-keyword">var</span> newVal = color.toHexString();
            <span class="hljs-keyword">if</span> (initialColor != newVal) {
              setValue(newVal);
            }
          },
          <span class="hljs-attr">move</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">color</span>) </span>{
            <span class="hljs-keyword">var</span> newVal = color.toHexString();
            setValue(newVal);
          },
          <span class="hljs-attr">change</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">color</span>) </span>{
            <span class="hljs-keyword">var</span> newVal = color.toHexString();
            setValue(newVal);
          }
        });
        $input.on(<span class="hljs-string">"focus"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
          <span class="hljs-keyword">var</span> el = angular.element(<span class="hljs-keyword">this</span>);
          initialColor = el.val();
        });
        $input.on(<span class="hljs-string">"blur"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
          <span class="hljs-keyword">var</span> el = angular.element(<span class="hljs-keyword">this</span>);
          <span class="hljs-keyword">var</span> newVal = el.val();
          <span class="hljs-keyword">if</span> (initialColor != newVal) {
            $picker.spectrum(<span class="hljs-string">"set"</span>, newVal);
            setValue(newVal);
          }
        });
      }
    }
  }
});
<span class="hljs-comment">/*! RESOURCE: /scripts/app.$sp/directive.spReferenceField.js */</span>
angular.module(<span class="hljs-string">'sn.$sp'</span>).directive(<span class="hljs-string">'spReferenceField'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$rootScope, spUtil, $uibModal, $http</span>) </span>{
<span class="hljs-meta">  'use strict'</span>;
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
    <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">templateUrl</span>: <span class="hljs-string">'sp_reference_field.xml'</span>,
    <span class="hljs-attr">controller</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$scope</span>) </span>{
      $scope.openReference = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">field, view</span>) </span>{
        <span class="hljs-keyword">var</span> data = {
          <span class="hljs-attr">table</span>: field.ed.reference,
          <span class="hljs-attr">sys_id</span>: field.value,
          <span class="hljs-attr">view</span>: view
        };
        <span class="hljs-keyword">if</span> (angular.isDefined(field.reference_key))
          data[field.reference_key] = field.value;
        <span class="hljs-keyword">else</span>
          data.sys_id = field.value;
        showForm(data);
      };

      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">showForm</span>(<span class="hljs-params">data</span>) </span>{
        <span class="hljs-keyword">var</span> url = spUtil.getWidgetURL(<span class="hljs-string">"widget-form"</span>);
        <span class="hljs-keyword">var</span> req = {
          <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>,
          <span class="hljs-attr">url</span>: url,
          <span class="hljs-attr">headers</span>: {
            <span class="hljs-string">'Accept'</span>: <span class="hljs-string">'application/json'</span>,
            <span class="hljs-string">'x-portal'</span>: $rootScope.portal_id
          },
          <span class="hljs-attr">data</span>: data
        }
        $http(req).then(qs, qe);

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">qs</span>(<span class="hljs-params">response</span>) </span>{
          <span class="hljs-keyword">var</span> r = response.data.result;
          showModal(r);
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">qe</span>(<span class="hljs-params">error</span>) </span>{
          <span class="hljs-built_in">console</span>.error(<span class="hljs-string">"Error "</span> + error.status + <span class="hljs-string">" "</span> + error.statusText);
        }
      }

      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">showModal</span>(<span class="hljs-params">form</span>) </span>{
        <span class="hljs-keyword">var</span> opts = {
          <span class="hljs-attr">size</span>: <span class="hljs-string">'lg'</span>,
          <span class="hljs-attr">templateUrl</span>: <span class="hljs-string">'sp_form_modal'</span>,
          <span class="hljs-attr">controller</span>: ModalInstanceCtrl,
          <span class="hljs-attr">resolve</span>: {}
        };
        opts.resolve.item = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
          <span class="hljs-keyword">return</span> angular.copy({
            <span class="hljs-attr">form</span>: form
          });
        };
        <span class="hljs-keyword">var</span> modalInstance = $uibModal.open(opts);
        modalInstance.result.then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{}, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{});
        $scope.$on(<span class="hljs-string">"$destroy"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
          modalInstance.close();
        });
        <span class="hljs-keyword">var</span> unregister = $scope.$on(<span class="hljs-string">'sp.form.record.updated'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">evt, fields</span>) </span>{
          unregister();
          unregister = <span class="hljs-literal">null</span>;
          modalInstance.close();
          <span class="hljs-keyword">if</span> (evt.stopPropagation)
            evt.stopPropagation();
          evt.preventDefault();
        });
      }

      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ModalInstanceCtrl</span>(<span class="hljs-params">$scope, $uibModalInstance, item</span>) </span>{
        $scope.item = item;
        $scope.ok = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
          $uibModalInstance.close();
        };
        $scope.cancel = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
          $uibModalInstance.dismiss(<span class="hljs-string">'cancel'</span>);
        };
      }
    }
  }
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.$sp/directive.spCssEditor.js */</span>
angular.module(<span class="hljs-string">'sn.$sp'</span>).directive(<span class="hljs-string">'spCssEditor'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">template</span>: <span class="hljs-string">'&lt;textarea ng-model="v" name="{{::field.name}}" style="width: 100%; min-height: 2em;" rows="1" wrap="soft" data-length="{{::dataLength}}" data-charlimit="false"&gt;'</span> +
      <span class="hljs-string">'&lt;/textarea&gt;'</span>,
    <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
    <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">require</span>: <span class="hljs-string">'^ngModel'</span>,
    <span class="hljs-attr">scope</span>: {
      <span class="hljs-attr">field</span>: <span class="hljs-string">'='</span>,
      <span class="hljs-attr">dataLength</span>: <span class="hljs-string">'@'</span>,
      <span class="hljs-attr">snDisabled</span>: <span class="hljs-string">'=?'</span>,
      <span class="hljs-attr">snChange</span>: <span class="hljs-string">'&amp;'</span>,
      <span class="hljs-attr">snBlur</span>: <span class="hljs-string">'&amp;'</span>
    },
    <span class="hljs-attr">link</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">scope, element, attrs, ctrl</span>) </span>{
      element[<span class="hljs-number">0</span>].value = scope.field.value;
      element[<span class="hljs-number">0</span>].id = scope.field.name + <span class="hljs-string">"_css_editor"</span>;
      <span class="hljs-keyword">var</span> cmi = CodeMirror.fromTextArea(element[<span class="hljs-number">0</span>], {
        <span class="hljs-attr">mode</span>: <span class="hljs-string">"text/x-less"</span>,
        <span class="hljs-attr">lineWrapping</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">readOnly</span>: scope.snDisabled === <span class="hljs-literal">true</span>,
        <span class="hljs-attr">viewportMargin</span>: <span class="hljs-literal">Infinity</span>,
        <span class="hljs-attr">lineNumbers</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">tabSize</span>: <span class="hljs-number">2</span>
      });
      cmi.on(<span class="hljs-string">'change'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">cm</span>) </span>{
        <span class="hljs-keyword">if</span> (<span class="hljs-string">"stagedValue"</span> <span class="hljs-keyword">in</span> scope.field) {
          scope.field.stagedValue = cm.getValue();
          ctrl.$setViewValue(scope.field.stagedValue);
        } <span class="hljs-keyword">else</span> {
          scope.field.value = cm.getValue();
          ctrl.$setViewValue(scope.field.value);
        }
        <span class="hljs-keyword">if</span> (angular.isDefined(scope.snChange))
          scope.snChange();
      });
      cmi.on(<span class="hljs-string">'blur'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">if</span> (angular.isDefined(scope.snBlur))
          scope.snBlur();
      });
      ctrl.$viewChangeListeners.push(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        scope.$<span class="hljs-built_in">eval</span>(attrs.ngChange);
      });
      scope.$watch(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> scope.field.value;
      }, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">newValue, oldValue</span>) </span>{
        <span class="hljs-keyword">if</span> (newValue != oldValue &amp;&amp; !cmi.hasFocus())
          cmi.getDoc().setValue(scope.field.value);
      });
      scope.$watch(<span class="hljs-string">'snDisabled'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">newValue</span>) </span>{
        <span class="hljs-keyword">if</span> (angular.isDefined(newValue)) {
          cmi.setOption(<span class="hljs-string">'readOnly'</span>, newValue);
        }
      });
    }
  }
});
<span class="hljs-comment">/*! RESOURCE: /scripts/app.$sp/directive.spTinymceEditor.js */</span>
angular.module(<span class="hljs-string">'sn.$sp'</span>).directive(<span class="hljs-string">'spTinymceEditor'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">getTemplateUrl, snAttachmentHandler, $timeout</span>) </span>{
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">templateUrl</span>: getTemplateUrl(<span class="hljs-string">'sp_tinymce_editor.xml'</span>),
    <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
    <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">scope</span>: {
      <span class="hljs-attr">model</span>: <span class="hljs-string">"=ngModel"</span>,
      <span class="hljs-attr">options</span>: <span class="hljs-string">"=ngModelOptions"</span>,
      <span class="hljs-attr">snBlur</span>: <span class="hljs-string">'&amp;'</span>,
      <span class="hljs-attr">snDisabled</span>: <span class="hljs-string">'=?'</span>
    },
    <span class="hljs-attr">controller</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$scope</span>) </span>{
      $scope.options = $scope.options || {};
      <span class="hljs-keyword">var</span> thisEditor = {};
      $scope.tinyMCEOptions = {
        <span class="hljs-attr">skin</span>: <span class="hljs-string">'lightgray'</span>,
        <span class="hljs-attr">theme</span>: <span class="hljs-string">'modern'</span>,
        <span class="hljs-attr">menubar</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">statusbar</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">plugins</span>: <span class="hljs-string">"codesample code"</span>,
        <span class="hljs-attr">toolbar</span>: <span class="hljs-string">'undo redo | formatselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | image | codesample code'</span>,
        <span class="hljs-attr">setup</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">ed</span>) </span>{
          thisEditor = ed;
          ed.addCommand(<span class="hljs-string">'imageUpload'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">ui, v</span>) </span>{
            $scope.clickAttachment();
          });
          ed.addButton(<span class="hljs-string">'image'</span>, {
            <span class="hljs-attr">icon</span>: <span class="hljs-string">'image'</span>,
            <span class="hljs-attr">tooltip</span>: <span class="hljs-string">'Insert image'</span>,
            <span class="hljs-attr">onclick</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
              ed.execCommand(<span class="hljs-string">'imageUpload'</span>);
            },
            <span class="hljs-attr">stateSelector</span>: <span class="hljs-string">'img:not([data-mce-object],[data-mce-placeholder])'</span>
          });
          ed.on(<span class="hljs-string">'blur'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">if</span> (angular.isDefined($scope.snBlur))
              $scope.snBlur();
          });
          $scope.registerPasteHandler();
        }
      };
      $scope.attachFiles = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>) </span>{
        snAttachmentHandler.create(<span class="hljs-string">"kb_social_qa_question"</span>, <span class="hljs-string">"-1"</span>).uploadAttachment(data.files[<span class="hljs-number">0</span>], <span class="hljs-literal">null</span>, {}).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>) </span>{
          <span class="hljs-keyword">var</span> args = tinymce.extend({}, {
            <span class="hljs-attr">src</span>: <span class="hljs-built_in">encodeURI</span>(<span class="hljs-string">"/"</span> + response.sys_id + <span class="hljs-string">".iix"</span>),
            <span class="hljs-attr">style</span>: <span class="hljs-string">"max-width: 100%; max-height: 480px;"</span>
          });
          thisEditor.execCommand(<span class="hljs-string">'mceInsertContent'</span>, <span class="hljs-literal">false</span>, thisEditor.dom.createHTML(<span class="hljs-string">'img'</span>, args), {
            <span class="hljs-attr">skip_undo</span>: <span class="hljs-number">1</span>
          });
        });
      };
      $scope.$watch(<span class="hljs-string">'snDisabled'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">newValue</span>) </span>{
        <span class="hljs-keyword">if</span> (angular.isDefined(newValue) &amp;&amp; <span class="hljs-keyword">typeof</span> thisEditor.setMode == <span class="hljs-string">"function"</span>)
          thisEditor.setMode(newValue ? <span class="hljs-string">'readonly'</span> : <span class="hljs-string">'design'</span>);
      });
    },
    <span class="hljs-attr">link</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">scope, element, attrs</span>) </span>{
      scope.attrs = attrs;
      scope.clickAttachment = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        element.find(<span class="hljs-string">"input"</span>).click();
      };
      scope.registerPasteHandler = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
          element.find(<span class="hljs-string">'iframe'</span>).contents().find(<span class="hljs-string">'body'</span>).bind(<span class="hljs-string">'paste'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
            e = e.originalEvent;
            <span class="hljs-keyword">var</span> files = [];
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; e.clipboardData.items.length; i++) {
              <span class="hljs-keyword">var</span> item = e.clipboardData.items[i];
              <span class="hljs-keyword">if</span> (item.kind &amp;&amp; item.kind === <span class="hljs-string">"file"</span>) {
                <span class="hljs-keyword">var</span> file = item.getAsFile();
                <span class="hljs-built_in">Object</span>.defineProperty(file, <span class="hljs-string">"name"</span>, {
                  <span class="hljs-attr">value</span>: <span class="hljs-string">"Pasted File - "</span> + <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>()
                });
                files.push(file);
              }
            }
            <span class="hljs-keyword">if</span> (files.length &gt; <span class="hljs-number">0</span>) {
              e.stopPropagation();
              e.preventDefault();
              scope.attachFiles({
                <span class="hljs-attr">files</span>: files
              });
            }
          });
        });
      };
    }
  }
});
<span class="hljs-comment">/*! RESOURCE: /scripts/app.$sp/directive.spHTMLEditor.js */</span>
angular.module(<span class="hljs-string">'sn.$sp'</span>).directive(<span class="hljs-string">'spHtmlEditor'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">template</span>: <span class="hljs-string">'&lt;textarea class="CodeMirror" name="{{::field.name}}" ng-model="v" style="width: 100%;" data-length="{{ ::dataLength }}" data-charlimit="false"&gt;&lt;/textarea&gt;'</span>,
    <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
    <span class="hljs-attr">require</span>: <span class="hljs-string">'^ngModel'</span>,
    <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">scope</span>: {
      <span class="hljs-attr">field</span>: <span class="hljs-string">'='</span>,
      <span class="hljs-attr">dataLength</span>: <span class="hljs-string">'@'</span>,
      <span class="hljs-attr">rows</span>: <span class="hljs-string">'@'</span>,
      <span class="hljs-attr">snDisabled</span>: <span class="hljs-string">'=?'</span>,
      <span class="hljs-attr">snChange</span>: <span class="hljs-string">'&amp;'</span>,
      <span class="hljs-attr">snBlur</span>: <span class="hljs-string">'&amp;'</span>
    },
    <span class="hljs-attr">link</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">scope, element, attrs, ctrl</span>) </span>{
      element[<span class="hljs-number">0</span>].value = scope.field.value;
      element[<span class="hljs-number">0</span>].id = scope.field.name + <span class="hljs-string">"_html_editor"</span>;
      <span class="hljs-keyword">var</span> cmi = CodeMirror.fromTextArea(element[<span class="hljs-number">0</span>], {
        <span class="hljs-attr">mode</span>: <span class="hljs-string">"htmlmixed"</span>,
        <span class="hljs-attr">lineWrapping</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">readOnly</span>: scope.snDisabled === <span class="hljs-literal">true</span>,
        <span class="hljs-attr">viewportMargin</span>: <span class="hljs-literal">Infinity</span>,
        <span class="hljs-attr">lineNumbers</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">tabSize</span>: <span class="hljs-number">2</span>
      });
      ctrl.$viewChangeListeners.push(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        scope.$<span class="hljs-built_in">eval</span>(attrs.ngChange);
      });
      cmi.on(<span class="hljs-string">'change'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">cm</span>) </span>{
        <span class="hljs-keyword">if</span> (<span class="hljs-string">"stagedValue"</span> <span class="hljs-keyword">in</span> scope.field) {
          scope.field.stagedValue = cm.getValue();
          ctrl.$setViewValue(scope.field.stagedValue);
        } <span class="hljs-keyword">else</span> {
          scope.field.value = cm.getValue();
          ctrl.$setViewValue(scope.field.value);
        }
        <span class="hljs-keyword">if</span> (angular.isDefined(scope.snChange))
          scope.snChange();
      });
      cmi.on(<span class="hljs-string">'blur'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">if</span> (angular.isDefined(scope.snBlur))
          scope.snBlur();
      });
      scope.$watch(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> scope.field.value;
      }, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">newValue, oldValue</span>) </span>{
        <span class="hljs-keyword">if</span> (newValue != oldValue &amp;&amp; !cmi.hasFocus())
          cmi.getDoc().setValue(scope.field.value);
      });
      scope.$watch(<span class="hljs-string">'snDisabled'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">newValue</span>) </span>{
        <span class="hljs-keyword">if</span> (angular.isDefined(newValue)) {
          cmi.setOption(<span class="hljs-string">'readOnly'</span>, newValue);
        }
      });
    }
  }
});
<span class="hljs-comment">/*! RESOURCE: /scripts/app.$sp/directive.spHtmlContent.js */</span>
angular.module(<span class="hljs-string">'sn.$sp'</span>).directive(<span class="hljs-string">'spHtmlContent'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$sce</span>) </span>{
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">template</span>: <span class="hljs-string">'&lt;p ng-bind-html="trustAsHtml(model)"&gt;&lt;/p&gt;'</span>,
    <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
    <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">scope</span>: {
      <span class="hljs-attr">model</span>: <span class="hljs-string">'='</span>
    },
    <span class="hljs-attr">link</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">scope, element, attrs, controller</span>) </span>{
      scope.trustAsHtml = $sce.trustAsHtml;
      scope.$watch(<span class="hljs-string">'model'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        Prism.highlightAll();
      })
    }
  }
});
<span class="hljs-comment">/*! RESOURCE: /scripts/app.$sp/directive.spCodeMirror.js */</span>
angular.module(<span class="hljs-string">'sn.$sp'</span>).directive(<span class="hljs-string">'spCodeMirror'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">template</span>: <span class="hljs-string">'&lt;textarea class="CodeMirror" name="{{::field.name}}" ng-model="v" style="width: 100%;" data-length="{{ ::dataLength }}" data-charlimit="false"&gt;'</span> +
      <span class="hljs-string">'&lt;/textarea&gt;'</span>,
    <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
    <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">require</span>: <span class="hljs-string">'^ngModel'</span>,
    <span class="hljs-attr">scope</span>: {
      <span class="hljs-attr">field</span>: <span class="hljs-string">'='</span>,
      <span class="hljs-attr">mode</span>: <span class="hljs-string">'@'</span>,
      <span class="hljs-attr">dataLength</span>: <span class="hljs-string">'@'</span>,
      <span class="hljs-attr">snDisabled</span>: <span class="hljs-string">'=?'</span>,
      <span class="hljs-attr">snChange</span>: <span class="hljs-string">'&amp;'</span>,
      <span class="hljs-attr">snBlur</span>: <span class="hljs-string">'&amp;'</span>
    },
    <span class="hljs-attr">link</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">scope, element, attrs, ctrl</span>) </span>{
      element[<span class="hljs-number">0</span>].value = scope.field.value;
      element[<span class="hljs-number">0</span>].id = scope.field.name + <span class="hljs-string">"_html_editor"</span>;
      <span class="hljs-keyword">var</span> cmi = CodeMirror.fromTextArea(element[<span class="hljs-number">0</span>], {
        <span class="hljs-attr">mode</span>: scope.mode,
        <span class="hljs-attr">lineWrapping</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">readOnly</span>: scope.snDisabled === <span class="hljs-literal">true</span>,
        <span class="hljs-attr">viewportMargin</span>: <span class="hljs-literal">Infinity</span>,
        <span class="hljs-attr">tabSize</span>: <span class="hljs-number">2</span>
      });
      ctrl.$viewChangeListeners.push(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        scope.$<span class="hljs-built_in">eval</span>(attrs.ngChange);
      });
      cmi.on(<span class="hljs-string">'change'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">cm</span>) </span>{
        <span class="hljs-keyword">if</span> (<span class="hljs-string">"stagedValue"</span> <span class="hljs-keyword">in</span> scope.field) {
          scope.field.stagedValue = cm.getValue();
          ctrl.$setViewValue(scope.field.stagedValue);
        } <span class="hljs-keyword">else</span> {
          scope.field.value = cm.getValue();
          ctrl.$setViewValue(scope.field.value);
        }
        <span class="hljs-keyword">if</span> (angular.isDefined(scope.snChange))
          scope.snChange();
      });
      cmi.on(<span class="hljs-string">'blur'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">cm</span>) </span>{
        <span class="hljs-keyword">if</span> (<span class="hljs-string">"stagedValue"</span> <span class="hljs-keyword">in</span> scope.field) {
          scope.field.stagedValue = cm.getValue();
          ctrl.$setViewValue(scope.field.stagedValue);
        } <span class="hljs-keyword">else</span> {
          scope.field.value = cm.getValue();
          ctrl.$setViewValue(scope.field.value);
        }
        <span class="hljs-keyword">if</span> (angular.isDefined(scope.snBlur))
          scope.snBlur();
      });
      scope.$watch(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> scope.field.value;
      }, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">newValue, oldValue</span>) </span>{
        <span class="hljs-keyword">if</span> (newValue != oldValue &amp;&amp; !cmi.hasFocus())
          cmi.getDoc().setValue(scope.field.value);
      });
      scope.$watch(<span class="hljs-string">'snDisabled'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">newValue</span>) </span>{
        <span class="hljs-keyword">if</span> (angular.isDefined(newValue)) {
          cmi.setOption(<span class="hljs-string">'readOnly'</span>, newValue);
        }
      });
    }
  }
});
<span class="hljs-comment">/*! RESOURCE: /scripts/app.$sp/directive.spScriptEditor.js */</span>
angular.module(<span class="hljs-string">'sn.$sp'</span>).directive(<span class="hljs-string">'spScriptEditor'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$rootScope, $timeout, $http, spCodeEditorAutocomplete, defaultJSAutocomplete</span>) </span>{
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">template</span>: <span class="hljs-string">'&lt;textarea class="CodeMirror" name="{{::field.name}}" ng-model="v" style="width: 100%;" data-length="{{::dataLength}}" data-charlimit="false"&gt;'</span> +
      <span class="hljs-string">'&lt;/textarea&gt;'</span>,
    <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
    <span class="hljs-attr">require</span>: <span class="hljs-string">'^ngModel'</span>,
    <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">scope</span>: {
      <span class="hljs-attr">field</span>: <span class="hljs-string">'='</span>,
      <span class="hljs-attr">dataLength</span>: <span class="hljs-string">'@'</span>,
      <span class="hljs-attr">options</span>: <span class="hljs-string">'@?'</span>,
      <span class="hljs-attr">snDisabled</span>: <span class="hljs-string">'=?'</span>,
      <span class="hljs-attr">snChange</span>: <span class="hljs-string">'&amp;'</span>,
      <span class="hljs-attr">snBlur</span>: <span class="hljs-string">'&amp;'</span>
    },
    <span class="hljs-attr">link</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">scope, element, attrs, ctrl</span>) </span>{
      element[<span class="hljs-number">0</span>].value = scope.field.value;
      element[<span class="hljs-number">0</span>].id = scope.field.name + <span class="hljs-string">"_javascript_editor"</span>;
      <span class="hljs-keyword">var</span> cmi = initializeCodeMirror(element[<span class="hljs-number">0</span>]);
      <span class="hljs-keyword">var</span> server;
      spCodeEditorAutocomplete.getConfig(<span class="hljs-string">'sp_widget'</span>, scope.field.name)
        .then(setupTernServer);
      scope.$watch(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> scope.field.value;
      }, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">newValue, oldValue</span>) </span>{
        <span class="hljs-keyword">if</span> (newValue != oldValue &amp;&amp; !cmi.hasFocus())
          cmi.getDoc().setValue(scope.field.value);
      });
      ctrl.$viewChangeListeners.push(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        scope.$<span class="hljs-built_in">eval</span>(attrs.ngChange);
      });
      cmi.on(<span class="hljs-string">'change'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">cm</span>) </span>{
        <span class="hljs-keyword">if</span> (<span class="hljs-string">"stagedValue"</span> <span class="hljs-keyword">in</span> scope.field) {
          scope.field.stagedValue = cm.getValue();
          ctrl.$setViewValue(scope.field.stagedValue);
        } <span class="hljs-keyword">else</span> {
          scope.field.value = cm.getValue();
          ctrl.$setViewValue(scope.field.value);
        }
        <span class="hljs-keyword">if</span> (angular.isDefined(scope.snChange))
          scope.snChange();
      });
      cmi.on(<span class="hljs-string">'blur'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">cm</span>) </span>{
        <span class="hljs-keyword">if</span> (<span class="hljs-string">"stagedValue"</span> <span class="hljs-keyword">in</span> scope.field) {
          scope.field.stagedValue = cm.getValue();
          ctrl.$setViewValue(scope.field.stagedValue);
        } <span class="hljs-keyword">else</span> {
          scope.field.value = cm.getValue();
          ctrl.$setViewValue(scope.field.value);
        }
        <span class="hljs-keyword">if</span> (angular.isDefined(scope.snBlur))
          scope.snBlur();
      });
      scope.$watch(<span class="hljs-string">'snDisabled'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">newValue</span>) </span>{
        <span class="hljs-keyword">if</span> (angular.isDefined(newValue)) {
          cmi.setOption(<span class="hljs-string">'readOnly'</span>, newValue);
        }
      });
      cmi.on(<span class="hljs-string">"keyup"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">cm, event</span>) </span>{
        <span class="hljs-keyword">var</span> keyCode = (<span class="hljs-string">'which'</span> <span class="hljs-keyword">in</span> event) ? event.which : event.keyCode;
        <span class="hljs-keyword">var</span> ternTooltip = <span class="hljs-built_in">document</span>.getElementsByClassName(<span class="hljs-string">'CodeMirror-Tern-tooltip'</span>)[<span class="hljs-number">0</span>];
        <span class="hljs-keyword">if</span> (keyCode == <span class="hljs-number">190</span>)
          <span class="hljs-keyword">if</span> (event.shiftKey)
            <span class="hljs-keyword">return</span>;
          <span class="hljs-keyword">else</span>
            server.complete(cmi, server);
        <span class="hljs-keyword">if</span> (keyCode == <span class="hljs-number">57</span> &amp;&amp; <span class="hljs-built_in">window</span>.event.shiftKey &amp;&amp; ternTooltip)
          angular.element(ternTooltip).show();
        <span class="hljs-keyword">if</span> (keyCode == <span class="hljs-number">27</span> &amp;&amp; ternTooltip) {
          angular.element(ternTooltip).hide();
        }
      });
      cmi.on(<span class="hljs-string">"startCompletion"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">cm</span>) </span>{
        <span class="hljs-keyword">var</span> completion = cm.state.completionActive;
        completion.options.completeSingle = <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">var</span> pick = completion.pick;
        completion.pick = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">data, i</span>) </span>{
          <span class="hljs-keyword">var</span> completion = data.list[i];
          CodeMirror.signal(cm, <span class="hljs-string">"codemirror_hint_pick"</span>, {
            <span class="hljs-attr">data</span>: completion,
            <span class="hljs-attr">editor</span>: cm
          });
          pick.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>);
        }
      });
      cmi.on(<span class="hljs-string">"codemirror_hint_pick"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">i</span>) </span>{
        <span class="hljs-keyword">var</span> data = i.data.data;
        <span class="hljs-keyword">var</span> editor = i.editor;
        <span class="hljs-keyword">var</span> cur = editor.getCursor();
        <span class="hljs-keyword">var</span> token = data.type;
        <span class="hljs-keyword">if</span> (token &amp;&amp; token.indexOf(<span class="hljs-string">'fn('</span>) != <span class="hljs-number">-1</span>) {
          <span class="hljs-keyword">if</span> (editor.getTokenAt({
              <span class="hljs-attr">ch</span>: cur.ch + <span class="hljs-number">1</span>,
              <span class="hljs-attr">line</span>: cur.line
            }).string != <span class="hljs-string">'('</span>) {
            editor.replaceRange(<span class="hljs-string">'()'</span>, {
              <span class="hljs-attr">line</span>: cur.line,
              <span class="hljs-attr">ch</span>: cur.ch
            }, {
              <span class="hljs-attr">line</span>: cur.line,
              <span class="hljs-attr">ch</span>: cur.ch
            });
            <span class="hljs-keyword">if</span> (token &amp;&amp; token.substr(<span class="hljs-number">0</span>, <span class="hljs-number">4</span>) !== <span class="hljs-string">'fn()'</span> &amp;&amp; angular.element(<span class="hljs-string">'div.CodeMirror-Tern-tooltip'</span>)[<span class="hljs-number">0</span>]) {
              editor.execCommand(<span class="hljs-string">'goCharLeft'</span>);
              setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">var</span> ternTooltip = <span class="hljs-built_in">document</span>.getElementsByClassName(<span class="hljs-string">'CodeMirror-Tern-tooltip'</span>)[<span class="hljs-number">0</span>];
                <span class="hljs-keyword">if</span> (ternTooltip) {
                  angular.element(ternTooltip).show();
                }
              }, <span class="hljs-number">100</span>)
            }
          } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (token &amp;&amp; token.substr(<span class="hljs-number">0</span>, <span class="hljs-number">4</span>) !== <span class="hljs-string">'fn()'</span>)
            editor.execCommand(<span class="hljs-string">'goCharRight'</span>);
        }
      });

      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">initializeCodeMirror</span>(<span class="hljs-params">elem</span>) </span>{
        <span class="hljs-keyword">var</span> options = {
          <span class="hljs-attr">mode</span>: <span class="hljs-string">"javascript"</span>,
          <span class="hljs-attr">lineNumbers</span>: <span class="hljs-literal">true</span>,
          <span class="hljs-attr">lineWrapping</span>: <span class="hljs-literal">false</span>,
          <span class="hljs-attr">readOnly</span>: scope.snDisabled === <span class="hljs-literal">true</span>,
          <span class="hljs-attr">viewportMargin</span>: <span class="hljs-literal">Infinity</span>,
          <span class="hljs-attr">gutters</span>: [<span class="hljs-string">"CodeMirror-lint-markers"</span>],
          <span class="hljs-attr">lint</span>: {
            <span class="hljs-attr">asi</span>: <span class="hljs-literal">true</span>
          },
          <span class="hljs-attr">indentWithTabs</span>: <span class="hljs-literal">true</span>,
          <span class="hljs-attr">tabSize</span>: <span class="hljs-number">2</span>,
          <span class="hljs-attr">matchBrackets</span>: <span class="hljs-literal">true</span>,
          <span class="hljs-attr">autoCloseBrackets</span>: <span class="hljs-literal">true</span>,
          <span class="hljs-attr">theme</span>: <span class="hljs-string">"snc"</span>
        };
        <span class="hljs-keyword">if</span> (scope.options) {
          <span class="hljs-built_in">Object</span>.keys(scope.options).forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">key</span>) </span>{
            options[key] = scope.options[key];
          });
        }
        <span class="hljs-keyword">return</span> CodeMirror.fromTextArea(elem, options);
      }

      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setupTernServer</span>(<span class="hljs-params">data</span>) </span>{
        <span class="hljs-keyword">var</span> plugins = {};
        <span class="hljs-keyword">if</span> (scope.field.name === <span class="hljs-string">"client_script"</span>)
          plugins = {
            <span class="hljs-string">"angular"</span>: <span class="hljs-string">"./"</span>
          };
        server = <span class="hljs-keyword">new</span> CodeMirror.TernServer({
          <span class="hljs-attr">defs</span>: [data, defaultJSAutocomplete],
          <span class="hljs-attr">plugins</span>: plugins
        });
        cmi.setOption(<span class="hljs-string">"extraKeys"</span>, {
          <span class="hljs-string">"Ctrl-Space"</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">cm</span>) </span>{
            server.complete(cm);
          },
          <span class="hljs-string">"Ctrl-I"</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">cm</span>) </span>{
            server.showType(cm);
          },
          <span class="hljs-string">"Ctrl-O"</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">cm</span>) </span>{
            server.showDocs(cm);
          },
          <span class="hljs-string">"Alt-."</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">cm</span>) </span>{
            server.jumpToDef(cm);
          },
          <span class="hljs-string">"Alt-,"</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">cm</span>) </span>{
            server.jumpBack(cm);
          },
          <span class="hljs-string">"Ctrl-Q"</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">cm</span>) </span>{
            server.rename(cm);
          },
          <span class="hljs-string">"Ctrl-."</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">cm</span>) </span>{
            server.selectName(cm);
          }
        });
        cmi.on(<span class="hljs-string">"cursorActivity"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">cm</span>) </span>{
          server.updateArgHints(cm);
        });
      }
    }
  }
});
<span class="hljs-comment">/*! RESOURCE: /scripts/app.$sp/directive.spEditableField.js */</span>
angular.module(<span class="hljs-string">'sn.$sp'</span>).directive(<span class="hljs-string">'spEditableField'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">getTemplateUrl, glideFormFactory, $http, spUtil</span>) </span>{
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
    <span class="hljs-attr">templateUrl</span>: <span class="hljs-string">'sp_editable_field.xml'</span>,
    <span class="hljs-attr">scope</span>: {
      <span class="hljs-attr">fieldModel</span>: <span class="hljs-string">"="</span>,
      <span class="hljs-attr">table</span>: <span class="hljs-string">"@"</span>,
      <span class="hljs-attr">tableId</span>: <span class="hljs-string">"="</span>,
      <span class="hljs-attr">block</span>: <span class="hljs-string">"=?"</span>,
      <span class="hljs-attr">editableByUser</span>: <span class="hljs-string">"="</span>,
      <span class="hljs-attr">onChange</span>: <span class="hljs-string">"=?"</span>,
      <span class="hljs-attr">onSubmit</span>: <span class="hljs-string">"=?"</span>,
      <span class="hljs-attr">asyncSubmitValidation</span>: <span class="hljs-string">"=?"</span>
    },
    <span class="hljs-attr">transclude</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">controller</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$scope</span>) </span>{
      <span class="hljs-keyword">var</span> REST_API_PATH = <span class="hljs-string">"/api/now/v1/ui/table_edit/"</span>;
      <span class="hljs-keyword">var</span> g_form;
      <span class="hljs-keyword">this</span>.createShadowModel = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        $scope.shadowModel = angular.copy($scope.fieldModel);
        $scope.shadowModel.table = $scope.table;
        $scope.shadowModel.sys_id = $scope.tableId;
        $scope.blockDisplay = $scope.block ? {
          <span class="hljs-attr">display</span>: <span class="hljs-string">'block'</span>
        } : {};
        $scope.editable = !$scope.shadowModel.readonly &amp;&amp; $scope.editableByUser;
        $scope.fieldID = $scope.table + <span class="hljs-string">"-"</span> + $scope.shadowModel.name.replace(<span class="hljs-string">'.'</span>, <span class="hljs-string">'_dot_'</span>) + <span class="hljs-string">"-"</span> + $scope.tableId;
        initGlideForm();
      };
      <span class="hljs-keyword">this</span>.createShadowModel();
      $scope.getGlideForm = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> g_form;
      };
      $scope.saveForm = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">if</span> (g_form)
          g_form.submit();
        <span class="hljs-keyword">if</span> (angular.isDefined($scope.asyncSubmitValidation)) {
          $scope.asyncSubmitValidation(g_form, $scope.shadowModel).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">result</span>) </span>{
            <span class="hljs-keyword">if</span> (result)
              completeSave();
          });
        }
      };

      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">completeSave</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> url = REST_API_PATH + $scope.table + <span class="hljs-string">"?sysparm_records="</span> + $scope.tableId + <span class="hljs-string">"&amp;sysparm_view=default&amp;sysparm_fields="</span> + $scope.shadowModel.name;
        <span class="hljs-keyword">var</span> data = {};
        data[$scope.shadowModel.name] = $scope.shadowModel.value;
        $http.put(url, data).success(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>) </span>{
          <span class="hljs-keyword">if</span> (data.result &amp;&amp; <span class="hljs-built_in">Array</span>.isArray(data.result.records))
            updateFieldModel(data.result.records);
          $scope.closePopover();
        });
      }

      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">updateFieldModel</span>(<span class="hljs-params">records</span>) </span>{
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; records.length; i++) {
          <span class="hljs-keyword">var</span> r = records[i];
          <span class="hljs-keyword">if</span> (r.data &amp;&amp; $scope.fieldModel.name <span class="hljs-keyword">in</span> r.data) {
            <span class="hljs-keyword">var</span> updated = r.data[$scope.fieldModel.name];
            $scope.fieldModel.value = updated.value;
            $scope.fieldModel.displayValue = updated.display_value;
          }
        }
      }

      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">initGlideForm</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">if</span> (g_form)
          g_form.$private.events.cleanup();
        <span class="hljs-keyword">var</span> uiMessageHandler = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">g_form, type, message</span>) </span>{
          <span class="hljs-keyword">switch</span> (type) {
            <span class="hljs-keyword">case</span> <span class="hljs-string">'infoMessage'</span>:
              spUtil.addInfoMessage(message);
              <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">'errorMessage'</span>:
              spUtil.addErrorMessage(message);
              <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">'clearMessages'</span>:
              <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">default</span>:
              <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
          }
        };
        g_form = glideFormFactory.create($scope, $scope.table, $scope.tableId, [$scope.shadowModel], <span class="hljs-literal">null</span>, {
          <span class="hljs-attr">uiMessageHandler</span>: uiMessageHandler
        });
        $scope.$emit(<span class="hljs-string">"spEditableField.gForm.initialized"</span>, g_form, $scope.shadowModel);
        <span class="hljs-keyword">if</span> (angular.isDefined($scope.onChange))
          g_form.$private.events.on(<span class="hljs-string">"change"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">fieldName, oldValue, newValue</span>) </span>{
            <span class="hljs-keyword">return</span> $scope.onChange.call($scope.onChange, g_form, $scope.shadowModel, oldValue, newValue);
          });
        <span class="hljs-keyword">if</span> (angular.isDefined($scope.onSubmit))
          g_form.$private.events.on(<span class="hljs-string">"submit"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">return</span> $scope.onSubmit.call($scope.onSubmit, g_form, $scope.shadowModel);
          });
        <span class="hljs-keyword">if</span> (!angular.isDefined($scope.asyncSubmitValidation)) {
          g_form.$private.events.on(<span class="hljs-string">'submitted'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
            completeSave();
          });
        }
      }
    },
    <span class="hljs-attr">link</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">scope, el, attrs, ctrl</span>) </span>{
      scope.closePopover = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">if</span> (scope.shadowModel.popoverIsOpen)
          ctrl.createShadowModel();
        scope.shadowModel.popoverIsOpen = <span class="hljs-literal">false</span>;
      }
      $(<span class="hljs-string">'body'</span>).on(<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) </span>{
        <span class="hljs-keyword">var</span> $et = $(event.target);
        <span class="hljs-keyword">if</span> (!($et.closest(<span class="hljs-string">".popover-"</span> + scope.fieldID).length ||
            $et.closest(<span class="hljs-string">".popover-trigger-"</span> + scope.fieldID).length)) {
          scope.$evalAsync(<span class="hljs-string">'closePopover()'</span>);
        }
      })
      scope.$on(<span class="hljs-string">'sp.spFormField.rendered'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e, element, input</span>) </span>{
        input.focus();
      })
    }
  }
});
angular.module(<span class="hljs-string">'sn.$sp'</span>).directive(<span class="hljs-string">'spEditableField2'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">getTemplateUrl, glideFormFactory, $http, spUtil, glideFormFieldFactory</span>) </span>{
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
    <span class="hljs-attr">templateUrl</span>: <span class="hljs-string">'sp_editable_field.xml'</span>,
    <span class="hljs-attr">scope</span>: {
      <span class="hljs-attr">fieldModel</span>: <span class="hljs-string">"="</span>,
      <span class="hljs-attr">table</span>: <span class="hljs-string">"@"</span>,
      <span class="hljs-attr">tableId</span>: <span class="hljs-string">"="</span>,
      <span class="hljs-attr">block</span>: <span class="hljs-string">"=?"</span>,
      <span class="hljs-attr">editableByUser</span>: <span class="hljs-string">"="</span>,
      <span class="hljs-attr">onChange</span>: <span class="hljs-string">"=?"</span>,
      <span class="hljs-attr">onSubmit</span>: <span class="hljs-string">"=?"</span>,
      <span class="hljs-attr">label</span>: <span class="hljs-string">"@?"</span>
    },
    <span class="hljs-attr">transclude</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">controller</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$scope</span>) </span>{
      $scope.v2 = <span class="hljs-literal">true</span>;
      <span class="hljs-keyword">var</span> REST_API_PATH = <span class="hljs-string">"/api/now/v1/ui/table_edit/"</span>;
      <span class="hljs-keyword">var</span> g_form;
      $scope.fieldModel = $scope.fieldModel || {};
      <span class="hljs-keyword">if</span> (angular.isDefined($scope.label))
        $scope.fieldModel.label = $scope.label;
      $scope.editable = !$scope.fieldModel.readonly &amp;&amp; $scope.editableByUser;
      $scope.fieldID = $scope.table + <span class="hljs-string">"-"</span> + $scope.fieldModel.name + <span class="hljs-string">"-"</span> + $scope.tableId;
      initGlideForm();
      $scope.getGlideForm = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> g_form;
      };
      $scope.$on(<span class="hljs-string">'sp.spEditableField.save'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e, fieldModel</span>) </span>{
        <span class="hljs-keyword">if</span> (fieldModel == $scope.fieldModel)
          $scope.saveForm();
      });
      $scope.saveForm = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">if</span> (g_form)
          g_form.submit();
      };

      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">completeSave</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> url = REST_API_PATH + $scope.table + <span class="hljs-string">"?sysparm_records="</span> + $scope.tableId + <span class="hljs-string">"&amp;sysparm_view=default&amp;sysparm_fields="</span> + $scope.fieldModel.name;
        <span class="hljs-keyword">var</span> data = {};
        data[$scope.fieldModel.name] = $scope.fieldModel.value;
        $http.put(url, data)
          .success(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>) </span>{
            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Field update successful"</span>, data);
          })
          .error(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">reason</span>) </span>{
            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Field update failure"</span>, reason);
          });
      }

      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">initGlideForm</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">if</span> (g_form)
          g_form.$private.events.cleanup();
        <span class="hljs-keyword">var</span> uiMessageHandler = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">g_form, type, message</span>) </span>{
          <span class="hljs-keyword">switch</span> (type) {
            <span class="hljs-keyword">case</span> <span class="hljs-string">'addInfoMessage'</span>:
              spUtil.addInfoMessage(message);
              <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">'addErrorMessage'</span>:
              spUtil.addErrorMessage(message);
              <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">'clearMessages'</span>:
              <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">default</span>:
          }
        };
        g_form = glideFormFactory.create($scope, $scope.table, $scope.tableId, [$scope.fieldModel], <span class="hljs-literal">null</span>, {
          <span class="hljs-attr">uiMessageHandler</span>: uiMessageHandler
        });
        $scope.$emit(<span class="hljs-string">"spEditableField.gForm.initialized"</span>, g_form, $scope.fieldModel);
        <span class="hljs-keyword">if</span> (angular.isDefined($scope.onChange)) {
          g_form.$private.events.on(<span class="hljs-string">"change"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">fieldName, oldValue, newValue</span>) </span>{
            <span class="hljs-keyword">return</span> $scope.onChange.call($scope.onChange, g_form, $scope.fieldModel, oldValue, newValue);
          });
        }
        <span class="hljs-keyword">if</span> (angular.isDefined($scope.onSubmit))
          g_form.$private.events.on(<span class="hljs-string">"submit"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">return</span> $scope.onSubmit.call($scope.onSubmit, g_form);
          });
        g_form.$private.events.on(<span class="hljs-string">'submitted'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
          completeSave();
        });
      }
    }
  }
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.$sp/directive.spFieldListElement.js */</span>
angular.module(<span class="hljs-string">'sn.$sp'</span>).directive(<span class="hljs-string">'snFieldListElement'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">getTemplateUrl, $http, urlTools, $timeout, $sanitize, i18n, $filter, nowServer</span>) </span>{
<span class="hljs-meta">  "use strict"</span>;
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
    <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">scope</span>: {
      <span class="hljs-attr">field</span>: <span class="hljs-string">'='</span>,
      <span class="hljs-attr">snChange</span>: <span class="hljs-string">'&amp;'</span>,
      <span class="hljs-attr">getGlideForm</span>: <span class="hljs-string">'&amp;glideForm'</span>,
      <span class="hljs-attr">snDisabled</span>: <span class="hljs-string">'='</span>
    },
    <span class="hljs-attr">template</span>: <span class="hljs-string">'&lt;input type="text" ng-disabled="snDisabled" style="min-width: 150px;" name="{{field.name}}" ng-model="field.value" /&gt;'</span>,
    <span class="hljs-attr">controller</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$scope</span>) </span>{
      $scope.table = $scope.field.ed.dependent_value;
      $scope.$watch(<span class="hljs-string">'field.dependentValue'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">newVal, oldVal</span>) </span>{
        <span class="hljs-keyword">if</span> (!angular.isDefined(newVal))
          <span class="hljs-keyword">return</span>;
        <span class="hljs-keyword">if</span> (newVal != oldVal)
          <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Should have changed tables to "</span> + newVal);
        $scope.table = $scope.field.dependentValue;
        <span class="hljs-keyword">var</span> src = nowServer.getURL(<span class="hljs-string">'table_fields'</span>, <span class="hljs-string">'exclude_formatters=true&amp;fd_table='</span> + newVal);
        $http.post(src).success(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>) </span>{
          $scope.field.choices = response;
        });
      });
    },
    <span class="hljs-attr">link</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">scope, element</span>) </span>{
      <span class="hljs-keyword">var</span> orderBy = $filter(<span class="hljs-string">'orderBy'</span>);
      <span class="hljs-keyword">var</span> isExecuting = <span class="hljs-literal">false</span>;
      <span class="hljs-keyword">var</span> fieldCache = {};
      <span class="hljs-keyword">var</span> data = [];
      <span class="hljs-keyword">var</span> term = <span class="hljs-string">""</span>;
      <span class="hljs-keyword">var</span> initTimeout = <span class="hljs-literal">null</span>;
      <span class="hljs-keyword">var</span> value = scope.field.value;
      <span class="hljs-keyword">var</span> oldValue = scope.field.value;
      <span class="hljs-keyword">var</span> $select;
      <span class="hljs-keyword">var</span> previousScrollTop;
      <span class="hljs-keyword">var</span> select2Helpers = {
        <span class="hljs-attr">query</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">q</span>) </span>{
          term = q.term;
          <span class="hljs-keyword">if</span> (data.length == <span class="hljs-number">0</span>) {
            getFieldsForTable(scope.table, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">tableName, fields</span>) </span>{
              data = fields;
              filterData(q);
            });
          } <span class="hljs-keyword">else</span>
            filterData(q);
        },
        <span class="hljs-attr">initSelection</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">elem, callback</span>) </span>{
          <span class="hljs-keyword">if</span> (scope.field.displayValue) {
            <span class="hljs-keyword">var</span> items = [];
            <span class="hljs-keyword">var</span> values = scope.field.value.split(<span class="hljs-string">','</span>);
            <span class="hljs-keyword">var</span> displayValues = scope.field.displayValue.split(<span class="hljs-string">','</span>);
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; values.length; i++)
              items.push({
                <span class="hljs-attr">id</span>: values[i],
                <span class="hljs-attr">text</span>: displayValues[i]
              });
            callback(items);
          } <span class="hljs-keyword">else</span>
            callback([]);
        },
        <span class="hljs-attr">formatResult</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">object, container, query</span>) </span>{
          <span class="hljs-keyword">var</span> row = object.text;
          <span class="hljs-keyword">if</span> (object.reference &amp;&amp; !object.children)
            row += <span class="hljs-string">"&lt;span style='float: right' class='expand fa fa-chevron-right' data-id='"</span> + object.id + <span class="hljs-string">"' data-reference='"</span> + object.reference + <span class="hljs-string">"'&gt;&lt;/span&gt;"</span>;
          <span class="hljs-keyword">return</span> row;
        }
      };
      <span class="hljs-keyword">var</span> config = {
        <span class="hljs-attr">containerCssClass</span>: <span class="hljs-string">'select2-reference ng-form-element'</span>,
        <span class="hljs-attr">placeholder</span>: <span class="hljs-string">'    '</span>,
        <span class="hljs-attr">formatSearching</span>: <span class="hljs-string">''</span>,
        <span class="hljs-attr">allowClear</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">query</span>: select2Helpers.query,
        <span class="hljs-attr">initSelection</span>: select2Helpers.initSelection,
        <span class="hljs-attr">formatResult</span>: select2Helpers.formatResult,
        <span class="hljs-attr">closeOnSelect</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">multiple</span>: <span class="hljs-literal">true</span>
      };

      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">filterData</span>(<span class="hljs-params">q</span>) </span>{
        <span class="hljs-keyword">var</span> r = {
          <span class="hljs-attr">results</span>: []
        };
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> c <span class="hljs-keyword">in</span> data) {
          <span class="hljs-keyword">var</span> row = data[c];
          <span class="hljs-keyword">if</span> (q.term.length == <span class="hljs-number">0</span> || row.text.toUpperCase().indexOf(q.term.toUpperCase()) &gt;= <span class="hljs-number">0</span> || row.id.toUpperCase().indexOf(q.term.toUpperCase()) &gt;= <span class="hljs-number">0</span>)
            r.results.push(row);
        }
        q.callback(r);
      }

      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">init</span>(<span class="hljs-params"></span>) </span>{
        $timeout.cancel(initTimeout);
        initTimeout = $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
          i18n.getMessage(<span class="hljs-string">'Searching...'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">searchingMsg</span>) </span>{
            config.formatSearching = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
              <span class="hljs-keyword">return</span> searchingMsg;
            };
          });
          element.css(<span class="hljs-string">"opacity"</span>, <span class="hljs-number">1</span>);
          element.select2(<span class="hljs-string">"destroy"</span>);
          $select = element.select2(config);
          $select.bind(<span class="hljs-string">"select2-open"</span>, onDropdownShow);
          $select.bind(<span class="hljs-string">"select2-close"</span>, onDropdownClose);
          $select.bind(<span class="hljs-string">"select2-selecting"</span>, onSelecting);
          $select.bind(<span class="hljs-string">"select2-removing"</span>, onRemoving);
          $select.bind(<span class="hljs-string">"change"</span>, onChange);
          $select.bind(<span class="hljs-string">"select2-loaded"</span>, onResultsLoaded);
          <span class="hljs-keyword">var</span> sortable = <span class="hljs-keyword">new</span> Sortable($select.select2(<span class="hljs-string">"container"</span>).find(<span class="hljs-string">"ul.select2-choices"</span>).get(<span class="hljs-number">0</span>), {
            <span class="hljs-attr">onStart</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
              $select.select2(<span class="hljs-string">"onSortStart"</span>);
            },
            <span class="hljs-attr">onEnd</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
              $select.select2(<span class="hljs-string">"onSortEnd"</span>);
            }
          });
        });
      }

      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">expandHandler</span>(<span class="hljs-params">e</span>) </span>{
        e.preventDefault();
        e.stopPropagation();
        <span class="hljs-keyword">if</span> (e.type == <span class="hljs-string">'click'</span>) {
          <span class="hljs-keyword">var</span> $el = angular.element(<span class="hljs-keyword">this</span>);
          previousScrollTop = $el.parents(<span class="hljs-string">'ul.select2-results'</span>).scrollTop();
          <span class="hljs-keyword">var</span> d = $el.data();
          <span class="hljs-keyword">var</span> targetRow = getDataRowByFieldName(d.id);
          getFieldsForTable(d.reference, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">tableName, refFields</span>) </span>{
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; refFields.length; i++)
              refFields[i].id = d.id + <span class="hljs-string">'.'</span> + refFields[i].id;
            targetRow.children = refFields;
            $select.select2(<span class="hljs-string">"search"</span>, term);
          });
        }
      };

      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getDataRowByFieldName</span>(<span class="hljs-params">fieldName</span>) </span>{
        <span class="hljs-keyword">var</span> fieldNames = fieldName.split(<span class="hljs-string">'.'</span>);
        <span class="hljs-keyword">var</span> row = getDataRowByFieldNamePart(fieldNames[<span class="hljs-number">0</span>], data);
        <span class="hljs-keyword">if</span> (fieldNames.length &gt; <span class="hljs-number">1</span>)
          <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">1</span>; i &lt; fieldNames.length; i++)
            row = getDataRowByFieldNamePart(fieldNames[i], row.children);
        <span class="hljs-keyword">return</span> row;
      }

      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getDataRowByFieldNamePart</span>(<span class="hljs-params">fieldNamePart, fieldArr</span>) </span>{
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; fieldArr.length; i++)
          <span class="hljs-keyword">if</span> (fieldArr[i].fieldName == fieldNamePart) <span class="hljs-keyword">return</span> fieldArr[i];
      }

      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getFieldsForTable</span>(<span class="hljs-params">tableName, callback</span>) </span>{
        <span class="hljs-keyword">if</span> (tableName <span class="hljs-keyword">in</span> fieldCache) {
          <span class="hljs-keyword">var</span> fields = getOrderedFieldsFromCache(tableName);
          callback.call(<span class="hljs-keyword">this</span>, tableName, fields);
          <span class="hljs-keyword">return</span>;
        }
        $http.get(<span class="hljs-string">'/api/now/ui/meta/'</span> + tableName).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">r</span>) </span>{
          <span class="hljs-keyword">var</span> fields = [];
          <span class="hljs-keyword">if</span> (r.data &amp;&amp; r.data.result &amp;&amp; r.data.result.columns) {
            fieldCache[tableName] = r.data.result.columns;
            fields = getOrderedFieldsFromCache(tableName);
          }
          callback.call(<span class="hljs-keyword">this</span>, tableName, fields);
        });

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getOrderedFieldsFromCache</span>(<span class="hljs-params">tableName</span>) </span>{
          <span class="hljs-keyword">var</span> col, cols = [],
            fields = fieldCache[tableName];
          <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> c <span class="hljs-keyword">in</span> fields) {
            col = fields[c];
            cols.push({
              <span class="hljs-attr">fieldName</span>: col.name,
              <span class="hljs-attr">id</span>: col.name,
              <span class="hljs-attr">text</span>: col.label,
              <span class="hljs-attr">reference</span>: col.reference
            });
          }
          <span class="hljs-keyword">return</span> orderBy(cols, <span class="hljs-string">'text'</span>, <span class="hljs-literal">false</span>);
        }
      }

      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onResultsLoaded</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">if</span> (!previousScrollTop)
          <span class="hljs-keyword">return</span>;
        $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
          angular.element(<span class="hljs-string">'ul.select2-results'</span>).scrollTop(previousScrollTop);
          previousScrollTop = <span class="hljs-literal">null</span>;
        });
      }

      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onDropdownShow</span>(<span class="hljs-params"></span>) </span>{
        angular.element(<span class="hljs-string">'ul.select2-results'</span>).on(<span class="hljs-string">'mousedown click mouseup'</span>, <span class="hljs-string">'span.expand'</span>, expandHandler);
      }

      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onDropdownClose</span>(<span class="hljs-params"></span>) </span>{
        angular.element(<span class="hljs-string">'ul.select2-results'</span>).off(<span class="hljs-string">'mousedown click mouseup'</span>, <span class="hljs-string">'span.expand'</span>, expandHandler);
      }

      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onChange</span>(<span class="hljs-params">e</span>) </span>{
        setValue(e.val, e);
      }

      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onSelecting</span>(<span class="hljs-params">e</span>) </span>{
        <span class="hljs-keyword">var</span> selectedItem = e.choice;
        <span class="hljs-keyword">if</span> (selectedItem[<span class="hljs-string">'id'</span>] != <span class="hljs-string">''</span>) {
          <span class="hljs-keyword">var</span> values = scope.field.value == <span class="hljs-string">''</span> ? [] : scope.field.value.split(<span class="hljs-string">','</span>);
          values.push(selectedItem[<span class="hljs-string">'id'</span>]);
          setValue(values, e);
        }
      }

      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onRemoving</span>(<span class="hljs-params">e</span>) </span>{
        <span class="hljs-keyword">var</span> removed = e.choice;
        <span class="hljs-keyword">var</span> values = scope.field.value.split(<span class="hljs-string">','</span>);
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = values.length - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; i--) {
          <span class="hljs-keyword">if</span> (removed[<span class="hljs-string">'id'</span>] == values[i]) {
            values.splice(i, <span class="hljs-number">1</span>);
            <span class="hljs-keyword">break</span>;
          }
        }
        setValue(values, e);
      }

      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setValue</span>(<span class="hljs-params">values, e</span>) </span>{
        isExecuting = <span class="hljs-literal">true</span>;
        oldValue = scope.field.value;
        scope.field.value = scope.field.displayValue = values.join(<span class="hljs-string">','</span>);
        e.preventDefault();
        $select.select2(<span class="hljs-string">'val'</span>, scope.field.value.split(<span class="hljs-string">','</span>));
        scope.$apply(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
          <span class="hljs-keyword">if</span> (scope.snChange)
            scope.snChange({
              <span class="hljs-attr">field</span>: scope.field,
              <span class="hljs-attr">newValue</span>: scope.field.value,
              <span class="hljs-attr">displayValue</span>: scope.field.displayValue,
              <span class="hljs-attr">oldValue</span>: oldValue
            });
          isExecuting = <span class="hljs-literal">false</span>;
        });
      }
      scope.$watch(<span class="hljs-string">"field.value"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">newValue</span>) </span>{
        <span class="hljs-keyword">if</span> (isExecuting) <span class="hljs-keyword">return</span>;
        <span class="hljs-keyword">if</span> (angular.isDefined(newValue) &amp;&amp; $select) {
          $select.select2(<span class="hljs-string">'val'</span>, newValue.split(<span class="hljs-string">','</span>)).select2(<span class="hljs-string">'close'</span>);
        }
      });
      init();
    }
  };
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.$sp/directive.spReferenceElement.js */</span>
angular.module(<span class="hljs-string">'sn.$sp'</span>).directive(<span class="hljs-string">'spReferenceElement'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$timeout, $http, urlTools, filterExpressionParser, $sanitize, i18n, spIs</span>) </span>{
<span class="hljs-meta">  "use strict"</span>;
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
    <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">scope</span>: {
      <span class="hljs-attr">ed</span>: <span class="hljs-string">"=?"</span>,
      <span class="hljs-attr">field</span>: <span class="hljs-string">"="</span>,
      <span class="hljs-attr">refTable</span>: <span class="hljs-string">"=?"</span>,
      <span class="hljs-attr">refId</span>: <span class="hljs-string">"=?"</span>,
      <span class="hljs-attr">snOptions</span>: <span class="hljs-string">"=?"</span>,
      <span class="hljs-attr">snOnBlur</span>: <span class="hljs-string">"&amp;"</span>,
      <span class="hljs-attr">snOnClose</span>: <span class="hljs-string">"&amp;"</span>,
      <span class="hljs-attr">minimumInputLength</span>: <span class="hljs-string">"@"</span>,
      <span class="hljs-attr">snDisabled</span>: <span class="hljs-string">"="</span>,
      <span class="hljs-attr">dropdownCssClass</span>: <span class="hljs-string">"@"</span>,
      <span class="hljs-attr">formatResultCssClass</span>: <span class="hljs-string">"&amp;"</span>,
      <span class="hljs-attr">displayColumn</span>: <span class="hljs-string">"@"</span>,
      <span class="hljs-attr">recordValues</span>: <span class="hljs-string">'&amp;'</span>,
      <span class="hljs-attr">getGlideForm</span>: <span class="hljs-string">'&amp;glideForm'</span>,
      <span class="hljs-attr">domain</span>: <span class="hljs-string">"@"</span>,
      <span class="hljs-attr">snSelectWidth</span>: <span class="hljs-string">'@'</span>,
    },
    <span class="hljs-attr">template</span>: <span class="hljs-string">'&lt;input type="text" name="{{field.name}}" ng-disabled="snDisabled" style="min-width: 150px;" /&gt;'</span>,
    <span class="hljs-attr">link</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">scope, element, attrs, ctrl</span>) </span>{
      scope.ed = scope.ed || scope.field.ed;
      scope.selectWidth = scope.snSelectWidth || <span class="hljs-string">'100%'</span>;
      element.css(<span class="hljs-string">"opacity"</span>, <span class="hljs-number">0</span>);
      <span class="hljs-keyword">var</span> fireReadyEvent = <span class="hljs-literal">true</span>;
      <span class="hljs-keyword">var</span> g_form;
      <span class="hljs-keyword">var</span> displayColumns;
      <span class="hljs-keyword">var</span> refAutoCompleter;
      <span class="hljs-keyword">var</span> refOrderBy;
      <span class="hljs-keyword">var</span> field = scope.field;
      <span class="hljs-keyword">var</span> isMultiple = scope.snOptions &amp;&amp; scope.snOptions.multiple === <span class="hljs-literal">true</span>;
      <span class="hljs-keyword">if</span> (angular.isDefined(scope.getGlideForm))
        g_form = scope.getGlideForm();
      <span class="hljs-keyword">var</span> fieldAttributes = {};
      <span class="hljs-keyword">if</span> (angular.isDefined(scope.field) &amp;&amp; angular.isDefined(scope.field.attributes) &amp;&amp; <span class="hljs-keyword">typeof</span> scope.ed.attributes == <span class="hljs-string">'undefined'</span>)
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">Array</span>.isArray(scope.field.attributes))
          fieldAttributes = scope.field.attributes;
        <span class="hljs-keyword">else</span>
          fieldAttributes = parseAttributes(scope.field.attributes);
      <span class="hljs-keyword">else</span>
        fieldAttributes = parseAttributes(scope.ed.attributes);
      <span class="hljs-keyword">if</span> (angular.isDefined(fieldAttributes[<span class="hljs-string">'ref_ac_columns'</span>]))
        displayColumns = fieldAttributes[<span class="hljs-string">'ref_ac_columns'</span>];
      <span class="hljs-keyword">if</span> (angular.isDefined(fieldAttributes[<span class="hljs-string">'ref_auto_completer'</span>]))
        refAutoCompleter = fieldAttributes[<span class="hljs-string">'ref_auto_completer'</span>];
      <span class="hljs-keyword">else</span>
        refAutoCompleter = <span class="hljs-string">"AJAXReferenceCompleter"</span>;
      <span class="hljs-keyword">if</span> (angular.isDefined(fieldAttributes[<span class="hljs-string">'ref_ac_order_by'</span>]))
        refOrderBy = fieldAttributes[<span class="hljs-string">'ref_ac_order_by'</span>];
      <span class="hljs-keyword">var</span> s2Helpers = {
        <span class="hljs-attr">formatSelection</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">item</span>) </span>{
          <span class="hljs-keyword">return</span> $sanitize(getDisplayValue(item));
        },
        <span class="hljs-attr">formatResult</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">item</span>) </span>{
          <span class="hljs-keyword">var</span> displayValues = getDisplayValues(item);
          <span class="hljs-keyword">if</span> (displayValues.length == <span class="hljs-number">1</span>)
            <span class="hljs-keyword">return</span> $sanitize(displayValues[<span class="hljs-number">0</span>]);
          <span class="hljs-keyword">if</span> (displayValues.length &gt; <span class="hljs-number">1</span>) {
            <span class="hljs-keyword">var</span> width = <span class="hljs-number">100</span> / displayValues.length;
            <span class="hljs-keyword">var</span> markup = <span class="hljs-string">""</span>;
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; displayValues.length; i++)
              markup += <span class="hljs-string">"&lt;div style='width: "</span> + width + <span class="hljs-string">"%;' class='select2-result-cell'&gt;"</span> + $sanitize(displayValues[i]) + <span class="hljs-string">"&lt;/div&gt;"</span>;
            <span class="hljs-keyword">return</span> markup;
          }
          <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>;
        },
        <span class="hljs-attr">search</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">queryParams</span>) </span>{
          <span class="hljs-keyword">var</span> url = urlTools.getURL(<span class="hljs-string">'sp_ref_list_data'</span>);
          <span class="hljs-keyword">return</span> $http.post(url, queryParams.data).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>) </span>{
            queryParams.success(response);
          });
        },
        <span class="hljs-attr">initSelection</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">elem, callback</span>) </span>{
          <span class="hljs-keyword">if</span> (scope.field.displayValue) {
            <span class="hljs-keyword">if</span> (isMultiple) {
              <span class="hljs-keyword">var</span> items = [];
              <span class="hljs-keyword">var</span> values = scope.field.value.split(<span class="hljs-string">','</span>);
              <span class="hljs-keyword">var</span> displayValues = scope.field.display_value_list;
              <span class="hljs-keyword">if</span> (<span class="hljs-built_in">Array</span>.isArray(scope.field.displayValue)) {
                displayValues.length = <span class="hljs-number">0</span>;
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i <span class="hljs-keyword">in</span> scope.field.displayValue)
                  displayValues[i] = scope.field.displayValue[i];
                scope.field.displayValue = displayValues.join(g_glide_list_separator);
              } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (values.length == <span class="hljs-number">1</span>) {
                displayValues.length = <span class="hljs-number">0</span>;
                displayValues[<span class="hljs-number">0</span>] = scope.field.displayValue;
              } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (scope.field.displayValue != displayValues.join(g_glide_list_separator)) {
                displayValues.length = <span class="hljs-number">0</span>;
                <span class="hljs-keyword">var</span> split = scope.field.displayValue.split(<span class="hljs-string">','</span>);
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i <span class="hljs-keyword">in</span> split)
                  displayValues[i] = split[i];
              }
              <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; values.length; i++) {
                items.push({
                  <span class="hljs-attr">sys_id</span>: values[i],
                  <span class="hljs-attr">name</span>: displayValues[i]
                });
              }
              callback(items);
            } <span class="hljs-keyword">else</span> {
              callback({
                <span class="hljs-attr">sys_id</span>: scope.field.value,
                <span class="hljs-attr">name</span>: scope.field.displayValue
              });
            }
          } <span class="hljs-keyword">else</span>
            callback([]);
        },
        <span class="hljs-attr">onSelecting</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
          <span class="hljs-keyword">var</span> selectedItem = e.choice;
          <span class="hljs-keyword">if</span> (<span class="hljs-string">'sys_id'</span> <span class="hljs-keyword">in</span> selectedItem) {
            <span class="hljs-keyword">var</span> values = field.value == <span class="hljs-string">''</span> ? [] : field.value.split(<span class="hljs-string">','</span>);
            <span class="hljs-keyword">var</span> displayValues = field.display_value_list;
            values.push(selectedItem.sys_id);
            displayValues.push(getDisplayValue(selectedItem));
            g_form.setValue(field.name, values.join(<span class="hljs-string">','</span>), displayValues.join(g_glide_list_separator));
            e.preventDefault();
            element.select2(<span class="hljs-string">'val'</span>, values).select2(<span class="hljs-string">'close'</span>);
          }
        },
        <span class="hljs-attr">onRemoving</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
          <span class="hljs-keyword">var</span> removed = e.choice;
          <span class="hljs-keyword">var</span> values = field.value.split(<span class="hljs-string">','</span>);
          <span class="hljs-keyword">var</span> displayValues = field.display_value_list;
          <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = values.length - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; i--) {
            <span class="hljs-keyword">if</span> (removed.sys_id == values[i]) {
              values.splice(i, <span class="hljs-number">1</span>);
              displayValues.splice(i, <span class="hljs-number">1</span>);
              <span class="hljs-keyword">break</span>;
            }
          }
          g_form.setValue(field.name, values.join(<span class="hljs-string">','</span>), displayValues.join(g_glide_list_separator));
          e.preventDefault();
          element.select2(<span class="hljs-string">'val'</span>, values);
        },
        <span class="hljs-attr">select2Change</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
          e.stopImmediatePropagation();
          <span class="hljs-keyword">if</span> (e.added) {
            <span class="hljs-keyword">var</span> selectedItem = e.added;
            <span class="hljs-keyword">var</span> value = selectedItem.sys_id;
            <span class="hljs-keyword">var</span> displayValue = value ? getDisplayValue(selectedItem) : <span class="hljs-string">''</span>;
            <span class="hljs-keyword">if</span> (scope.field[<span class="hljs-string">'_cat_variable'</span>] === <span class="hljs-literal">true</span> &amp;&amp; (<span class="hljs-string">'price'</span> <span class="hljs-keyword">in</span> selectedItem || <span class="hljs-string">'recurring_price'</span> <span class="hljs-keyword">in</span> selectedItem))
              setPrice(selectedItem.price, selectedItem.recurring_price);
            g_form.setValue(scope.field.name, value, displayValue);
          } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (e.removed) {
            <span class="hljs-keyword">if</span> (scope.field[<span class="hljs-string">'_cat_variable'</span>] === <span class="hljs-literal">true</span>)
              setPrice(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
            g_form.clearValue(scope.field.name);
          }
        }
      };
      <span class="hljs-keyword">var</span> config = {
        <span class="hljs-attr">width</span>: scope.selectWidth,
        <span class="hljs-attr">minimumInputLength</span>: scope.minimumInputLength ? <span class="hljs-built_in">parseInt</span>(scope.minimumInputLength, <span class="hljs-number">10</span>) : <span class="hljs-number">0</span>,
        <span class="hljs-attr">containerCssClass</span>: <span class="hljs-string">'select2-reference ng-form-element'</span>,
        <span class="hljs-attr">placeholder</span>: <span class="hljs-string">'   '</span>,
        <span class="hljs-attr">formatSearching</span>: <span class="hljs-string">''</span>,
        <span class="hljs-attr">allowClear</span>: attrs.allowClear !== <span class="hljs-string">'false'</span>,
        <span class="hljs-attr">id</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">item</span>) </span>{
          <span class="hljs-keyword">return</span> item.sys_id;
        },
        <span class="hljs-attr">sortResults</span>: (scope.snOptions &amp;&amp; scope.snOptions.sortResults) ? scope.snOptions.sortResults : <span class="hljs-literal">undefined</span>,
        <span class="hljs-attr">ajax</span>: {
          <span class="hljs-attr">quietMillis</span>: NOW.ac_wait_time,
          <span class="hljs-attr">data</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">filterText, page</span>) </span>{
            <span class="hljs-keyword">var</span> filterExpression = filterExpressionParser.parse(filterText, scope.ed.defaultOperator);
            <span class="hljs-keyword">var</span> q = <span class="hljs-string">''</span>;
            <span class="hljs-keyword">var</span> columnsToSearch = getReferenceColumnsToSearch();
            <span class="hljs-keyword">var</span> queryArr = [];
            <span class="hljs-keyword">var</span> query;
            columnsToSearch.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">colToSearch</span>) </span>{
              query = <span class="hljs-string">""</span>;
              <span class="hljs-keyword">if</span> (field.ed.queryString)
                query += field.ed.queryString + <span class="hljs-string">'^'</span>;
              query += colToSearch + filterExpression.operator + filterExpression.filterText +
                <span class="hljs-string">'^'</span> + colToSearch + <span class="hljs-string">'ISNOTEMPTY'</span> + getExcludedValues();
              queryArr.push(query);
            });
            q += queryArr.join(<span class="hljs-string">"^NQ"</span>);
            <span class="hljs-keyword">if</span> (refOrderBy)
              q += <span class="hljs-string">"^ORDERBY"</span> + refOrderBy;
            q += <span class="hljs-string">"^EQ"</span>;
            <span class="hljs-keyword">var</span> params = {
              <span class="hljs-attr">start</span>: (scope.pageSize * (page - <span class="hljs-number">1</span>)),
              <span class="hljs-attr">count</span>: scope.pageSize,
              <span class="hljs-attr">sysparm_target_table</span>: scope.refTable,
              <span class="hljs-attr">sysparm_target_sys_id</span>: scope.refId,
              <span class="hljs-attr">sysparm_target_field</span>: scope.ed.name,
              <span class="hljs-attr">table</span>: scope.ed.reference,
              <span class="hljs-attr">qualifier</span>: scope.ed.qualifier,
              <span class="hljs-attr">data_adapter</span>: scope.ed.data_adapter,
              <span class="hljs-attr">attributes</span>: scope.ed.attributes,
              <span class="hljs-attr">dependent_field</span>: scope.ed.dependent_field,
              <span class="hljs-attr">dependent_table</span>: scope.ed.dependent_table,
              <span class="hljs-attr">dependent_value</span>: scope.ed.dependent_value,
              <span class="hljs-attr">p</span>: scope.ed.reference + <span class="hljs-string">';q:'</span> + q + <span class="hljs-string">';r:'</span> + scope.ed.qualifier
            };
            <span class="hljs-keyword">if</span> (displayColumns)
              params.required_fields = displayColumns.split(<span class="hljs-string">";"</span>).join(<span class="hljs-string">":"</span>);
            <span class="hljs-keyword">if</span> (scope.domain) {
              params.sysparm_domain = scope.domain;
            }
            <span class="hljs-keyword">if</span> (angular.isDefined(scope.field) &amp;&amp; scope.field[<span class="hljs-string">'_cat_variable'</span>] === <span class="hljs-literal">true</span>) {
              <span class="hljs-keyword">delete</span> params[<span class="hljs-string">'sysparm_target_table'</span>];
              params[<span class="hljs-string">'sysparm_include_variables'</span>] = <span class="hljs-literal">true</span>;
              params[<span class="hljs-string">'variable_ids'</span>] = scope.field.sys_id;
              <span class="hljs-keyword">var</span> getFieldSequence = g_form.$private.options(<span class="hljs-string">'getFieldSequence'</span>);
              <span class="hljs-keyword">if</span> (getFieldSequence) {
                params[<span class="hljs-string">'variable_sequence1'</span>] = getFieldSequence();
              }
              <span class="hljs-keyword">var</span> itemSysId = g_form.$private.options(<span class="hljs-string">'itemSysId'</span>);
              params[<span class="hljs-string">'sysparm_id'</span>] = itemSysId;
              <span class="hljs-keyword">var</span> getFieldParams = g_form.$private.options(<span class="hljs-string">'getFieldParams'</span>);
              <span class="hljs-keyword">if</span> (getFieldParams) {
                angular.extend(params, getFieldParams());
              }
            }
            <span class="hljs-keyword">if</span> (scope.recordValues)
              params.sysparm_record_values = scope.recordValues();
            <span class="hljs-keyword">return</span> params;
          },
          <span class="hljs-attr">results</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">data, page</span>) </span>{
            <span class="hljs-keyword">return</span> ctrl.filterResults(data, page, scope.pageSize);
          },
          <span class="hljs-attr">transport</span>: s2Helpers.search
        },
        <span class="hljs-attr">formatSelection</span>: s2Helpers.formatSelection,
        <span class="hljs-attr">formatResult</span>: s2Helpers.formatResult,
        <span class="hljs-attr">initSelection</span>: s2Helpers.initSelection,
        <span class="hljs-attr">dropdownCssClass</span>: attrs.dropdownCssClass,
        <span class="hljs-attr">formatResultCssClass</span>: scope.formatResultCssClass || <span class="hljs-literal">null</span>,
        <span class="hljs-attr">multiple</span>: isMultiple
      };
      <span class="hljs-keyword">if</span> (isMultiple &amp;&amp; scope.ed.reference == <span class="hljs-string">"sys_user"</span>) {
        config.createSearchChoice = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">term</span>) </span>{
          <span class="hljs-keyword">if</span> (spIs.an.email(term)) {
            <span class="hljs-keyword">return</span> {
              <span class="hljs-attr">email</span>: term,
              <span class="hljs-attr">name</span>: term,
              <span class="hljs-attr">user_name</span>: term,
              <span class="hljs-attr">sys_id</span>: term
            };
          }
        };
      }
      <span class="hljs-keyword">if</span> (scope.snOptions) {
        <span class="hljs-keyword">if</span> (scope.snOptions.placeholder) {
          config.placeholder = scope.snOptions.placeholder;
        }
        <span class="hljs-keyword">if</span> (scope.snOptions.width) {
          config.width = scope.snOptions.width;
        }
      }

      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getReferenceColumnsToSearch</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> colNames = [<span class="hljs-string">'name'</span>];
        <span class="hljs-keyword">if</span> (fieldAttributes[<span class="hljs-string">'ref_ac_columns_search'</span>] == <span class="hljs-string">'true'</span> &amp;&amp; <span class="hljs-string">'ref_ac_columns'</span> <span class="hljs-keyword">in</span> fieldAttributes &amp;&amp; fieldAttributes[<span class="hljs-string">'ref_ac_columns'</span>] != <span class="hljs-string">''</span>) {
          colNames = fieldAttributes[<span class="hljs-string">'ref_ac_columns'</span>].split(<span class="hljs-string">';'</span>);
          <span class="hljs-keyword">if</span> (scope.ed.searchField)
            colNames.push(scope.ed.searchField);
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (scope.ed.searchField)
          colNames = [scope.ed.searchField];
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (fieldAttributes[<span class="hljs-string">'ref_ac_order_by'</span>])
          colNames = [fieldAttributes[<span class="hljs-string">'ref_ac_order_by'</span>]];
        <span class="hljs-keyword">return</span> colNames.filter(onlyUnique);
      }

      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getExcludedValues</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">if</span> (scope.ed.excludeValues &amp;&amp; scope.ed.excludeValues != <span class="hljs-string">''</span>) {
          <span class="hljs-keyword">return</span> <span class="hljs-string">'^sys_idNOT IN'</span> + scope.ed.excludeValues;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-string">''</span>;
      }

      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">parseAttributes</span>(<span class="hljs-params">strAttributes</span>) </span>{
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> strAttributes === <span class="hljs-string">'object'</span>)
          <span class="hljs-keyword">return</span> strAttributes;
        <span class="hljs-keyword">var</span> attributeArray = (strAttributes &amp;&amp; strAttributes.length ? strAttributes.split(<span class="hljs-string">','</span>) : []);
        <span class="hljs-keyword">var</span> attributeObj = {};
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; attributeArray.length; i++) {
          <span class="hljs-keyword">if</span> (attributeArray[i].length &gt; <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">var</span> attribute = attributeArray[i].split(<span class="hljs-string">'='</span>);
            attributeObj[attribute[<span class="hljs-number">0</span>]] = attribute.length &gt; <span class="hljs-number">1</span> ? attribute[<span class="hljs-number">1</span>] : <span class="hljs-string">''</span>;
          }
        }
        <span class="hljs-keyword">return</span> attributeObj;
      }

      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">init</span>(<span class="hljs-params"></span>) </span>{
        $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
          i18n.getMessage(<span class="hljs-string">'Searching...'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">searchingMsg</span>) </span>{
            config.formatSearching = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
              <span class="hljs-keyword">return</span> searchingMsg;
            };
          });
          element.css(<span class="hljs-string">"opacity"</span>, <span class="hljs-number">1</span>);
          element.select2(<span class="hljs-string">"destroy"</span>);
          <span class="hljs-keyword">var</span> select2 = element.select2(config);
          element.select2(<span class="hljs-string">"val"</span>, scope.field.value.split(<span class="hljs-string">','</span>));
          <span class="hljs-keyword">if</span> (isMultiple) {
            element.bind(<span class="hljs-string">"select2-selecting"</span>, s2Helpers.onSelecting);
            element.bind(<span class="hljs-string">"select2-removing"</span>, s2Helpers.onRemoving);
          } <span class="hljs-keyword">else</span> {
            element.bind(<span class="hljs-string">"change select2-removed"</span>, s2Helpers.select2Change);
          }
          element.bind(<span class="hljs-string">"select2-blur"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
            $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
              scope.snOnBlur();
            });
          });
          <span class="hljs-keyword">if</span> (fireReadyEvent) {
            scope.$emit(<span class="hljs-string">'select2.ready'</span>, element);
            fireReadyEvent = <span class="hljs-literal">false</span>;
          }
        });
      }

      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getDisplayValue</span>(<span class="hljs-params">selectedItem</span>) </span>{
        <span class="hljs-keyword">var</span> displayValue = <span class="hljs-string">''</span>;
        <span class="hljs-keyword">if</span> (selectedItem &amp;&amp; selectedItem.sys_id) {
          <span class="hljs-keyword">if</span> (scope.displayColumn &amp;&amp; <span class="hljs-keyword">typeof</span> selectedItem[scope.displayColumn] != <span class="hljs-string">"undefined"</span>)
            displayValue = selectedItem[scope.displayColumn];
          <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (selectedItem.$$displayValue)
            displayValue = selectedItem.$$displayValue;
          <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (selectedItem.name)
            displayValue = selectedItem.name;
          <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (selectedItem.title)
            displayValue = selectedItem.title;
        }
        <span class="hljs-keyword">return</span> displayValue;
      }

      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getDisplayValues</span>(<span class="hljs-params">selectedItem</span>) </span>{
        <span class="hljs-keyword">var</span> displayValues = [];
        <span class="hljs-keyword">if</span> (selectedItem &amp;&amp; selectedItem.sys_id) {
          displayValues.push(getDisplayValue(selectedItem));
        }
        <span class="hljs-keyword">if</span> (displayColumns &amp;&amp; refAutoCompleter === <span class="hljs-string">"AJAXTableCompleter"</span>) {
          <span class="hljs-keyword">var</span> columns = displayColumns.split(<span class="hljs-string">";"</span>);
          <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; columns.length; i++) {
            <span class="hljs-keyword">var</span> column = columns[i];
            <span class="hljs-keyword">if</span> (selectedItem[column])
              displayValues.push(selectedItem[column]);
          }
        }
        <span class="hljs-keyword">return</span> displayValues.filter(onlyUnique);
      }

      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onlyUnique</span>(<span class="hljs-params">value, index, self</span>) </span>{
        <span class="hljs-keyword">return</span> self.indexOf(value) === index;
      }

      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setPrice</span>(<span class="hljs-params">p, rp</span>) </span>{
        scope.field.price = p;
        scope.field.recurring_price = rp;
      }
      g_form.$private.events.on(<span class="hljs-string">"change"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">fieldName, oldValue, value</span>) </span>{
        <span class="hljs-keyword">if</span> (fieldName == field.name) {
          <span class="hljs-keyword">if</span> (value == <span class="hljs-string">""</span> &amp;&amp; scope.field.display_value_list)
            scope.field.display_value_list.length = <span class="hljs-number">0</span>;
          element.select2(<span class="hljs-string">"val"</span>, <span class="hljs-keyword">typeof</span> value == <span class="hljs-string">'string'</span> ? value.split(<span class="hljs-string">','</span>) : value);
        }
      });
      scope.$on(<span class="hljs-string">"snReferencePicker.activate"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">evt, parms</span>) </span>{
        $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
          element.select2(<span class="hljs-string">"open"</span>);
        })
      });
      init();
    },
    <span class="hljs-attr">controller</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$scope, $rootScope</span>) </span>{
      $scope.pageSize = <span class="hljs-number">20</span>;
      <span class="hljs-keyword">this</span>.filterResults = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">data, page</span>) </span>{
        <span class="hljs-keyword">return</span> {
          <span class="hljs-attr">results</span>: data.data.items,
          <span class="hljs-attr">more</span>: (page * $scope.pageSize &lt; data.data.total)
        };
      };
    }
  };
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.$sp/directive.spCurrencyElement.js */</span>
angular.module(<span class="hljs-string">'sn.$sp'</span>).directive(<span class="hljs-string">'spCurrencyElement'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">templateUrl</span>: <span class="hljs-string">'sp_element_currency.xml'</span>,
    <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
    <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">scope</span>: {
      <span class="hljs-attr">field</span>: <span class="hljs-string">'='</span>,
      <span class="hljs-attr">snBlur</span>: <span class="hljs-string">'&amp;'</span>,
      <span class="hljs-attr">snChange</span>: <span class="hljs-string">'&amp;'</span>,
      <span class="hljs-string">'getGlideForm'</span>: <span class="hljs-string">'&amp;glideForm'</span>
    },
    <span class="hljs-attr">controller</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$scope</span>) </span>{
      <span class="hljs-keyword">var</span> g_form = $scope.getGlideForm();
      <span class="hljs-keyword">var</span> field = $scope.field;
      g_form.$private.events.on(<span class="hljs-string">"change"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">fieldName, oldValue, newValue</span>) </span>{
        <span class="hljs-keyword">if</span> (fieldName == field.name) {
          <span class="hljs-keyword">if</span> (newValue.indexOf(<span class="hljs-string">";"</span>) &gt; <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">var</span> v = newValue.split(<span class="hljs-string">";"</span>);
            field.currencyCode = v[<span class="hljs-number">0</span>];
            field.currencyValue = v[<span class="hljs-number">1</span>];
          } <span class="hljs-keyword">else</span>
            field.currencyValue = newValue;
        }
      });
      $scope.formatValue = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">shouldSetValue</span>) </span>{
        <span class="hljs-keyword">var</span> v = field.currencyValue;
        <span class="hljs-keyword">if</span> (field.currencyValue != <span class="hljs-string">""</span>)
          v = field.currencyCode + <span class="hljs-string">";"</span> + field.currencyValue;
        field.stagedValue = v;
        $scope.snChange();
        <span class="hljs-keyword">if</span> (shouldSetValue)
          $scope.snBlur();
      }
    }
  }
});
<span class="hljs-comment">/*! RESOURCE: /scripts/app.$sp/directive.spDurationElement.js */</span>
angular.module(<span class="hljs-string">'sn.$sp'</span>).directive(<span class="hljs-string">'spDurationElement'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-meta">  "use strict"</span>;

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getVisibleUnits</span>(<span class="hljs-params">attributes</span>) </span>{
    <span class="hljs-keyword">var</span> maxUnit = <span class="hljs-string">"days"</span>;
    <span class="hljs-keyword">var</span> o = {
      <span class="hljs-attr">days</span>: [<span class="hljs-string">"days"</span>, <span class="hljs-string">"hours"</span>, <span class="hljs-string">"minutes"</span>, <span class="hljs-string">"seconds"</span>],
      <span class="hljs-attr">hours</span>: [<span class="hljs-string">"hours"</span>, <span class="hljs-string">"minutes"</span>, <span class="hljs-string">"seconds"</span>],
      <span class="hljs-attr">minutes</span>: [<span class="hljs-string">"minutes"</span>, <span class="hljs-string">"seconds"</span>],
      <span class="hljs-attr">seconds</span>: [<span class="hljs-string">"seconds"</span>]
    };
    <span class="hljs-keyword">if</span> (attributes &amp;&amp; attributes.max_unit &amp;&amp; attributes.max_unit <span class="hljs-keyword">in</span> o)
      maxUnit = attributes.max_unit;
    <span class="hljs-keyword">return</span> o[maxUnit];
  }
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
    <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">require</span>: <span class="hljs-string">'ngModel'</span>,
    <span class="hljs-attr">templateUrl</span>: <span class="hljs-string">'sp_element_duration.xml'</span>,
    <span class="hljs-attr">link</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">scope, element, attrs, ngModelCtrl</span>) </span>{
      <span class="hljs-keyword">var</span> theDawnOfTime;
      scope.field = scope.$<span class="hljs-built_in">eval</span>(attrs.field);
      scope.visibleUnits = getVisibleUnits(scope.field.attributes);
      ngModelCtrl.$formatters.push(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">if</span> (!ngModelCtrl.$modelValue)
          <span class="hljs-keyword">return</span> {
            <span class="hljs-attr">days</span>: <span class="hljs-number">0</span>,
            <span class="hljs-attr">hours</span>: <span class="hljs-number">0</span>,
            <span class="hljs-attr">minutes</span>: <span class="hljs-number">0</span>,
            <span class="hljs-attr">seconds</span>: <span class="hljs-number">0</span>
          };
        theDawnOfTime = moment(<span class="hljs-string">"1970-01-01 00:00:00"</span>);
        <span class="hljs-keyword">var</span> dur = moment.duration(moment(ngModelCtrl.$modelValue).diff(theDawnOfTime));
        <span class="hljs-keyword">if</span> (moment(ngModelCtrl.$modelValue).isDST())
          dur.add(<span class="hljs-number">1</span>, <span class="hljs-string">"hours"</span>);
        <span class="hljs-keyword">var</span> d = <span class="hljs-built_in">parseInt</span>(dur.asDays(), <span class="hljs-number">10</span>);
        <span class="hljs-keyword">var</span> h = dur.get(<span class="hljs-string">'hours'</span>);
        <span class="hljs-keyword">var</span> m = dur.get(<span class="hljs-string">'minutes'</span>);
        <span class="hljs-keyword">var</span> s = dur.get(<span class="hljs-string">'seconds'</span>);
        <span class="hljs-keyword">if</span> (scope.visibleUnits[<span class="hljs-number">0</span>] == <span class="hljs-string">"hours"</span>) {
          h = h + (d * <span class="hljs-number">24</span>);
          d = <span class="hljs-number">0</span>;
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (scope.visibleUnits[<span class="hljs-number">0</span>] == <span class="hljs-string">"minutes"</span>) {
          m = m + (h * <span class="hljs-number">60</span>) + (d * <span class="hljs-number">1440</span>);
          d = h = <span class="hljs-number">0</span>;
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (scope.visibleUnits[<span class="hljs-number">0</span>] == <span class="hljs-string">"seconds"</span>) {
          s = s + (m * <span class="hljs-number">60</span>) + (h * <span class="hljs-number">3600</span>) + (d * <span class="hljs-number">86400</span>);
          d = h = m = <span class="hljs-number">0</span>;
        }
        <span class="hljs-keyword">return</span> {
          <span class="hljs-attr">days</span>: d,
          <span class="hljs-attr">hours</span>: h,
          <span class="hljs-attr">minutes</span>: m,
          <span class="hljs-attr">seconds</span>: s
        };
      });
      ngModelCtrl.$render = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        scope.parts = ngModelCtrl.$viewValue;
      };
      ngModelCtrl.$parsers.push(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">model</span>) </span>{
        theDawnOfTime = moment(<span class="hljs-string">"1970-01-01 00:00:00"</span>);
        <span class="hljs-keyword">var</span> modelValue = moment.duration(model);
        <span class="hljs-keyword">var</span> newValue = theDawnOfTime.add(modelValue).format(<span class="hljs-string">"YYYY-MM-DD HH:mm:ss"</span>);
        <span class="hljs-keyword">return</span> newValue;
      });
      scope.updateDuration = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        ngModelCtrl.$setViewValue(angular.copy(scope.parts));
      };
      scope.showLabel = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">unit</span>) </span>{
        <span class="hljs-keyword">if</span> (unit == <span class="hljs-string">"days"</span> || unit == <span class="hljs-string">"hours"</span>)
          <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">if</span> (scope.visibleUnits[<span class="hljs-number">0</span>] == <span class="hljs-string">"minutes"</span>)
          <span class="hljs-keyword">return</span> unit == <span class="hljs-string">"minutes"</span>;
        <span class="hljs-keyword">return</span> scope.visibleUnits[<span class="hljs-number">0</span>] == <span class="hljs-string">"seconds"</span>;
      };
    }
  };
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.$sp/controller.spLogin.js */</span>
angular.module(<span class="hljs-string">"sn.$sp"</span>).controller(<span class="hljs-string">"spLogin"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$scope, $http, $window, urlTools, $location, i18n</span>) </span>{
  $scope.login = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">username, password</span>) </span>{
    <span class="hljs-keyword">var</span> url = urlTools.getURL(<span class="hljs-string">'view_form.login'</span>);
    <span class="hljs-keyword">var</span> pageId = $location.search().id || $scope.page.id;
    <span class="hljs-keyword">var</span> isLoginPage = $scope.portal.login_page_dv == pageId;
    <span class="hljs-keyword">return</span> $http({
      <span class="hljs-attr">method</span>: <span class="hljs-string">'post'</span>,
      <span class="hljs-attr">url</span>: url,
      <span class="hljs-attr">data</span>: urlTools.encodeURIParameters({
        <span class="hljs-string">'sysparm_type'</span>: <span class="hljs-string">'login'</span>,
        <span class="hljs-string">'ni.nolog.user_password'</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-string">'remember_me'</span>: <span class="hljs-keyword">typeof</span> remember_me != <span class="hljs-string">'undefined'</span> &amp;&amp; !!remember_me ? <span class="hljs-literal">true</span> : <span class="hljs-literal">false</span>,
        <span class="hljs-string">'user_name'</span>: username,
        <span class="hljs-string">'user_password'</span>: password,
        <span class="hljs-string">'get_redirect_url'</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-string">'sysparm_goto_url'</span>: isLoginPage ? <span class="hljs-literal">null</span> : $location.url()
      }),
      <span class="hljs-attr">headers</span>: {
        <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/x-www-form-urlencoded'</span>
      }
    }).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>) </span>{
      <span class="hljs-keyword">if</span> (!response.data) {
        $scope.message = i18n.getMessage(<span class="hljs-string">"There was an error processing your request"</span>);
        <span class="hljs-keyword">return</span>;
      }
      <span class="hljs-keyword">if</span> (response.data.status == <span class="hljs-string">'success'</span>) {
        $scope.success = response.data.message;
        $<span class="hljs-built_in">window</span>.location = response.data.redirect_url;
      } <span class="hljs-keyword">else</span> {
        $scope.message = response.data.message;
      }
    }, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">errorCallback</span>(<span class="hljs-params">response</span>) </span>{
      $scope.message = i18n.getMessage(<span class="hljs-string">"There was an error processing your request"</span>);
    });
  }
});
<span class="hljs-comment">/*! RESOURCE: /scripts/app.$sp/directive.spMessageDialog.js */</span>
angular.module(<span class="hljs-string">"sn.$sp"</span>).directive(<span class="hljs-string">'spMessageDialog'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">nowServer, i18n, $timeout</span>) </span>{
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
    <span class="hljs-attr">scope</span>: {
      <span class="hljs-attr">name</span>: <span class="hljs-string">'@'</span>,
      <span class="hljs-attr">title</span>: <span class="hljs-string">'@'</span>,
      <span class="hljs-attr">message</span>: <span class="hljs-string">'@'</span>,
      <span class="hljs-attr">question</span>: <span class="hljs-string">'@'</span>,
      <span class="hljs-attr">ok</span>: <span class="hljs-string">'@'</span>,
      <span class="hljs-attr">cancel</span>: <span class="hljs-string">'@'</span>,
      <span class="hljs-attr">dialogClass</span>: <span class="hljs-string">'@'</span>,
      <span class="hljs-attr">checkboxMessage</span>: <span class="hljs-string">'@'</span>,
      <span class="hljs-attr">checkboxCallback</span>: <span class="hljs-string">'&amp;'</span>,
      <span class="hljs-attr">checkboxState</span>: <span class="hljs-string">'='</span>
    },
    <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">templateUrl</span>: <span class="hljs-string">'sp_dialog.xml'</span>,
    <span class="hljs-attr">link</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">scope, element</span>) </span>{
      element.remove();
      element.appendTo($(<span class="hljs-string">'body'</span>));
      <span class="hljs-keyword">if</span> (scope.checkboxMessage) {
        scope.checkboxModel = {
          <span class="hljs-attr">value</span>: scope.checkboxState
        };
        scope.update = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
          scope.checkboxState = scope.checkboxModel.value;
          $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
            scope.checkboxCallback()(scope.checkboxState);
          })
        }
      }
    }
  }
});
<span class="hljs-comment">/*! RESOURCE: /scripts/app.$sp/controller.spPage.js */</span>
angular.module(<span class="hljs-string">"sn.$sp"</span>).controller(<span class="hljs-string">"spPage"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$scope, $http, $location, $window, $timeout, spUtil, nowServer, snRecordWatcher, cabrillo, $rootScope, glideUserSession</span>) </span>{
  <span class="hljs-keyword">var</span> _ = $<span class="hljs-built_in">window</span>._;
  $scope.firstPage = <span class="hljs-literal">true</span>;
  $scope.page = {};
  $scope.page.title = <span class="hljs-string">"Loading..."</span>;
  $scope.theme = {};
  $scope.portal = {};
  $scope.sessions = {};
  $scope.status = <span class="hljs-string">""</span>;
  $scope.isViewNative = cabrillo.isNative();
  $scope.openWindow = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">parms</span>) </span>{
    <span class="hljs-keyword">var</span> jo = <span class="hljs-built_in">JSON</span>.parse(parms);
    <span class="hljs-keyword">var</span> left = <span class="hljs-built_in">window</span>.screenX + <span class="hljs-built_in">window</span>.innerWidth - <span class="hljs-number">540</span>;
    <span class="hljs-keyword">var</span> top = <span class="hljs-built_in">window</span>.screenY + <span class="hljs-number">140</span>;
    <span class="hljs-built_in">window</span>.open(jo.url, jo.name, <span class="hljs-string">"left="</span> + left + <span class="hljs-string">",top="</span> + top + <span class="hljs-string">","</span> + jo.specs);
  };
  $scope.parseJSON = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">str</span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">JSON</span>.parse(str);
  }
  $scope.getContainerClasses = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">container</span>) </span>{
    <span class="hljs-keyword">var</span> classes = {};
    classes[container.width] = !container.bootstrap_alt;
    classes[container.container_class_name] = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">return</span> classes;
  }
  <span class="hljs-keyword">var</span> oid = $location.search().id;
  <span class="hljs-keyword">var</span> oldPath = $location.path();
  $rootScope.$on(<span class="hljs-string">'$locationChangeSuccess'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e, newUrl, oldUrl</span>) </span>{
    $scope.$broadcast(<span class="hljs-string">"$$uiNotification.dismiss"</span>);
    $scope.locationChanged = (oldUrl != newUrl);
    <span class="hljs-keyword">var</span> s = $location.search();
    <span class="hljs-keyword">var</span> p = $location.path();
    <span class="hljs-keyword">if</span> (oldPath != p) {
      $<span class="hljs-built_in">window</span>.location.href = $location.absUrl();
      <span class="hljs-keyword">return</span>;
    }
    <span class="hljs-keyword">if</span> (angular.isDefined($scope.containers) &amp;&amp; oid == s.id &amp;&amp; s.spa) {
      e.pageIsHandling = <span class="hljs-literal">true</span>;
      <span class="hljs-keyword">return</span>;
    }
    <span class="hljs-keyword">if</span> (p.indexOf(<span class="hljs-string">".do"</span>) &gt; <span class="hljs-number">0</span> &amp;&amp; p.indexOf(<span class="hljs-string">"sp.do"</span>) == <span class="hljs-number">-1</span>) {
      <span class="hljs-keyword">var</span> newUrl = $location.absUrl();
      newUrl = newUrl.substr(newUrl.search(<span class="hljs-regexp">/[^\/]+.do/</span>));
      $<span class="hljs-built_in">window</span>.location.href = <span class="hljs-string">"/"</span> + newUrl;
      <span class="hljs-keyword">return</span>;
    }
    <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">window</span>.NOW.has_access &amp;&amp; $scope.locationChanged) {
      $<span class="hljs-built_in">window</span>.location.href = $location.absUrl();
      <span class="hljs-keyword">return</span>;
    }
    oid = s.id;
    <span class="hljs-keyword">var</span> t = getUrl();
    refreshPage(t);
  });

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getUrl</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> currentParms = $location.search();
    <span class="hljs-keyword">var</span> params = {};
    angular.extend(params, currentParms);
    params.time = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().getTime();
    params.portal_id = $scope.portal_id;
    params.request_uri = $location.url();
    <span class="hljs-keyword">return</span> <span class="hljs-string">'/api/now/sp/page?'</span> + $.param(params);
  }

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">loadPage</span>(<span class="hljs-params">response</span>) </span>{
    $scope.firstPage = <span class="hljs-literal">false</span>;
    $scope.containers = _.filter(response.containers, {
      <span class="hljs-string">'subheader'</span>: <span class="hljs-literal">false</span>
    });
    $scope.subheaders = _.filter(response.containers, {
      <span class="hljs-string">'subheader'</span>: <span class="hljs-literal">true</span>
    });
    $scope.rectangles = response.rectangles;
    $scope.style = <span class="hljs-string">''</span>;
    <span class="hljs-keyword">var</span> p = response.page;
    <span class="hljs-keyword">var</span> u = response.user;
    <span class="hljs-keyword">if</span> (!isPublicOrUserLoggedIn(p, u)) {
      <span class="hljs-keyword">if</span> ($scope.locationChanged) {
        $<span class="hljs-built_in">window</span>.location.href = $location.absUrl();
        <span class="hljs-keyword">return</span>;
      }
    }
    $rootScope.page = $scope.page = p;
    setCSS(p);
    <span class="hljs-keyword">if</span> (response.portal.title)
      $<span class="hljs-built_in">window</span>.document.title = (p.title) ? response.portal.title + <span class="hljs-string">' - '</span> + p.title : response.portal.title;
    <span class="hljs-keyword">else</span>
      $<span class="hljs-built_in">window</span>.document.title = p.title;
    $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      jQuery(<span class="hljs-string">'section, .flex-item'</span>).scrollTop(<span class="hljs-number">0</span>);
    });
    $rootScope.theme = $scope.theme = response.theme;
    <span class="hljs-keyword">var</span> style = [];
    <span class="hljs-keyword">if</span> ($scope.isNative)
      style.push(<span class="hljs-string">'isNative'</span>);
    <span class="hljs-keyword">if</span> ($scope.theme.navbar_fixed)
      style.push(<span class="hljs-string">'fixed-header'</span>);
    <span class="hljs-keyword">if</span> ($scope.theme.footer_fixed)
      style.push(<span class="hljs-string">'fixed-footer'</span>);
    $scope.style = style.join(<span class="hljs-string">' '</span>);
    response.portal.logoutUrl = <span class="hljs-string">"/logout.do?sysparm_goto_url=/"</span> + response.portal.url_suffix;
    $rootScope.portal = $scope.portal = response.portal;
    <span class="hljs-keyword">if</span> (!$scope.user) {
      $rootScope.user = $scope.user = {};
      glideUserSession.loadCurrentUser().then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">g_user</span>) </span>{
        $rootScope.g_user = g_user;
      });
    }
    angular.extend($scope.user, response.user);
    $scope.user.logged_in = $scope.user.user_name != <span class="hljs-string">'guest'</span>;
    $scope.$broadcast(<span class="hljs-string">'$$uiNotification'</span>, response.$$uiNotification);
    snRecordWatcher.init();
  }
  <span class="hljs-keyword">var</span> pageLoaded = <span class="hljs-literal">false</span>;
  $scope.$on(<span class="hljs-string">'sp.page.reload'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> t = getUrl();
    refreshPage(t);
  });

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">refreshPage</span>(<span class="hljs-params">dataURL</span>) </span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">window</span>.pageData &amp;&amp; !pageLoaded) {
      pageLoaded = <span class="hljs-literal">true</span>;
      loadPage(pageData);
    } <span class="hljs-keyword">else</span> {
      $http.get(dataURL, {
        <span class="hljs-attr">headers</span>: spUtil.getHeaders()
      }).success(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>) </span>{
        loadPage(response.result);
      });
    }
  }

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isPublicOrUserLoggedIn</span>(<span class="hljs-params">page, user</span>) </span>{
    <span class="hljs-keyword">if</span> (page.public)
      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">if</span> (user.user_name == <span class="hljs-string">"guest"</span>)
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  }

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setCSS</span>(<span class="hljs-params">page</span>) </span>{
    jQuery(<span class="hljs-string">"style[data-page-id='"</span> + page.sys_id + <span class="hljs-string">"']"</span>).remove();
    <span class="hljs-keyword">if</span> (page.css) {
      <span class="hljs-keyword">var</span> buf = [
        <span class="hljs-string">'&lt;style type="text/css" data-page-id="'</span> + page.sys_id + <span class="hljs-string">'" data-page-title="'</span> + page.title + <span class="hljs-string">'"&gt;'</span>,
        page.css,
        <span class="hljs-string">'&lt;/style&gt;'</span>
      ];
      jQuery(jQuery(buf.join(<span class="hljs-string">'\n'</span>))).appendTo(<span class="hljs-string">'head'</span>);
    }
  }
  $(<span class="hljs-built_in">window</span>).keydown(onKeyDown);

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onKeyDown</span>(<span class="hljs-params">e</span>) </span>{
    <span class="hljs-keyword">if</span> (e.keyCode != <span class="hljs-number">83</span>)
      <span class="hljs-keyword">return</span>;
    <span class="hljs-keyword">if</span> (e.metaKey || e.ctrlKey) {
      e.stopPropagation();
      e.preventDefault();
      $rootScope.$broadcast(<span class="hljs-string">"$sp.save"</span>, e);
    }
  }
  $scope.$on(<span class="hljs-string">'$destroy'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    $(<span class="hljs-built_in">window</span>).off(<span class="hljs-string">"keydown"</span>, onKeyDown);
  })
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.$sp/service.spPreference.js */</span>
angular.module(<span class="hljs-string">'sn.$sp'</span>).factory(<span class="hljs-string">'spPreference'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">nowServer, $http</span>) </span>{
<span class="hljs-meta">  "use strict"</span>;
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">set</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">name, value</span>) </span>{
      <span class="hljs-keyword">var</span> dataURL = nowServer.getURL(<span class="hljs-string">"$sp"</span>);
      <span class="hljs-keyword">var</span> n = {
        <span class="hljs-attr">sysparm_ck</span>: g_ck,
        <span class="hljs-attr">type</span>: <span class="hljs-string">"set_preference"</span>,
        <span class="hljs-attr">name</span>: name,
        <span class="hljs-attr">value</span>: value
      }
      <span class="hljs-built_in">Object</span>.keys(n).forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">t</span>) </span>{
        dataURL += <span class="hljs-string">"&amp;"</span> + t + <span class="hljs-string">"="</span> + n[t]
      })
      $http.post(dataURL);
    }
  }
});
<span class="hljs-comment">/*! RESOURCE: /scripts/app.$sp/factory.spWidget.js */</span>
angular.module(<span class="hljs-string">'sn.$sp'</span>).factory(<span class="hljs-string">'spWidgetService'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$compile, lazyLoader, spServer, $rootScope, $injector</span>) </span>{
  <span class="hljs-keyword">var</span> head = <span class="hljs-built_in">document</span>.head || <span class="hljs-built_in">document</span>.getElementsByTagName(<span class="hljs-string">'head'</span>)[<span class="hljs-number">0</span>];

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addElement</span>(<span class="hljs-params">options</span>) </span>{
    <span class="hljs-keyword">var</span> el = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'style'</span>);
    el.type = <span class="hljs-string">'text/css'</span>;
    <span class="hljs-keyword">if</span> (options.id)
      el.setAttribute(<span class="hljs-string">'id'</span>, options.id);
    <span class="hljs-keyword">if</span> (options.widget)
      el.setAttribute(<span class="hljs-string">'widget'</span>, options.widget);
    <span class="hljs-keyword">if</span> (el.styleSheet)
      el.styleSheet.cssText = options.css;
    <span class="hljs-keyword">else</span>
      el.appendChild(<span class="hljs-built_in">document</span>.createTextNode(options.css));
    <span class="hljs-keyword">return</span> el;
  }

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">render</span>(<span class="hljs-params">scope, element, template</span>) </span>{
    element.html(template);
    <span class="hljs-keyword">var</span> el = $compile(element.contents())(scope);
    element.replaceWith(el);
  }

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">loadCSS</span>(<span class="hljs-params">scope</span>) </span>{
    <span class="hljs-keyword">var</span> id = scope.widget.directiveName + <span class="hljs-string">'-s'</span>;
    <span class="hljs-keyword">if</span> (scope.widget.css) {
      <span class="hljs-keyword">if</span> (scope.widget.update)
        scope.widget.css = scope.widget.css.replace(<span class="hljs-keyword">new</span> <span class="hljs-built_in">RegExp</span>(<span class="hljs-string">'v'</span> + scope.widget.sys_id, <span class="hljs-string">'g'</span>), scope.widget.directiveName);
      <span class="hljs-keyword">if</span> (!$(<span class="hljs-string">"head #"</span> + id).length)
        head.appendChild(addElement({
          <span class="hljs-attr">css</span>: scope.widget.css,
          <span class="hljs-attr">id</span>: id,
          <span class="hljs-attr">widget</span>: scope.widget.name
        }));
    }
    <span class="hljs-keyword">if</span> (scope.widget.rectangle &amp;&amp; scope.widget.rectangle.css)
      head.appendChild(addElement({
        <span class="hljs-attr">css</span>: scope.widget.rectangle.css,
        <span class="hljs-attr">widget</span>: scope.widget.name
      }));
  }

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">initData</span>(<span class="hljs-params">scope</span>) </span>{
    scope.data = scope.widget.data;
    scope.options = scope.widget.options;
    scope.widget_parameters = scope.options;
  }

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">noData</span>(<span class="hljs-params">scope</span>) </span>{
    <span class="hljs-keyword">if</span> (!scope.widget || !<span class="hljs-built_in">Object</span>.keys(scope.widget).length) {
      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
  }

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">loadDirective</span>(<span class="hljs-params">scope, directiveName</span>) </span>{
    <span class="hljs-keyword">if</span> (scope.widget.providers) {
      lazyLoader.providers(scope.widget.providers);
    }
    lazyLoader.directive(directiveName, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$injector</span>) </span>{
      <span class="hljs-keyword">var</span> api = {
        <span class="hljs-attr">restrict</span>: <span class="hljs-string">'C'</span>,
        <span class="hljs-attr">replace</span>: <span class="hljs-literal">false</span>
      };
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> scope.data.replace !== <span class="hljs-string">'undefined'</span>)
        api.replace = scope.data.replace;
      <span class="hljs-keyword">if</span> (scope.widget.template)
        api.template = scope.widget.template;
      <span class="hljs-keyword">if</span> (scope.widget.client_script) {
        <span class="hljs-keyword">try</span> {
          <span class="hljs-built_in">eval</span>(<span class="hljs-string">'api.controller='</span> + scope.widget.client_script);
          <span class="hljs-keyword">if</span> (scope.widget.controller_as) {
            api.controllerAs = scope.widget.controller_as;
            api.bindToController = {
              <span class="hljs-attr">data</span>: <span class="hljs-string">'='</span>,
              <span class="hljs-attr">options</span>: <span class="hljs-string">'='</span>,
              <span class="hljs-attr">widget</span>: <span class="hljs-string">'='</span>,
              <span class="hljs-attr">server</span>: <span class="hljs-string">'='</span>
            };
          }
        } <span class="hljs-keyword">catch</span> (e) {
          <span class="hljs-built_in">console</span>.log(e);
          <span class="hljs-built_in">console</span>.log(scope.widget.client_script);
        }
      }
      api.link = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">sc, elem, attr, ctrl</span>) </span>{
        <span class="hljs-keyword">var</span> link;
        <span class="hljs-keyword">if</span> (scope.widget.link) {
          <span class="hljs-built_in">eval</span>(<span class="hljs-string">'link='</span> + scope.widget.link);
          <span class="hljs-keyword">if</span> (link) {
            link(sc, elem, attr, ctrl)
          }
        };
      };
      <span class="hljs-keyword">return</span> api;
    });
  }

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">initGlobals</span>(<span class="hljs-params">scope</span>) </span>{
    scope.page = scope.page || $rootScope.page;
    scope.portal = $rootScope.portal;
    scope.user = $rootScope.user;
    scope.theme = $rootScope.theme;
    scope.server = spServer.set(scope);
  }
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">render</span>: render,
    <span class="hljs-attr">loadCSS</span>: loadCSS,
    <span class="hljs-attr">initData</span>: initData,
    <span class="hljs-attr">initGlobals</span>: initGlobals,
    <span class="hljs-attr">noData</span>: noData,
    <span class="hljs-attr">loadDirective</span>: loadDirective
  }
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.$sp/directive.spWidget.js */</span>
angular.module(<span class="hljs-string">'sn.$sp'</span>).directive(<span class="hljs-string">'spWidget'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$rootScope, $timeout, lazyLoader, spWidgetService, spUtil</span>) </span>{
<span class="hljs-meta">  'use strict'</span>;
  <span class="hljs-keyword">var</span> service = spWidgetService;

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">renderWidget</span>(<span class="hljs-params">scope, element</span>) </span>{
    <span class="hljs-keyword">if</span> (scope.widget.ngTemplates)
      lazyLoader.putTemplates(scope.widget.ngTemplates);
    service.initData(scope);
    service.initGlobals(scope);
    <span class="hljs-keyword">var</span> name = scope.widget.sys_id;
    name = <span class="hljs-string">"v"</span> + name;
    <span class="hljs-keyword">if</span> (scope.widget.update) {
      name += spUtil.createUid(<span class="hljs-string">'xxxxx'</span>);
    }
    scope.widget.directiveName = name;
    scope.$watch(<span class="hljs-string">"widget"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">newValue, oldValue</span>) </span>{
      <span class="hljs-keyword">if</span> (newValue !== oldValue)
        service.initData(scope);
    });
    <span class="hljs-keyword">var</span> idTag = (scope.widget.rectangle_id) ? <span class="hljs-string">"id=\"x"</span> + scope.widget.rectangle_id + <span class="hljs-string">"\""</span> : <span class="hljs-string">""</span>;
    <span class="hljs-keyword">var</span> template = <span class="hljs-string">'&lt;div '</span> + idTag + <span class="hljs-string">' class="'</span> + name + <span class="hljs-string">'" data="data" options="options" widget="widget" server="server"&gt;&lt;/div&gt;'</span>;
    <span class="hljs-keyword">if</span> (name.length == <span class="hljs-number">0</span>)
      <span class="hljs-keyword">return</span>;

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">load</span>(<span class="hljs-params"></span>) </span>{
      service.loadDirective(scope, name, template);
      service.loadCSS(scope);
      service.render(scope, element, template);
    }
    <span class="hljs-keyword">if</span> (scope.widget.dependencies) {
      lazyLoader.dependencies(scope.widget.dependencies).then(load, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
        spUtil.format(<span class="hljs-string">'An error occurred when loading widget dependencies for: {name} ({id}) {error}'</span>, {
          <span class="hljs-attr">name</span>: scope.widget.name,
          <span class="hljs-attr">id</span>: scope.widget.sys_id,
          <span class="hljs-attr">error</span>: e
        });
        load();
      });
    } <span class="hljs-keyword">else</span> {
      load();
    }
  }

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">link</span>(<span class="hljs-params">scope, element</span>) </span>{
    <span class="hljs-keyword">if</span> (service.noData(scope)) {
      <span class="hljs-keyword">var</span> w = scope.$watch(<span class="hljs-string">"widget"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">if</span> (!service.noData(scope)) {
          w();
          renderWidget(scope, element);
        }
      });
      <span class="hljs-keyword">return</span>;
    }
    renderWidget(scope, element);
  }
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">restrict</span>: <span class="hljs-string">"E"</span>,
    <span class="hljs-attr">link</span>: link,
    <span class="hljs-attr">scope</span>: {
      <span class="hljs-attr">widget</span>: <span class="hljs-string">'='</span>,
      <span class="hljs-attr">page</span>: <span class="hljs-string">'=?'</span>
    }
  };
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.$sp/controller.spWidgetDebug.js */</span>
angular.module(<span class="hljs-string">'sn.$sp'</span>).controller(<span class="hljs-string">'spWidgetDebug'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$scope, $rootScope, $uibModal, $http, spUtil, $window, i18n</span>) </span>{
  $scope.reveal = <span class="hljs-literal">false</span>;
  $scope.page = $rootScope.page;
  $scope.portal = $rootScope.portal;
  $scope.contextMenu = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) </span>{
    <span class="hljs-keyword">var</span> menu = [];
    <span class="hljs-keyword">if</span> (!event.ctrlKey || !$rootScope.user.can_debug)
      <span class="hljs-keyword">return</span> menu;
    <span class="hljs-keyword">var</span> w = $scope.rectangle.widget;
    <span class="hljs-keyword">var</span> n = <span class="hljs-string">"'"</span> + w.name + <span class="hljs-string">"'"</span>;
    menu.push(n + <span class="hljs-string">' '</span> + i18n.getMessage(<span class="hljs-string">'generated in'</span>) + <span class="hljs-string">': '</span> + w._server_time);
    menu.push([i18n.getMessage(<span class="hljs-string">"Instance Options"</span>), editInstance]);
    menu.push([i18n.getMessage(<span class="hljs-string">'Instance in Page Editor'</span>) + <span class="hljs-string">' '</span>, instancePageEdit]);
    menu.push([i18n.getMessage(<span class="hljs-string">'Page in Designer'</span>) + <span class="hljs-string">' '</span>, openDesigner]);
    menu.push(<span class="hljs-literal">null</span>);
    menu.push([i18n.getMessage(<span class="hljs-string">'Edit Container Background'</span>), editBackground]);
    menu.push(<span class="hljs-literal">null</span>);
    menu.push([i18n.getMessage(<span class="hljs-string">'Widget Options Schema'</span>), editOptionSchema]);
    menu.push([i18n.getMessage(<span class="hljs-string">'Widget in Form Modal'</span>), editWidget]);
    menu.push([i18n.getMessage(<span class="hljs-string">'Widget in Editor'</span>) + <span class="hljs-string">' '</span>, openWidgetEditor]);
    menu.push(<span class="hljs-literal">null</span>);
    menu.push([i18n.getMessage(<span class="hljs-string">'Log to console'</span>) + <span class="hljs-string">': $scope.data'</span>, logScopeData]);
    menu.push([i18n.getMessage(<span class="hljs-string">'Log to console'</span>) + <span class="hljs-string">': $scope'</span>, logScope]);
    <span class="hljs-keyword">return</span> menu;
  }

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">logScope</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Widget $scope.data..."</span>, $scope.rectangle.widget);
  }

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">logScopeData</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Widget $scope.data..."</span>, $scope.rectangle.widget.data);
  }

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">editWidget</span>(<span class="hljs-params"></span>) </span>{
    editRecord(<span class="hljs-string">'sp_widget'</span>, $scope.rectangle.widget.sys_id);
  }

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">editInstance</span>(<span class="hljs-params"></span>) </span>{
    editRecord(<span class="hljs-string">'sp_instance'</span>, $scope.rectangle.sys_id);
  }

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">editBackground</span>(<span class="hljs-params"></span>) </span>{
    editRecord(<span class="hljs-string">'sp_container'</span>, $scope.container.sys_id);
  }

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">openDesigner</span>(<span class="hljs-params"></span>) </span>{
    $<span class="hljs-built_in">window</span>.open(<span class="hljs-string">'/$spd.do#/'</span> + $scope.portal.url_suffix + <span class="hljs-string">'/editor/'</span> + $scope.page.id + <span class="hljs-string">'/'</span> + $scope.rectangle.sys_id, <span class="hljs-string">'$spd.do'</span>);
  }

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">openWidgetEditor</span>(<span class="hljs-params"></span>) </span>{
    openConfig({
      <span class="hljs-attr">id</span>: <span class="hljs-string">'widget_editor'</span>,
      <span class="hljs-attr">sys_id</span>: $scope.rectangle.widget.sys_id
    });
  }

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">instancePageEdit</span>(<span class="hljs-params"></span>) </span>{
    openConfig({
      <span class="hljs-attr">id</span>: <span class="hljs-string">'page_edit'</span>,
      <span class="hljs-attr">p</span>: $scope.page.id,
      <span class="hljs-attr">table</span>: <span class="hljs-string">'sp_instance'</span>,
      <span class="hljs-attr">sys_id</span>: $scope.rectangle.sys_id
    });
  }

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">editOptionSchema</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> data = {
      <span class="hljs-attr">embeddedWidgetId</span>: <span class="hljs-string">'we20'</span>,
      <span class="hljs-attr">embeddedWidgetOptions</span>: {
        <span class="hljs-attr">sys_id</span>: $scope.rectangle.widget.sys_id
      }
    };
    spUtil.get(<span class="hljs-string">'widget-modal'</span>, data).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">widget</span>) </span>{
      widget.options.afterClose = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        $scope.rectangle.debugModal = <span class="hljs-literal">null</span>;
        $rootScope.$broadcast(<span class="hljs-string">'sp.page.reload'</span>);
      };
      $scope.rectangle.debugModal = widget;
    });
  }

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">openConfig</span>(<span class="hljs-params">params</span>) </span>{
    $<span class="hljs-built_in">window</span>.open(<span class="hljs-string">'/sp_config?'</span> + $.param(params), <span class="hljs-string">'sp_config'</span>);
  }

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">editRecord</span>(<span class="hljs-params">table, sys_id</span>) </span>{
    <span class="hljs-keyword">var</span> input = {
      <span class="hljs-attr">table</span>: table,
      <span class="hljs-attr">sys_id</span>: sys_id
    };
    spUtil.get(<span class="hljs-string">'widget-options-config'</span>, input).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">widget</span>) </span>{
      <span class="hljs-keyword">var</span> myModalCtrl = <span class="hljs-literal">null</span>;
      widget.options.afterClose = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        $scope.rectangle.debugModal = <span class="hljs-literal">null</span>;
      };
      widget.options.afterOpen = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">modalCtrl</span>) </span>{
        myModalCtrl = modalCtrl;
      };
      $scope.rectangle.debugModal = widget;
      <span class="hljs-keyword">var</span> unregister = $scope.$on(<span class="hljs-string">'sp.form.record.updated'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">evt, fields</span>) </span>{
        unregister();
        unregister = <span class="hljs-literal">null</span>;
        myModalCtrl.close();
        $rootScope.$broadcast(<span class="hljs-string">'sp.page.reload'</span>);
      });
    });
  }
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.$sp/directive.spNavbarToggle.js */</span>
angular.module(<span class="hljs-string">'sn.$sp'</span>).directive(<span class="hljs-string">'spNavbarToggle'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">cabrillo, $timeout</span>) </span>{
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">restrict</span>: <span class="hljs-string">'A'</span>,
    <span class="hljs-attr">link</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$scope, element, attrs</span>) </span>{
      $scope.toggleNavMenu = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        $(element).collapse(<span class="hljs-string">'toggle'</span>);
      }
      <span class="hljs-keyword">if</span> (cabrillo.isNative) {
        cabrillo.viewLayout.setNavigationBarButtons([{
          <span class="hljs-attr">title</span>: <span class="hljs-string">'Menu'</span>
        }], $scope.toggleNavMenu);
      }
    }
  }
});
<span class="hljs-comment">/*! RESOURCE: /scripts/app.$sp/directive.spAttachmentButton.js */</span>
angular.module(<span class="hljs-string">'sn.$sp'</span>).directive(<span class="hljs-string">'spAttachmentButton'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">cabrillo, $rootScope, $timeout</span>) </span>{
<span class="hljs-meta">  'use strict'</span>;
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
    <span class="hljs-attr">template</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">var</span> inputTemplate;
      <span class="hljs-keyword">if</span> (cabrillo.isNative()) {
        inputTemplate = <span class="hljs-string">'&lt;a href="#" id="attachment_add" ng-click="showAttachOptions()" class="panel-button sp-attachment-add"&gt;&lt;span class="glyphicon glyphicon-camera"&gt;&lt;/span&gt;&lt;/a&gt;'</span>;
      } <span class="hljs-keyword">else</span> {
        inputTemplate = <span class="hljs-string">'&lt;input type="file" style="display: none" multiple="true" ng-file-select="attachmentHandler.onFileSelect($files)" class="sp-attachments-input"/&gt;'</span>;
        inputTemplate += <span class="hljs-string">'&lt;a href="javascript:void(0)" id="attachment_add" ng-click="attachmentHandler.openSelector($event)" class="panel-button sp-attachment-add"&gt;&lt;span class="glyphicon glyphicon-paperclip"&gt;&lt;/span&gt;&lt;/a&gt;'</span>;
      }
      <span class="hljs-keyword">return</span> [
        <span class="hljs-string">'&lt;span class="file-upload-input"&gt;'</span>,
        inputTemplate,
        <span class="hljs-string">'&lt;/span&gt;'</span>
      ].join(<span class="hljs-string">''</span>);
    },
    <span class="hljs-attr">controller</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$element, $scope</span>) </span>{
      $scope.attachmentClassNames = <span class="hljs-string">'btn-default attachment-btn btn-primary icon-paperclip icon-camera list-group-btn'</span>;
      $scope.showAttachOptions = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> handler = $scope.attachmentHandler;
        cabrillo.attachments.addFile(
          handler.tableName,
          handler.tableId,
          <span class="hljs-literal">null</span>, {
            <span class="hljs-attr">maxWidth</span>: <span class="hljs-number">1000</span>,
            <span class="hljs-attr">maxHeight</span>: <span class="hljs-number">1000</span>
          }
        ).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>) </span>{
          handler.getAttachmentList();
          $rootScope.$broadcast(<span class="hljs-string">"added_attachment"</span>);
        }, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
          <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Failed to attach new file'</span>);
        });
      };
      $scope.$on(<span class="hljs-string">'attachment_select_files'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
        $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
          $($element).find(<span class="hljs-string">'.sp-attachments-input'</span>).click();
        });
      });
    }
  }
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.$sp/directive.spPageRow.js */</span>
angular.module(<span class="hljs-string">'sn.$sp'</span>).directive(<span class="hljs-string">'spPageRow'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$rootScope, $timeout, $compile</span>) </span>{
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
    <span class="hljs-attr">templateUrl</span>: <span class="hljs-string">'sp_page_row'</span>,
    <span class="hljs-attr">compile</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$tElement</span>) </span>{
      <span class="hljs-keyword">var</span> el = angular.element($tElement[<span class="hljs-number">0</span>]);
      <span class="hljs-keyword">var</span> recursiveNode = el.children(<span class="hljs-string">".sp-row-content"</span>).remove();
      <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">scope, element, attrs</span>) </span>{
        <span class="hljs-keyword">var</span> newNode = recursiveNode.clone();
        element.append(newNode);
        $compile(newNode)(scope);
      };
    },
    <span class="hljs-attr">replace</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">scope</span>: {
      <span class="hljs-attr">columns</span>: <span class="hljs-string">"="</span>,
      <span class="hljs-attr">container</span>: <span class="hljs-string">"="</span>,
      <span class="hljs-attr">row</span>: <span class="hljs-string">'='</span>
    },
    <span class="hljs-attr">controller</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$scope</span>) </span>{}
  }
});
<span class="hljs-comment">/*! RESOURCE: /scripts/app.$sp/directive.spPanel.js */</span>
angular.module(<span class="hljs-string">'sn.$sp'</span>).directive(<span class="hljs-string">'spPanel'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
    <span class="hljs-attr">transclude</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">link</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$scope, $element, $attributes, controller, transcludeFn</span>) </span>{
      $scope.widgetParameters = $scope.widget_parameters || $scope.$parent.widget_parameters || {};
      <span class="hljs-keyword">if</span> (!$scope.options)
        $scope.options = $scope.$<span class="hljs-built_in">eval</span>($attributes.options) || $scope.$parent.options;
      <span class="hljs-keyword">var</span> title;
      <span class="hljs-keyword">try</span> {
        title = $scope.$<span class="hljs-built_in">eval</span>($attributes.title);
      } <span class="hljs-keyword">catch</span> (e) {
        title = $attributes.title
      }
      $scope.title = title || $scope.options.title;
      $scope.bodyClass = $scope.$<span class="hljs-built_in">eval</span>($attributes.bodyClass) || <span class="hljs-string">"panel-body"</span>;
      transcludeFn($scope, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">clone</span>) </span>{
        <span class="hljs-keyword">var</span> container = $element.find(<span class="hljs-string">'div.transclude'</span>);
        container.empty();
        container.append(clone);
      });
    },
    <span class="hljs-attr">template</span>: <span class="hljs-string">'&lt;div class="panel panel-{{options.color}} b"&gt;'</span> +
      <span class="hljs-string">'&lt;div class="panel-heading"&gt; &lt;h4 class="panel-title"&gt;'</span> +
      <span class="hljs-string">'&lt;fa ng-if="options.glyph.length" name="{{options.glyph}}" class="m-r-sm" /&gt;{{title}}&lt;/h4&gt;'</span> +
      <span class="hljs-string">'&lt;/div&gt;'</span> +
      <span class="hljs-string">'&lt;div class="{{bodyClass}} transclude"&gt;&lt;/div&gt;'</span> +
      <span class="hljs-string">'&lt;/div&gt;'</span>
  }
});;
<span class="hljs-comment">/*! RESOURCE: /scripts/app.$sp/directive.spModel.js */</span>
angular.module(<span class="hljs-string">'sn.$sp'</span>).directive(<span class="hljs-string">'spModel'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$timeout, spUtil, glideFormFactory, glideUserSession, catalogItemFactory, glideFormEnvironmentFactory, catalogGlideFormFactory, spUIActionFactory, glideModalFactory, $uibModal,
      spModal, glideListFactory</span>) </span>{
<span class="hljs-meta">      'use strict'</span>;
      <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">restrict</span>: <span class="hljs-string">'E'</span>,
        <span class="hljs-attr">templateUrl</span>: <span class="hljs-string">'sp_model.xml'</span>,
        <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">scope</span>: {
          <span class="hljs-attr">formModel</span>: <span class="hljs-string">"="</span>,
          <span class="hljs-attr">mandatory</span>: <span class="hljs-string">'='</span>,
          <span class="hljs-attr">isInlineForm</span>: <span class="hljs-string">'=?'</span>
        },
        <span class="hljs-attr">controller</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$element, $scope</span>) </span>{
            <span class="hljs-keyword">var</span> g_form;
            <span class="hljs-keyword">var</span> flatFields;
            <span class="hljs-keyword">var</span> isCatalogItem;
            <span class="hljs-keyword">var</span> debounceFieldChange;
            <span class="hljs-keyword">var</span> formModel;
            $scope.$watch(<span class="hljs-string">'formModel'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">newValue</span>) </span>{
              <span class="hljs-keyword">if</span> (angular.isDefined(newValue))
                init();
            });
            $scope.shouldPullRight = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">layout, rightCol</span>) </span>{
              <span class="hljs-keyword">return</span> layout == <span class="hljs-string">"2across"</span> &amp;&amp; rightCol;
            };;

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onChange</span>(<span class="hljs-params">fieldName, oldValue, newValue</span>) </span>{
              <span class="hljs-keyword">if</span> (!(fieldName <span class="hljs-keyword">in</span> formModel._fields))
                <span class="hljs-keyword">return</span>;
              $timeout.cancel(debounceFieldChange[fieldName]);
              debounceFieldChange[fieldName] = $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">var</span> field = formModel._fields[fieldName];
                <span class="hljs-keyword">if</span> (isCatalogItem) {
                  <span class="hljs-keyword">if</span> (field._pricing) {
                    setPrices(field, newValue);
                    setBoolean(field, newValue);
                    calcPrice();
                  }
                }
                populateMandatory();
                <span class="hljs-keyword">var</span> p = {
                  <span class="hljs-attr">field</span>: field,
                  <span class="hljs-attr">oldValue</span>: oldValue,
                  <span class="hljs-attr">newValue</span>: newValue
                };
                $scope.$emit(<span class="hljs-string">"field.change"</span>, p);
                $scope.$emit(<span class="hljs-string">"field.change."</span> + field.name, p);
              });
            }

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">populateMandatory</span>(<span class="hljs-params"></span>) </span>{
              <span class="hljs-keyword">var</span> mandatory = [];
              <span class="hljs-keyword">var</span> field;
              <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> f <span class="hljs-keyword">in</span> flatFields) {
                field = flatFields[f];
                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> field.mandatory_filled == <span class="hljs-string">'undefined'</span>)
                  <span class="hljs-keyword">continue</span>;
                <span class="hljs-keyword">if</span> (field.mandatory_filled())
                  <span class="hljs-keyword">continue</span>;
                <span class="hljs-keyword">if</span> (field.visible &amp;&amp; field.isMandatory())
                  mandatory.push(field);
              }
              $scope.mandatory = mandatory;
              $scope.$emit(<span class="hljs-string">"variable.mandatory.change"</span>);
            }

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">uiMessageHandler</span>(<span class="hljs-params">g_form, type, message</span>) </span>{
              <span class="hljs-keyword">switch</span> (type) {
                <span class="hljs-keyword">case</span> <span class="hljs-string">'infoMessage'</span>:
                  spUtil.addInfoMessage(message);
                  <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-string">'errorMessage'</span>:
                  spUtil.addErrorMessage(message);
                  <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-string">'clearMessages'</span>:
                  <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">default</span>:
                  <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
              }
            }

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getFlatFieldsFromView</span>(<span class="hljs-params">formModel</span>) </span>{
              <span class="hljs-keyword">var</span> fields = [],
                field;
              <span class="hljs-keyword">var</span> sections = formModel._sections;
              <span class="hljs-keyword">if</span> (sections != <span class="hljs-literal">null</span>) {
                <span class="hljs-keyword">try</span> {
                  <span class="hljs-keyword">var</span> section, col, container, contField;
                  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> s <span class="hljs-keyword">in</span> sections) {
                    section = sections[s];
                    <span class="hljs-keyword">if</span> (hasVariablePrefix(section.id))
                      fields.push(formModel._fields[section.id]);
                    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> c <span class="hljs-keyword">in</span> section.columns) {
                      col = section.columns[c];
                      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> f <span class="hljs-keyword">in</span> col.fields) {
                        field = col.fields[f];
                        <span class="hljs-keyword">if</span> (formModel._fields[field.name])
                          fields.push(formModel._fields[field.name]);
                        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> c <span class="hljs-keyword">in</span> field.containers) {
                          container = field.containers[c];
                          <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> cont <span class="hljs-keyword">in</span> container.fields) {
                            contField = container.fields[cont];
                            <span class="hljs-keyword">if</span> (formModel._fields[contField.name])
                              fields.push(formModel._fields[contField.name]);
                          }
                        }
                      }
                    }
                  }
                } <span class="hljs-keyword">catch</span> (e) {
                  <span class="hljs-built_in">console</span>.error(<span class="hljs-string">'spModel.getFlatFieldsFromView() - Error getting fields from _sections -&gt; columns -&gt; fields.'</span>, e, formModel);
                }
              } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> f <span class="hljs-keyword">in</span> formModel._view) {
                  field = formModel._view[f];
                  <span class="hljs-keyword">if</span> (formModel._fields[field.name])
                    fields.push(formModel._fields[field.name]);
                }
              }
              <span class="hljs-keyword">return</span> fields;
            }

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">hasCatalogVariable</span>(<span class="hljs-params">flatFields</span>) </span>{
              <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> f <span class="hljs-keyword">in</span> flatFields) {
                <span class="hljs-keyword">if</span> (flatFields[f].hasOwnProperty(<span class="hljs-string">'_cat_variable'</span>))
                  <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
              }
              <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
            }

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">calcPrice</span>(<span class="hljs-params"></span>) </span>{
              <span class="hljs-keyword">var</span> price = <span class="hljs-number">0</span>;
              <span class="hljs-keyword">var</span> recurring_price = <span class="hljs-number">0</span>;
              angular.forEach(formModel._fields, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">field</span>) </span>{
                <span class="hljs-keyword">if</span> (field.price)
                  price += <span class="hljs-built_in">Number</span>(field.price);
                <span class="hljs-keyword">if</span> (field.recurring_price)
                  recurring_price += <span class="hljs-built_in">Number</span>(field.recurring_price);
              });
              <span class="hljs-keyword">var</span> o = {
                <span class="hljs-attr">price</span>: price,
                <span class="hljs-attr">recurring_price</span>: recurring_price
              };
              $scope.$emit(<span class="hljs-string">"variable.price.change"</span>, o);
            }

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setBoolean</span>(<span class="hljs-params">field, value</span>) </span>{
              <span class="hljs-keyword">if</span> (field.type != <span class="hljs-string">'boolean'</span>)
                <span class="hljs-keyword">return</span>;
              <span class="hljs-keyword">if</span> (value == <span class="hljs-literal">true</span> || value == <span class="hljs-string">'true'</span>) {
                field.price = field._pricing.price_if_checked;
                field.recurring_price = field._pricing.rec_price_if_checked;
              } <span class="hljs-keyword">else</span>
                field.price = field.recurring_price = <span class="hljs-number">0</span>;
            }

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setPrices</span>(<span class="hljs-params">field, v
</span></span></pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
